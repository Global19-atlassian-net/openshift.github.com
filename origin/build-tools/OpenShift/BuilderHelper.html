<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: OpenShift::BuilderHelper
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (B)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../OpenShift.html" title="OpenShift (module)">OpenShift</a></span></span>
     &raquo; 
    <span class="title">BuilderHelper</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: OpenShift::BuilderHelper
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
      <dt class="r1">Includes:</dt>
      <dd class="r1"><span class='object_link'><a href="Amazon.html" title="OpenShift::Amazon (module)">Amazon</a></span>, <span class='object_link'><a href="SSH.html" title="OpenShift::SSH (module)">SSH</a></span>, <span class='object_link'><a href="Tito.html" title="OpenShift::Tito (module)">Tito</a></span>, Thor::Actions</dd>
      
    
  
  
    <dt class="r2">Included in:</dt>
    <dd class="r2"><span class='object_link'><a href="Builder.html" title="OpenShift::Builder (class)">Builder</a></span>, <span class='object_link'><a href="../Origin/BuilderPlugin.html" title="Origin::BuilderPlugin (class)">Origin::BuilderPlugin</a></span></dd>
    
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">origin-dev-tools/build/lib/openshift/builder_helper.rb</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="SSH_TIMEOUT-classvariable" class="">@@SSH_TIMEOUT =
          
        </dt>
        <dd><pre class="code"><span class='integer val'>4800</span>
</pre></dd>
      
        <dt id="SSH_TIMEOUT_OVERRIDES-classvariable" class="">@@SSH_TIMEOUT_OVERRIDES =
          
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span> <span class='string val'>&quot;benchmark&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>172800</span> <span class='rbrace token'>}</span>
</pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="SSH.html" title="OpenShift::SSH (module)">SSH</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="SSH.html#SCP_CMD-constant" title="OpenShift::SSH::SCP_CMD (constant)">SSH::SCP_CMD</a></span>, <span class='object_link'><a href="SSH.html#SSH_CMD-constant" title="OpenShift::SSH::SSH_CMD (constant)">SSH::SSH_CMD</a></span></p>





  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_ssh_cmd_to_threads-instance_method" title="#add_ssh_cmd_to_threads (instance method)">- (Object) <strong>add_ssh_cmd_to_threads</strong>(hostname, threads, failures, titles, cmds, retry_individually = false, timeouts = @@SSH_TIMEOUT, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_and_install-instance_method" title="#build_and_install (instance method)">- (Object) <strong>build_and_install</strong>(package_name, build_dir, spec_file, options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#devenv_base_branch_wildcard-instance_method" title="#devenv_base_branch_wildcard (instance method)">- (Object) <strong>devenv_base_branch_wildcard</strong>(branch) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#devenv_branch_wildcard-instance_method" title="#devenv_branch_wildcard (instance method)">- (Object) <strong>devenv_branch_wildcard</strong>(branch) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_host_by_name_or_tag-instance_method" title="#get_host_by_name_or_tag (instance method)">- (Object) <strong>get_host_by_name_or_tag</strong>(name, options = nil, user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Get the hostname from a tag lookup or assume it&#8217;s SSH accessible
directly Only look for a tag if the --tag option is specified.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ignore_packages-instance_method" title="#get_ignore_packages (instance method)">- (Object) <strong>get_ignore_packages</strong>(include_unmodified = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_required_packages-instance_method" title="#get_required_packages (instance method)">- (Object) <strong>get_required_packages</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_sorted_package_names-instance_method" title="#get_sorted_package_names (instance method)">- (Object) <strong>get_sorted_package_names</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#init_repos-instance_method" title="#init_repos (instance method)">- (Object) <strong>init_repos</strong>(hostname, replace = true, repo = nil, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mcollective_logs-instance_method" title="#mcollective_logs (instance method)">- (Object) <strong>mcollective_logs</strong>(hostname) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_and_exit-instance_method" title="#print_and_exit (instance method)">- (Object) <strong>print_and_exit</strong>(ret, out) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_highlighted_output-instance_method" title="#print_highlighted_output (instance method)">- (Object) <strong>print_highlighted_output</strong>(title, out) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reboot-instance_method" title="#reboot (instance method)">- (Object) <strong>reboot</strong>(instance) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#repo_clone_commands-instance_method" title="#repo_clone_commands (instance method)">- (Object) <strong>repo_clone_commands</strong>(hostname) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#repo_path-instance_method" title="#repo_path (instance method)">- (Object) <strong>repo_path</strong>(dir = '') </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_temp_commit-instance_method" title="#reset_temp_commit (instance method)">- (Object) <strong>reset_temp_commit</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_test_dir-instance_method" title="#reset_test_dir (instance method)">- (Object) <strong>reset_test_dir</strong>(hostname, backup = false, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#retry_test_failures-instance_method" title="#retry_test_failures (instance method)">- (Object) <strong>retry_test_failures</strong>(hostname, failures, num_retries = 1, timeout = @@SSH_TIMEOUT, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run_ssh-instance_method" title="#run_ssh (instance method)">- (Object) <strong>run_ssh</strong>(hostname, title, cmd, timeout = @@SSH_TIMEOUT, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#scp_remote_tests-instance_method" title="#scp_remote_tests (instance method)">- (Object) <strong>scp_remote_tests</strong>(hostname, repo_parent_dir = &quot;/root&quot;, user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sync_available_sibling_repos-instance_method" title="#sync_available_sibling_repos (instance method)">- (Object) <strong>sync_available_sibling_repos</strong>(hostname, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
clones origin-server/rhc over to remote; returns command to run remotely
for cloning to standard working dirs, plus the names of those working dirs.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sync_repo-instance_method" title="#sync_repo (instance method)">- (Object) <strong>sync_repo</strong>(repo_name, hostname, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;, verbose = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sync_repos-instance_method" title="#sync_repos (instance method)">- (Object) <strong>sync_repos</strong>(hostname, remote_repo_parent_dir = &quot;/root&quot;, sshuser = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sync_sibling_repo-instance_method" title="#sync_sibling_repo (instance method)">- (Object) <strong>sync_sibling_repo</strong>(repo_name, repo_dir, hostname, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#temp_commit-instance_method" title="#temp_commit (instance method)">- (Object) <strong>temp_commit</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_api_file-instance_method" title="#update_api_file (instance method)">- (Object) <strong>update_api_file</strong>(instance) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_express_server-instance_method" title="#update_express_server (instance method)">- (Object) <strong>update_express_server</strong>(instance) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_remote_tests-instance_method" title="#update_remote_tests (instance method)">- (Object) <strong>update_remote_tests</strong>(hostname, branch = nil, repo_parent_dir = &quot;/root&quot;, user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_ssh_config_verifier-instance_method" title="#update_ssh_config_verifier (instance method)">- (Object) <strong>update_ssh_config_verifier</strong>(instance) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_test_bundle-instance_method" title="#update_test_bundle (instance method)">- (Object) <strong>update_test_bundle</strong>(hostname, user, *dirs) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Amazon.html" title="OpenShift::Amazon (module)">Amazon</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Amazon.html#add_tag-instance_method" title="OpenShift::Amazon#add_tag (method)">#add_tag</a></span>, <span class='object_link'><a href="Amazon.html#block_until_available-instance_method" title="OpenShift::Amazon#block_until_available (method)">#block_until_available</a></span>, <span class='object_link'><a href="Amazon.html#check_update-instance_method" title="OpenShift::Amazon#check_update (method)">#check_update</a></span>, <span class='object_link'><a href="Amazon.html#connect-instance_method" title="OpenShift::Amazon#connect (method)">#connect</a></span>, <span class='object_link'><a href="Amazon.html#delete_detached_volumes-instance_method" title="OpenShift::Amazon#delete_detached_volumes (method)">#delete_detached_volumes</a></span>, <span class='object_link'><a href="Amazon.html#delete_unused_snapshots-instance_method" title="OpenShift::Amazon#delete_unused_snapshots (method)">#delete_unused_snapshots</a></span>, <span class='object_link'><a href="Amazon.html#find_instance-instance_method" title="OpenShift::Amazon#find_instance (method)">#find_instance</a></span>, <span class='object_link'><a href="Amazon.html#flag_old_devenvs-instance_method" title="OpenShift::Amazon#flag_old_devenvs (method)">#flag_old_devenvs</a></span>, <span class='object_link'><a href="Amazon.html#flag_old_qe_devenvs-instance_method" title="OpenShift::Amazon#flag_old_qe_devenvs (method)">#flag_old_qe_devenvs</a></span>, <span class='object_link'><a href="Amazon.html#get_amis-instance_method" title="OpenShift::Amazon#get_amis (method)">#get_amis</a></span>, <span class='object_link'><a href="Amazon.html#get_internal_hostname-instance_method" title="OpenShift::Amazon#get_internal_hostname (method)">#get_internal_hostname</a></span>, <span class='object_link'><a href="Amazon.html#get_latest_ami-instance_method" title="OpenShift::Amazon#get_latest_ami (method)">#get_latest_ami</a></span>, <span class='object_link'><a href="Amazon.html#get_private_ip-instance_method" title="OpenShift::Amazon#get_private_ip (method)">#get_private_ip</a></span>, <span class='object_link'><a href="Amazon.html#get_specific_ami-instance_method" title="OpenShift::Amazon#get_specific_ami (method)">#get_specific_ami</a></span>, <span class='object_link'><a href="Amazon.html#get_specific_public_ami-instance_method" title="OpenShift::Amazon#get_specific_public_ami (method)">#get_specific_public_ami</a></span>, <span class='object_link'><a href="Amazon.html#instance_status-instance_method" title="OpenShift::Amazon#instance_status (method)">#instance_status</a></span>, <span class='object_link'><a href="Amazon.html#is_valid%3F-instance_method" title="OpenShift::Amazon#is_valid? (method)">#is_valid?</a></span>, <span class='object_link'><a href="Amazon.html#launch_instance-instance_method" title="OpenShift::Amazon#launch_instance (method)">#launch_instance</a></span>, <span class='object_link'><a href="Amazon.html#register_image-instance_method" title="OpenShift::Amazon#register_image (method)">#register_image</a></span>, <span class='object_link'><a href="Amazon.html#set_instance_ip-instance_method" title="OpenShift::Amazon#set_instance_ip (method)">#set_instance_ip</a></span>, <span class='object_link'><a href="Amazon.html#setup_rsa_key-instance_method" title="OpenShift::Amazon#setup_rsa_key (method)">#setup_rsa_key</a></span>, <span class='object_link'><a href="Amazon.html#stop_untagged_instances-instance_method" title="OpenShift::Amazon#stop_untagged_instances (method)">#stop_untagged_instances</a></span>, <span class='object_link'><a href="Amazon.html#tag_to_terminate-instance_method" title="OpenShift::Amazon#tag_to_terminate (method)">#tag_to_terminate</a></span>, <span class='object_link'><a href="Amazon.html#terminate_flagged_instances-instance_method" title="OpenShift::Amazon#terminate_flagged_instances (method)">#terminate_flagged_instances</a></span>, <span class='object_link'><a href="Amazon.html#terminate_instance-instance_method" title="OpenShift::Amazon#terminate_instance (method)">#terminate_instance</a></span>, <span class='object_link'><a href="Amazon.html#terminate_old_verifiers-instance_method" title="OpenShift::Amazon#terminate_old_verifiers (method)">#terminate_old_verifiers</a></span>, <span class='object_link'><a href="Amazon.html#update_facts-instance_method" title="OpenShift::Amazon#update_facts (method)">#update_facts</a></span>, <span class='object_link'><a href="Amazon.html#use_private_ip-instance_method" title="OpenShift::Amazon#use_private_ip (method)">#use_private_ip</a></span>, <span class='object_link'><a href="Amazon.html#use_public_ip-instance_method" title="OpenShift::Amazon#use_public_ip (method)">#use_public_ip</a></span>, <span class='object_link'><a href="Amazon.html#verify_image-instance_method" title="OpenShift::Amazon#verify_image (method)">#verify_image</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="SSH.html" title="OpenShift::SSH (module)">SSH</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="SSH.html#can_ssh%3F-instance_method" title="OpenShift::SSH#can_ssh? (method)">#can_ssh?</a></span>, <span class='object_link'><a href="SSH.html#scp_from-instance_method" title="OpenShift::SSH#scp_from (method)">#scp_from</a></span>, <span class='object_link'><a href="SSH.html#scp_to-instance_method" title="OpenShift::SSH#scp_to (method)">#scp_to</a></span>, <span class='object_link'><a href="SSH.html#ssh-instance_method" title="OpenShift::SSH#ssh (method)">#ssh</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Tito.html" title="OpenShift::Tito (module)">Tito</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Tito.html#get_build_dirs-instance_method" title="OpenShift::Tito#get_build_dirs (method)">#get_build_dirs</a></span>, <span class='object_link'><a href="Tito.html#get_packages-instance_method" title="OpenShift::Tito#get_packages (method)">#get_packages</a></span>, <span class='object_link'><a href="Tito.html#get_stale_dirs-instance_method" title="OpenShift::Tito#get_stale_dirs (method)">#get_stale_dirs</a></span>, <span class='object_link'><a href="Tito.html#get_sync_dirs-instance_method" title="OpenShift::Tito#get_sync_dirs (method)">#get_sync_dirs</a></span>, <span class='object_link'><a href="Tito.html#get_version-instance_method" title="OpenShift::Tito#get_version (method)">#get_version</a></span>, <span class='object_link'><a href="Tito.html#get_yum_version-instance_method" title="OpenShift::Tito#get_yum_version (method)">#get_yum_version</a></span>, <span class='object_link'><a href="Tito.html#next_minor_version-instance_method" title="OpenShift::Tito#next_minor_version (method)">#next_minor_version</a></span>, <span class='object_link'><a href="Tito.html#next_patch_version-instance_method" title="OpenShift::Tito#next_patch_version (method)">#next_patch_version</a></span>, <span class='object_link'><a href="Tito.html#next_tito_version-instance_method" title="OpenShift::Tito#next_tito_version (method)">#next_tito_version</a></span>, <span class='object_link'><a href="Tito.html#update_gemfile_version-instance_method" title="OpenShift::Tito#update_gemfile_version (method)">#update_gemfile_version</a></span>, <span class='object_link'><a href="Tito.html#update_sync_history-instance_method" title="OpenShift::Tito#update_sync_history (method)">#update_sync_history</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_ssh_cmd_to_threads-instance_method">
  
    - (<tt>Object</tt>) <strong>add_ssh_cmd_to_threads</strong>(hostname, threads, failures, titles, cmds, retry_individually = false, timeouts = @@SSH_TIMEOUT, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 422</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_add_ssh_cmd_to_threads identifier id'>add_ssh_cmd_to_threads</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_threads identifier id'>threads</span><span class='comma token'>,</span> <span class='rubyid_failures identifier id'>failures</span><span class='comma token'>,</span> <span class='rubyid_titles identifier id'>titles</span><span class='comma token'>,</span> <span class='rubyid_cmds identifier id'>cmds</span><span class='comma token'>,</span> <span class='rubyid_retry_individually identifier id'>retry_individually</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='rubyid_timeouts identifier id'>timeouts</span><span class='assign token'>=</span><span class='rubyid_@@SSH_TIMEOUT ivar id'>@@SSH_TIMEOUT</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_titles identifier id'>titles</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_titles identifier id'>titles</span><span class='rbrack token'>]</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_titles identifier id'>titles</span><span class='dot token'>.</span><span class='rubyid_kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span>
  <span class='rubyid_cmds identifier id'>cmds</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_cmds identifier id'>cmds</span><span class='rbrack token'>]</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_cmds identifier id'>cmds</span><span class='dot token'>.</span><span class='rubyid_kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span>
  <span class='rubyid_retry_individually identifier id'>retry_individually</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_retry_individually identifier id'>retry_individually</span><span class='rbrack token'>]</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_retry_individually identifier id'>retry_individually</span><span class='dot token'>.</span><span class='rubyid_kind_of? fid id'>kind_of?</span> <span class='rubyid_Array constant id'>Array</span>
  <span class='rubyid_timeouts identifier id'>timeouts</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_timeouts identifier id'>timeouts</span><span class='rbrack token'>]</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_timeouts identifier id'>timeouts</span><span class='dot token'>.</span><span class='rubyid_kind_of? fid id'>kind_of?</span> <span class='rubyid_Array constant id'>Array</span>
  <span class='rubyid_start_time identifier id'>start_time</span> <span class='assign token'>=</span> <span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_threads identifier id'>threads</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span> <span class='rubyid_Thread constant id'>Thread</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='lbrace token'>{</span>
    <span class='rubyid_multi identifier id'>multi</span> <span class='assign token'>=</span> <span class='rubyid_cmds identifier id'>cmds</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
    <span class='rubyid_cmds identifier id'>cmds</span><span class='dot token'>.</span><span class='rubyid_each_with_index identifier id'>each_with_index</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_index identifier id'>index</span><span class='bitor op'>|</span>
      <span class='rubyid_title identifier id'>title</span> <span class='assign token'>=</span> <span class='rubyid_titles identifier id'>titles</span><span class='lbrack token'>[</span><span class='rubyid_index identifier id'>index</span><span class='rbrack token'>]</span>
      <span class='rubyid_retry_individ identifier id'>retry_individ</span> <span class='assign token'>=</span> <span class='rubyid_retry_individually identifier id'>retry_individually</span><span class='lbrack token'>[</span><span class='rubyid_index identifier id'>index</span><span class='rbrack token'>]</span>
      <span class='rubyid_timeout identifier id'>timeout</span> <span class='assign token'>=</span> <span class='rubyid_timeouts identifier id'>timeouts</span><span class='lbrack token'>[</span><span class='rubyid_index identifier id'>index</span><span class='rbrack token'>]</span>
      <span class='rubyid_output identifier id'>output</span><span class='comma token'>,</span> <span class='rubyid_exit_code identifier id'>exit_code</span> <span class='assign token'>=</span> <span class='rubyid_run_ssh identifier id'>run_ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_title identifier id'>title</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_exit_code identifier id'>exit_code</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_output identifier id'>output</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;Failing Scenarios:&quot;</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_output identifier id'>output</span> <span class='match op'>=~</span> <span class='regexp val'>/cucumber openshift-test\/tests\/.*\.feature:\d+/</span>
          <span class='rubyid_output identifier id'>output</span><span class='dot token'>.</span><span class='rubyid_lines identifier id'>lines</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_line identifier id'>line</span><span class='bitor op'>|</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_line identifier id'>line</span> <span class='match op'>=~</span> <span class='regexp val'>/cucumber openshift-test\/tests\/(.*\.feature):(\d+)/</span>
              <span class='rubyid_test identifier id'>test</span> <span class='assign token'>=</span> <span class='rubyid_$1 nth_ref id'>$1</span>
              <span class='rubyid_scenario identifier id'>scenario</span> <span class='assign token'>=</span> <span class='rubyid_$2 nth_ref id'>$2</span>
              <span class='rubyid_if if kw'>if</span> <span class='rubyid_retry_individ identifier id'>retry_individ</span>
                <span class='rubyid_failures identifier id'>failures</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{title} (#{test}:#{scenario})&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;su -c \&quot;cucumber #{CUCUMBER_OPTIONS} openshift-test/tests/#{test}:#{scenario}\&quot;&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='rubyid_else else kw'>else</span>
                <span class='rubyid_failures identifier id'>failures</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{title} (#{test})&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;su -c \&quot;cucumber #{CUCUMBER_OPTIONS} openshift-test/tests/#{test}\&quot;&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='rubyid_end end kw'>end</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_retry_individ identifier id'>retry_individ</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_output identifier id'>output</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;Failure:&quot;</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_output identifier id'>output</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;rake_test_loader&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_found_test identifier id'>found_test</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
          <span class='rubyid_output identifier id'>output</span><span class='dot token'>.</span><span class='rubyid_lines identifier id'>lines</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_line identifier id'>line</span><span class='bitor op'>|</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_line identifier id'>line</span> <span class='match op'>=~</span> <span class='regexp val'>/\A(test_\w+)\((\w+Test)\) \[\/.*\/(test\/.*_test\.rb):(\d+)\]:/</span>
              <span class='rubyid_found_test identifier id'>found_test</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
              <span class='rubyid_test_name identifier id'>test_name</span> <span class='assign token'>=</span> <span class='rubyid_$1 nth_ref id'>$1</span>
              <span class='rubyid_class_name identifier id'>class_name</span> <span class='assign token'>=</span> <span class='rubyid_$2 nth_ref id'>$2</span>
              <span class='rubyid_file_name identifier id'>file_name</span> <span class='assign token'>=</span> <span class='rubyid_$3 nth_ref id'>$3</span>

              <span class='comment val'># determine if the first part of the command is a directory change</span>
              <span class='comment val'># if so, include that in the retry command</span>
              <span class='rubyid_chdir_command identifier id'>chdir_command</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
              <span class='rubyid_if if kw'>if</span> <span class='rubyid_cmd identifier id'>cmd</span> <span class='match op'>=~</span> <span class='regexp val'>/\A(cd .+?; )/</span>
                <span class='rubyid_chdir_command identifier id'>chdir_command</span> <span class='assign token'>=</span> <span class='rubyid_$1 nth_ref id'>$1</span>
              <span class='rubyid_end end kw'>end</span>
              <span class='rubyid_failures identifier id'>failures</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{class_name} (#{test_name})&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{chdir_command} ruby -Ilib:test #{file_name} -n #{test_name}&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_failures identifier id'>failures</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='rubyid_title identifier id'>title</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_found_test identifier id'>found_test</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_failures identifier id'>failures</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='rubyid_title identifier id'>title</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_still_running_tests identifier id'>still_running_tests</span> <span class='assign token'>=</span> <span class='string val'>''</span>
      <span class='rubyid_threads identifier id'>threads</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span>
        <span class='rubyid_t identifier id'>t</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_title identifier id'>title</span><span class='rparen token'>)</span>
        <span class='rubyid_still_running_tests identifier id'>still_running_tests</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;   #{t[1].pretty_inspect}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_t identifier id'>t</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_still_running_tests identifier id'>still_running_tests</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='rubyid_mins identifier id'>mins</span><span class='comma token'>,</span> <span class='rubyid_secs identifier id'>secs</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='minus op'>-</span> <span class='rubyid_start_time identifier id'>start_time</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_abs identifier id'>abs</span><span class='dot token'>.</span><span class='rubyid_divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='integer val'>60</span><span class='rparen token'>)</span>
        <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Still Running Tests (#{mins}m #{secs.to_i}s):&quot;</span>
        <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_still_running_tests identifier id'>still_running_tests</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='rubyid_Array constant id'>Array</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_titles identifier id'>titles</span><span class='rparen token'>)</span> <span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_and_install-instance_method">
  
    - (<tt>Object</tt>) <strong>build_and_install</strong>(package_name, build_dir, spec_file, options) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 38</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_build_and_install identifier id'>build_and_install</span><span class='lparen token'>(</span><span class='rubyid_package_name identifier id'>package_name</span><span class='comma token'>,</span> <span class='rubyid_build_dir identifier id'>build_dir</span><span class='comma token'>,</span> <span class='rubyid_spec_file identifier id'>spec_file</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_remove_dir identifier id'>remove_dir</span> <span class='string val'>'/tmp/tito/'</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span> <span class='string val'>'/tmp/tito/'</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Building in #{build_dir}&quot;</span>
  <span class='rubyid_spec_file identifier id'>spec_file</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='rubyid_spec_file identifier id'>spec_file</span><span class='rparen token'>)</span>
  <span class='rubyid_inside identifier id'>inside</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{build_dir}&quot;</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid___FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='comment val'># Build and install the RPM's locally</span>
    <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='string val'>&quot;tito build --rpm --test&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_verbose? fid id'>verbose?</span><span class='rparen token'>)</span>
      <span class='rubyid_package identifier id'>package</span> <span class='assign token'>=</span> <span class='rubyid_Package constant id'>Package</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_spec_file identifier id'>spec_file</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_spec_file identifier id'>spec_file</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='rubyid_package_name identifier id'>package_name</span> <span class='assign token'>=</span> <span class='rubyid_package identifier id'>package</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span>
      <span class='rubyid_ignore_packages identifier id'>ignore_packages</span> <span class='assign token'>=</span> <span class='rubyid_get_ignore_packages identifier id'>get_ignore_packages</span>
      <span class='rubyid_packages identifier id'>packages</span> <span class='assign token'>=</span> <span class='rubyid_get_packages identifier id'>get_packages</span>
      <span class='rubyid_required_packages_str identifier id'>required_packages_str</span> <span class='assign token'>=</span> <span class='string val'>''</span>
      <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_ignore_packages identifier id'>ignore_packages</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_package_name identifier id'>package_name</span><span class='rparen token'>)</span>
        <span class='rubyid_package identifier id'>package</span><span class='dot token'>.</span><span class='rubyid_build_requires identifier id'>build_requires</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_r_package identifier id'>r_package</span><span class='bitor op'>|</span>
          <span class='rubyid_required_packages_str identifier id'>required_packages_str</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; \\\&quot;#{r_package.yum_name_with_version}\\\&quot;&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_packages identifier id'>packages</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_r_package identifier id'>r_package</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='dstring node'>&quot;su -c \&quot;yum install -y --skip-broken #{required_packages_str} 2&gt;&amp;1\&quot;&quot;</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_required_packages_str identifier id'>required_packages_str</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_required_packages_str identifier id'>required_packages_str</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> <span class='orop op'>||</span> <span class='notop op'>!</span><span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='string val'>&quot;tito build --rpm --test&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_verbose? fid id'>verbose?</span><span class='rparen token'>)</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_retry_failure_with_tag identifier id'>retry_failure_with_tag</span>
          <span class='comment val'># Tag to trick tito to build</span>
          <span class='rubyid_commit_id identifier id'>commit_id</span> <span class='assign token'>=</span> <span class='xstring val'>`git log --pretty=format:%%H --max-count=1 %s&quot; % .`</span>
          <span class='rubyid_spec_file_name identifier id'>spec_file_name</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_basename identifier id'>basename</span><span class='lparen token'>(</span><span class='rubyid_spec_file identifier id'>spec_file</span><span class='rparen token'>)</span>
          <span class='rubyid_version identifier id'>version</span> <span class='assign token'>=</span> <span class='rubyid_get_version identifier id'>get_version</span><span class='lparen token'>(</span><span class='rubyid_spec_file_name identifier id'>spec_file_name</span><span class='rparen token'>)</span>
          <span class='rubyid_next_version identifier id'>next_version</span> <span class='assign token'>=</span> <span class='rubyid_next_tito_version identifier id'>next_tito_version</span><span class='lparen token'>(</span><span class='rubyid_version identifier id'>version</span><span class='comma token'>,</span> <span class='rubyid_commit_id identifier id'>commit_id</span><span class='rparen token'>)</span>
          <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;current spec file version #{version} next version #{next_version}&quot;</span>
          <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='dstring node'>&quot;tito tag --accept-auto-changelog --use-version='#{next_version}'; tito build --rpm --test&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_verbose? fid id'>verbose?</span><span class='rparen token'>)</span>
            <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_rm_rf identifier id'>rm_rf</span> <span class='string val'>'/tmp/devenv/sync/'</span>
            <span class='rubyid_exit identifier id'>exit</span> <span class='integer val'>1</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Package #{package_name} failed to build.&quot;</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_Dir constant id'>Dir</span><span class='dot token'>.</span><span class='rubyid_glob identifier id'>glob</span><span class='lparen token'>(</span><span class='string val'>'/tmp/tito/x86_64/*.rpm'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_file identifier id'>file</span><span class='bitor op'>|</span>
      <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span> <span class='string val'>&quot;/tmp/tito/noarch/&quot;</span>
      <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mv identifier id'>mv</span> <span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span> <span class='string val'>&quot;/tmp/tito/noarch/&quot;</span>
    <span class='rbrace token'>}</span>
    <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='string val'>&quot;rpm -Uvh --force /tmp/tito/noarch/*.rpm&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_verbose? fid id'>verbose?</span><span class='rparen token'>)</span>
      <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='dstring node'>&quot;rpm -e --justdb --nodeps #{package_name}; yum install -y /tmp/tito/noarch/*.rpm&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_verbose? fid id'>verbose?</span><span class='rparen token'>)</span>
        <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_rm_rf identifier id'>rm_rf</span> <span class='string val'>'/tmp/devenv/sync/'</span>
        <span class='rubyid_exit identifier id'>exit</span> <span class='integer val'>1</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_build_dir identifier id'>build_dir</span> <span class='match op'>=~</span> <span class='regexp val'>/\/cartridges\/openshift-origin-cartridge-(.*)/</span> <span class='orop op'>||</span> <span class='rubyid_build_dir identifier id'>build_dir</span> <span class='match op'>=~</span> <span class='regexp val'>/\/cartridges\/(.*)/</span>
      <span class='rubyid_short_cart_name identifier id'>short_cart_name</span> <span class='assign token'>=</span> <span class='rubyid_$1 nth_ref id'>$1</span>
      <span class='rubyid_cart_install_dir identifier id'>cart_install_dir</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;/usr/libexec/openshift/cartridges/v2/#{short_cart_name}&quot;</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span> <span class='rubyid_cart_install_dir identifier id'>cart_install_dir</span>
        <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='dstring node'>&quot;oo-admin-cartridge --action install --source #{cart_install_dir}&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_verbose? fid id'>verbose?</span><span class='rparen token'>)</span>
          <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_rm_rf identifier id'>rm_rf</span> <span class='string val'>'/tmp/devenv/sync/'</span>
          <span class='rubyid_exit identifier id'>exit</span> <span class='integer val'>1</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="devenv_base_branch_wildcard-instance_method">
  
    - (<tt>Object</tt>) <strong>devenv_base_branch_wildcard</strong>(branch) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


560
561
562
563
564
565
566
567
568</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 560</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_devenv_base_branch_wildcard identifier id'>devenv_base_branch_wildcard</span><span class='lparen token'>(</span><span class='rubyid_branch identifier id'>branch</span><span class='rparen token'>)</span>
  <span class='rubyid_wildcard identifier id'>wildcard</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_branch identifier id'>branch</span> <span class='eq op'>==</span> <span class='string val'>'master'</span>
    <span class='rubyid_wildcard identifier id'>wildcard</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{DEVENV_NAME}-base_*&quot;</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_wildcard identifier id'>wildcard</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{DEVENV_NAME}-#{branch}-base_*&quot;</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_wildcard identifier id'>wildcard</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="devenv_branch_wildcard-instance_method">
  
    - (<tt>Object</tt>) <strong>devenv_branch_wildcard</strong>(branch) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


550
551
552
553
554
555
556
557
558</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 550</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_devenv_branch_wildcard identifier id'>devenv_branch_wildcard</span><span class='lparen token'>(</span><span class='rubyid_branch identifier id'>branch</span><span class='rparen token'>)</span>
  <span class='rubyid_wildcard identifier id'>wildcard</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_branch identifier id'>branch</span> <span class='eq op'>==</span> <span class='string val'>'master'</span>
    <span class='rubyid_wildcard identifier id'>wildcard</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{DEVENV_NAME}_*&quot;</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_wildcard identifier id'>wildcard</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{DEVENV_NAME}-#{branch}_*&quot;</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_wildcard identifier id'>wildcard</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_host_by_name_or_tag-instance_method">
  
    - (<tt>Object</tt>) <strong>get_host_by_name_or_tag</strong>(name, options = nil, user = &quot;root&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Get the hostname from a tag lookup or assume it&#8217;s SSH accessible
directly Only look for a tag if the --tag option is specified
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 26</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_host_by_name_or_tag identifier id'>get_host_by_name_or_tag</span><span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_options identifier id'>options</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_name identifier id'>name</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_options identifier id'>options</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_tag? fid id'>tag?</span>
  
  <span class='rubyid_instance identifier id'>instance</span> <span class='assign token'>=</span> <span class='rubyid_find_instance identifier id'>find_instance</span><span class='lparen token'>(</span><span class='rubyid_connect identifier id'>connect</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_region identifier id'>region</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_dns_name identifier id'>dns_name</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Unable to find instance with tag: #{name}&quot;</span>
    <span class='rubyid_exit identifier id'>exit</span> <span class='integer val'>1</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_ignore_packages-instance_method">
  
    - (<tt>Object</tt>) <strong>get_ignore_packages</strong>(include_unmodified = false) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 257</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_ignore_packages identifier id'>get_ignore_packages</span><span class='lparen token'>(</span><span class='rubyid_include_unmodified identifier id'>include_unmodified</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_packages_str identifier id'>packages_str</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='rubyid_IGNORE_PACKAGES constant id'>IGNORE_PACKAGES</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_package_name identifier id'>package_name</span><span class='bitor op'>|</span>
    <span class='rubyid_packages_str identifier id'>packages_str</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; #{package_name}&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_include_unmodified? fid id'>include_unmodified?</span>
    <span class='rubyid_build_dirs identifier id'>build_dirs</span> <span class='assign token'>=</span> <span class='rubyid_get_build_dirs identifier id'>get_build_dirs</span>

    <span class='rubyid_all_packages identifier id'>all_packages</span> <span class='assign token'>=</span> <span class='rubyid_get_packages identifier id'>get_packages</span>
    <span class='rubyid_build_dirs identifier id'>build_dirs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_build_info identifier id'>build_info</span><span class='bitor op'>|</span>
      <span class='rubyid_package_name identifier id'>package_name</span> <span class='assign token'>=</span> <span class='rubyid_build_info identifier id'>build_info</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='rubyid_all_packages identifier id'>all_packages</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_package_name identifier id'>package_name</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_all_packages identifier id'>all_packages</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_package_name identifier id'>package_name</span><span class='bitor op'>|</span>
      <span class='rubyid_packages_str identifier id'>packages_str</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; #{package_name}&quot;</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_packages_str identifier id'>packages_str</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_required_packages-instance_method">
  
    - (<tt>Object</tt>) <strong>get_required_packages</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 222</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_required_packages identifier id'>get_required_packages</span>
  <span class='rubyid_required_packages_str identifier id'>required_packages_str</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='rubyid_packages identifier id'>packages</span> <span class='assign token'>=</span> <span class='rubyid_get_sorted_package_names identifier id'>get_sorted_package_names</span>
  <span class='rubyid_ignore_packages identifier id'>ignore_packages</span> <span class='assign token'>=</span> <span class='rubyid_get_ignore_packages identifier id'>get_ignore_packages</span>

  <span class='rubyid_SIBLING_REPOS constant id'>SIBLING_REPOS</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='bitor op'>|</span>
    <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='bitor op'>|</span>
      <span class='rubyid_exists identifier id'>exists</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='rparen token'>)</span>
      <span class='rubyid_inside identifier id'>inside</span><span class='lparen token'>(</span><span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
        <span class='rubyid_spec_file_list identifier id'>spec_file_list</span> <span class='assign token'>=</span> <span class='xstring val'>`find -name *.spec`</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_spec_file_list identifier id'>spec_file_list</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_spec_file identifier id'>spec_file</span><span class='bitor op'>|</span>
          <span class='rubyid_package identifier id'>package</span> <span class='assign token'>=</span> <span class='rubyid_Package constant id'>Package</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_spec_file identifier id'>spec_file</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_spec_file identifier id'>spec_file</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='rubyid_package_name identifier id'>package_name</span> <span class='assign token'>=</span> <span class='rubyid_package identifier id'>package</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span>
          <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_ignore_packages identifier id'>ignore_packages</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_package identifier id'>package</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>
            <span class='rubyid_required_packages identifier id'>required_packages</span> <span class='assign token'>=</span> <span class='rubyid_package identifier id'>package</span><span class='dot token'>.</span><span class='rubyid_build_requires identifier id'>build_requires</span> <span class='plus op'>+</span> <span class='rubyid_package identifier id'>package</span><span class='dot token'>.</span><span class='rubyid_requires identifier id'>requires</span>
            <span class='rubyid_required_packages identifier id'>required_packages</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_r_package identifier id'>r_package</span><span class='bitor op'>|</span>
              <span class='rubyid_required_packages_str identifier id'>required_packages_str</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; \\\&quot;#{r_package.yum_name_with_version}\\\&quot;&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_packages identifier id'>packages</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_r_package identifier id'>r_package</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_exists identifier id'>exists</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_required_packages_str identifier id'>required_packages_str</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_sorted_package_names-instance_method">
  
    - (<tt>Object</tt>) <strong>get_sorted_package_names</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


248
249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 248</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_sorted_package_names identifier id'>get_sorted_package_names</span>
  <span class='rubyid_packages identifier id'>packages</span> <span class='assign token'>=</span> <span class='rubyid_get_packages identifier id'>get_packages</span><span class='lparen token'>(</span><span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_packages_str identifier id'>packages_str</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='rubyid_packages identifier id'>packages</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_sort identifier id'>sort</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_package_name identifier id'>package_name</span><span class='bitor op'>|</span>
    <span class='rubyid_packages_str identifier id'>packages_str</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; #{package_name}&quot;</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_packages_str identifier id'>packages_str</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="init_repos-instance_method">
  
    - (<tt>Object</tt>) <strong>init_repos</strong>(hostname, replace = true, repo = nil, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


208
209
210
211
212
213
214
215
216
217
218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 208</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_init_repos identifier id'>init_repos</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_replace identifier id'>replace</span><span class='assign token'>=</span><span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_repo identifier id'>repo</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='assign token'>=</span><span class='string val'>&quot;/root&quot;</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_git_clone_commands identifier id'>git_clone_commands</span> <span class='assign token'>=</span> <span class='string val'>''</span>

  <span class='rubyid_SIBLING_REPOS constant id'>SIBLING_REPOS</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_repo identifier id'>repo</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_repo identifier id'>repo</span> <span class='eq op'>==</span> <span class='rubyid_repo_name identifier id'>repo_name</span>
      <span class='rubyid_repo_git_url identifier id'>repo_git_url</span> <span class='assign token'>=</span> <span class='rubyid_SIBLING_REPOS_GIT_URL constant id'>SIBLING_REPOS_GIT_URL</span><span class='lbrack token'>[</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='rbrack token'>]</span>
      <span class='rubyid_git_clone_commands identifier id'>git_clone_commands</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;if [ ! -d #{remote_repo_parent_dir}/#{repo_name}-bare ]; then\n&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_replace identifier id'>replace</span>
      <span class='rubyid_git_clone_commands identifier id'>git_clone_commands</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;rm -rf #{remote_repo_parent_dir}/#{repo_name}; git clone --bare #{repo_git_url} #{remote_repo_parent_dir}/#{repo_name}-bare;\n&quot;</span>
      <span class='rubyid_git_clone_commands identifier id'>git_clone_commands</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;fi\n&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_replace identifier id'>replace</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_git_clone_commands identifier id'>git_clone_commands</span><span class='comma token'>,</span> <span class='integer val'>240</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mcollective_logs-instance_method">
  
    - (<tt>Object</tt>) <strong>mcollective_logs</strong>(hostname) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


306
307
308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 306</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_mcollective_logs identifier id'>mcollective_logs</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Keep all mcollective logs on remote instance: #{hostname}&quot;</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;echo keeplogs=9999 &gt;&gt; /etc/mcollective/server.cfg&quot;</span><span class='comma token'>,</span> <span class='integer val'>240</span><span class='rparen token'>)</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;/sbin/service mcollective restart&quot;</span><span class='comma token'>,</span> <span class='integer val'>240</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_and_exit-instance_method">
  
    - (<tt>Object</tt>) <strong>print_and_exit</strong>(ret, out) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


578
579
580
581
582
583
584</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 578</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_print_and_exit identifier id'>print_and_exit</span><span class='lparen token'>(</span><span class='rubyid_ret identifier id'>ret</span><span class='comma token'>,</span> <span class='rubyid_out identifier id'>out</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_ret identifier id'>ret</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Exiting with error code #{ret}&quot;</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Output: #{out}&quot;</span>
    <span class='rubyid_exit identifier id'>exit</span> <span class='rubyid_ret identifier id'>ret</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_highlighted_output-instance_method">
  
    - (<tt>Object</tt>) <strong>print_highlighted_output</strong>(title, out) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


570
571
572
573
574
575
576</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 570</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_print_highlighted_output identifier id'>print_highlighted_output</span><span class='lparen token'>(</span><span class='rubyid_title identifier id'>title</span><span class='comma token'>,</span> <span class='rubyid_out identifier id'>out</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;------------------ Begin #{title} ------------------------&quot;</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_out identifier id'>out</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;------------------- End #{title} -------------------------&quot;</span>
  <span class='rubyid_puts identifier id'>puts</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reboot-instance_method">
  
    - (<tt>Object</tt>) <strong>reboot</strong>(instance) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


416
417
418
419
420</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 416</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_reboot identifier id'>reboot</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
  <span class='rubyid_print identifier id'>print</span> <span class='string val'>&quot;Rebooting instance to apply new kernel...&quot;</span>
  <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_reboot identifier id'>reboot</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Done&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="repo_clone_commands-instance_method">
  
    - (<tt>Object</tt>) <strong>repo_clone_commands</strong>(hostname) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202
203
204
205
206</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 200</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_repo_clone_commands identifier id'>repo_clone_commands</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='rparen token'>)</span>
  <span class='rubyid_clone_commands identifier id'>clone_commands</span> <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='rubyid_SIBLING_REPOS constant id'>SIBLING_REPOS</span><span class='dot token'>.</span><span class='rubyid_each_key identifier id'>each_key</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='bitor op'>|</span>
    <span class='rubyid_clone_commands identifier id'>clone_commands</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;git clone #{repo_name}-bare #{repo_name}; &quot;</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_clone_commands identifier id'>clone_commands</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="repo_path-instance_method">
  
    - (<tt>Object</tt>) <strong>repo_path</strong>(dir = '') 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


389
390
391</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 389</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_repo_path identifier id'>repo_path</span><span class='lparen token'>(</span><span class='rubyid_dir identifier id'>dir</span><span class='assign token'>=</span><span class='string val'>''</span><span class='rparen token'>)</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='dstring node'>&quot;../#{dir}&quot;</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid___FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_temp_commit-instance_method">
  
    - (<tt>Object</tt>) <strong>reset_temp_commit</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


297
298
299
300
301
302
303
304</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 297</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_reset_temp_commit identifier id'>reset_temp_commit</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@temp_commit ivar id'>@temp_commit</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Undoing temporary commit...&quot;</span>
    <span class='xstring val'>`git reset HEAD^`</span>
    <span class='rubyid_@temp_commit ivar id'>@temp_commit</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Done.&quot;</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_test_dir-instance_method">
  
    - (<tt>Object</tt>) <strong>reset_test_dir</strong>(hostname, backup = false, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 486</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_reset_test_dir identifier id'>reset_test_dir</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_backup identifier id'>backup</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='dstring node'>%{
cat&lt;&lt;EOF &gt; /tmp/reset_test_dir.sh
if [ -d /tmp/rhc ]
then
if #{backup}
then
    if \\\$(ls /tmp/rhc/run_* &gt; /dev/null 2&gt;&amp;1)
    then
        rm -rf /tmp/rhc_previous_runs
        mkdir -p /tmp/rhc_previous_runs
        mv /tmp/rhc/run_* /tmp/rhc_previous_runs
    fi
    if \\\$(ls /tmp/rhc/* &gt; /dev/null 2&gt;&amp;1)
    then
        for i in {1..100}
        do
            if ! [ -d /tmp/rhc_previous_runs/run_$i ]
            then
                mkdir -p /tmp/rhc_previous_runs/run_$i
                mv /tmp/rhc/* /tmp/rhc_previous_runs/run_$i
                break
            fi
        done
    fi
    if \\\$(ls /tmp/rhc_previous_runs/run_* &gt; /dev/null 2&gt;&amp;1)
    then
        mv /tmp/rhc_previous_runs/run_* /tmp/rhc/
        rm -rf /tmp/rhc_previous_runs
    fi
else
    rm -rf /tmp/rhc
fi
fi
mkdir -p /tmp/rhc/junit
EOF
chmod +x /tmp/reset_test_dir.sh
}</span><span class='comma token'>,</span> <span class='integer val'>120</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;su -c '/tmp/reset_test_dir.sh'&quot;</span> <span class='comma token'>,</span> <span class='integer val'>120</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="retry_test_failures-instance_method">
  
    - (<tt>Object</tt>) <strong>retry_test_failures</strong>(hostname, failures, num_retries = 1, timeout = @@SSH_TIMEOUT, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 527</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_retry_test_failures identifier id'>retry_test_failures</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_failures identifier id'>failures</span><span class='comma token'>,</span> <span class='rubyid_num_retries identifier id'>num_retries</span><span class='assign token'>=</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='assign token'>=</span><span class='rubyid_@@SSH_TIMEOUT ivar id'>@@SSH_TIMEOUT</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_failures identifier id'>failures</span><span class='dot token'>.</span><span class='rubyid_reverse! fid id'>reverse!</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;All Failures: #{failures.pretty_inspect}&quot;</span>
  <span class='rubyid_reset_test_dir identifier id'>reset_test_dir</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_failures identifier id'>failures</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_failure identifier id'>failure</span><span class='bitor op'>|</span>
    <span class='rubyid_title identifier id'>title</span> <span class='assign token'>=</span> <span class='rubyid_failure identifier id'>failure</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='rubyid_failure identifier id'>failure</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='rubyid_num_retries identifier id'>num_retries</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Retry attempt #{i} for: #{title}&quot;</span>
      <span class='rubyid_output identifier id'>output</span><span class='comma token'>,</span> <span class='rubyid_exit_code identifier id'>exit_code</span> <span class='assign token'>=</span> <span class='rubyid_run_ssh identifier id'>run_ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_title identifier id'>title</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_exit_code identifier id'>exit_code</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_i identifier id'>i</span> <span class='eq op'>==</span> <span class='rubyid_num_retries identifier id'>num_retries</span>
          <span class='rubyid_exit identifier id'>exit</span> <span class='rubyid_exit_code identifier id'>exit_code</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_reset_test_dir identifier id'>reset_test_dir</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_break break kw'>break</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run_ssh-instance_method">
  
    - (<tt>Object</tt>) <strong>run_ssh</strong>(hostname, title, cmd, timeout = @@SSH_TIMEOUT, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


393
394
395
396
397</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 393</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_run_ssh identifier id'>run_ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_title identifier id'>title</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='assign token'>=</span><span class='rubyid_@@SSH_TIMEOUT ivar id'>@@SSH_TIMEOUT</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_output identifier id'>output</span><span class='comma token'>,</span> <span class='rubyid_code identifier id'>code</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;\n\n-----------------------------------------------------------\nBegin Output From \#{title} Tests\n-----------------------------------------------------------\n\n# \#{cmd}\n\n\#{output}\n\n-----------------------------------------------------------\nEnd Output From \#{title} Tests\n-----------------------------------------------------------\n\n\n&quot;</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_output identifier id'>output</span><span class='comma token'>,</span> <span class='rubyid_code identifier id'>code</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="scp_remote_tests-instance_method">
  
    - (<tt>Object</tt>) <strong>scp_remote_tests</strong>(hostname, repo_parent_dir = &quot;/root&quot;, user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 121</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_scp_remote_tests identifier id'>scp_remote_tests</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_repo_parent_dir identifier id'>repo_parent_dir</span><span class='assign token'>=</span><span class='string val'>&quot;/root&quot;</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_init_repos identifier id'>init_repos</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_repo_parent_dir identifier id'>repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='rparen token'>)</span>
  <span class='rubyid_sync_repos identifier id'>sync_repos</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_repo_parent_dir identifier id'>repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='rparen token'>)</span>
  <span class='rubyid_update_remote_tests identifier id'>update_remote_tests</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_repo_parent_dir identifier id'>repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sync_available_sibling_repos-instance_method">
  
    - (<tt>Object</tt>) <strong>sync_available_sibling_repos</strong>(hostname, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
clones origin-server/rhc over to remote; returns command to run remotely
for cloning to standard working dirs, plus the names of those working dirs
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 184</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_sync_available_sibling_repos identifier id'>sync_available_sibling_repos</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='assign token'>=</span><span class='string val'>&quot;/root&quot;</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_working_dirs identifier id'>working_dirs</span> <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='rubyid_clone_commands identifier id'>clone_commands</span> <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='rubyid_SIBLING_REPOS constant id'>SIBLING_REPOS</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='bitor op'>|</span>
    <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='bitor op'>|</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_sync_sibling_repo identifier id'>sync_sibling_repo</span><span class='lparen token'>(</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='comma token'>,</span> <span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
        <span class='rubyid_working_dirs identifier id'>working_dirs</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{repo_name} &quot;</span>
        <span class='rubyid_clone_commands identifier id'>clone_commands</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;git clone #{repo_name}-bare #{repo_name}; &quot;</span>
        <span class='rubyid_break break kw'>break</span> <span class='comment val'># just need the first repo found</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_clone_commands identifier id'>clone_commands</span><span class='comma token'>,</span> <span class='rubyid_working_dirs identifier id'>working_dirs</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sync_repo-instance_method">
  
    - (<tt>Object</tt>) <strong>sync_repo</strong>(repo_name, hostname, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;, verbose = false) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 135</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_sync_repo identifier id'>sync_repo</span><span class='lparen token'>(</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='assign token'>=</span><span class='string val'>&quot;/root&quot;</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='comma token'>,</span> <span class='rubyid_verbose identifier id'>verbose</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_temp_commit identifier id'>temp_commit</span>

  <span class='rubyid_begin begin kw'>begin</span>

    <span class='comment val'># Get the current branch</span>
    <span class='rubyid_branch identifier id'>branch</span> <span class='assign token'>=</span> <span class='rubyid_get_branch identifier id'>get_branch</span>

    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Synchronizing local changes from branch #{branch} for repo #{repo_name} from #{File.basename(FileUtils.pwd)}...&quot;</span>

    <span class='rubyid_init_repos identifier id'>init_repos</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>

    <span class='rubyid_exitcode identifier id'>exitcode</span> <span class='assign token'>=</span> <span class='rubyid_run identifier id'>run</span><span class='lparen token'>(</span><span class='string val'>&quot;#######\n# Start shell code\nexport GIT_SSH=\#{GIT_SSH_PATH}\n\#{branch == 'origin/master' ? \&quot;git push -q \#{ssh_user}@\#{hostname}:\#{remote_repo_parent_dir}/\#{repo_name}-bare master:master --tags --force; \&quot; : ''}\ngit push -q \#{ssh_user}@\#{hostname}:\#{remote_repo_parent_dir}/\#{repo_name}-bare \#{branch}:master --tags --force\n\n#######\n# End shell code\n&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_verbose identifier id'>verbose</span><span class='rparen token'>)</span>

    <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Done&quot;</span>
  <span class='rubyid_ensure ensure kw'>ensure</span>
    <span class='rubyid_reset_temp_commit identifier id'>reset_temp_commit</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sync_repos-instance_method">
  
    - (<tt>Object</tt>) <strong>sync_repos</strong>(hostname, remote_repo_parent_dir = &quot;/root&quot;, sshuser = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 127</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_sync_repos identifier id'>sync_repos</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='assign token'>=</span><span class='string val'>&quot;/root&quot;</span><span class='comma token'>,</span> <span class='rubyid_sshuser identifier id'>sshuser</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_SIBLING_REPOS constant id'>SIBLING_REPOS</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='bitor op'>|</span>
    <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='bitor op'>|</span>
      <span class='rubyid_break break kw'>break</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_sync_sibling_repo identifier id'>sync_sibling_repo</span><span class='lparen token'>(</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='comma token'>,</span> <span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_sshuser identifier id'>sshuser</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sync_sibling_repo-instance_method">
  
    - (<tt>Object</tt>) <strong>sync_sibling_repo</strong>(repo_name, repo_dir, hostname, remote_repo_parent_dir = &quot;/root&quot;, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 165</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_sync_sibling_repo identifier id'>sync_sibling_repo</span><span class='lparen token'>(</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='comma token'>,</span> <span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='assign token'>=</span><span class='string val'>&quot;/root&quot;</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_exists identifier id'>exists</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_inside identifier id'>inside</span><span class='lparen token'>(</span><span class='rubyid_repo_dir identifier id'>repo_dir</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_sync_repo identifier id'>sync_repo</span><span class='lparen token'>(</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_remote_repo_parent_dir identifier id'>remote_repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_exists identifier id'>exists</span>
  <span class='rubyid_exists identifier id'>exists</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="temp_commit-instance_method">
  
    - (<tt>Object</tt>) <strong>temp_commit</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 280</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_temp_commit identifier id'>temp_commit</span>
  <span class='comment val'># Warn on uncommitted changes</span>
  <span class='xstring val'>`git diff-index --quiet HEAD`</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_$? gvar id'>$?</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
    <span class='comment val'># Perform a temporary commit</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Creating temporary commit to build&quot;</span>
    <span class='xstring val'>`git commit -a -m &quot;Temporary commit to build&quot;`</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_$? gvar id'>$?</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;No-op.&quot;</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_@temp_commit ivar id'>@temp_commit</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Done.&quot;</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_api_file-instance_method">
  
    - (<tt>Object</tt>) <strong>update_api_file</strong>(instance) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 312</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_update_api_file identifier id'>update_api_file</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
  <span class='rubyid_public_ip identifier id'>public_ip</span> <span class='assign token'>=</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_dns_name identifier id'>dns_name</span>
  <span class='rubyid_external_config identifier id'>external_config</span> <span class='assign token'>=</span> <span class='string val'>&quot;~/.openshift/console.conf&quot;</span>
  <span class='rubyid_config_file identifier id'>config_file</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='rubyid_external_config identifier id'>external_config</span><span class='rparen token'>)</span>

  <span class='rubyid_Dir constant id'>Dir</span><span class='dot token'>.</span><span class='rubyid_mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='string val'>'~/.openshift'</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_nil nil kw'>nil</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_FileTest constant id'>FileTest</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_config_file identifier id'>config_file</span><span class='rparen token'>)</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;File '#{external_config}' does not exist, creating...&quot;</span>
    <span class='rubyid_system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;touch #{external_config}&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_config_file identifier id'>config_file</span><span class='comma token'>,</span> <span class='string val'>'w'</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span><span class='lparen token'>(</span><span class='string val'>&quot;BROKER_URL=https://\#{public_ip}/broker/rest\nDOMAIN_SUFFIX=dev.rhcloud.com\n# Uncomment the next line to set a proxy URL for the broker\n# BROKER_PROXY_URL=\n&quot;</span>
      <span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Updating ~/.openshift/console.conf with public ip = #{public_ip}&quot;</span>
    <span class='rubyid_s identifier id'>s</span> <span class='assign token'>=</span> <span class='rubyid_IO constant id'>IO</span><span class='dot token'>.</span><span class='rubyid_read identifier id'>read</span><span class='lparen token'>(</span><span class='rubyid_config_file identifier id'>config_file</span><span class='rparen token'>)</span>
    <span class='rubyid_s identifier id'>s</span><span class='dot token'>.</span><span class='rubyid_gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>%r[^BROKER_URL=\s*https://[^/]+/broker/rest$]</span><span class='rubyid_m identifier id'>m</span><span class='comma token'>,</span> <span class='dstring node'>&quot;BROKER_URL=https://#{public_ip}/broker/rest&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_config_file identifier id'>config_file</span><span class='comma token'>,</span> <span class='string val'>'w'</span><span class='rparen token'>)</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span><span class='lparen token'>(</span><span class='rubyid_s identifier id'>s</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_express_server-instance_method">
  
    - (<tt>Object</tt>) <strong>update_express_server</strong>(instance) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


383
384
385
386
387</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 383</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_update_express_server identifier id'>update_express_server</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
  <span class='rubyid_public_ip identifier id'>public_ip</span> <span class='assign token'>=</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_public_ip_address identifier id'>public_ip_address</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Updating ~/.openshift/express.conf libra_server entry with public ip = #{public_ip}&quot;</span>
  <span class='dxstring node'>`sed -i -e 's,^libra_server.*,libra_server=#{public_ip},' ~/.openshift/express.conf`</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_remote_tests-instance_method">
  
    - (<tt>Object</tt>) <strong>update_remote_tests</strong>(hostname, branch = nil, repo_parent_dir = &quot;/root&quot;, user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 98</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_update_remote_tests identifier id'>update_remote_tests</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_branch identifier id'>branch</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_repo_parent_dir identifier id'>repo_parent_dir</span><span class='assign token'>=</span><span class='string val'>&quot;/root&quot;</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Updating remote tests...&quot;</span>
  <span class='rubyid_git_archive_commands identifier id'>git_archive_commands</span> <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='rubyid_SIBLING_REPOS constant id'>SIBLING_REPOS</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_repo_name identifier id'>repo_name</span><span class='comma token'>,</span> <span class='rubyid_repo_dirs identifier id'>repo_dirs</span><span class='bitor op'>|</span>
    <span class='rubyid_repo_dir identifier id'>repo_dir</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{repo_parent_dir}/#{repo_name}-bare&quot;</span>
    <span class='rubyid_git_archive_commands identifier id'>git_archive_commands</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;pushd #{repo_dir} &gt; /dev/null; git archive --prefix openshift-test/#{::OPENSHIFT_ARCHIVE_DIR_MAP[repo_name] || ''} --format=tar #{branch ? branch : 'HEAD'} | (cd #{repo_parent_dir} &amp;&amp; tar --warning=no-timestamp -xf -); popd &gt; /dev/null; &quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_output identifier id'>output</span><span class='comma token'>,</span> <span class='rubyid_exit_code identifier id'>exit_code</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='dstring node'>%{
set -e;
su -c \&quot;rm -rf #{repo_parent_dir}/openshift-test\&quot;
#{git_archive_commands}
su -c \&quot;mkdir -p /tmp/rhc/junit\&quot;
}</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_exit_code identifier id'>exit_code</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
    <span class='rubyid_exit identifier id'>exit</span> <span class='integer val'>1</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_update_cucumber_tests identifier id'>update_cucumber_tests</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_repo_parent_dir identifier id'>repo_parent_dir</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Done&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_ssh_config_verifier-instance_method">
  
    - (<tt>Object</tt>) <strong>update_ssh_config_verifier</strong>(instance) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 340</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_update_ssh_config_verifier identifier id'>update_ssh_config_verifier</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
  <span class='rubyid_public_ip identifier id'>public_ip</span> <span class='assign token'>=</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_public_ip_address identifier id'>public_ip_address</span>
  <span class='rubyid_ssh_config identifier id'>ssh_config</span> <span class='assign token'>=</span> <span class='string val'>&quot;~/.ssh/config&quot;</span>
  <span class='rubyid_pem_file identifier id'>pem_file</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='string val'>&quot;~/.ssh/libra.pem&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='rubyid_pem_file identifier id'>pem_file</span><span class='rparen token'>)</span>
    <span class='comment val'># copy it from local repo</span>
    <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;cp misc/libra.pem #{pem_file}&quot;</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_cmd identifier id'>cmd</span>
    <span class='rubyid_system identifier id'>system</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
    <span class='rubyid_system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;chmod 600 #{pem_file}&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_config_file identifier id'>config_file</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='rubyid_ssh_config identifier id'>ssh_config</span><span class='rparen token'>)</span>

  <span class='rubyid_config_template identifier id'>config_template</span> <span class='assign token'>=</span> <span class='string val'>&quot;Host verifier\n  HostName 10.1.1.1\n  User      root\n  IdentityFile ~/.ssh/libra.pem\n&quot;</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_FileTest constant id'>FileTest</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_config_file identifier id'>config_file</span><span class='rparen token'>)</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;File '#{ssh_config}' does not exists, creating...&quot;</span>
    <span class='rubyid_system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;touch #{ssh_config}&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;chmod 600 #{ssh_config}&quot;</span>
    <span class='rubyid_system identifier id'>system</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
    <span class='rubyid_file_mode identifier id'>file_mode</span> <span class='assign token'>=</span> <span class='string val'>'w'</span>
    <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_config_file identifier id'>config_file</span><span class='comma token'>,</span> <span class='rubyid_file_mode identifier id'>file_mode</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span><span class='lparen token'>(</span><span class='rubyid_config_template identifier id'>config_template</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;grep -n 'Host verifier' #{config_file}&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_file_mode identifier id'>file_mode</span> <span class='assign token'>=</span> <span class='string val'>'a'</span>
      <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_config_file identifier id'>config_file</span><span class='comma token'>,</span> <span class='rubyid_file_mode identifier id'>file_mode</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span><span class='lparen token'>(</span><span class='rubyid_config_template identifier id'>config_template</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_line_num identifier id'>line_num</span> <span class='assign token'>=</span> <span class='xstring val'>`grep -n 'Host verifier' ~/.ssh/config`</span><span class='dot token'>.</span><span class='rubyid_chomp identifier id'>chomp</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Updating ~/.ssh/config verifier entry with public ip = #{public_ip}&quot;</span>
  <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='dxstring node'>`sed -i -e '#{line_num.to_i + i}s,HostName.*,HostName #{public_ip},' ~/.ssh/config`</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_test_bundle-instance_method">
  
    - (<tt>Object</tt>) <strong>update_test_bundle</strong>(hostname, user, *dirs) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/builder_helper.rb', line 173</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_update_test_bundle identifier id'>update_test_bundle</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='rubyid_dirs identifier id'>dirs</span><span class='rparen token'>)</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='rubyid_dirs identifier id'>dirs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_dir identifier id'>dir</span><span class='bitor op'>|</span>
    <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;cd ~/openshift-test/#{dir}; rm Gemfile.lock; bundle install --local; touch Gemfile.lock;\n&quot;</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_user identifier id'>user</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue May 28 18:46:23 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.8.7).
</div>

  </body>
</html>