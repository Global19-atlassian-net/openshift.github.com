<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: OpenShift::Amazon
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../OpenShift.html" title="OpenShift (module)">OpenShift</a></span></span>
     &raquo; 
    <span class="title">Amazon</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: OpenShift::Amazon
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="BuilderHelper.html" title="OpenShift::BuilderHelper (module)">BuilderHelper</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">origin-dev-tools/build/lib/openshift/amz.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_tag-instance_method" title="#add_tag (instance method)">- (Object) <strong>add_tag</strong>(instance, name, retries = 2) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#block_until_available-instance_method" title="#block_until_available (instance method)">- (Object) <strong>block_until_available</strong>(instance, ssh_user = &quot;root&quot;, terminate_if_unavailable = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_update-instance_method" title="#check_update (instance method)">- (Object) <strong>check_update</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect-instance_method" title="#connect (instance method)">- (Object) <strong>connect</strong>(region = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_detached_volumes-instance_method" title="#delete_detached_volumes (instance method)">- (Object) <strong>delete_detached_volumes</strong>(conn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_unused_snapshots-instance_method" title="#delete_unused_snapshots (instance method)">- (Object) <strong>delete_unused_snapshots</strong>(conn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_instance-instance_method" title="#find_instance (instance method)">- (Object) <strong>find_instance</strong>(conn, name, use_tag = false, block_until_available = true, ssh_user = &quot;root&quot;, silent = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flag_old_devenvs-instance_method" title="#flag_old_devenvs (instance method)">- (Object) <strong>flag_old_devenvs</strong>(conn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flag_old_qe_devenvs-instance_method" title="#flag_old_qe_devenvs (instance method)">- (Object) <strong>flag_old_qe_devenvs</strong>(conn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_amis-instance_method" title="#get_amis (instance method)">- (Object) <strong>get_amis</strong>(conn, filter) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_internal_hostname-instance_method" title="#get_internal_hostname (instance method)">- (Object) <strong>get_internal_hostname</strong>(hostname, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_latest_ami-instance_method" title="#get_latest_ami (instance method)">- (Object) <strong>get_latest_ami</strong>(conn, filter_val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_private_ip-instance_method" title="#get_private_ip (instance method)">- (Object) <strong>get_private_ip</strong>(hostname, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_specific_ami-instance_method" title="#get_specific_ami (instance method)">- (Object) <strong>get_specific_ami</strong>(conn, filter_val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_specific_public_ami-instance_method" title="#get_specific_public_ami (instance method)">- (Object) <strong>get_specific_public_ami</strong>(conn, filter_val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#instance_status-instance_method" title="#instance_status (instance method)">- (Object) <strong>instance_status</strong>(instance) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_valid%3F-instance_method" title="#is_valid? (instance method)">- (Boolean) <strong>is_valid?</strong>(hostname, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#launch_instance-instance_method" title="#launch_instance (instance method)">- (Object) <strong>launch_instance</strong>(image, name, max_retries = 1, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_image-instance_method" title="#register_image (instance method)">- (Object) <strong>register_image</strong>(conn, instance, name, manifest) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_instance_ip-instance_method" title="#set_instance_ip (instance method)">- (Object) <strong>set_instance_ip</strong>(hostname, ip, dhostname, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_rsa_key-instance_method" title="#setup_rsa_key (instance method)">- (Object) <strong>setup_rsa_key</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_untagged_instances-instance_method" title="#stop_untagged_instances (instance method)">- (Object) <strong>stop_untagged_instances</strong>(conn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tag_to_terminate-instance_method" title="#tag_to_terminate (instance method)">- (Object) <strong>tag_to_terminate</strong>(i) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#terminate_flagged_instances-instance_method" title="#terminate_flagged_instances (instance method)">- (Object) <strong>terminate_flagged_instances</strong>(conn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#terminate_instance-instance_method" title="#terminate_instance (instance method)">- (Object) <strong>terminate_instance</strong>(instance, handle_unauthorized = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#terminate_old_verifiers-instance_method" title="#terminate_old_verifiers (instance method)">- (Object) <strong>terminate_old_verifiers</strong>(conn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_facts-instance_method" title="#update_facts (instance method)">- (Object) <strong>update_facts</strong>(hostname, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use_private_ip-instance_method" title="#use_private_ip (instance method)">- (Object) <strong>use_private_ip</strong>(hostname, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use_public_ip-instance_method" title="#use_public_ip (instance method)">- (Object) <strong>use_public_ip</strong>(hostname, ssh_user = &quot;root&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verify_image-instance_method" title="#verify_image (instance method)">- (Object) <strong>verify_image</strong>(image) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_tag-instance_method">
  
    - (<tt>Object</tt>) <strong>add_tag</strong>(instance, name, retries = 2) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228
229
230
231
232
233
234
235
236
237</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 226</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_add_tag identifier id'>add_tag</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_retries identifier id'>retries</span><span class='assign token'>=</span><span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='rubyid_retries identifier id'>retries</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='comment val'># Tag the instance</span>
      <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_add_tag identifier id'>add_tag</span><span class='lparen token'>(</span><span class='string val'>'Name'</span><span class='comma token'>,</span> <span class='symbol val'>:value</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
      <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Failed adding tag: #{e.message}&quot;</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_i identifier id'>i</span> <span class='eq op'>==</span> <span class='rubyid_retries identifier id'>retries</span>
      <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>5</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="block_until_available-instance_method">
  
    - (<tt>Object</tt>) <strong>block_until_available</strong>(instance, ssh_user = &quot;root&quot;, terminate_if_unavailable = false) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 278</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_block_until_available identifier id'>block_until_available</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='comma token'>,</span> <span class='rubyid_terminate_if_unavailable identifier id'>terminate_if_unavailable</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Waiting for instance to be available...&quot;</span>

  <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>24</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_break break kw'>break</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:running</span>
    <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Instance isn't running yet... retrying&quot;</span>
    <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>5</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:running</span>
    <span class='rubyid_terminate_instance identifier id'>terminate_instance</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_terminate_if_unavailable identifier id'>terminate_if_unavailable</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ScriptError constant id'>ScriptError</span><span class='comma token'>,</span> <span class='string val'>&quot;Instance is not in a state of 'running'&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_hostname identifier id'>hostname</span> <span class='assign token'>=</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_dns_name identifier id'>dns_name</span>
  <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>30</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_break break kw'>break</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_can_ssh? fid id'>can_ssh?</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
    <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;SSH access failed... retrying&quot;</span>
    <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>5</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_can_ssh? fid id'>can_ssh?</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
    <span class='rubyid_terminate_instance identifier id'>terminate_instance</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ScriptError constant id'>ScriptError</span><span class='comma token'>,</span> <span class='string val'>&quot;SSH availability timed out&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Instance (#{hostname}) is accessible&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_update-instance_method">
  
    - (<tt>Object</tt>) <strong>check_update</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 56</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_check_update identifier id'>check_update</span>
  <span class='rubyid_yum_output identifier id'>yum_output</span> <span class='assign token'>=</span> <span class='xstring val'>`yum check-update rhc-*`</span>

  <span class='rubyid_packages identifier id'>packages</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_yum_output identifier id'>yum_output</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_line identifier id'>line</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_start_with? fid id'>start_with?</span><span class='lparen token'>(</span><span class='string val'>&quot;Obsoleting&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_break break kw'>break</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_start_with? fid id'>start_with?</span><span class='lparen token'>(</span><span class='string val'>&quot;rhc&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_pkg_name identifier id'>pkg_name</span> <span class='assign token'>=</span> <span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='rubyid_version identifier id'>version</span> <span class='assign token'>=</span> <span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
      <span class='rubyid_packages identifier id'>packages</span><span class='lbrack token'>[</span><span class='rubyid_pkg_name identifier id'>pkg_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_version identifier id'>version</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_packages identifier id'>packages</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connect-instance_method">
  
    - (<tt>Object</tt>) <strong>connect</strong>(region = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 21</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_connect identifier id'>connect</span><span class='lparen token'>(</span><span class='rubyid_region identifier id'>region</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='rubyid_conn identifier id'>conn</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_begin begin kw'>begin</span>
    <span class='comment val'># Parse the credentials</span>
    <span class='rubyid_config identifier id'>config</span> <span class='assign token'>=</span> <span class='rubyid_ParseConfig constant id'>ParseConfig</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='string val'>&quot;~/.awscred&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

    <span class='comment val'># Setup the SSH key</span>
    <span class='rubyid_setup_rsa_key identifier id'>setup_rsa_key</span>

    <span class='comment val'># Setup the global access configuration</span>
    <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_config identifier id'>config</span><span class='lparen token'>(</span>
      <span class='symbol val'>:access_key_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_get_value identifier id'>get_value</span><span class='lparen token'>(</span><span class='string val'>&quot;AWSAccessKeyId&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span>
      <span class='symbol val'>:secret_access_key</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_get_value identifier id'>get_value</span><span class='lparen token'>(</span><span class='string val'>&quot;AWSSecretKey&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span>
      <span class='symbol val'>:ssl_ca_file</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;/etc/pki/tls/certs/ca-bundle.trust.crt&quot;</span>
    <span class='rparen token'>)</span>

    <span class='comment val'># Return the AMZ connection</span>
    <span class='rubyid_conn identifier id'>conn</span> <span class='assign token'>=</span> <span class='rubyid_AWS constant id'>AWS</span><span class='colon2 op'>::</span><span class='rubyid_EC2 constant id'>EC2</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_StandardError constant id'>StandardError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Couldn't access credentials in \#{File.expand_path(\&quot;~/.awscred\&quot;)}\n\nPlease create a file with the following format:\nAWSAccessKeyId=&lt;ACCESS_KEY&gt;\nAWSSecretKey=&lt;SECRET_KEY&gt;\n&quot;</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;Error - no credentials&quot;</span>
  <span class='rubyid_end end kw'>end</span>
      
  <span class='rubyid_conn identifier id'>conn</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_regions identifier id'>regions</span><span class='lbrack token'>[</span><span class='rubyid_region identifier id'>region</span><span class='rbrack token'>]</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_region identifier id'>region</span>
  <span class='rubyid_conn identifier id'>conn</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_detached_volumes-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_detached_volumes</strong>(conn) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 79</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_delete_detached_volumes identifier id'>delete_detached_volumes</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='rparen token'>)</span>
  <span class='rubyid_volumes identifier id'>volumes</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_volumes identifier id'>volumes</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;status&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;available&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_volumes identifier id'>volumes</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_volume identifier id'>volume</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_volume identifier id'>volume</span><span class='dot token'>.</span><span class='rubyid_create_time identifier id'>create_time</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='lt op'>&lt;</span> <span class='lparen token'>(</span><span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_now identifier id'>now</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='minus op'>-</span> <span class='integer val'>10800</span><span class='rparen token'>)</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Deleting #{volume.size}GB detached volume: #{volume.id}&quot;</span>
      <span class='rubyid_volume identifier id'>volume</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_unused_snapshots-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_unused_snapshots</strong>(conn) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91
92
93
94
95
96
97
98
99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 89</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_delete_unused_snapshots identifier id'>delete_unused_snapshots</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='rparen token'>)</span>
  <span class='rubyid_snapshots identifier id'>snapshots</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_snapshots identifier id'>snapshots</span><span class='dot token'>.</span><span class='rubyid_with_owner identifier id'>with_owner</span><span class='lparen token'>(</span><span class='symbol val'>:self</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;status&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;completed&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_snapshots identifier id'>snapshots</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_snapshot identifier id'>snapshot</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_snapshot identifier id'>snapshot</span><span class='dot token'>.</span><span class='rubyid_start_time identifier id'>start_time</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='lt op'>&lt;</span> <span class='lparen token'>(</span><span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_now identifier id'>now</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='minus op'>-</span> <span class='integer val'>10800</span><span class='rparen token'>)</span>
      <span class='rubyid_begin begin kw'>begin</span>
        <span class='rubyid_snapshot identifier id'>snapshot</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span>
      <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_AWS constant id'>AWS</span><span class='colon2 op'>::</span><span class='rubyid_EC2 constant id'>EC2</span><span class='colon2 op'>::</span><span class='rubyid_Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='rubyid_InvalidSnapshot constant id'>InvalidSnapshot</span><span class='colon2 op'>::</span><span class='rubyid_InUse constant id'>InUse</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Deleted #{snapshot.volume_size}GB unused snapshot: #{snapshot.id}&quot;</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_instance-instance_method">
  
    - (<tt>Object</tt>) <strong>find_instance</strong>(conn, name, use_tag = false, block_until_available = true, ssh_user = &quot;root&quot;, silent = false) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 161</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_find_instance identifier id'>find_instance</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_use_tag identifier id'>use_tag</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='rubyid_block_until_available identifier id'>block_until_available</span><span class='assign token'>=</span><span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='comma token'>,</span> <span class='rubyid_silent identifier id'>silent</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_use_tag identifier id'>use_tag</span>
    <span class='rubyid_instances identifier id'>instances</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>'tag-key'</span><span class='comma token'>,</span> <span class='string val'>'Name'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>'tag-value'</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_instances identifier id'>instances</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>'dns-name'</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='symbol val'>:terminated</span><span class='rparen token'>)</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Found instance #{i.id} (#{i.tags[&quot;Name&quot;]})&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_silent identifier id'>silent</span>
      <span class='rubyid_block_until_available identifier id'>block_until_available</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_block_until_available identifier id'>block_until_available</span>
      <span class='rubyid_return return kw'>return</span> <span class='rubyid_i identifier id'>i</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;No instance found matching #{name}&quot;</span>

  <span class='comment val'># If we are searching by tag, then find instances with names for</span>
  <span class='comment val'># which the given name is a prefix, and suggest these instances.</span>
  <span class='rubyid_matches identifier id'>matches</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_use_tag identifier id'>use_tag</span>
    <span class='rubyid_instances identifier id'>instances</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>'tag-key'</span><span class='comma token'>,</span> <span class='string val'>'Name'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>'tag-value'</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{name}*&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='symbol val'>:terminated</span><span class='rparen token'>)</span>
        <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Did you mean one of the following?&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_matches identifier id'>matches</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
        <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;  #{i.tags[&quot;Name&quot;]}&quot;</span>
        <span class='rubyid_matches identifier id'>matches</span> <span class='assign token'>=</span> <span class='rubyid_matches identifier id'>matches</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_return return kw'>return</span> <span class='rubyid_nil nil kw'>nil</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flag_old_devenvs-instance_method">
  
    - (<tt>Object</tt>) <strong>flag_old_devenvs</strong>(conn) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 446</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_flag_old_devenvs identifier id'>flag_old_devenvs</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='rparen token'>)</span>
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:stopped</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>&quot;Name&quot;</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/preserve/</span><span class='rparen token'>)</span>
        <span class='rubyid_launch_yday identifier id'>launch_yday</span> <span class='assign token'>=</span> <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_launch_time identifier id'>launch_time</span><span class='dot token'>.</span><span class='rubyid_yday identifier id'>yday</span>
        <span class='rubyid_yday identifier id'>yday</span> <span class='assign token'>=</span> <span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='dot token'>.</span><span class='rubyid_yday identifier id'>yday</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_yday identifier id'>yday</span> <span class='lt op'>&lt;</span> <span class='rubyid_launch_yday identifier id'>launch_yday</span>
          <span class='rubyid_yday identifier id'>yday</span> <span class='opasgn op'>+=</span> <span class='integer val'>365</span> <span class='comment val'># minor leap year bug here (will terminate 1 day late)</span>
        <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_yday identifier id'>yday</span> <span class='minus op'>-</span> <span class='rubyid_launch_yday identifier id'>launch_yday</span> <span class='gt op'>&gt;</span> <span class='integer val'>6</span>
          <span class='rubyid_tag_to_terminate identifier id'>tag_to_terminate</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flag_old_qe_devenvs-instance_method">
  
    - (<tt>Object</tt>) <strong>flag_old_qe_devenvs</strong>(conn) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


463
464
465
466
467
468
469
470
471
472
473
474
475
476
477</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 463</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_flag_old_qe_devenvs identifier id'>flag_old_qe_devenvs</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='rparen token'>)</span>
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
      <span class='rubyid_current_time identifier id'>current_time</span> <span class='assign token'>=</span> <span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>&quot;Name&quot;</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/^S?QE(_|-)/i</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>&quot;Name&quot;</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/preserve/</span><span class='rparen token'>)</span>
        <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='rubyid_current_time identifier id'>current_time</span> <span class='minus op'>-</span> <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_launch_time identifier id'>launch_time</span><span class='rparen token'>)</span> <span class='gt op'>&gt;</span> <span class='integer val'>57600</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:running</span><span class='rparen token'>)</span>
          <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Stopping qe instance #{i.id} (#{i.tags[&quot;Name&quot;]})&quot;</span>
          <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_stop identifier id'>stop</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='rubyid_current_time identifier id'>current_time</span> <span class='minus op'>-</span> <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_launch_time identifier id'>launch_time</span><span class='rparen token'>)</span> <span class='gt op'>&gt;</span> <span class='integer val'>10800</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:stopped</span><span class='rparen token'>)</span>
          <span class='rubyid_tag_to_terminate identifier id'>tag_to_terminate</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_amis-instance_method">
  
    - (<tt>Object</tt>) <strong>get_amis</strong>(conn, filter) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 73</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_amis identifier id'>get_amis</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='comma token'>,</span> <span class='rubyid_filter identifier id'>filter</span><span class='rparen token'>)</span>
  <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_images identifier id'>images</span><span class='dot token'>.</span><span class='rubyid_with_owner identifier id'>with_owner</span><span class='lparen token'>(</span><span class='symbol val'>:self</span><span class='rparen token'>)</span><span class='dot token'>.</span>
    <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;state&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;available&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span>
    <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;name&quot;</span><span class='comma token'>,</span> <span class='rubyid_filter identifier id'>filter</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_internal_hostname-instance_method">
  
    - (<tt>Object</tt>) <strong>get_internal_hostname</strong>(hostname, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341
342</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 339</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_internal_hostname identifier id'>get_internal_hostname</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_internal_hostname identifier id'>internal_hostname</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;hostname&quot;</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_internal_hostname identifier id'>internal_hostname</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_latest_ami-instance_method">
  
    - (<tt>Object</tt>) <strong>get_latest_ami</strong>(conn, filter_val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 134</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_latest_ami identifier id'>get_latest_ami</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='comma token'>,</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='rparen token'>)</span>
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='comment val'># Limit to DevEnv images</span>
    <span class='rubyid_devenv_amis identifier id'>devenv_amis</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_images identifier id'>images</span><span class='dot token'>.</span><span class='rubyid_with_owner identifier id'>with_owner</span><span class='lparen token'>(</span><span class='symbol val'>:self</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;state&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;available&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;name&quot;</span><span class='comma token'>,</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='rparen token'>)</span>
    <span class='comment val'># Take the last DevEnv AMI - memoize saves a remote call</span>
    <span class='rubyid_devenv_amis identifier id'>devenv_amis</span><span class='dot token'>.</span><span class='rubyid_to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='rubyid_sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_ami identifier id'>ami</span><span class='bitor op'>|</span> <span class='rubyid_ami identifier id'>ami</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;_&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_last identifier id'>last</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_private_ip-instance_method">
  
    - (<tt>Object</tt>) <strong>get_private_ip</strong>(hostname, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


317
318
319
320
321
322
323
324</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 317</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_private_ip identifier id'>get_private_ip</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_private_ip identifier id'>private_ip</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;facter ipaddress&quot;</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_private_ip identifier id'>private_ip</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_private_ip identifier id'>private_ip</span><span class='dot token'>.</span><span class='rubyid_strip identifier id'>strip</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;EXITING - AMZ instance didn't return ipaddress fact&quot;</span>
    <span class='rubyid_exit identifier id'>exit</span> <span class='integer val'>0</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_private_ip identifier id'>private_ip</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_specific_ami-instance_method">
  
    - (<tt>Object</tt>) <strong>get_specific_ami</strong>(conn, filter_val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 118</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_specific_ami identifier id'>get_specific_ami</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='comma token'>,</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='dot token'>.</span><span class='rubyid_start_with? fid id'>start_with?</span><span class='lparen token'>(</span><span class='string val'>&quot;ami&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_filter_param identifier id'>filter_param</span> <span class='assign token'>=</span> <span class='string val'>&quot;image-id&quot;</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_filter_param identifier id'>filter_param</span> <span class='assign token'>=</span> <span class='string val'>&quot;name&quot;</span>
  <span class='rubyid_end end kw'>end</span> 
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_devenv_amis identifier id'>devenv_amis</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_images identifier id'>images</span><span class='dot token'>.</span><span class='rubyid_with_owner identifier id'>with_owner</span><span class='lparen token'>(</span><span class='symbol val'>:self</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;state&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;available&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='rubyid_filter_param identifier id'>filter_param</span><span class='comma token'>,</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='rparen token'>)</span>
    <span class='comment val'># Take the last DevEnv AMI - memoize saves a remote call</span>
    <span class='rubyid_devenv_amis identifier id'>devenv_amis</span><span class='dot token'>.</span><span class='rubyid_to_a identifier id'>to_a</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>

  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_specific_public_ami-instance_method">
  
    - (<tt>Object</tt>) <strong>get_specific_public_ami</strong>(conn, filter_val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106
107
108
109
110
111
112
113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 103</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_specific_public_ami identifier id'>get_specific_public_ami</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='comma token'>,</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='dot token'>.</span><span class='rubyid_start_with? fid id'>start_with?</span><span class='lparen token'>(</span><span class='string val'>&quot;ami&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_filter_param identifier id'>filter_param</span> <span class='assign token'>=</span> <span class='string val'>&quot;image-id&quot;</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_filter_param identifier id'>filter_param</span> <span class='assign token'>=</span> <span class='string val'>&quot;name&quot;</span>
  <span class='rubyid_end end kw'>end</span> 
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_devenv_amis identifier id'>devenv_amis</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_images identifier id'>images</span><span class='dot token'>.</span>
      <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='string val'>&quot;state&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;available&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='rubyid_filter_param identifier id'>filter_param</span><span class='comma token'>,</span> <span class='rubyid_filter_val identifier id'>filter_val</span><span class='rparen token'>)</span>
    <span class='comment val'># Take the last DevEnv AMI - memoize saves a remote call</span>
    <span class='rubyid_devenv_amis identifier id'>devenv_amis</span><span class='dot token'>.</span><span class='rubyid_to_a identifier id'>to_a</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="instance_status-instance_method">
  
    - (<tt>Object</tt>) <strong>instance_status</strong>(instance) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 145</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>10</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_index identifier id'>index</span><span class='bitor op'>|</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='rubyid_status identifier id'>status</span> <span class='assign token'>=</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_status identifier id'>status</span>
      <span class='rubyid_return return kw'>return</span> <span class='rubyid_status identifier id'>status</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_index identifier id'>index</span> <span class='eq op'>==</span> <span class='integer val'>10</span>
        <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_terminate identifier id'>terminate</span>
        <span class='rubyid_raise identifier id'>raise</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Error getting status(retrying): #{e.message}&quot;</span>
      <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>30</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_valid?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>is_valid?</strong>(hostname, ssh_user = &quot;root&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


307
308
309
310
311
312
313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 307</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_is_valid? fid id'>is_valid?</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_@validation_output ivar id'>@validation_output</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ACCEPT_DEVENV_SCRIPT constant id'>ACCEPT_DEVENV_SCRIPT</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@validation_output ivar id'>@validation_output</span> <span class='eq op'>==</span> <span class='string val'>&quot;PASS&quot;</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_true true kw'>true</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Node Acceptance Output = #{@validation_output}&quot;</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_false false kw'>false</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="launch_instance-instance_method">
  
    - (<tt>Object</tt>) <strong>launch_instance</strong>(image, name, max_retries = 1, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 239</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_launch_instance identifier id'>launch_instance</span><span class='lparen token'>(</span><span class='rubyid_image identifier id'>image</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_max_retries identifier id'>max_retries</span> <span class='assign token'>=</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Creating new instance...&quot;</span>

  <span class='comment val'># You may have to retry creating instances since Amazon</span>
  <span class='comment val'># fails at bringing them up every once in a while</span>
  <span class='rubyid_retries identifier id'>retries</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='comment val'># Launch a new instance</span>
  <span class='rubyid_instance identifier id'>instance</span> <span class='assign token'>=</span> <span class='rubyid_image identifier id'>image</span><span class='dot token'>.</span><span class='rubyid_run_instance identifier id'>run_instance</span><span class='lparen token'>(</span><span class='rubyid_$amz_options gvar id'>$amz_options</span><span class='rparen token'>)</span>

  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_add_tag identifier id'>add_tag</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='rparen token'>)</span>

    <span class='comment val'># Block until the instance is accessible</span>
    <span class='rubyid_block_until_available identifier id'>block_until_available</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>

    <span class='rubyid_return return kw'>return</span> <span class='rubyid_instance identifier id'>instance</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_ScriptError constant id'>ScriptError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='comment val'># Handles retrying instance creation for instances that</span>
    <span class='comment val'># didn't come up with SSH access in time</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_retries identifier id'>retries</span> <span class='leq op'>&lt;=</span> <span class='rubyid_max_retries identifier id'>max_retries</span>
      <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Retrying instance creation (attempt #{retries + 1})...&quot;</span>

      <span class='comment val'># Terminate the current instance since it didn't load</span>
      <span class='rubyid_terminate_instance identifier id'>terminate_instance</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>

      <span class='comment val'># Launch a new instance</span>
      <span class='rubyid_instance identifier id'>instance</span> <span class='assign token'>=</span> <span class='rubyid_image identifier id'>image</span><span class='dot token'>.</span><span class='rubyid_run_instance identifier id'>run_instance</span><span class='lparen token'>(</span><span class='rubyid_$amz_options gvar id'>$amz_options</span><span class='rparen token'>)</span>

      <span class='comment val'># Retry the above logic to verify accessibility</span>
      <span class='rubyid_retries identifier id'>retries</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='rubyid_retry retry kw'>retry</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_message identifier id'>message</span>
      <span class='rubyid_exit identifier id'>exit</span> <span class='integer val'>1</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_image-instance_method">
  
    - (<tt>Object</tt>) <strong>register_image</strong>(conn, instance, name, manifest) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 363</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_register_image identifier id'>register_image</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='comma token'>,</span> <span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_manifest identifier id'>manifest</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Registering AMI...&quot;</span>
  <span class='rubyid_outer_num_retries identifier id'>outer_num_retries</span> <span class='assign token'>=</span> <span class='integer val'>4</span>
  <span class='rubyid_image identifier id'>image</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='rubyid_outer_num_retries identifier id'>outer_num_retries</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_outer_index identifier id'>outer_index</span><span class='bitor op'>|</span>
    <span class='rubyid_image identifier id'>image</span> <span class='assign token'>=</span> <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_images identifier id'>images</span><span class='dot token'>.</span><span class='rubyid_create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:instance_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_id identifier id'>id</span><span class='comma token'>,</span> 
      <span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span>
      <span class='symbol val'>:description</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_manifest identifier id'>manifest</span><span class='rparen token'>)</span>
    <span class='rubyid_num_retries identifier id'>num_retries</span> <span class='assign token'>=</span> <span class='integer val'>10</span>
    <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='rubyid_num_retries identifier id'>num_retries</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_index identifier id'>index</span><span class='bitor op'>|</span>
      <span class='rubyid_begin begin kw'>begin</span>
        <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>30</span> <span class='rubyid_until until_mod kw'>until</span> <span class='rubyid_image identifier id'>image</span><span class='dot token'>.</span><span class='rubyid_state identifier id'>state</span> <span class='eq op'>==</span> <span class='symbol val'>:available</span>
        <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Sleeping for 30 seconds to let image stabilize...&quot;</span>
        <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>30</span>
        <span class='rubyid_break break kw'>break</span>
      <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_index identifier id'>index</span> <span class='eq op'>==</span> <span class='rubyid_num_retries identifier id'>num_retries</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_outer_index identifier id'>outer_index</span> <span class='eq op'>==</span> <span class='rubyid_outer_num_retries identifier id'>outer_num_retries</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_index identifier id'>index</span> <span class='eq op'>==</span> <span class='rubyid_num_retries identifier id'>num_retries</span>
          <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Error getting state: #{e.message}&quot;</span>
          <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Deregistering image: #{image.name}&quot;</span>
          <span class='rubyid_image identifier id'>image</span><span class='dot token'>.</span><span class='rubyid_deregister identifier id'>deregister</span>
          <span class='rubyid_image identifier id'>image</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Error getting state(retrying): #{e.message}&quot;</span>
        <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>30</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_break break kw'>break</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_image identifier id'>image</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Image ID: #{image.id}&quot;</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Image Name: #{image.name}&quot;</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Done&quot;</span>
  <span class='rubyid_image identifier id'>image</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_instance_ip-instance_method">
  
    - (<tt>Object</tt>) <strong>set_instance_ip</strong>(hostname, ip, dhostname, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


350
351
352
353
354
355</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 350</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_instance_ip identifier id'>set_instance_ip</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ip identifier id'>ip</span><span class='comma token'>,</span> <span class='rubyid_dhostname identifier id'>dhostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_print identifier id'>print</span> <span class='dstring node'>&quot;Updating the controller to use the ip '#{ip}'...&quot;</span>
  <span class='comment val'># Both calls below are needed to fix a race condition between ssh and libra-data start times</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='dstring node'>&quot;sed -i \&quot;s/.*PUBLIC_IP_OVERRIDE.*/PUBLIC_IP_OVERRIDE='#{ip}'/g\&quot; /etc/openshift/node.conf; sed -i \&quot;s/.*PUBLIC_HOSTNAME_OVERRIDE.*/PUBLIC_HOSTNAME_OVERRIDE='#{dhostname}'/g\&quot; /etc/openshift/node.conf; /usr/libexec/mcollective/update_yaml.rb /etc/mcollective/facts.yaml&quot;</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>'Done'</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_rsa_key-instance_method">
  
    - (<tt>Object</tt>) <strong>setup_rsa_key</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 8</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_setup_rsa_key identifier id'>setup_rsa_key</span>
  <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_RSA constant id'>RSA</span><span class='rparen token'>)</span>
    <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Setting up RSA key...&quot;</span>
    <span class='rubyid_ssh_key identifier id'>ssh_key</span> <span class='assign token'>=</span> <span class='rubyid_RSA_SOURCE constant id'>RSA_SOURCE</span>
    <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Key location = &quot;</span> <span class='plus op'>+</span> <span class='rubyid_ssh_key identifier id'>ssh_key</span>
    <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Destination = &quot;</span> <span class='plus op'>+</span> <span class='rubyid_RSA constant id'>RSA</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_RSA constant id'>RSA</span><span class='rparen token'>)</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span> <span class='integer val'>0700</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_RSA constant id'>RSA</span><span class='rparen token'>)</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_cp identifier id'>cp</span> <span class='rubyid_ssh_key identifier id'>ssh_key</span><span class='comma token'>,</span> <span class='rubyid_RSA constant id'>RSA</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span> <span class='integer val'>0600</span><span class='comma token'>,</span> <span class='rubyid_RSA constant id'>RSA</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_untagged_instances-instance_method">
  
    - (<tt>Object</tt>) <strong>stop_untagged_instances</strong>(conn) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


479
480
481
482
483
484
485
486
487
488
489
490
491</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 479</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_stop_untagged_instances identifier id'>stop_untagged_instances</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='rparen token'>)</span>
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:running</span> <span class='orop op'>||</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:stopped</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>'Name'</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
        <span class='rubyid_tag_to_terminate identifier id'>tag_to_terminate</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span>

        <span class='comment val'># Stop the nodes to save resources</span>
        <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Stopping untagged instance #{i.id} (#{i.tags[&quot;Name&quot;]})&quot;</span>
        <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_stop identifier id'>stop</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tag_to_terminate-instance_method">
  
    - (<tt>Object</tt>) <strong>tag_to_terminate</strong>(i) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


493
494
495
496
497
498</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 493</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_tag_to_terminate identifier id'>tag_to_terminate</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>&quot;Name&quot;</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='notop op'>!</span><span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>&quot;Name&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_end_with? fid id'>end_with?</span><span class='lparen token'>(</span><span class='string val'>'-terminate'</span><span class='rparen token'>)</span>
    <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Tagging instance to terminate #{i.id} (#{i.tags[&quot;Name&quot;]})&quot;</span>
    <span class='rubyid_add_tag identifier id'>add_tag</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{i.tags[&quot;Name&quot;]}-will-terminate&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="terminate_flagged_instances-instance_method">
  
    - (<tt>Object</tt>) <strong>terminate_flagged_instances</strong>(conn) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


399
400
401
402
403
404
405
406
407
408</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 399</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_terminate_flagged_instances identifier id'>terminate_flagged_instances</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='rparen token'>)</span>
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:stopped</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:running</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>&quot;Name&quot;</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='rubyid_TERMINATE_REGEX constant id'>TERMINATE_REGEX</span><span class='rparen token'>)</span>
        <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Terminating #{i.id} (#{i.tags[&quot;Name&quot;]})&quot;</span>
        <span class='rubyid_terminate_instance identifier id'>terminate_instance</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="terminate_instance-instance_method">
  
    - (<tt>Object</tt>) <strong>terminate_instance</strong>(instance, handle_unauthorized = false) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 194</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_terminate_instance identifier id'>terminate_instance</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='comma token'>,</span> <span class='rubyid_handle_unauthorized identifier id'>handle_unauthorized</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_api_termination_disabled? fid id'>api_termination_disabled?</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span>
        <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_terminate identifier id'>terminate</span>
        <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>12</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span>
          <span class='rubyid_break break kw'>break</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:terminated</span>
          <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Instance isn't terminated yet... waiting&quot;</span>
          <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>5</span>
        <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_break break kw'>break</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:terminated</span>
        <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Instance isn't terminated yet... retrying&quot;</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_AWS constant id'>AWS</span><span class='colon2 op'>::</span><span class='rubyid_EC2 constant id'>EC2</span><span class='colon2 op'>::</span><span class='rubyid_Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='rubyid_UnauthorizedOperation constant id'>UnauthorizedOperation</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_handle_unauthorized identifier id'>handle_unauthorized</span>
      <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;You do not have permission to terminate instances.&quot;</span>
    <span class='rubyid_ensure ensure kw'>ensure</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='symbol val'>:terminated</span>
        <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Failed to terminate.  Calling stop instead.&quot;</span>
        <span class='rubyid_tag_to_terminate identifier id'>tag_to_terminate</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
        <span class='rubyid_begin begin kw'>begin</span>
          <span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_stop identifier id'>stop</span>
        <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
          <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Failed to stop: #{e.message}&quot;</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Termination protection is enabled for: #{instance.id} (#{instance.tags[&quot;Name&quot;]})&quot;</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="terminate_old_verifiers-instance_method">
  
    - (<tt>Object</tt>) <strong>terminate_old_verifiers</strong>(conn) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 410</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_terminate_old_verifiers identifier id'>terminate_old_verifiers</span><span class='lparen token'>(</span><span class='rubyid_conn identifier id'>conn</span><span class='rparen token'>)</span>
  <span class='rubyid_AWS constant id'>AWS</span><span class='dot token'>.</span><span class='rubyid_memoize identifier id'>memoize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_build_name_to_verifiers identifier id'>build_name_to_verifiers</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='rubyid_conn identifier id'>conn</span><span class='dot token'>.</span><span class='rubyid_instances identifier id'>instances</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
      <span class='rubyid_VERIFIER_REGEXS constant id'>VERIFIER_REGEXS</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_regex identifier id'>regex</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span><span class='bitor op'>|</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_tags identifier id'>tags</span><span class='lbrack token'>[</span><span class='string val'>&quot;Name&quot;</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='rubyid_regex identifier id'>regex</span>
          <span class='rubyid_build_name identifier id'>build_name</span> <span class='assign token'>=</span> <span class='rubyid_$1 nth_ref id'>$1</span>
          <span class='rubyid_build_num identifier id'>build_num</span> <span class='assign token'>=</span> <span class='rubyid_$2 nth_ref id'>$2</span>
          <span class='rubyid_build_name_to_verifiers identifier id'>build_name_to_verifiers</span><span class='lbrack token'>[</span><span class='rubyid_build_name identifier id'>build_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_build_name_to_verifiers identifier id'>build_name_to_verifiers</span><span class='lbrack token'>[</span><span class='rubyid_build_name identifier id'>build_name</span><span class='rbrack token'>]</span>
          <span class='rubyid_build_name_to_verifiers identifier id'>build_name_to_verifiers</span><span class='lbrack token'>[</span><span class='rubyid_build_name identifier id'>build_name</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='rubyid_build_num identifier id'>build_num</span><span class='comma token'>,</span> <span class='rubyid_i identifier id'>i</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span><span class='rbrack token'>]</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_build_name_to_verifiers identifier id'>build_name_to_verifiers</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_build_name identifier id'>build_name</span><span class='comma token'>,</span> <span class='rubyid_verifiers identifier id'>verifiers</span><span class='bitor op'>|</span>
      <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_verifiers identifier id'>verifiers</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='rubyid_verifiers identifier id'>verifiers</span> <span class='assign token'>=</span> <span class='rubyid_verifiers identifier id'>verifiers</span><span class='dot token'>.</span><span class='rubyid_sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_verifier identifier id'>verifier</span><span class='bitor op'>|</span> <span class='rubyid_verifier identifier id'>verifier</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span><span class='rbrace token'>}</span>
        <span class='rubyid_verifiers identifier id'>verifiers</span><span class='dot token'>.</span><span class='rubyid_each_with_index identifier id'>each_with_index</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_verifier identifier id'>verifier</span><span class='comma token'>,</span> <span class='rubyid_index identifier id'>index</span><span class='bitor op'>|</span>
          <span class='rubyid_build_num identifier id'>build_num</span> <span class='assign token'>=</span> <span class='rubyid_verifier identifier id'>verifier</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
          <span class='rubyid_i identifier id'>i</span> <span class='assign token'>=</span> <span class='rubyid_verifier identifier id'>verifier</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
          <span class='rubyid_opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='rubyid_verifier identifier id'>verifier</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span>
          <span class='rubyid_max_run_time identifier id'>max_run_time</span> <span class='assign token'>=</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:max_run_time</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:max_run_time</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='integer val'>9000</span> <span class='comment val'>#2.5 hours</span>
          <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_index identifier id'>index</span> <span class='eq op'>==</span> <span class='rubyid_verifiers identifier id'>verifiers</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:multiple</span><span class='rbrack token'>]</span>
            <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='minus op'>-</span> <span class='rubyid_i identifier id'>i</span><span class='dot token'>.</span><span class='rubyid_launch_time identifier id'>launch_time</span> <span class='gt op'>&gt;</span> <span class='rubyid_max_run_time identifier id'>max_run_time</span>
              <span class='rubyid_next next kw'>next</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:running</span> <span class='orop op'>||</span> <span class='rubyid_instance_status identifier id'>instance_status</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='symbol val'>:stopped</span>
            <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Terminating verifier #{i.id} (#{i.tags[&quot;Name&quot;]})&quot;</span>
            <span class='rubyid_terminate_instance identifier id'>terminate_instance</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_facts-instance_method">
  
    - (<tt>Object</tt>) <strong>update_facts</strong>(hostname, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


344
345
346
347
348</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 344</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_update_facts identifier id'>update_facts</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Updating instance facts and running libra-data to set the public ip...&quot;</span>
  <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;sed -i \&quot;s/.*PUBLIC_IP_OVERRIDE.*/#PUBLIC_IP_OVERRIDE=/g\&quot; /etc/openshift/node.conf; sed -i \&quot;s/.*PUBLIC_HOSTNAME_OVERRIDE.*/#PUBLIC_HOSTNAME_OVERRIDE=/g\&quot; /etc/openshift/node.conf; /usr/libexec/mcollective/update_yaml.rb /etc/mcollective/facts.yaml; service libra-data start&quot;</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>'Done'</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="use_private_ip-instance_method">
  
    - (<tt>Object</tt>) <strong>use_private_ip</strong>(hostname, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328
329
330</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 326</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_use_private_ip identifier id'>use_private_ip</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_private_ip identifier id'>private_ip</span> <span class='assign token'>=</span> <span class='rubyid_get_private_ip identifier id'>get_private_ip</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Updating instance facts with private ip #{private_ip}&quot;</span>
  <span class='rubyid_set_instance_ip identifier id'>set_instance_ip</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_private_ip identifier id'>private_ip</span><span class='comma token'>,</span> <span class='rubyid_private_ip identifier id'>private_ip</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="use_public_ip-instance_method">
  
    - (<tt>Object</tt>) <strong>use_public_ip</strong>(hostname, ssh_user = &quot;root&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


332
333
334
335
336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 332</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_use_public_ip identifier id'>use_public_ip</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_dhostname identifier id'>dhostname</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;wget -qO- http://169.254.169.254/latest/meta-data/public-hostname&quot;</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_public_ip identifier id'>public_ip</span> <span class='assign token'>=</span> <span class='rubyid_ssh identifier id'>ssh</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='string val'>&quot;wget -qO- http://169.254.169.254/latest/meta-data/public-ipv4&quot;</span><span class='comma token'>,</span> <span class='integer val'>60</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Updating instance facts with public ip #{public_ip} and hostname #{dhostname}&quot;</span>
  <span class='rubyid_set_instance_ip identifier id'>set_instance_ip</span><span class='lparen token'>(</span><span class='rubyid_hostname identifier id'>hostname</span><span class='comma token'>,</span> <span class='rubyid_public_ip identifier id'>public_ip</span><span class='comma token'>,</span> <span class='rubyid_dhostname identifier id'>dhostname</span><span class='comma token'>,</span> <span class='rubyid_ssh_user identifier id'>ssh_user</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="verify_image-instance_method">
  
    - (<tt>Object</tt>) <strong>verify_image</strong>(image) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


357
358
359
360
361</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-dev-tools/build/lib/openshift/amz.rb', line 357</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_verify_image identifier id'>verify_image</span><span class='lparen token'>(</span><span class='rubyid_image identifier id'>image</span><span class='rparen token'>)</span>
  <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Tagging image (#{image.id}) as '#{VERIFIED_TAG}'...&quot;</span>
  <span class='rubyid_image identifier id'>image</span><span class='dot token'>.</span><span class='rubyid_add_tag identifier id'>add_tag</span><span class='lparen token'>(</span><span class='string val'>'Name'</span><span class='comma token'>,</span> <span class='symbol val'>:value</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_VERIFIED_TAG constant id'>VERIFIED_TAG</span><span class='rparen token'>)</span>
  <span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Done&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sun Jun  2 18:45:57 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.8.7).
</div>

  </body>
</html>