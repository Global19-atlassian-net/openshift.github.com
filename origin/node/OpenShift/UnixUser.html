<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OpenShift::UnixUser
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (U)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../OpenShift.html" title="OpenShift (module)">OpenShift</a></span></span>
     &raquo; 
    <span class="title">UnixUser</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OpenShift::UnixUser
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OpenShift::UnixUser</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">ActiveModel::Observing, <span class='object_link'><a href="NodeLogger.html" title="OpenShift::NodeLogger (module)">NodeLogger</a></span>, <span class='object_link'><a href="Utils/ShellExec.html" title="OpenShift::Utils::ShellExec (module)">OpenShift::Utils::ShellExec</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">origin-server/node/lib/openshift-origin-node/model/unix_user.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <h2>Unix User</h2>
<p>
Represents a user account on the system.
</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="DEFAULT_SKEL_DIR-constant" class="">DEFAULT_SKEL_DIR =
          
        </dt>
        <dd><pre class="code"><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Config constant id'>Config</span><span class='colon2 op'>::</span><span class='rubyid_CONF_DIR constant id'>CONF_DIR</span><span class='comma token'>,</span><span class='string val'>&quot;skel&quot;</span><span class='rparen token'>)</span>
</pre></dd>
      
        <dt id="MODIFY_SSH_KEY_MUTEX-classvariable" class="">@@MODIFY_SSH_KEY_MUTEX =
          
        </dt>
        <dd><pre class="code"><span class='rubyid_Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
</pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="NodeLogger.html" title="OpenShift::NodeLogger (module)">NodeLogger</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NodeLogger.html#PROFILES-constant" title="OpenShift::NodeLogger::PROFILES (constant)">NodeLogger::PROFILES</a></span></p>


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#app_name-instance_method" title="#app_name (instance method)">- (Object) <strong>app_name</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute app_name.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#application_uuid-instance_method" title="#application_uuid (instance method)">- (Object) <strong>application_uuid</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute application_uuid.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#container_name-instance_method" title="#container_name (instance method)">- (Object) <strong>container_name</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute container_name.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#container_uuid-instance_method" title="#container_uuid (instance method)">- (Object) <strong>container_uuid</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute container_uuid.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#debug-instance_method" title="#debug (instance method)">- (Object) <strong>debug</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute debug.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#gecos-instance_method" title="#gecos (instance method)">- (Object) <strong>gecos</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute gecos.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#gid-instance_method" title="#gid (instance method)">- (Object) <strong>gid</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute gid.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#homedir-instance_method" title="#homedir (instance method)">- (Object) <strong>homedir</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute homedir.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#namespace-instance_method" title="#namespace (instance method)">- (Object) <strong>namespace</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute namespace.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#quota_blocks-instance_method" title="#quota_blocks (instance method)">- (Object) <strong>quota_blocks</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute quota_blocks.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#quota_files-instance_method" title="#quota_files (instance method)">- (Object) <strong>quota_files</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute quota_files.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#uid-instance_method" title="#uid (instance method)">- (Object) <strong>uid</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute uid.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#uuid-instance_method" title="#uuid (instance method)">- (Object) <strong>uuid</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute uuid.
</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#all-class_method" title="all (class method)">+ (Object) <strong>all</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Return an enumerator which provides a UnixUser object for every
OpenShift user in the system.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#from_uuid-class_method" title="from_uuid (class method)">+ (Object) <strong>from_uuid</strong>(container_uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Return a UnixUser object loaded from the gear_uuid on the system.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ip_addr-class_method" title="get_ip_addr (class method)">+ (Object) <strong>get_ip_addr</strong>(uid, host_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Deterministically constructs an IP address for the given UID based on the
given host identifier (LSB of the IP).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ip_network-class_method" title="get_ip_network (class method)">+ (Object) <strong>get_ip_network</strong>(uid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Deterministically constructs a network and netmask for the given UID.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#kill_procs-class_method" title="kill_procs (class method)">+ (Object) <strong>kill_procs</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Private: Kill all processes for a given gear.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_broker_auth-instance_method" title="#add_broker_auth (instance method)">- (Object) <strong>add_broker_auth</strong>(iv, token) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Add broker authorization keys so gear can communicate with.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_env_var-instance_method" title="#add_env_var (instance method)">- (Object) <strong>add_env_var</strong>(key, value, prefix_cloud_name = false, &amp;blk) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Add an environment variable to a given gear.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_ssh_key-instance_method" title="#add_ssh_key (instance method)">- (Object) <strong>add_ssh_key</strong>(key, key_type = nil, comment = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Append an SSH key to a users authorized_keys file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (Object) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Create an empty gear.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Destroys a gear stopping all processes and removing all files.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ssh_key_cmd_entry-instance_method" title="#get_ssh_key_cmd_entry (instance method)">- (Object) <strong>get_ssh_key_cmd_entry</strong>(key, key_type, comment) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate the command entry for the ssh key to be written into the
authorized keys file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (UnixUser) <strong>initialize</strong>(application_uuid, container_uuid, user_uid = nil, app_name = nil, container_name = nil, namespace = nil, quota_blocks = nil, quota_files = nil, debug = false) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of UnixUser.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_homedir-instance_method" title="#initialize_homedir (instance method)">- (Object) <strong>initialize_homedir</strong>(basedir, homedir, cart_basedir) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
# ~/app-root.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_openshift_port_proxy-instance_method" title="#initialize_openshift_port_proxy (instance method)">- (Object) <strong>initialize_openshift_port_proxy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Private: Initialize OpenShift Port Proxy for this gear.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#list_home_dir-instance_method" title="#list_home_dir (instance method)">- (String) <strong>list_home_dir</strong>(home_dir) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: list directories (cartridges) in home directory.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#modify_ssh_keys-instance_method" title="#modify_ssh_keys (instance method)">- (Hash) <strong>modify_ssh_keys</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
private: Modify ssh authorized_keys file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">- (Object) <strong>name</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#next_uid-instance_method" title="#next_uid (instance method)">- (Object) <strong>next_uid</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Private: Determine next available user id.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#purge_sysvipc-instance_method" title="#purge_sysvipc (instance method)">- (Object) <strong>purge_sysvipc</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Private: Purge IPC entities for a given gear.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_broker_auth-instance_method" title="#remove_broker_auth (instance method)">- (Object) <strong>remove_broker_auth</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Remove broker authentication keys from gear.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_env_var-instance_method" title="#remove_env_var (instance method)">- (Object) <strong>remove_env_var</strong>(key, prefix_cloud_name = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Remove an environment variable from a given gear.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_ssh_key-instance_method" title="#remove_ssh_key (instance method)">- (Object) <strong>remove_ssh_key</strong>(key, comment = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Remove an SSH key from a users authorized_keys file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#replace_ssh_keys-instance_method" title="#replace_ssh_keys (instance method)">- (Object) <strong>replace_ssh_keys</strong>(ssh_keys) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Remove all existing SSH keys and add the new ones to a users
authorized_keys file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_ssh_keys-instance_method" title="#validate_ssh_keys (instance method)">- (Object) <strong>validate_ssh_keys</strong>(ssh_keys) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
validate the ssh keys to check for the required attributes.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="NodeLogger.html" title="OpenShift::NodeLogger (module)">NodeLogger</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NodeLogger.html#build_logger-class_method" title="OpenShift::NodeLogger.build_logger (method)">build_logger</a></span>, <span class='object_link'><a href="NodeLogger.html#logger-instance_method" title="OpenShift::NodeLogger#logger (method)">#logger</a></span>, <span class='object_link'><a href="NodeLogger.html#logger-class_method" title="OpenShift::NodeLogger.logger (method)">logger</a></span>, <span class='object_link'><a href="NodeLogger.html#logger_rebuild-class_method" title="OpenShift::NodeLogger.logger_rebuild (method)">logger_rebuild</a></span>, <span class='object_link'><a href="NodeLogger.html#trace_logger-instance_method" title="OpenShift::NodeLogger#trace_logger (method)">#trace_logger</a></span>, <span class='object_link'><a href="NodeLogger.html#trace_logger-class_method" title="OpenShift::NodeLogger.trace_logger (method)">trace_logger</a></span>, <span class='object_link'><a href="NodeLogger.html#trace_rebuild-class_method" title="OpenShift::NodeLogger.trace_rebuild (method)">trace_rebuild</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Utils/ShellExec.html" title="OpenShift::Utils::ShellExec (module)">OpenShift::Utils::ShellExec</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Utils/ShellExec.html#kill_process_tree-class_method" title="OpenShift::Utils::ShellExec.kill_process_tree (method)">kill_process_tree</a></span>, <span class='object_link'><a href="Utils/ShellExec.html#run_as-class_method" title="OpenShift::Utils::ShellExec.run_as (method)">run_as</a></span>, <span class='object_link'><a href="Utils/ShellExec.html#shellCmd-class_method" title="OpenShift::Utils::ShellExec.shellCmd (method)">shellCmd</a></span>, <span class='object_link'><a href="Utils/ShellExec.html#shellCmd-instance_method" title="OpenShift::Utils::ShellExec#shellCmd (method)">#shellCmd</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="OpenShift::UnixUser (class)">UnixUser</a></span></tt>) <strong>initialize</strong>(application_uuid, container_uuid, user_uid = nil, app_name = nil, container_name = nil, namespace = nil, quota_blocks = nil, quota_files = nil, debug = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
A new instance of UnixUser
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 51</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_application_uuid identifier id'>application_uuid</span><span class='comma token'>,</span> <span class='rubyid_container_uuid identifier id'>container_uuid</span><span class='comma token'>,</span> <span class='rubyid_user_uid identifier id'>user_uid</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span>
    <span class='rubyid_app_name identifier id'>app_name</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_container_name identifier id'>container_name</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_namespace identifier id'>namespace</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_quota_blocks identifier id'>quota_blocks</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_quota_files identifier id'>quota_files</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_debug identifier id'>debug</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_@config ivar id'>@config</span> <span class='assign token'>=</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Config constant id'>Config</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_@cartridge_format ivar id'>@cartridge_format</span> <span class='assign token'>=</span> <span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_Sdk constant id'>Sdk</span><span class='dot token'>.</span><span class='rubyid_node_default_model identifier id'>node_default_model</span><span class='lparen token'>(</span><span class='rubyid_@config ivar id'>@config</span><span class='rparen token'>)</span>

  <span class='rubyid_@container_uuid ivar id'>@container_uuid</span> <span class='assign token'>=</span> <span class='rubyid_container_uuid identifier id'>container_uuid</span>
  <span class='rubyid_@application_uuid ivar id'>@application_uuid</span> <span class='assign token'>=</span> <span class='rubyid_application_uuid identifier id'>application_uuid</span>
  <span class='rubyid_@uuid ivar id'>@uuid</span> <span class='assign token'>=</span> <span class='rubyid_container_uuid identifier id'>container_uuid</span>
  <span class='rubyid_@app_name ivar id'>@app_name</span> <span class='assign token'>=</span> <span class='rubyid_app_name identifier id'>app_name</span>
  <span class='rubyid_@container_name ivar id'>@container_name</span> <span class='assign token'>=</span> <span class='rubyid_container_name identifier id'>container_name</span>
  <span class='rubyid_@namespace ivar id'>@namespace</span> <span class='assign token'>=</span> <span class='rubyid_namespace identifier id'>namespace</span>
  <span class='rubyid_@quota_blocks ivar id'>@quota_blocks</span> <span class='assign token'>=</span> <span class='rubyid_quota_blocks identifier id'>quota_blocks</span>
  <span class='rubyid_@quota_files ivar id'>@quota_files</span> <span class='assign token'>=</span> <span class='rubyid_quota_files identifier id'>quota_files</span>
  <span class='rubyid_@debug ivar id'>@debug</span> <span class='assign token'>=</span> <span class='rubyid_debug identifier id'>debug</span>

  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_user_info identifier id'>user_info</span> <span class='assign token'>=</span> <span class='rubyid_Etc constant id'>Etc</span><span class='dot token'>.</span><span class='rubyid_getpwnam identifier id'>getpwnam</span><span class='lparen token'>(</span><span class='rubyid_@uuid ivar id'>@uuid</span><span class='rparen token'>)</span>
    <span class='rubyid_@uid ivar id'>@uid</span> <span class='assign token'>=</span> <span class='rubyid_user_info identifier id'>user_info</span><span class='dot token'>.</span><span class='rubyid_uid identifier id'>uid</span>
    <span class='rubyid_@gid ivar id'>@gid</span> <span class='assign token'>=</span> <span class='rubyid_user_info identifier id'>user_info</span><span class='dot token'>.</span><span class='rubyid_gid identifier id'>gid</span>
    <span class='rubyid_@gecos ivar id'>@gecos</span> <span class='assign token'>=</span> <span class='rubyid_user_info identifier id'>user_info</span><span class='dot token'>.</span><span class='rubyid_gecos identifier id'>gecos</span>
    <span class='rubyid_@homedir ivar id'>@homedir</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{user_info.dir}/&quot;</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_@uid ivar id'>@uid</span> <span class='assign token'>=</span> <span class='rubyid_user_uid identifier id'>user_uid</span>
    <span class='rubyid_@gid ivar id'>@gid</span> <span class='assign token'>=</span> <span class='rubyid_user_uid identifier id'>user_uid</span>
    <span class='rubyid_@gecos ivar id'>@gecos</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_@homedir ivar id'>@homedir</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="app_name-instance_method">
  
    - (<tt>Object</tt>) <strong>app_name</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute app_name
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_app_name identifier id'>app_name</span>
  <span class='rubyid_@app_name ivar id'>@app_name</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="application_uuid-instance_method">
  
    - (<tt>Object</tt>) <strong>application_uuid</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute application_uuid
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_application_uuid identifier id'>application_uuid</span>
  <span class='rubyid_@application_uuid ivar id'>@application_uuid</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="container_name-instance_method">
  
    - (<tt>Object</tt>) <strong>container_name</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute container_name
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_container_name identifier id'>container_name</span>
  <span class='rubyid_@container_name ivar id'>@container_name</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="container_uuid-instance_method">
  
    - (<tt>Object</tt>) <strong>container_uuid</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute container_uuid
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_container_uuid identifier id'>container_uuid</span>
  <span class='rubyid_@container_uuid ivar id'>@container_uuid</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="debug=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="debug-instance_method">
  
    - (<tt>Object</tt>) <strong>debug</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute debug
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 45</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_debug identifier id'>debug</span>
  <span class='rubyid_@debug ivar id'>@debug</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="gecos-instance_method">
  
    - (<tt>Object</tt>) <strong>gecos</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute gecos
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_gecos identifier id'>gecos</span>
  <span class='rubyid_@gecos ivar id'>@gecos</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="gid-instance_method">
  
    - (<tt>Object</tt>) <strong>gid</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute gid
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_gid identifier id'>gid</span>
  <span class='rubyid_@gid ivar id'>@gid</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="homedir-instance_method">
  
    - (<tt>Object</tt>) <strong>homedir</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute homedir
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_homedir identifier id'>homedir</span>
  <span class='rubyid_@homedir ivar id'>@homedir</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="namespace-instance_method">
  
    - (<tt>Object</tt>) <strong>namespace</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute namespace
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_namespace identifier id'>namespace</span>
  <span class='rubyid_@namespace ivar id'>@namespace</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="quota_blocks-instance_method">
  
    - (<tt>Object</tt>) <strong>quota_blocks</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute quota_blocks
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_quota_blocks identifier id'>quota_blocks</span>
  <span class='rubyid_@quota_blocks ivar id'>@quota_blocks</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="quota_files-instance_method">
  
    - (<tt>Object</tt>) <strong>quota_files</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute quota_files
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_quota_files identifier id'>quota_files</span>
  <span class='rubyid_@quota_files ivar id'>@quota_files</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="uid-instance_method">
  
    - (<tt>Object</tt>) <strong>uid</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute uid
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_uid identifier id'>uid</span>
  <span class='rubyid_@uid ivar id'>@uid</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="uuid-instance_method">
  
    - (<tt>Object</tt>) <strong>uuid</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute uuid
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_uuid identifier id'>uuid</span>
  <span class='rubyid_@uuid ivar id'>@uuid</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="all-class_method">
  
    + (<tt>Object</tt>) <strong>all</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Return an enumerator which provides a UnixUser object for every
OpenShift user in the system.
</p>
<p>
Caveat: the quota information will not be populated.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 820</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_all identifier id'>all</span>
  <span class='rubyid_Enumerator constant id'>Enumerator</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_yielder identifier id'>yielder</span><span class='bitor op'>|</span>
    <span class='rubyid_config identifier id'>config</span> <span class='assign token'>=</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Config constant id'>Config</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
    <span class='rubyid_gecos identifier id'>gecos</span> <span class='assign token'>=</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_GECOS&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='string val'>&quot;OO application container&quot;</span>

    <span class='comment val'># Some duplication with from_uuid; it may be expensive to keep re-parsing passwd.</span>
    <span class='comment val'># Etc is not reentrent.  Capture the password table in one shot.</span>
    <span class='rubyid_pwents identifier id'>pwents</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='rubyid_Etc constant id'>Etc</span><span class='dot token'>.</span><span class='rubyid_passwd identifier id'>passwd</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_pwent identifier id'>pwent</span><span class='bitor op'>|</span>
      <span class='rubyid_pwents identifier id'>pwents</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_pwents identifier id'>pwents</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_pwent identifier id'>pwent</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_gecos identifier id'>gecos</span> <span class='eq op'>==</span> <span class='rubyid_gecos identifier id'>gecos</span>
        <span class='rubyid_u identifier id'>u</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
        <span class='rubyid_begin begin kw'>begin</span>
          <span class='rubyid_env identifier id'>env</span> <span class='assign token'>=</span> <span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_Environ constant id'>Environ</span><span class='dot token'>.</span><span class='rubyid_for_gear identifier id'>for_gear</span><span class='lparen token'>(</span><span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_dir identifier id'>dir</span><span class='rparen token'>)</span>
          <span class='rubyid_u identifier id'>u</span> <span class='assign token'>=</span> <span class='rubyid_UnixUser constant id'>UnixUser</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>&quot;OPENSHIFT_APP_UUID&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_uid identifier id'>uid</span><span class='comma token'>,</span>
                           <span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>&quot;OPENSHIFT_APP_NAME&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>&quot;OPENSHIFT_GEAR_NAME&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
                           <span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'OPENSHIFT_GEAR_DNS'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/\..*$/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/^.*\-/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='rubyid_rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
          <span class='rubyid_NodeLogger constant id'>NodeLogger</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Failed to instantiate UnixUser for #{pwent.uid}: #{e}&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_NodeLogger constant id'>NodeLogger</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Backtrace: #{e.backtrace}&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_yielder identifier id'>yielder</span><span class='dot token'>.</span><span class='rubyid_yield identifier id'>yield</span><span class='lparen token'>(</span><span class='rubyid_u identifier id'>u</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="from_uuid-class_method">
  
    + (<tt>Object</tt>) <strong>from_uuid</strong>(container_uuid) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Return a UnixUser object loaded from the gear_uuid on the system
</p>
<p>
Caveat: the quota information will not be populated.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


801
802
803
804
805
806
807
808
809
810
811
812</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 801</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_from_uuid identifier id'>from_uuid</span><span class='lparen token'>(</span><span class='rubyid_container_uuid identifier id'>container_uuid</span><span class='rparen token'>)</span>
  <span class='rubyid_config identifier id'>config</span> <span class='assign token'>=</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Config constant id'>Config</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_gecos identifier id'>gecos</span> <span class='assign token'>=</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_GECOS&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='string val'>&quot;OO application container&quot;</span>
  <span class='rubyid_pwent identifier id'>pwent</span> <span class='assign token'>=</span> <span class='rubyid_Etc constant id'>Etc</span><span class='dot token'>.</span><span class='rubyid_getpwnam identifier id'>getpwnam</span><span class='lparen token'>(</span><span class='rubyid_container_uuid identifier id'>container_uuid</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_gecos identifier id'>gecos</span> <span class='neq op'>!=</span> <span class='rubyid_gecos identifier id'>gecos</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Not an OpenShift gear: #{gear_uuid}&quot;</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_env identifier id'>env</span> <span class='assign token'>=</span> <span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_Environ constant id'>Environ</span><span class='dot token'>.</span><span class='rubyid_for_gear identifier id'>for_gear</span><span class='lparen token'>(</span><span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_dir identifier id'>dir</span><span class='rparen token'>)</span>
  <span class='rubyid_UnixUser constant id'>UnixUser</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>&quot;OPENSHIFT_APP_UUID&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_pwent identifier id'>pwent</span><span class='dot token'>.</span><span class='rubyid_uid identifier id'>uid</span><span class='comma token'>,</span>
               <span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>&quot;OPENSHIFT_APP_NAME&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>&quot;OPENSHIFT_GEAR_NAME&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
               <span class='rubyid_env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'OPENSHIFT_GEAR_DNS'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/\..*$/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/^.*\-/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_ip_addr-class_method">
  
    + (<tt>Object</tt>) <strong>get_ip_addr</strong>(uid, host_id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Deterministically constructs an IP address for the given UID based on the
given host identifier (LSB of the IP). The host identifier must be a value
between 1-127 inclusive.
</p>
<p>
The global user IP range begins at 0x7F000000.
</p>
<p>
Returns an IP address string in dotted-quad notation.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 759</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_get_ip_addr identifier id'>get_ip_addr</span><span class='lparen token'>(</span><span class='rubyid_uid identifier id'>uid</span><span class='comma token'>,</span> <span class='rubyid_host_id identifier id'>host_id</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;Invalid host_id specified&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_host_id identifier id'>host_id</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_host_id identifier id'>host_id</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Integer constant id'>Integer</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;Invalid UID specified&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_uid identifier id'>uid</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Integer constant id'>Integer</span><span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='orop op'>||</span> <span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='gt op'>&gt;</span> <span class='integer val'>262143</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='dstring node'>&quot;User uid #{@uid} is outside the working range 0-262143&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_host_id identifier id'>host_id</span> <span class='lt op'>&lt;</span> <span class='integer val'>1</span> <span class='orop op'>||</span> <span class='rubyid_host_id identifier id'>host_id</span> <span class='gt op'>&gt;</span> <span class='integer val'>127</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='dstring node'>&quot;Supplied host identifier #{host_id} must be between 1 and 127&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Generate an IP (32-bit unsigned) in the user's range</span>
  <span class='rubyid_ip identifier id'>ip</span> <span class='assign token'>=</span> <span class='integer val'>0x7</span><span class='rubyid_F000000 constant id'>F000000</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='lshft op'>&lt;&lt;</span> <span class='integer val'>7</span><span class='rparen token'>)</span>  <span class='plus op'>+</span> <span class='rubyid_host_id identifier id'>host_id</span>

  <span class='comment val'># Return the IP in dotted-quad notation</span>
  <span class='dstring node'>&quot;#{ip &gt;&gt; 24}.#{ip &gt;&gt; 16 &amp; 0xFF}.#{ip &gt;&gt; 8 &amp; 0xFF}.#{ip &amp; 0xFF}&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_ip_network-class_method">
  
    + (<tt>Object</tt>) <strong>get_ip_network</strong>(uid) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Deterministically constructs a network and netmask for the given UID
</p>
<p>
The global user IP range begins at 0x7F000000.
</p>
<p>
Returns an IP network and netmask in dotted-quad notation.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


783
784
785
786
787
788
789
790
791
792
793
794</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 783</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_get_ip_network identifier id'>get_ip_network</span><span class='lparen token'>(</span><span class='rubyid_uid identifier id'>uid</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;Invalid UID specified&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_uid identifier id'>uid</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Integer constant id'>Integer</span><span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='orop op'>||</span> <span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='gt op'>&gt;</span> <span class='integer val'>262143</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='dstring node'>&quot;User uid #{@uid} is outside the working range 0-262143&quot;</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='comment val'># Generate the network (32-bit unsigned) for the user's range</span>
  <span class='rubyid_ip identifier id'>ip</span> <span class='assign token'>=</span> <span class='integer val'>0x7</span><span class='rubyid_F000000 constant id'>F000000</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='lshft op'>&lt;&lt;</span> <span class='integer val'>7</span><span class='rparen token'>)</span>

  <span class='comment val'># Return the network/netmask in dotted-quad notation</span>
  <span class='lbrack token'>[</span> <span class='dstring node'>&quot;#{ip &gt;&gt; 24}.#{ip &gt;&gt; 16 &amp; 0xFF}.#{ip &gt;&gt; 8 &amp; 0xFF}.#{ip &amp; 0xFF}&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;255.255.255.128&quot;</span> <span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="kill_procs-class_method">
  
    + (<tt>Object</tt>) <strong>kill_procs</strong>(id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Private: Kill all processes for a given gear
</p>
<p>
Kill all processes owned by the uid or uuid. No reason for graceful
shutdown first, the directories and user are going
</p>
<pre class="code ruby18"><code class="ruby18">
  to be removed from the system.
</code></pre>
<p>
Examples: kill_gear_procs
</p>
<pre class="code ruby18"><code class="ruby18">
   =&gt; true
   pkill -u id
</code></pre>
<p>
Raises exception on error.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 627</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_kill_procs identifier id'>kill_procs</span><span class='lparen token'>(</span><span class='rubyid_id identifier id'>id</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_id identifier id'>id</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_id identifier id'>id</span> <span class='eq op'>==</span> <span class='string val'>&quot;&quot;</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Supplied ID must be a uid.&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Give it a good try to delete all processes.</span>
  <span class='comment val'># This abuse is neccessary to release locks on polyinstantiated</span>
  <span class='comment val'>#    directories by pam_namespace.</span>
  <span class='rubyid_out identifier id'>out</span> <span class='assign token'>=</span> <span class='rubyid_err identifier id'>err</span> <span class='assign token'>=</span> <span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='float val'>10</span><span class='dot token'>.</span><span class='rubyid_times identifier id'>times</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExec constant id'>ShellExec</span><span class='dot token'>.</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='dstring node'>%{/usr/bin/pkill -9 -u #{id}}</span><span class='rparen token'>)</span>
    <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span><span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span><span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExec constant id'>ShellExec</span><span class='dot token'>.</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='dstring node'>%{/usr/bin/pgrep -u #{id}}</span><span class='rparen token'>)</span>
    <span class='rubyid_break break kw'>break</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='integer val'>0</span> <span class='eq op'>==</span> <span class='rubyid_rc identifier id'>rc</span>

    <span class='rubyid_NodeLogger constant id'>NodeLogger</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='dstring node'>&quot;ERROR: attempt #{i}/10 there are running \&quot;killed\&quot; processes for #{id}(#{rc}): stdout: #{out} stderr: #{err}&quot;</span>
    <span class='rubyid_sleep identifier id'>sleep</span> <span class='integer val'>0</span><span class='integer val'>.5</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># looks backwards but 0 implies processes still existed</span>
  <span class='rubyid_if if kw'>if</span> <span class='integer val'>0</span> <span class='eq op'>==</span> <span class='rubyid_rc identifier id'>rc</span>
    <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span><span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span><span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExec constant id'>ShellExec</span><span class='dot token'>.</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='dstring node'>&quot;ps -u #{@uid} -o state,pid,ppid,cmd&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_NodeLogger constant id'>NodeLogger</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='dstring node'>&quot;ERROR: failed to kill all processes for #{id}(#{rc}): stdout: #{out} stderr: #{err}&quot;</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_broker_auth-instance_method">
  
    - (<tt>Object</tt>) <strong>add_broker_auth</strong>(iv, token) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Add broker authorization keys so gear can communicate with
</p>
<pre class="code ruby18"><code class="ruby18">
        broker.
</code></pre>
<p>
iv - A String value for the IV file. token - A String value for the token
file.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  add_broker_auth('ivvalue', 'tokenvalue')
  # =&gt; [&quot;/var/lib/openshift/UUID/.auth/iv&quot;,
        &quot;/var/lib/openshift/UUID/.auth/token&quot;]
</code></pre>
<p>
Returns An Array of Strings for the newly created auth files
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 409</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_add_broker_auth identifier id'>add_broker_auth</span><span class='lparen token'>(</span><span class='rubyid_iv identifier id'>iv</span><span class='comma token'>,</span><span class='rubyid_token identifier id'>token</span><span class='rparen token'>)</span>
  <span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span><span class='assign token'>=</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='comma token'>,</span><span class='string val'>'.auth'</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span> <span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span><span class='comma token'>,</span> <span class='string val'>'iv'</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_WRONLY constant id'>WRONLY</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_TRUNC constant id'>TRUNC</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span> <span class='rubyid_iv identifier id'>iv</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span><span class='comma token'>,</span> <span class='string val'>'token'</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_WRONLY constant id'>WRONLY</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_TRUNC constant id'>TRUNC</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span> <span class='rubyid_token identifier id'>token</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown_R identifier id'>oo_chown_R</span><span class='lparen token'>(</span><span class='string val'>&quot;root&quot;</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span><span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rubyid_o0750 identifier id'>o0750</span><span class='comma token'>,</span> <span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rubyid_o0640 identifier id'>o0640</span><span class='comma token'>,</span> <span class='rubyid_Dir constant id'>Dir</span><span class='dot token'>.</span><span class='rubyid_glob identifier id'>glob</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{broker_auth_dir}/*&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_env_var-instance_method">
  
    - (<tt>Object</tt>) <strong>add_env_var</strong>(key, value, prefix_cloud_name = false, &amp;blk) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Add an environment variable to a given gear.
</p>
<p>
key - The String value of target environment variable. value - The String
value to place inside the environment variable. prefix_cloud_name - The
String value to append in front of key.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
 add_env_var('mysql-5.3')
 # =&gt; 36
</code></pre>
<p>
Returns the Integer value for how many bytes got written or raises on
failure.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 336</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_prefix_cloud_name identifier id'>prefix_cloud_name</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_blk identifier id'>blk</span><span class='rparen token'>)</span>
  <span class='rubyid_env_dir identifier id'>env_dir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='comma token'>,</span> <span class='string val'>'.env/'</span><span class='rparen token'>)</span>
  <span class='rubyid_key identifier id'>key</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;OPENSHIFT_#{key}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_prefix_cloud_name identifier id'>prefix_cloud_name</span>

  <span class='rubyid_filename identifier id'>filename</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_env_dir identifier id'>env_dir</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_filename identifier id'>filename</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_WRONLY constant id'>WRONLY</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_TRUNC constant id'>TRUNC</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='symbol val'>:v1</span> <span class='eq op'>==</span> <span class='rubyid_@cartridge_format ivar id'>@cartridge_format</span>
      <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span> <span class='dstring node'>&quot;export #{key}='#{value}'&quot;</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_mcs_label identifier id'>mcs_label</span> <span class='assign token'>=</span> <span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_SELinux constant id'>SELinux</span><span class='dot token'>.</span><span class='rubyid_get_mcs_label identifier id'>get_mcs_label</span><span class='lparen token'>(</span><span class='rubyid_uid identifier id'>uid</span><span class='rparen token'>)</span>
  <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_gid identifier id'>gid</span><span class='comma token'>,</span> <span class='rubyid_filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_SELinux constant id'>SELinux</span><span class='dot token'>.</span><span class='rubyid_set_mcs_label identifier id'>set_mcs_label</span><span class='lparen token'>(</span><span class='rubyid_mcs_label identifier id'>mcs_label</span><span class='comma token'>,</span> <span class='rubyid_filename identifier id'>filename</span><span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_block_given? fid id'>block_given?</span>
    <span class='rubyid_blk identifier id'>blk</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_ssh_key-instance_method">
  
    - (<tt>Object</tt>) <strong>add_ssh_key</strong>(key, key_type = nil, comment = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Append an SSH key to a users authorized_keys file
</p>
<p>
key - The String value of the ssh key. key_type - The String value of the
key type ssh-(rsa|dss)). comment - The String value of the comment to
append to the key.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  add_ssh_key('AAAAB3NzaC1yc2EAAAADAQABAAABAQDE0DfenPIHn5Bq/...',
              'ssh-rsa',
              'example@example.com')
  # =&gt; nil
</code></pre>
<p>
Returns nil on Success or raises on Failure
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


261
262
263
264
265
266
267
268
269
270
271
272</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 261</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_add_ssh_key identifier id'>add_ssh_key</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_key_type identifier id'>key_type</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_comment identifier id'>comment</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='rubyid_comment identifier id'>comment</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_comment identifier id'>comment</span>
  <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:before_add_ssh_key</span><span class='comma token'>,</span> <span class='rubyid_self self kw'>self</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>

  <span class='rubyid_ssh_comment identifier id'>ssh_comment</span><span class='comma token'>,</span> <span class='rubyid_cmd_entry identifier id'>cmd_entry</span> <span class='assign token'>=</span> <span class='rubyid_get_ssh_key_cmd_entry identifier id'>get_ssh_key_cmd_entry</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_key_type identifier id'>key_type</span><span class='comma token'>,</span> <span class='rubyid_comment identifier id'>comment</span><span class='rparen token'>)</span>

  <span class='rubyid_modify_ssh_keys identifier id'>modify_ssh_keys</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_keys identifier id'>keys</span><span class='bitor op'>|</span>
    <span class='rubyid_keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='rubyid_ssh_comment identifier id'>ssh_comment</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_cmd_entry identifier id'>cmd_entry</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:after_add_ssh_key</span><span class='comma token'>,</span> <span class='rubyid_self self kw'>self</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-instance_method">
  
    - (<tt>Object</tt>) <strong>create</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Create an empty gear.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  create
  # =&gt; nil
  # a user
  # Setup permissions
</code></pre>
<p>
Returns nil on Success or raises on Failure
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 94</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_create identifier id'>create</span>
  <span class='rubyid_skel_dir identifier id'>skel_dir</span> <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_SKEL_DIR&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='rubyid_DEFAULT_SKEL_DIR constant id'>DEFAULT_SKEL_DIR</span>
  <span class='rubyid_shell identifier id'>shell</span>    <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_SHELL&quot;</span><span class='rparen token'>)</span>     <span class='orop op'>||</span> <span class='string val'>&quot;/bin/bash&quot;</span>
  <span class='rubyid_gecos identifier id'>gecos</span>    <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_GECOS&quot;</span><span class='rparen token'>)</span>     <span class='orop op'>||</span> <span class='string val'>&quot;OO application container&quot;</span>
  <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:before_unix_user_create</span><span class='rparen token'>)</span>
  <span class='rubyid_basedir identifier id'>basedir</span> <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_BASE_DIR&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_supplementary_groups identifier id'>supplementary_groups</span> <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_SUPL_GRPS&quot;</span><span class='rparen token'>)</span>

  <span class='comment val'># lock to prevent race condition between create and delete of gear</span>
  <span class='rubyid_uuid_lock_file identifier id'>uuid_lock_file</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;/var/lock/oo-create.#{@uuid}&quot;</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_uuid_lock_file identifier id'>uuid_lock_file</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_RDWR constant id'>RDWR</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rubyid_o0600 identifier id'>o0600</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span> <span class='rubyid_uuid_lock identifier id'>uuid_lock</span> <span class='bitor op'>|</span>
    <span class='rubyid_uuid_lock identifier id'>uuid_lock</span><span class='dot token'>.</span><span class='rubyid_fcntl identifier id'>fcntl</span><span class='lparen token'>(</span><span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_F_SETFD constant id'>F_SETFD</span><span class='comma token'>,</span> <span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_FD_CLOEXEC constant id'>FD_CLOEXEC</span><span class='rparen token'>)</span>
    <span class='rubyid_uuid_lock identifier id'>uuid_lock</span><span class='dot token'>.</span><span class='rubyid_flock identifier id'>flock</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_LOCK_EX constant id'>LOCK_EX</span><span class='rparen token'>)</span>

    <span class='comment val'># Lock to prevent race condition on obtaining a UNIX user uid.</span>
    <span class='comment val'># When running without districts, there is a simple search on the</span>
    <span class='comment val'>#   passwd file for the next available uid.</span>
    <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;/var/lock/oo-create&quot;</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_RDWR constant id'>RDWR</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rubyid_o0600 identifier id'>o0600</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span> <span class='rubyid_uid_lock identifier id'>uid_lock</span> <span class='bitor op'>|</span>
      <span class='rubyid_uid_lock identifier id'>uid_lock</span><span class='dot token'>.</span><span class='rubyid_fcntl identifier id'>fcntl</span><span class='lparen token'>(</span><span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_F_SETFD constant id'>F_SETFD</span><span class='comma token'>,</span> <span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_FD_CLOEXEC constant id'>FD_CLOEXEC</span><span class='rparen token'>)</span>
      <span class='rubyid_uid_lock identifier id'>uid_lock</span><span class='dot token'>.</span><span class='rubyid_flock identifier id'>flock</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_LOCK_EX constant id'>LOCK_EX</span><span class='rparen token'>)</span>

      <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_@uid ivar id'>@uid</span>
        <span class='rubyid_@uid ivar id'>@uid</span> <span class='assign token'>=</span> <span class='rubyid_@gid ivar id'>@gid</span> <span class='assign token'>=</span> <span class='rubyid_next_uid identifier id'>next_uid</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_@homedir ivar id'>@homedir</span>
        <span class='rubyid_@homedir ivar id'>@homedir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_basedir identifier id'>basedir</span><span class='comma token'>,</span><span class='rubyid_@uuid ivar id'>@uuid</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='dstring node'>%{useradd -u #{@uid} \
              -d #{@homedir} \
              -s #{shell} \
              -c '#{gecos}' \
              -m \
              -k #{skel_dir} \
              #{@uuid}}</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_supplementary_groups identifier id'>supplementary_groups</span> <span class='neq op'>!=</span> <span class='string val'>&quot;&quot;</span>
        <span class='rubyid_cmd identifier id'>cmd</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>%{ -G &quot;#{supplementary_groups}&quot;}</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span><span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span><span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_UserCreationException constant id'>UserCreationException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
              <span class='dstring node'>&quot;ERROR: unable to create user account(#{rc}): #{cmd.squeeze(&quot; &quot;)} stdout: #{out} stderr: #{err}&quot;</span>
              <span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_rc identifier id'>rc</span> <span class='eq op'>==</span> <span class='integer val'>0</span>

      <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='string val'>&quot;root&quot;</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span>
      <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span> <span class='integer val'>0</span><span class='rubyid_o0750 identifier id'>o0750</span><span class='comma token'>,</span> <span class='rubyid_@homedir ivar id'>@homedir</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;CREATE_APP_SYMLINKS&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
        <span class='rubyid_unobfuscated identifier id'>unobfuscated</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span><span class='comma token'>,</span><span class='dstring node'>&quot;#{@container_name}-#{namespace}&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span> <span class='rubyid_unobfuscated identifier id'>unobfuscated</span>
          <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_ln_s identifier id'>ln_s</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_basename identifier id'>basename</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_unobfuscated identifier id'>unobfuscated</span><span class='comma token'>,</span> <span class='symbol val'>:force=</span><span class='gt op'>&gt;</span><span class='rubyid_true true kw'>true</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:after_unix_user_create</span><span class='rparen token'>)</span>
    <span class='rubyid_initialize_homedir identifier id'>initialize_homedir</span><span class='lparen token'>(</span><span class='rubyid_basedir identifier id'>basedir</span><span class='comma token'>,</span> <span class='rubyid_@homedir ivar id'>@homedir</span><span class='comma token'>,</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;CARTRIDGE_BASE_PATH&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rubyid_initialize_openshift_port_proxy identifier id'>initialize_openshift_port_proxy</span>

    <span class='rubyid_uuid_lock identifier id'>uuid_lock</span><span class='dot token'>.</span><span class='rubyid_flock identifier id'>flock</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_LOCK_UN constant id'>LOCK_UN</span><span class='rparen token'>)</span>
    <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_unlink identifier id'>unlink</span><span class='lparen token'>(</span><span class='rubyid_uuid_lock_file identifier id'>uuid_lock_file</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Destroys a gear stopping all processes and removing all files
</p>
<p>
The order of the calls and gyrations done in this code is to prevent
</p>
<pre class="code ruby18"><code class="ruby18">
  pam_namespace from locking polyinstantiated directories during
  their deletion. If you see &quot;broken&quot; gears, i.e. ~uuid/.tmp and
   ~/uuid/.sandbox after #destroy has been called, this method is broken.
</code></pre>
<p>
See Bug 853582 for history.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  destroy
  # =&gt; nil
</code></pre>
<p>
Returns nil on Success or raises on Failure
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="UserDeletionException.html" title="OpenShift::UserDeletionException (class)">UserDeletionException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 171</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_destroy identifier id'>destroy</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@uid ivar id'>@uid</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_or or kw'>or</span> <span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_or or kw'>or</span> <span class='notop op'>!</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_directory? fid id'>directory?</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='comment val'># gear seems to have been destroyed already... suppress any error</span>
    <span class='comment val'># TODO : remove remaining stuff if it exists, e.g. .httpd/#{uuid}* etc</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_UserDeletionException constant id'>UserDeletionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
        <span class='dstring node'>&quot;ERROR: unable to destroy user account #{@uuid}&quot;</span>
        <span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>

  <span class='comment val'># Don't try to delete a gear that is being scaled-up|created|deleted</span>
  <span class='rubyid_uuid_lock_file identifier id'>uuid_lock_file</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;/var/lock/oo-create.#{@uuid}&quot;</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_uuid_lock_file identifier id'>uuid_lock_file</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_RDWR constant id'>RDWR</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rubyid_o0600 identifier id'>o0600</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span> <span class='rubyid_lock identifier id'>lock</span> <span class='bitor op'>|</span>
    <span class='rubyid_lock identifier id'>lock</span><span class='dot token'>.</span><span class='rubyid_fcntl identifier id'>fcntl</span><span class='lparen token'>(</span><span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_F_SETFD constant id'>F_SETFD</span><span class='comma token'>,</span> <span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_FD_CLOEXEC constant id'>FD_CLOEXEC</span><span class='rparen token'>)</span>
    <span class='rubyid_lock identifier id'>lock</span><span class='dot token'>.</span><span class='rubyid_flock identifier id'>flock</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_LOCK_EX constant id'>LOCK_EX</span><span class='rparen token'>)</span>

    <span class='comment val'># These calls and their order is designed to release pam_namespace's</span>
    <span class='comment val'>#   locks on .tmp and .sandbox. Change then at your peril.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># 1. Kill off the easy processes</span>
    <span class='comment val'># 2. Lock down the user from creating new processes (cgroups freeze, nprocs 0)</span>
    <span class='comment val'># 3. Attempt to move any processes that didn't die into state 'D' (re: cgroups freeze)</span>
    <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_kill_procs identifier id'>kill_procs</span><span class='lparen token'>(</span><span class='rubyid_@uid ivar id'>@uid</span><span class='rparen token'>)</span>
    <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:before_unix_user_destroy</span><span class='rparen token'>)</span>
    <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_kill_procs identifier id'>kill_procs</span><span class='lparen token'>(</span><span class='rubyid_@uid ivar id'>@uid</span><span class='rparen token'>)</span>

    <span class='rubyid_purge_sysvipc identifier id'>purge_sysvipc</span><span class='lparen token'>(</span><span class='rubyid_uuid identifier id'>uuid</span><span class='rparen token'>)</span>
    <span class='rubyid_initialize_openshift_port_proxy identifier id'>initialize_openshift_port_proxy</span>

    <span class='rubyid_if if kw'>if</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;CREATE_APP_SYMLINKS&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
      <span class='rubyid_Dir constant id'>Dir</span><span class='dot token'>.</span><span class='rubyid_foreach identifier id'>foreach</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_dent identifier id'>dent</span><span class='bitor op'>|</span>
        <span class='rubyid_unobfuscate identifier id'>unobfuscate</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_dent identifier id'>dent</span><span class='rparen token'>)</span>
        <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_symlink? fid id'>symlink?</span><span class='lparen token'>(</span><span class='rubyid_unobfuscate identifier id'>unobfuscate</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
            <span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_readlink identifier id'>readlink</span><span class='lparen token'>(</span><span class='rubyid_unobfuscate identifier id'>unobfuscate</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_basename identifier id'>basename</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_unlink identifier id'>unlink</span><span class='lparen token'>(</span><span class='rubyid_unobfuscate identifier id'>unobfuscate</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_FrontendHttpServer constant id'>FrontendHttpServer</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_@container_uuid ivar id'>@container_uuid</span><span class='comma token'>,</span><span class='rubyid_@container_name ivar id'>@container_name</span><span class='comma token'>,</span><span class='rubyid_@namespace ivar id'>@namespace</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_destroy identifier id'>destroy</span>

    <span class='rubyid_dirs identifier id'>dirs</span> <span class='assign token'>=</span> <span class='rubyid_list_home_dir identifier id'>list_home_dir</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span>
    <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;userdel -f \&quot;#{@uuid}\&quot;&quot;</span>
    <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span><span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span><span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_UserDeletionException constant id'>UserDeletionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
          <span class='dstring node'>&quot;ERROR: unable to destroy user account(#{rc}): #{cmd} stdout: #{out} stderr: #{err}&quot;</span>
          <span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_rc identifier id'>rc</span> <span class='eq op'>==</span> <span class='integer val'>0</span>

    <span class='comment val'># 1. Don't believe everything you read on the userdel man page...</span>
    <span class='comment val'># 2. If there are any active processes left pam_namespace is not going</span>
    <span class='comment val'>#      to let polyinstantiated directories be deleted.</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_rm_rf identifier id'>rm_rf</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span>
      <span class='comment val'># Ops likes the verbose verbage</span>
      <span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_warn identifier id'>warn</span> <span class='dstring node'>%Q{
1st attempt to remove \'#{@homedir}\' from filesystem failed.
Dir(before)   #{@uuid}/#{@uid} =&gt; #{dirs}
Dir(after)    #{@uuid}/#{@uid} =&gt; #{list_home_dir(@homedir)}
      }</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='comment val'># release resources (cgroups thaw), this causes Zombies to get killed</span>
    <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:after_unix_user_destroy</span><span class='rparen token'>)</span>

    <span class='comment val'># try one last time...</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span>
      <span class='rubyid_sleep identifier id'>sleep</span><span class='lparen token'>(</span><span class='integer val'>5</span><span class='rparen token'>)</span>                    <span class='comment val'># don't fear the reaper</span>
      <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_rm_rf identifier id'>rm_rf</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span>   <span class='comment val'># This is our last chance to nuke the polyinstantiated directories</span>
      <span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_warn identifier id'>warn</span><span class='lparen token'>(</span><span class='dstring node'>&quot;2nd attempt to remove \'#{@homedir}\' from filesystem failed.&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_lock identifier id'>lock</span><span class='dot token'>.</span><span class='rubyid_flock identifier id'>flock</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_LOCK_UN constant id'>LOCK_UN</span><span class='rparen token'>)</span>
    <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_unlink identifier id'>unlink</span><span class='lparen token'>(</span><span class='rubyid_uuid_lock_file identifier id'>uuid_lock_file</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_ssh_key_cmd_entry-instance_method">
  
    - (<tt>Object</tt>) <strong>get_ssh_key_cmd_entry</strong>(key, key_type, comment) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Generate the command entry for the ssh key to be written into the
authorized keys file
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


728
729
730
731
732
733
734
735
736</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 728</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_ssh_key_cmd_entry identifier id'>get_ssh_key_cmd_entry</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_key_type identifier id'>key_type</span><span class='comma token'>,</span> <span class='rubyid_comment identifier id'>comment</span><span class='rparen token'>)</span>
  <span class='rubyid_key_type identifier id'>key_type</span>    <span class='assign token'>=</span> <span class='string val'>&quot;ssh-rsa&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_key_type identifier id'>key_type</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_strip identifier id'>strip</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
  <span class='rubyid_cloud_name identifier id'>cloud_name</span>  <span class='assign token'>=</span> <span class='string val'>&quot;OPENSHIFT&quot;</span>
  <span class='rubyid_ssh_comment identifier id'>ssh_comment</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{cloud_name}-#{@uuid}-#{comment}&quot;</span>
  <span class='rubyid_shell identifier id'>shell</span>       <span class='assign token'>=</span> <span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_SHELL&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='string val'>&quot;/bin/bash&quot;</span>
  <span class='rubyid_cmd_entry identifier id'>cmd_entry</span>   <span class='assign token'>=</span> <span class='dstring node'>&quot;command=\&quot;#{shell}\&quot;,no-X11-forwarding #{key_type} #{key} #{ssh_comment}&quot;</span>
  
  <span class='lbrack token'>[</span><span class='rubyid_ssh_comment identifier id'>ssh_comment</span><span class='comma token'>,</span> <span class='rubyid_cmd_entry identifier id'>cmd_entry</span><span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_homedir-instance_method">
  
    - (<tt>Object</tt>) <strong>initialize_homedir</strong>(basedir, homedir, cart_basedir) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
# ~/app-root
</p>
<pre class="code ruby18"><code class="ruby18">
  # ~/app-root/data
  # ~/app-root/runtime/repo
  # ~/app-root/repo -&gt; runtime/repo
  # ~/app-root/runtime/data -&gt; ../data
</code></pre>
<p>
Returns nil on Success and raises on Failure.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 460</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize_homedir identifier id'>initialize_homedir</span><span class='lparen token'>(</span><span class='rubyid_basedir identifier id'>basedir</span><span class='comma token'>,</span> <span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='rubyid_cart_basedir identifier id'>cart_basedir</span><span class='rparen token'>)</span>
  <span class='rubyid_@homedir ivar id'>@homedir</span> <span class='assign token'>=</span> <span class='rubyid_homedir identifier id'>homedir</span>
  <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:before_initialize_homedir</span><span class='rparen token'>)</span>
  <span class='rubyid_homedir identifier id'>homedir</span> <span class='assign token'>=</span> <span class='rubyid_homedir identifier id'>homedir</span><span class='dot token'>.</span><span class='rubyid_end_with? fid id'>end_with?</span><span class='lparen token'>(</span><span class='string val'>'/'</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='rubyid_homedir identifier id'>homedir</span> <span class='colon op'>:</span> <span class='rubyid_homedir identifier id'>homedir</span> <span class='plus op'>+</span> <span class='string val'>'/'</span>

  <span class='comment val'># Required for polyinstantiated tmp dirs to work</span>
  <span class='lbrack token'>[</span><span class='string val'>&quot;.tmp&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;.sandbox&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_poly_dir identifier id'>poly_dir</span><span class='bitor op'>|</span>
    <span class='rubyid_full_poly_dir identifier id'>full_poly_dir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='rubyid_poly_dir identifier id'>poly_dir</span><span class='rparen token'>)</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span> <span class='rubyid_full_poly_dir identifier id'>full_poly_dir</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rubyid_o0000 identifier id'>o0000</span><span class='comma token'>,</span> <span class='rubyid_full_poly_dir identifier id'>full_poly_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Polydir runs before the marker is created so set up sandbox by hand</span>
  <span class='rubyid_sandbox_uuid_dir identifier id'>sandbox_uuid_dir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='string val'>&quot;.sandbox&quot;</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span> <span class='rubyid_sandbox_uuid_dir identifier id'>sandbox_uuid_dir</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_@cartridge_format ivar id'>@cartridge_format</span> <span class='eq op'>==</span> <span class='symbol val'>:v1</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rubyid_o1755 identifier id'>o1755</span><span class='comma token'>,</span> <span class='rubyid_sandbox_uuid_dir identifier id'>sandbox_uuid_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_sandbox_uuid_dir identifier id'>sandbox_uuid_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_env_dir identifier id'>env_dir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='string val'>&quot;.env&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span><span class='lparen token'>(</span><span class='rubyid_env_dir identifier id'>env_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rubyid_o0750 identifier id'>o0750</span><span class='comma token'>,</span> <span class='rubyid_env_dir identifier id'>env_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_env_dir identifier id'>env_dir</span><span class='rparen token'>)</span>

  <span class='rubyid_ssh_dir identifier id'>ssh_dir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='string val'>&quot;.ssh&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span><span class='lparen token'>(</span><span class='rubyid_ssh_dir identifier id'>ssh_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rubyid_o0750 identifier id'>o0750</span><span class='comma token'>,</span> <span class='rubyid_ssh_dir identifier id'>ssh_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_ssh_dir identifier id'>ssh_dir</span><span class='rparen token'>)</span>

  <span class='rubyid_geardir identifier id'>geardir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='rubyid_@container_name ivar id'>@container_name</span><span class='comma token'>,</span> <span class='string val'>&quot;/&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_gearappdir identifier id'>gearappdir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='string val'>&quot;app-root&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/&quot;</span><span class='rparen token'>)</span>

  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;APP_DNS&quot;</span><span class='comma token'>,</span>
              <span class='dstring node'>&quot;#{@app_name}-#{@namespace}.#{@config.get(&quot;CLOUD_DOMAIN&quot;)}&quot;</span><span class='comma token'>,</span>
              <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;APP_NAME&quot;</span><span class='comma token'>,</span> <span class='rubyid_@app_name ivar id'>@app_name</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;APP_UUID&quot;</span><span class='comma token'>,</span> <span class='rubyid_@application_uuid ivar id'>@application_uuid</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>

  <span class='rubyid_data_dir identifier id'>data_dir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_gearappdir identifier id'>gearappdir</span><span class='comma token'>,</span> <span class='string val'>&quot;data&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;DATA_DIR&quot;</span><span class='comma token'>,</span> <span class='rubyid_data_dir identifier id'>data_dir</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span><span class='lparen token'>(</span><span class='rubyid_v identifier id'>v</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;HISTFILE&quot;</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_data_dir identifier id'>data_dir</span><span class='comma token'>,</span> <span class='string val'>&quot;.bash_history&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_profile identifier id'>profile</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_data_dir identifier id'>data_dir</span><span class='comma token'>,</span> <span class='string val'>&quot;.bash_profile&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_profile identifier id'>profile</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_WRONLY constant id'>WRONLY</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_TRUNC constant id'>TRUNC</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rubyid_o0600 identifier id'>o0600</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span> <span class='string val'>%Q{
# Warning: Be careful with modifications to this file,
#          Your changes may cause your application to fail.
}</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_profile identifier id'>profile</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>


  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_DNS&quot;</span><span class='comma token'>,</span>
              <span class='dstring node'>&quot;#{@container_name}-#{@namespace}.#{@config.get(&quot;CLOUD_DOMAIN&quot;)}&quot;</span><span class='comma token'>,</span>
              <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_NAME&quot;</span><span class='comma token'>,</span> <span class='rubyid_@container_name ivar id'>@container_name</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_UUID&quot;</span><span class='comma token'>,</span> <span class='rubyid_@container_uuid ivar id'>@container_uuid</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>

  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;HOMEDIR&quot;</span><span class='comma token'>,</span> <span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>

  <span class='comment val'># Ensure HOME exists for git support</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;HOME&quot;</span><span class='comma token'>,</span> <span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>

  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;PATH&quot;</span><span class='comma token'>,</span>
              <span class='dstring node'>&quot;#{cart_basedir}/abstract-httpd/info/bin/:#{cart_basedir}/abstract/info/bin/:/bin:/sbin:/usr/bin:/usr/sbin:/$PATH&quot;</span><span class='comma token'>,</span>
              <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>

  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;REPO_DIR&quot;</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_gearappdir identifier id'>gearappdir</span><span class='comma token'>,</span> <span class='string val'>&quot;runtime&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;repo&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_mkdir_p identifier id'>mkdir_p</span><span class='lparen token'>(</span><span class='rubyid_v identifier id'>v</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_cd identifier id'>cd</span> <span class='rubyid_gearappdir identifier id'>gearappdir</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_d identifier id'>d</span><span class='bitor op'>|</span>
      <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_ln_s identifier id'>ln_s</span><span class='lparen token'>(</span><span class='string val'>&quot;runtime/repo&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;repo&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_cd identifier id'>cd</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_gearappdir identifier id'>gearappdir</span><span class='comma token'>,</span> <span class='string val'>&quot;runtime&quot;</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_d identifier id'>d</span><span class='bitor op'>|</span>
      <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_ln_s identifier id'>ln_s</span><span class='lparen token'>(</span><span class='string val'>&quot;../data&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;data&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rbrace token'>}</span>

  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;TMP_DIR&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/tmp/&quot;</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;TMP_DIR&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/tmp/&quot;</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;TMPDIR&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/tmp/&quot;</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_add_env_var identifier id'>add_env_var</span><span class='lparen token'>(</span><span class='string val'>&quot;TMP&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/tmp/&quot;</span><span class='comma token'>,</span> <span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>

  <span class='comment val'># Update all directory entries ~/app-root/*</span>
  <span class='rubyid_Dir constant id'>Dir</span><span class='lbrack token'>[</span><span class='rubyid_gearappdir identifier id'>gearappdir</span> <span class='plus op'>+</span> <span class='string val'>&quot;/*&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_entries identifier id'>entries</span><span class='dot token'>.</span><span class='rubyid_reject identifier id'>reject</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_e identifier id'>e</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='string val'>&quot;.&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;..&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span> <span class='rubyid_e identifier id'>e</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_e identifier id'>e</span><span class='bitor op'>|</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_chmod_R identifier id'>chmod_R</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rubyid_o0750 identifier id'>o0750</span><span class='comma token'>,</span> <span class='rubyid_e identifier id'>e</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>
    <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown_R identifier id'>oo_chown_R</span><span class='lparen token'>(</span><span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_e identifier id'>e</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_gearappdir identifier id'>gearappdir</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='dstring node'>&quot;Failed to instantiate gear: missing application directory (#{gearappdir})&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='rubyid_gearappdir identifier id'>gearappdir</span><span class='rparen token'>)</span>

  <span class='rubyid_state_file identifier id'>state_file</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_gearappdir identifier id'>gearappdir</span><span class='comma token'>,</span> <span class='string val'>&quot;runtime&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;.state&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_state_file identifier id'>state_file</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_WRONLY constant id'>WRONLY</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_TRUNC constant id'>TRUNC</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rubyid_o0660 identifier id'>o0660</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span> <span class='string val'>&quot;new\n&quot;</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown identifier id'>oo_chown</span><span class='lparen token'>(</span><span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_state_file identifier id'>state_file</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@debug ivar id'>@debug</span><span class='rparen token'>)</span>

  <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_FrontendHttpServer constant id'>FrontendHttpServer</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_@container_uuid ivar id'>@container_uuid</span><span class='comma token'>,</span><span class='rubyid_@container_name ivar id'>@container_name</span><span class='comma token'>,</span><span class='rubyid_@namespace ivar id'>@namespace</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_create identifier id'>create</span>

  <span class='comment val'># Fix SELinux context for cart dirs</span>
  <span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_SELinux constant id'>SELinux</span><span class='dot token'>.</span><span class='rubyid_clear_mcs_label_R identifier id'>clear_mcs_label_R</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='rparen token'>)</span>
  <span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_SELinux constant id'>SELinux</span><span class='dot token'>.</span><span class='rubyid_set_mcs_label_R identifier id'>set_mcs_label_R</span><span class='lparen token'>(</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_SELinux constant id'>SELinux</span><span class='dot token'>.</span><span class='rubyid_get_mcs_label identifier id'>get_mcs_label</span><span class='lparen token'>(</span><span class='rubyid_@uid ivar id'>@uid</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_Dir constant id'>Dir</span><span class='dot token'>.</span><span class='rubyid_glob identifier id'>glob</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_homedir identifier id'>homedir</span><span class='comma token'>,</span> <span class='string val'>'*'</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:after_initialize_homedir</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_openshift_port_proxy-instance_method">
  
    - (<tt>Object</tt>) <strong>initialize_openshift_port_proxy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Private: Initialize OpenShift Port Proxy for this gear
</p>
<p>
The port proxy range is determined by configuration and must produce
identical results to the abstract cartridge provided range.
</p>
<p>
Examples: initialize_openshift_port_proxy
</p>
<pre class="code ruby18"><code class="ruby18">
   =&gt; true
   service openshift_port_proxy setproxy 35000 delete 35001 delete etc...
</code></pre>
<p>
Returns:
</p>
<pre class="code ruby18"><code class="ruby18">
   true   - port proxy could be initialized properly
   false  - port proxy could not be initialized properly
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


604
605
606
607
608
609
610
611</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 604</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize_openshift_port_proxy identifier id'>initialize_openshift_port_proxy</span>
  <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:before_initialize_openshift_port_proxy</span><span class='rparen token'>)</span>

  <span class='rubyid_proxy_server identifier id'>proxy_server</span> <span class='assign token'>=</span> <span class='rubyid_FrontendProxyServer constant id'>FrontendProxyServer</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_proxy_server identifier id'>proxy_server</span><span class='dot token'>.</span><span class='rubyid_delete_all_for_uid identifier id'>delete_all_for_uid</span><span class='lparen token'>(</span><span class='rubyid_@uid ivar id'>@uid</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>

  <span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:after_initialize_openshift_port_proxy</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="list_home_dir-instance_method">
  
    - (<tt>String</tt>) <strong>list_home_dir</strong>(home_dir) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: list directories (cartridges) in home directory
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>home</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
directory
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
comma separated list of directories
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


361
362
363
364
365
366
367
368
369
370</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 361</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_list_home_dir identifier id'>list_home_dir</span><span class='lparen token'>(</span><span class='rubyid_home_dir identifier id'>home_dir</span><span class='rparen token'>)</span>
  <span class='rubyid_results identifier id'>results</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_home_dir identifier id'>home_dir</span><span class='rparen token'>)</span>
    <span class='rubyid_Dir constant id'>Dir</span><span class='dot token'>.</span><span class='rubyid_foreach identifier id'>foreach</span><span class='lparen token'>(</span><span class='rubyid_home_dir identifier id'>home_dir</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_entry identifier id'>entry</span><span class='bitor op'>|</span>
      <span class='comment val'>#next if entry =~ /^\.{1,2}/   # Ignore &quot;.&quot;, &quot;..&quot;, or hidden files</span>
      <span class='rubyid_results identifier id'>results</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_entry identifier id'>entry</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_results identifier id'>results</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>', '</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="modify_ssh_keys-instance_method">
  
    - (<tt>Hash</tt>) <strong>modify_ssh_keys</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
private: Modify ssh authorized_keys file
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
authorized keys with the comment field as the key
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 688</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_modify_ssh_keys identifier id'>modify_ssh_keys</span>
  <span class='rubyid_authorized_keys_file identifier id'>authorized_keys_file</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='comma token'>,</span> <span class='string val'>&quot;.ssh&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;authorized_keys&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_keys identifier id'>keys</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>

  <span class='rubyid_@@MODIFY_SSH_KEY_MUTEX ivar id'>@@MODIFY_SSH_KEY_MUTEX</span><span class='dot token'>.</span><span class='rubyid_synchronize identifier id'>synchronize</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;/var/lock/oo-modify-ssh-keys&quot;</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_RDWR constant id'>RDWR</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rubyid_o0600 identifier id'>o0600</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span> <span class='rubyid_lock identifier id'>lock</span> <span class='bitor op'>|</span>
      <span class='rubyid_lock identifier id'>lock</span><span class='dot token'>.</span><span class='rubyid_fcntl identifier id'>fcntl</span><span class='lparen token'>(</span><span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_F_SETFD constant id'>F_SETFD</span><span class='comma token'>,</span> <span class='rubyid_Fcntl constant id'>Fcntl</span><span class='colon2 op'>::</span><span class='rubyid_FD_CLOEXEC constant id'>FD_CLOEXEC</span><span class='rparen token'>)</span>
      <span class='rubyid_lock identifier id'>lock</span><span class='dot token'>.</span><span class='rubyid_flock identifier id'>flock</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_LOCK_EX constant id'>LOCK_EX</span><span class='rparen token'>)</span>
      <span class='rubyid_begin begin kw'>begin</span>
        <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span><span class='lparen token'>(</span><span class='rubyid_authorized_keys_file identifier id'>authorized_keys_file</span><span class='comma token'>,</span> <span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_RDWR constant id'>RDWR</span><span class='bitor op'>|</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_CREAT constant id'>CREAT</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rubyid_o0440 identifier id'>o0440</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_file identifier id'>file</span><span class='bitor op'>|</span>
          <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_each_line identifier id'>each_line</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_line identifier id'>line</span><span class='bitor op'>|</span>
            <span class='rubyid_begin begin kw'>begin</span>
              <span class='rubyid_keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_chomp identifier id'>chomp</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_chomp identifier id'>chomp</span>
            <span class='rubyid_rescue rescue kw'>rescue</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_if if kw'>if</span> <span class='rubyid_block_given? fid id'>block_given?</span>
            <span class='rubyid_old_keys identifier id'>old_keys</span> <span class='assign token'>=</span> <span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>

            <span class='rubyid_yield yield kw'>yield</span> <span class='rubyid_keys identifier id'>keys</span>

            <span class='rubyid_if if kw'>if</span> <span class='rubyid_old_keys identifier id'>old_keys</span> <span class='neq op'>!=</span> <span class='rubyid_keys identifier id'>keys</span>
              <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_seek identifier id'>seek</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_IO constant id'>IO</span><span class='colon2 op'>::</span><span class='rubyid_SEEK_SET constant id'>SEEK_SET</span><span class='rparen token'>)</span>
              <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span><span class='lparen token'>(</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_values identifier id'>values</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span><span class='plus op'>+</span><span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span>
              <span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_truncate identifier id'>truncate</span><span class='lparen token'>(</span><span class='rubyid_file identifier id'>file</span><span class='dot token'>.</span><span class='rubyid_tell identifier id'>tell</span><span class='rparen token'>)</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_PathUtils constant id'>PathUtils</span><span class='dot token'>.</span><span class='rubyid_oo_chown_R identifier id'>oo_chown_R</span><span class='lparen token'>(</span><span class='string val'>'root'</span><span class='comma token'>,</span> <span class='rubyid_@uuid ivar id'>@uuid</span><span class='comma token'>,</span> <span class='rubyid_authorized_keys_file identifier id'>authorized_keys_file</span><span class='rparen token'>)</span>
        <span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='dstring node'>&quot;restorecon #{authorized_keys_file}&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_ensure ensure kw'>ensure</span>
        <span class='rubyid_lock identifier id'>lock</span><span class='dot token'>.</span><span class='rubyid_flock identifier id'>flock</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='colon2 op'>::</span><span class='rubyid_LOCK_UN constant id'>LOCK_UN</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_keys identifier id'>keys</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="name-instance_method">
  
    - (<tt>Object</tt>) <strong>name</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 80</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_name identifier id'>name</span>
  <span class='rubyid_@uuid ivar id'>@uuid</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="next_uid-instance_method">
  
    - (<tt>Object</tt>) <strong>next_uid</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Private: Determine next available user id. This is usually determined
</p>
<pre class="code ruby18"><code class="ruby18">
          and provided by the broker but is auto determined if not
          provided.
</code></pre>
<p>
Examples:
</p>
<pre class="code ruby18"><code class="ruby18">
  next_uid =&gt;
  # =&gt; 504
</code></pre>
<p>
Returns Integer value for next available uid.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


577
578
579
580
581
582
583
584
585
586
587
588</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 577</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_next_uid identifier id'>next_uid</span>
  <span class='rubyid_uids identifier id'>uids</span> <span class='assign token'>=</span> <span class='rubyid_IO constant id'>IO</span><span class='dot token'>.</span><span class='rubyid_readlines identifier id'>readlines</span><span class='lparen token'>(</span><span class='string val'>&quot;/etc/passwd&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_line identifier id'>line</span><span class='bitor op'>|</span> <span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='rbrace token'>}</span>
  <span class='rubyid_gids identifier id'>gids</span> <span class='assign token'>=</span> <span class='rubyid_IO constant id'>IO</span><span class='dot token'>.</span><span class='rubyid_readlines identifier id'>readlines</span><span class='lparen token'>(</span><span class='string val'>&quot;/etc/group&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_line identifier id'>line</span><span class='bitor op'>|</span> <span class='rubyid_line identifier id'>line</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span> <span class='rbrace token'>}</span>
  <span class='rubyid_min_uid identifier id'>min_uid</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_MIN_UID&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='string val'>&quot;500&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span>
  <span class='rubyid_max_uid identifier id'>max_uid</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_@config ivar id'>@config</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;GEAR_MAX_UID&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='string val'>&quot;1500&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span>

  <span class='lparen token'>(</span><span class='rubyid_min_uid identifier id'>min_uid</span><span class='dot2 op'>..</span><span class='rubyid_max_uid identifier id'>max_uid</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_uids identifier id'>uids</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span> <span class='rubyid_and and kw'>and</span> <span class='notop op'>!</span><span class='rubyid_gids identifier id'>gids</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_i identifier id'>i</span><span class='rparen token'>)</span>
      <span class='rubyid_return return kw'>return</span> <span class='rubyid_i identifier id'>i</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="purge_sysvipc-instance_method">
  
    - (<tt>Object</tt>) <strong>purge_sysvipc</strong>(id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Private: Purge IPC entities for a given gear
</p>
<p>
Enumerate and remove all IPC entities for a given user ID or user name.
</p>
<p>
Examples: purge_sysvipc
</p>
<pre class="code ruby18"><code class="ruby18">
   =&gt; true
   ipcs -c
   ipcrm -s id
   ipcrm -m id
</code></pre>
<p>
Raises exception on error.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 666</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_purge_sysvipc identifier id'>purge_sysvipc</span><span class='lparen token'>(</span><span class='rubyid_id identifier id'>id</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_id identifier id'>id</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_id identifier id'>id</span> <span class='eq op'>==</span> <span class='string val'>&quot;&quot;</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Supplied ID must be a user name or uid.&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='lbrack token'>[</span><span class='string val'>'-m'</span><span class='comma token'>,</span> <span class='string val'>'-q'</span><span class='comma token'>,</span> <span class='string val'>'-s'</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_ipctype identifier id'>ipctype</span><span class='bitor op'>|</span>
    <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span><span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span><span class='rubyid_rc identifier id'>rc</span><span class='assign token'>=</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='dstring node'>%{/usr/bin/ipcs -c #{ipctype} 2&gt; /dev/null}</span><span class='rparen token'>)</span>
    <span class='rubyid_out identifier id'>out</span><span class='dot token'>.</span><span class='rubyid_lines identifier id'>lines</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_ipcl identifier id'>ipcl</span><span class='bitor op'>|</span>
      <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_ipcl identifier id'>ipcl</span><span class='match op'>=~</span><span class='regexp val'>/^\d/</span>
      <span class='rubyid_ipcent identifier id'>ipcent</span> <span class='assign token'>=</span> <span class='rubyid_ipcl identifier id'>ipcl</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_ipcent identifier id'>ipcent</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_id identifier id'>id</span>
        <span class='comment val'># The ID may already be gone</span>
        <span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='dstring node'>%{/usr/bin/ipcrm #{ipctype} #{ipcent[0]}}</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_broker_auth-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_broker_auth</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Remove broker authentication keys from gear.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  remove_broker_auth
  # =&gt; nil
</code></pre>
<p>
Returns nil on Success and false on Failure
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


433
434
435
436
437</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 433</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_remove_broker_auth identifier id'>remove_broker_auth</span>
  <span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span><span class='assign token'>=</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='comma token'>,</span> <span class='string val'>'.auth'</span><span class='rparen token'>)</span>
  <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_rm_rf identifier id'>rm_rf</span> <span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span>
  <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_broker_auth_dir identifier id'>broker_auth_dir</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='rubyid_false false kw'>false</span> <span class='colon op'>:</span> <span class='rubyid_true true kw'>true</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_env_var-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_env_var</strong>(key, prefix_cloud_name = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Remove an environment variable from a given gear.
</p>
<p>
key - String name of the environment variable to remove. prefix_cloud_name
- String prefix to append to key.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  remove_env_var('OPENSHIFT_MONGODB_DB_URL')
  # =&gt; nil
</code></pre>
<p>
Returns an nil on success and false on failure.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


383
384
385
386
387
388
389
390
391
392
393
394
395</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 383</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_remove_env_var identifier id'>remove_env_var</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_prefix_cloud_name identifier id'>prefix_cloud_name</span><span class='assign token'>=</span><span class='rubyid_false false kw'>false</span><span class='rparen token'>)</span>
  <span class='rubyid_status identifier id'>status</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
  <span class='lbrack token'>[</span><span class='string val'>&quot;.env&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;.env/.uservars&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_path identifier id'>path</span><span class='bitor op'>|</span>
    <span class='rubyid_env_dir identifier id'>env_dir</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_@homedir ivar id'>@homedir</span><span class='comma token'>,</span><span class='rubyid_path identifier id'>path</span><span class='rparen token'>)</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_prefix_cloud_name identifier id'>prefix_cloud_name</span>
      <span class='rubyid_key identifier id'>key</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;OPENSHIFT_#{key}&quot;</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_env_file_path identifier id'>env_file_path</span> <span class='assign token'>=</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_env_dir identifier id'>env_dir</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='rubyid_FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rubyid_rm_f identifier id'>rm_f</span> <span class='rubyid_env_file_path identifier id'>env_file_path</span>
    <span class='rubyid_status identifier id'>status</span> <span class='assign token'>=</span> <span class='rubyid_status identifier id'>status</span> <span class='integer val'>? </span><span class='rubyid_true true kw'>true</span> <span class='colon op'>:</span> <span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='rubyid_env_file_path identifier id'>env_file_path</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='rubyid_false false kw'>false</span> <span class='colon op'>:</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_status identifier id'>status</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_ssh_key-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_ssh_key</strong>(key, comment = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Remove an SSH key from a users authorized_keys file.
</p>
<p>
key - The String value of the ssh key. comment - The String value of the
comment associated with the key.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  remove_ssh_key('AAAAB3NzaC1yc2EAAAADAQABAAABAQDE0DfenPIHn5Bq/...',
              'example@example.com')
  # =&gt; nil
</code></pre>
<p>
Returns nil on Success or raises on Failure
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


286
287
288
289
290
291
292
293
294</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 286</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_remove_ssh_key identifier id'>remove_ssh_key</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_comment identifier id'>comment</span><span class='assign token'>=</span><span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:before_remove_ssh_key</span><span class='comma token'>,</span> <span class='rubyid_self self kw'>self</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>

  <span class='rubyid_modify_ssh_keys identifier id'>modify_ssh_keys</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_keys identifier id'>keys</span><span class='bitor op'>|</span>
    <span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_delete_if identifier id'>delete_if</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:after_remove_ssh_key</span><span class='comma token'>,</span> <span class='rubyid_self self kw'>self</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace_ssh_keys-instance_method">
  
    - (<tt>Object</tt>) <strong>replace_ssh_keys</strong>(ssh_keys) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Remove all existing SSH keys and add the new ones to a users
authorized_keys file.
</p>
<p>
ssh_keys - The Array of ssh keys.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  replace_ssh_keys([{'key' =&gt; AAAAB3NzaC1yc2EAAAADAQABAAABAQDE0DfenPIHn5Bq/...', 'type' =&gt; 'ssh-rsa', 'name' =&gt; 'key1'}])
  # =&gt; nil
</code></pre>
<p>
Returns nil on Success or raises on Failure
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 306</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_replace_ssh_keys identifier id'>replace_ssh_keys</span><span class='lparen token'>(</span><span class='rubyid_ssh_keys identifier id'>ssh_keys</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_Exception constant id'>Exception</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'The provided ssh keys do not have the required attributes'</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_validate_ssh_keys identifier id'>validate_ssh_keys</span><span class='lparen token'>(</span><span class='rubyid_ssh_keys identifier id'>ssh_keys</span><span class='rparen token'>)</span>
  
  <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:before_replace_ssh_keys</span><span class='comma token'>,</span> <span class='rubyid_self self kw'>self</span><span class='rparen token'>)</span>

  <span class='rubyid_modify_ssh_keys identifier id'>modify_ssh_keys</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_keys identifier id'>keys</span><span class='bitor op'>|</span>
    <span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_delete_if identifier id'>delete_if</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='rubyid_true true kw'>true</span> <span class='rbrace token'>}</span>
    
    <span class='rubyid_ssh_keys identifier id'>ssh_keys</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='bitor op'>|</span>
      <span class='rubyid_ssh_comment identifier id'>ssh_comment</span><span class='comma token'>,</span> <span class='rubyid_cmd_entry identifier id'>cmd_entry</span> <span class='assign token'>=</span> <span class='rubyid_get_ssh_key_cmd_entry identifier id'>get_ssh_key_cmd_entry</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='lbrack token'>[</span><span class='string val'>'key'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='lbrack token'>[</span><span class='string val'>'type'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='lbrack token'>[</span><span class='string val'>'comment'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='rubyid_keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='rubyid_ssh_comment identifier id'>ssh_comment</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_cmd_entry identifier id'>cmd_entry</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_notify_observers identifier id'>notify_observers</span><span class='lparen token'>(</span><span class='symbol val'>:after_replace_ssh_keys</span><span class='comma token'>,</span> <span class='rubyid_self self kw'>self</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_ssh_keys-instance_method">
  
    - (<tt>Object</tt>) <strong>validate_ssh_keys</strong>(ssh_keys) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
validate the ssh keys to check for the required attributes
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


739
740
741
742
743
744
745
746
747
748
749
750</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/model/unix_user.rb', line 739</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_validate_ssh_keys identifier id'>validate_ssh_keys</span><span class='lparen token'>(</span><span class='rubyid_ssh_keys identifier id'>ssh_keys</span><span class='rparen token'>)</span>
  <span class='rubyid_ssh_keys identifier id'>ssh_keys</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='bitor op'>|</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_key identifier id'>key</span><span class='lbrack token'>[</span><span class='string val'>'key'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_key identifier id'>key</span><span class='lbrack token'>[</span><span class='string val'>'type'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_key identifier id'>key</span><span class='lbrack token'>[</span><span class='string val'>'comment'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
        <span class='rubyid_return return kw'>return</span> <span class='rubyid_false false kw'>false</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_ex identifier id'>ex</span>
      <span class='rubyid_return return kw'>return</span> <span class='rubyid_false false kw'>false</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_true true kw'>true</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon May 20 18:40:01 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.8.7).
</div>

  </body>
</html>