<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  File: Installing OpenShift Origin Manually
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Installing OpenShift Origin Manually</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Installing OpenShift Origin Manually</h1>

<p>This document describes how to create a private PaaS service using OpenShift. It makes a number of simplifying assumptions about the environment of the service. In particular, we will assume that the underlying platform is Fedora 18 with Ruby 1.9. You may have to adjust the configuration for a different environment.</p>

<p>The document is organized into two. The first part will take the reader, step-by-step, through the process of installing and configuring a broker and one or more nodes. And, the second part will explain and demonstrate the operation of the new installation using the rhc tool.</p>

<h2>Part I: Installation and Configuration</h2>

<p>The instructions in this section describe how to install and configure a basic OpenShift PaaS environment with a broker and one or more nodes. These instructions are intended for Linux administrators and developers with intermediate level experience. They are extremely detailed in order to demonstrate the variety of settings you may configure and where to do so.</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_In constant id'>In</span> <span class='rubyid_the identifier id'>the</span> <span class='rubyid_following identifier id'>following</span> <span class='rubyid_steps identifier id'>steps</span><span class='comma token'>,</span> <span class='rubyid_it identifier id'>it</span> <span class='rubyid_is identifier id'>is</span> <span class='rubyid_recommended identifier id'>recommended</span> <span class='rubyid_that identifier id'>that</span> <span class='rubyid_you identifier id'>you</span> <span class='rubyid_back identifier id'>back</span> <span class='rubyid_up identifier id'>up</span> <span class='rubyid_any identifier id'>any</span> <span class='rubyid_files identifier id'>files</span> <span class='rubyid_that identifier id'>that</span> <span class='rubyid_you identifier id'>you</span> <span class='rubyid_change identifier id'>change</span> <span class='rubyid_by identifier id'>by</span> <span class='rubyid_running identifier id'>running</span> <span class='lparen token'>(</span><span class='rubyid_for for kw'>for</span> <span class='rubyid_example identifier id'>example</span><span class='rparen token'>)</span> 
<span class='rubyid_cp identifier id'>cp</span> <span class='rubyid_foo identifier id'>foo</span> <span class='rubyid_foo identifier id'>foo</span><span class='dot token'>.</span><span class='rubyid_orig identifier id'>orig</span> <span class='comment val'>#before editing the file foo</span>
</code></pre>

<h3>Preliminary Information</h3>

<p>Before proceeding with the installation and configuration, this section provides some basic information and requirements for installing OpenShift PaaS.</p>

<h3>Supported Operating Systems</h3>

<p>This installation relies on a current Fedora 18 installation as its base. We recommend installing the &quot;Basic Server&quot; configuration for a base install, though others should work too.</p>

<h3>Hardware Requirements</h3>

<p>Although the instructions in this document have been primarily tested on KVM virtual machines, the instructions are applicable to other environments.</p>

<p>Below are the hardware requirements for all hosts, whether configured as a broker or as a node. The hardware requirements are applicable for both physical and virtual environments.</p>

<p>Minimum 1 GB of memory
Minimum 8 GB of hard disk space
x86_64 architecture
Network connectivity (Preferibly static IPs)</p>

<h3>Service Parameters</h3>

<p>In this example of a basic OpenShift installation, the broker and node are configured with the following parameters:</p>

<p>Service Domain: <code>example.com</code>
Broker IP address: dynamic (from DHCP)
Broker host name: <code>broker.example.com</code></p>

<p>Node 0 IP address: dynamic (from DHCP)
Node 0 host name: <code>node.example.com</code></p>

<p>Data Store Service: MongoDB
Authentication Service: Basic Authentication via httpd <code>mod_auth_basic</code>
DNS Service: <code>BIND</code>
IP address: dynamic (from DHCP)
Zone: example.com (same as Service Domain)
Domain Suffix: <code>example.com</code> (same as Service Domain)</p>

<p>Messaging Service: MCollective using ActiveMQ</p>

<p>All of these parameters can be customized as necessary. As detailed in the instructions, the domain name and host names can be easily modified by editing appropriate configuration files. The selection of data-store service, authentication service, and DNS server are implemented as plug-ins to the broker.</p>

<p>Note that while DHCP is supported and assumed in this document, dynamic re-assignment of IP addresses is not supported and may cause problems.</p>

<h3>DNS Information</h3>

<p>The OpenShift PaaS service publishes the host names of new applications to DNS. The DNS update service negotiates with the owner of a domain so that a sub domain can be allocated. It also establishes authentication credentials to allow automatic updates. The sample configuration uses a private DNS service to allow the OpenShift PaaS service to publish new host names without requiring access to an official DNS service. The application host names will only be visible on the OpenShift PaaS hosts and any workstation configured to use the configured DNS service, unless properly delegated by a public DNS service.</p>

<p>The creation of a private DNS service and establishing a delegation agreement with your IT department are outside the scope of this document. Each organization has its own policies and procedures for managing DNS services. If you want to make the OpenShift PaaS service available in any way, you will have to discuss the delegation requirements at your site with the appropriate personnel.</p>

<h3>Puppet based installation</h3>

<p>For your convenience, a <a href="file.install_origin_using_puppet.html">puppet based installed</a> script for configuring a host as a broker or as a node (or as both) is available.</p>

<p>The steps in this document explain the actions of the puppet recipe. The steps and the script are independent in the sense that you can obtain a complete broker or node host just by following the steps manually or just by running the kickstart script. For your convenience, we will point to the corresponding part of the puppet recipe for each section in the steps below.</p>

<h3>Setting up Time Synchronization</h3>

<p>OpenShift requires NTP to synchronize the system and hardware clocks. This synchronization is necessary for communication between the broker and node hosts; if the clocks are too far out of synchronization, MCollective will drop messages. It is also helpful to have accurate timestamps on files and in log file entries.</p>

<p>On the host, use the ntpdate command to set the system clock (use whatever NTP servers are appropriate for your environment):</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_ntpdate identifier id'>ntpdate</span> <span class='rubyid_clock identifier id'>clock</span><span class='dot token'>.</span><span class='rubyid_redhat identifier id'>redhat</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span>
</code></pre>

<p>You will also want to configure ntpd via /etc/ntp.conf to keep the clock synchronized during operation.</p>

<p>If you get the error message &quot;the NTP socket is in use, exiting,&quot; then ntpd is already running, but the clock may not be synchronized if it starts too far off. You should stop the service while executing this command.</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_service identifier id'>service</span> <span class='rubyid_ntpd identifier id'>ntpd</span> <span class='rubyid_stop identifier id'>stop</span>
<span class='rubyid_ntpdate identifier id'>ntpdate</span> <span class='rubyid_clock identifier id'>clock</span><span class='dot token'>.</span><span class='rubyid_redhat identifier id'>redhat</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span>
<span class='rubyid_service identifier id'>service</span> <span class='rubyid_ntpd identifier id'>ntpd</span> <span class='rubyid_start identifier id'>start</span>
</code></pre>

<p>If you are installing on physical hardware, use the hwclock command to synchronize the hardware clock to the system clock. If you are running on a virtual machine, such as an Amazon EC2 instance, skip this step. Otherwise, enter the following command:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_hwclock identifier id'>hwclock</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='rubyid_systohc identifier id'>systohc</span>

<span class='rubyid_Ref constant id'>Ref</span><span class='colon op'>:</span> <span class='rubyid_https identifier id'>https</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/o</span><span class='rubyid_penshift identifier id'>penshift</span><span class='div op'>/</span><span class='rubyid_puppet identifier id'>puppet</span><span class='minus op'>-</span><span class='rubyid_openshift_origin identifier id'>openshift_origin</span><span class='div op'>/</span><span class='rubyid_blob identifier id'>blob</span><span class='div op'>/</span><span class='rubyid_master identifier id'>master</span><span class='div op'>/</span><span class='rubyid_manifests identifier id'>manifests</span><span class='div op'>/</span><span class='rubyid_ntpd identifier id'>ntpd</span><span class='dot token'>.</span><span class='rubyid_pp identifier id'>pp</span>
</code></pre>

<h3>Enabling Remote Administration</h3>

<p>It may be desirable to install SSH keys for the root user so that you can interact with the hosts remotely from your personal workstation. First, ensure that root&#39;s ssh configuration directory exists and has the correct permissions on the host:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_mkdir identifier id'>mkdir</span> <span class='regexp val'>/root/</span><span class='dot token'>.</span><span class='rubyid_ssh identifier id'>ssh</span>
<span class='rubyid_chmod identifier id'>chmod</span> <span class='integer val'>700</span> <span class='div op'>/</span><span class='rubyid_root identifier id'>root</span><span class='div op'>/</span><span class='dot token'>.</span><span class='rubyid_ssh identifier id'>ssh</span>
</code></pre>

<p>On your workstation, you can either use the ssh-keygen command to generate a new keypair, or use an existing public key. In either case, edit the <em>/root/.ssh/authorized_keys</em> file on the host and append the public key, or use the ssh-copy-id command to do the same. For example, on your local workstation, you can issue the following command:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_ssh identifier id'>ssh</span><span class='minus op'>-</span><span class='rubyid_copy identifier id'>copy</span><span class='minus op'>-</span><span class='rubyid_id identifier id'>id</span> <span class='rubyid_root identifier id'>root</span><span class='rubyid_@10 ivar id'>@10</span><span class='float val'>.0.0</span><span class='integer val'>.1</span>
</code></pre>

<p>Replace &quot;10.0.0.1&quot; with the actual IP address of the broker in the above command.</p>

<h3>Setting up Host 1 as a Broker with Related Components</h3>

<p>This section describes how to install and configure the first OpenShift host, which will be running the Broker, MongoDB, ActiveMQ, and BIND. Each logical component is broken out into an individual section.</p>

<p>You should perform all of the procedures in this section after you have installed and configured the base operating system and before you start installing and configuring any node hosts.</p>

<h4>Setting up the Required Repositories</h4>

<p>OpenShift Origin currently relies on many packages that are not in Fedora and must be retrieved from OpenShift repositories.</p>

<h5>OpenShift Origin Dependencies</h5>

<p>Ref: <a href="https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/init.pp#L265">https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/init.pp#L265</a></p>

<p>File: /etc/yum.repos.d/openshift-origin-deps.repo</p>

<p>Contents:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrack token'>[</span><span class='rubyid_openshift identifier id'>openshift</span><span class='minus op'>-</span><span class='rubyid_origin identifier id'>origin</span><span class='minus op'>-</span><span class='rubyid_deps identifier id'>deps</span><span class='rbrack token'>]</span>
<span class='rubyid_name identifier id'>name</span><span class='assign token'>=</span><span class='rubyid_openshift identifier id'>openshift</span><span class='minus op'>-</span><span class='rubyid_origin identifier id'>origin</span><span class='minus op'>-</span><span class='rubyid_deps identifier id'>deps</span>
<span class='rubyid_baseurl identifier id'>baseurl</span><span class='assign token'>=</span><span class='rubyid_https identifier id'>https</span><span class='symbol val'>:/</span><span class='regexp val'>/mirror.openshift.com/</span><span class='rubyid_pub identifier id'>pub</span><span class='div op'>/</span><span class='rubyid_openshift identifier id'>openshift</span><span class='minus op'>-</span><span class='rubyid_origin identifier id'>origin</span><span class='div op'>/</span><span class='rubyid_fedora identifier id'>fedora</span><span class='minus op'>-</span><span class='integer val'>18</span><span class='div op'>/</span><span class='rubyid_$basearch gvar id'>$basearch</span><span class='div op'>/</span>
<span class='rubyid_gpgcheck identifier id'>gpgcheck</span><span class='assign token'>=</span><span class='integer val'>0</span>
<span class='rubyid_enabled identifier id'>enabled</span><span class='assign token'>=</span><span class='integer val'>1</span>
</code></pre>

<h5>OpenShift Origin RPMs</h5>

<p>Ref: <a href="https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/init.pp#L278">https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/init.pp#L278</a></p>

<p>File: /etc/yum.repos.d/openshift-origin.repo</p>

<p>Contents:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrack token'>[</span><span class='rubyid_openshift identifier id'>openshift</span><span class='minus op'>-</span><span class='rubyid_origin identifier id'>origin</span><span class='rbrack token'>]</span>
<span class='rubyid_name identifier id'>name</span><span class='assign token'>=</span><span class='rubyid_openshift identifier id'>openshift</span><span class='minus op'>-</span><span class='rubyid_origin identifier id'>origin</span>
<span class='rubyid_baseurl identifier id'>baseurl</span><span class='assign token'>=</span><span class='rubyid_https identifier id'>https</span><span class='symbol val'>:/</span><span class='regexp val'>/mirror.openshift.com/</span><span class='rubyid_pub identifier id'>pub</span><span class='div op'>/</span><span class='rubyid_openshift identifier id'>openshift</span><span class='minus op'>-</span><span class='rubyid_origin identifier id'>origin</span><span class='div op'>/</span><span class='rubyid_nightly identifier id'>nightly</span><span class='div op'>/</span><span class='rubyid_fedora identifier id'>fedora</span><span class='minus op'>-</span><span class='integer val'>18</span><span class='div op'>/</span><span class='rubyid_latest identifier id'>latest</span><span class='div op'>/</span><span class='rubyid_$basearch gvar id'>$basearch</span><span class='div op'>/</span>
<span class='rubyid_gpgcheck identifier id'>gpgcheck</span><span class='assign token'>=</span><span class='integer val'>0</span>
<span class='rubyid_enabled identifier id'>enabled</span><span class='assign token'>=</span><span class='integer val'>1</span>
</code></pre>

<h5>Jenkins</h5>

<p>Ref: <a href="https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/node.pp#L362">https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/node.pp#L362</a></p>

<p>File: /etc/yum.repos.d/jenkins.repo</p>

<p>Contents:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrack token'>[</span><span class='rubyid_jenkins identifier id'>jenkins</span><span class='rbrack token'>]</span>
<span class='rubyid_name identifier id'>name</span><span class='assign token'>=</span><span class='rubyid_jenkins identifier id'>jenkins</span>
<span class='rubyid_baseurl identifier id'>baseurl</span><span class='assign token'>=</span><span class='rubyid_http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/pkg.jenkins-ci.org/</span><span class='rubyid_redhat identifier id'>redhat</span>
<span class='rubyid_gpgcheck identifier id'>gpgcheck</span><span class='assign token'>=</span><span class='integer val'>1</span>
<span class='rubyid_enabled identifier id'>enabled</span><span class='assign token'>=</span><span class='integer val'>1</span>
</code></pre>

<p>Import repository key:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_rpm identifier id'>rpm</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='rubyid_import identifier id'>import</span> <span class='rubyid_http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/pkg.jenkins-ci.org/</span><span class='rubyid_redhat identifier id'>redhat</span><span class='div op'>/</span><span class='rubyid_jenkins identifier id'>jenkins</span><span class='minus op'>-</span><span class='rubyid_ci identifier id'>ci</span><span class='dot token'>.</span><span class='rubyid_org identifier id'>org</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span>
</code></pre>

<p><em>RUNNING YUM UPDATE</em></p>

<p>To update all of the base packages needed for these instructions, run the following command.</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_yum identifier id'>yum</span> <span class='rubyid_update identifier id'>update</span>
</code></pre>

<p>It is important to do this to ensure at least the selinux-policy package is updated, as OpenShift relies on a recent update to this package.</p>

<h4>Setting up BIND / DNS</h4>

<p>In this section, we will configure BIND on the broker. Skip this section if you have alternative arrangements for handling DNS updates from OpenShift.
If you wish to have OpenShift update an existing BIND server in your infrastructure, it should be fairly apparent from the ensuing setup how to enable that. If you are using something different, the DNS update plugin can be swapped out.</p>

<p><em>INSTALLING</em></p>

<p>To install all of the packages needed for these instructions, run the following command.</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_yum identifier id'>yum</span> <span class='rubyid_install identifier id'>install</span> <span class='rubyid_bind identifier id'>bind</span> <span class='rubyid_bind identifier id'>bind</span><span class='minus op'>-</span><span class='rubyid_utils identifier id'>utils</span>
</code></pre>

<p><em>CONFIGURING</em></p>

<p>We will be referring frequently to the domain name with which we are configuring this OpenShift installation, so let us set the $domain environment variable for easy reference:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_domain identifier id'>domain</span><span class='assign token'>=</span><span class='rubyid_example identifier id'>example</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span>
</code></pre>

<p>Note: You may replace &quot;example.com&quot; with the domain name you have chosen for this installation of OpenShift.</p>

<p>Next, set the <code>$keyfile</code> environment variable to contain the filename for a new DNSSEC key for our domain (we will create this key shortly):</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_keyfile identifier id'>keyfile</span><span class='assign token'>=</span><span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span><span class='div op'>/</span>$<span class='lbrace token'>{</span><span class='rubyid_domain identifier id'>domain</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span>
</code></pre>

<p>We will use the dnssec-keygen tool to generate the new DNSSEC key for the domain. Run the following commands to delete any old keys and generate a new key:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_rm identifier id'>rm</span> <span class='minus op'>-</span><span class='rubyid_vf identifier id'>vf</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span><span class='div op'>/</span><span class='rubyid_K constant id'>K</span>$<span class='lbrace token'>{</span><span class='rubyid_domain identifier id'>domain</span><span class='rbrace token'>}</span><span class='mult op'>*</span>
<span class='rubyid_pushd identifier id'>pushd</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span>
<span class='rubyid_dnssec identifier id'>dnssec</span><span class='minus op'>-</span><span class='rubyid_keygen identifier id'>keygen</span> <span class='minus op'>-</span><span class='rubyid_a identifier id'>a</span> <span class='rubyid_HMAC constant id'>HMAC</span><span class='minus op'>-</span><span class='rubyid_MD5 constant id'>MD5</span> <span class='minus op'>-</span><span class='rubyid_b identifier id'>b</span> <span class='integer val'>512</span> <span class='minus op'>-</span><span class='rubyid_n identifier id'>n</span> <span class='rubyid_USER constant id'>USER</span> <span class='minus op'>-</span><span class='rubyid_r identifier id'>r</span> <span class='regexp val'>/dev/</span><span class='rubyid_urandom identifier id'>urandom</span> $<span class='lbrace token'>{</span><span class='rubyid_domain identifier id'>domain</span><span class='rbrace token'>}</span>
<span class='rubyid_KEY constant id'>KEY</span><span class='assign token'>=</span><span class='string val'>&quot;$(grep Key: K${domain}*.private | cut -d ' ' -f 2)&quot;</span>
<span class='rubyid_popd identifier id'>popd</span>
</code></pre>

<p>Notice that we have set the $KEY environment variable to hold the newly generated key. We will use this key in a later step.</p>

<p>Next, we must ensure we have a key for the broker to communicate with BIND. We use the rndc-confgen command to generate the appropriate configuration files for rndc, which is the tool that the broker will use to perform this communication.</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_rndc identifier id'>rndc</span><span class='minus op'>-</span><span class='rubyid_confgen identifier id'>confgen</span> <span class='minus op'>-</span><span class='rubyid_a identifier id'>a</span> <span class='minus op'>-</span><span class='rubyid_r identifier id'>r</span> <span class='regexp val'>/dev/</span><span class='rubyid_urandom identifier id'>urandom</span>
</code></pre>

<p>We must ensure that the ownership, permissions, and SELinux context are set appropriately for this new key:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_restorecon identifier id'>restorecon</span> <span class='minus op'>-</span><span class='rubyid_v identifier id'>v</span> <span class='regexp val'>/etc/</span><span class='rubyid_rndc identifier id'>rndc</span><span class='dot token'>.</span><span class='mult op'>*</span> <span class='regexp val'>/etc/n</span><span class='rubyid_amed identifier id'>amed</span><span class='dot token'>.</span><span class='mult op'>*</span>
<span class='rubyid_chown identifier id'>chown</span> <span class='minus op'>-</span><span class='rubyid_v identifier id'>v</span> <span class='rubyid_root identifier id'>root</span><span class='symbol val'>:named</span> <span class='div op'>/</span><span class='rubyid_etc identifier id'>etc</span><span class='div op'>/</span><span class='rubyid_rndc identifier id'>rndc</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span>
<span class='rubyid_chmod identifier id'>chmod</span> <span class='minus op'>-</span><span class='rubyid_v identifier id'>v</span> <span class='integer val'>640</span> <span class='div op'>/</span><span class='rubyid_etc identifier id'>etc</span><span class='div op'>/</span><span class='rubyid_rndc identifier id'>rndc</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span>
</code></pre>

<p>We are configuring the local BIND instance so that the broker and nodes will be able to resolve internal hostnames. However, the broker and node will still need to be able to handle requests to resolve hostnames on the broader Internet. To this end, we configure BIND to forward such requests to regular DNS servers. To this end, create the file <code>/var/named/forwarders.conf</code> with the following content:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_forwarders identifier id'>forwarders</span> <span class='lbrace token'>{</span> <span class='float val'>8.8</span><span class='float val'>.8.8</span><span class='semicolon token'>;</span> <span class='float val'>8.8</span><span class='float val'>.4.4</span><span class='semicolon token'>;</span> <span class='rbrace token'>}</span> <span class='semicolon token'>;</span>
</code></pre>

<p>Note: Change the above list of forwarders as appropriate to comply with your local network&#39;s requirements.</p>

<p>Again, we must ensure that the permissions and SELinux context are set appropriately for the new forwarders.conf file:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_restorecon identifier id'>restorecon</span> <span class='minus op'>-</span><span class='rubyid_v identifier id'>v</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span><span class='div op'>/</span><span class='rubyid_forwarders identifier id'>forwarders</span><span class='dot token'>.</span><span class='rubyid_conf identifier id'>conf</span>
<span class='rubyid_chmod identifier id'>chmod</span> <span class='minus op'>-</span><span class='rubyid_v identifier id'>v</span> <span class='integer val'>755</span> <span class='div op'>/</span><span class='rubyid_var identifier id'>var</span><span class='div op'>/</span><span class='rubyid_named identifier id'>named</span><span class='div op'>/</span><span class='rubyid_forwarders identifier id'>forwarders</span><span class='dot token'>.</span><span class='rubyid_conf identifier id'>conf</span>
</code></pre>

<p>We need to configure BIND to perform resolution for hostnames under the domain we are using for our OpenShift installation. To that end, we must create a database for the domain. The dns-bind plug-in includes an example database, which we will use as a template. Delete and create the <code>/var/named/dynamic</code> directory:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_rm identifier id'>rm</span> <span class='minus op'>-</span><span class='rubyid_rvf identifier id'>rvf</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span><span class='div op'>/</span><span class='rubyid_dynamic identifier id'>dynamic</span>
<span class='rubyid_mkdir identifier id'>mkdir</span> <span class='minus op'>-</span><span class='rubyid_vp identifier id'>vp</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span><span class='div op'>/</span><span class='rubyid_dynamic identifier id'>dynamic</span>
</code></pre>

<p>Now, create an initial named database in a new file named <code>/var/named/dynamic/${domain}.db</code> (where <code>${domain}</code> is your chosen domain) using the following command (if the shell syntax is unfamiliar, see the <a href="http://www.gnu.org/software/bash/manual/bashref.html#Here-Documents">BASH documentation on heredocs</a> ):</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_cat identifier id'>cat</span> <span class='string val'>&quot;\\$ORIGIN .\n\\$TTL 1 ; 1 seconds (for testing only)\n${domain} IN SOA ns1.${domain}. hostmaster.${domain}. (\n                         2011112904 ; serial\n                         60         ; refresh (1 minute)\n                         15         ; retry (15 seconds)\n                         1800       ; expire (30 minutes)\n                         10         ; minimum (10 seconds)\n                          )\n                     NS ns1.${domain}.\n\\$ORIGIN ${domain}.\nns1               A        127.0.0.1\n\n&quot;</span> <span class='gt op'>&gt;</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span><span class='div op'>/</span><span class='rubyid_dynamic identifier id'>dynamic</span><span class='div op'>/</span>$<span class='lbrace token'>{</span><span class='rubyid_domain identifier id'>domain</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_db identifier id'>db</span>
</code></pre>

<p>Next, we install the DNSSEC key for our domain. Create the file <code>/var/named/${domain}.key</code> (where <code>${domain}</code> is your chosen domain) using the following command:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_cat identifier id'>cat</span> <span class='string val'>&quot;key ${domain} {\n  algorithm HMAC-MD5;\n  secret \&quot;${KEY}\&quot;;\n};\n&quot;</span> <span class='gt op'>&gt;</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span><span class='div op'>/</span>$<span class='lbrace token'>{</span><span class='rubyid_domain identifier id'>domain</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span>
</code></pre>

<p>We need to set the permissions and SELinux contexts appropriately:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_chown identifier id'>chown</span> <span class='minus op'>-</span><span class='rubyid_Rv constant id'>Rv</span> <span class='rubyid_named identifier id'>named</span><span class='symbol val'>:named</span> <span class='div op'>/</span><span class='rubyid_var identifier id'>var</span><span class='div op'>/</span><span class='rubyid_named identifier id'>named</span>
<span class='rubyid_restorecon identifier id'>restorecon</span> <span class='minus op'>-</span><span class='rubyid_rv identifier id'>rv</span> <span class='regexp val'>/var/n</span><span class='rubyid_amed identifier id'>amed</span>
</code></pre>

<p>We must also create a new <code>/etc/named.conf</code> file, as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_cat identifier id'>cat</span> <span class='string val'>&quot;// named.conf\n//\n// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS\n// server as a caching only nameserver (as a localhost DNS resolver only).\n//\n// See /usr/share/doc/bind*/sample/ for example named configuration files.\n//\n\noptions {\n    listen-on port 53 { any; };\n    directory \&quot;/var/named\&quot;;\n    dump-file \&quot;/var/named/data/cache_dump.db\&quot;;\n    statistics-file \&quot;/var/named/data/named_stats.txt\&quot;;\n    memstatistics-file \&quot;/var/named/data/named_mem_stats.txt\&quot;;\n    allow-query { any; };\n    recursion yes;\n\n    /* Path to ISC DLV key */\n    bindkeys-file \&quot;/etc/named.iscdlv.key\&quot;;\n\n    // set forwarding to the next nearest server (from DHCP response\n    forward only;\n    include \&quot;forwarders.conf\&quot;;\n};\n\nlogging {\n    channel default_debug {\n        file \&quot;data/named.run\&quot;;\n        severity dynamic;\n    };\n};\n\n// use the default rndc key\ninclude \&quot;/etc/rndc.key\&quot;;\n\ncontrols {\n    inet 127.0.0.1 port 953\n    allow { 127.0.0.1; } keys { \&quot;rndc-key\&quot;; };\n};\n\ninclude \&quot;/etc/named.rfc1912.zones\&quot;;\n\ninclude \&quot;${domain}.key\&quot;;\n\nzone \&quot;${domain}\&quot; IN {\n    type master;\n    file \&quot;dynamic/${domain}.db\&quot;;\n    allow-update { key ${domain} ; } ;\n};\n&quot;</span> <span class='gt op'>&gt;</span> <span class='regexp val'>/etc/n</span><span class='rubyid_amed identifier id'>amed</span><span class='dot token'>.</span><span class='rubyid_conf identifier id'>conf</span>
</code></pre>

<p>Set permissions and SELinux contexts appropriately:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_chown identifier id'>chown</span> <span class='minus op'>-</span><span class='rubyid_v identifier id'>v</span> <span class='rubyid_root identifier id'>root</span><span class='symbol val'>:named</span> <span class='div op'>/</span><span class='rubyid_etc identifier id'>etc</span><span class='div op'>/</span><span class='rubyid_named identifier id'>named</span><span class='dot token'>.</span><span class='rubyid_conf identifier id'>conf</span>
<span class='rubyid_restorecon identifier id'>restorecon</span> <span class='regexp val'>/etc/n</span><span class='rubyid_amed identifier id'>amed</span><span class='dot token'>.</span><span class='rubyid_conf identifier id'>conf</span>
</code></pre>

<p>Configuring Host 1 Name Resolution</p>

<p>To use the local named service to resolve host names in your domain, you now need to update the host&#39;s <code>/etc/resolv.conf</code> file. You also need to configure the firewall and start the named service in order to serve local and remote DNS requests for the domain.</p>

<p>To that end, edit <code>/etc/resolv.conf</code> and put the following at the top of the file, changing &quot;10.0.0.1&quot; to the IP address of Host 1::</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_nameserver identifier id'>nameserver</span> <span class='float val'>10.0</span><span class='float val'>.0.1</span>
</code></pre>

<p>Open the firewall rules and make the service restart on reboot with:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_lokkit identifier id'>lokkit</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='rubyid_service identifier id'>service</span><span class='assign token'>=</span><span class='rubyid_dns identifier id'>dns</span>
<span class='rubyid_chkconfig identifier id'>chkconfig</span> <span class='rubyid_named identifier id'>named</span> <span class='rubyid_on identifier id'>on</span>
</code></pre>

<p>Use the service command to start BIND (&quot;named&quot;) so we can perform some updates immediately:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_service identifier id'>service</span> <span class='rubyid_named identifier id'>named</span> <span class='rubyid_start identifier id'>start</span>
</code></pre>

<p>Tell BIND about the broker using the nsupdate command to open an interactive session. &quot;server,&quot; &quot;update,&quot; and &quot;send&quot; are commands to the nsupdate command. CTRL+D closes the interactive session.</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_Note constant id'>Note</span><span class='colon op'>:</span> <span class='rubyid_Replace constant id'>Replace</span> <span class='string val'>&quot;broker.example.com&quot;</span> <span class='rubyid_with identifier id'>with</span> <span class='rubyid_the identifier id'>the</span> <span class='rubyid_actual identifier id'>actual</span> <span class='rubyid_FQDN constant id'>FQDN</span> <span class='rubyid_of identifier id'>of</span> <span class='rubyid_the identifier id'>the</span> <span class='rubyid_broker identifier id'>broker</span><span class='comma token'>,</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_replace identifier id'>replace</span> <span class='string val'>&quot;10.0.0.1&quot;</span> <span class='rubyid_with identifier id'>with</span> <span class='rubyid_the identifier id'>the</span> <span class='rubyid_actual identifier id'>actual</span> <span class='rubyid_IP constant id'>IP</span> <span class='rubyid_address identifier id'>address</span> <span class='rubyid_of identifier id'>of</span> <span class='rubyid_the identifier id'>the</span> <span class='rubyid_broker identifier id'>broker</span><span class='dot token'>.</span>

<span class='rubyid_nsupdate identifier id'>nsupdate</span> <span class='minus op'>-</span><span class='rubyid_k identifier id'>k</span> $<span class='lbrace token'>{</span><span class='rubyid_keyfile identifier id'>keyfile</span><span class='rbrace token'>}</span>
<span class='rubyid_server identifier id'>server</span> <span class='float val'>127.0</span><span class='float val'>.0.1</span>
<span class='rubyid_update identifier id'>update</span> <span class='rubyid_delete identifier id'>delete</span> <span class='rubyid_broker identifier id'>broker</span><span class='dot token'>.</span><span class='rubyid_example identifier id'>example</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span> <span class='rubyid_A constant id'>A</span>
<span class='rubyid_update identifier id'>update</span> <span class='rubyid_add identifier id'>add</span> <span class='rubyid_broker identifier id'>broker</span><span class='dot token'>.</span><span class='rubyid_example identifier id'>example</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span> <span class='integer val'>180</span> <span class='rubyid_A constant id'>A</span> <span class='float val'>10.0</span><span class='float val'>.0.1</span>
<span class='rubyid_send identifier id'>send</span>
<span class='rubyid_quit identifier id'>quit</span>
</code></pre>

<p>Ref: <a href="https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/named.pp">https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/named.pp</a></p>

<p>Ref: <a href="https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/init.pp#L446">https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/init.pp#L446</a></p>

<p><em>VERIFYING</em></p>

<p>Verify that BIND is configured correctly to resolve the broker&#39;s hostname:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_dig identifier id'>dig</span> <span class='rubyid_@127 ivar id'>@127</span><span class='float val'>.0.0</span><span class='integer val'>.1</span> <span class='rubyid_broker identifier id'>broker</span><span class='dot token'>.</span><span class='rubyid_example identifier id'>example</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span>
</code></pre>

<p>Verify that BIND properly forwards requests for other hostnames:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_dig identifier id'>dig</span> <span class='rubyid_@127 ivar id'>@127</span><span class='float val'>.0.0</span><span class='integer val'>.1</span> <span class='rubyid_icann identifier id'>icann</span><span class='dot token'>.</span><span class='rubyid_org identifier id'>org</span> <span class='rubyid_a identifier id'>a</span>
</code></pre>

<p>Verify that the broker is using the local BIND instance by running the following command on the broker:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_dig identifier id'>dig</span> <span class='rubyid_broker identifier id'>broker</span><span class='dot token'>.</span><span class='rubyid_example identifier id'>example</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span>
</code></pre>

<h4>Setting up MongoDB</h4>

<p>MongoDB requires several minor configuration changes to prepare it for use with OpenShift. These include setting up authentication, specifying the default database size, and creating an administrative user.</p>

<p><em>INSTALLING</em></p>

<p>To install all of the packages needed for MongoDB, run the following command:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_yum identifier id'>yum</span> <span class='rubyid_install identifier id'>install</span> <span class='rubyid_mongodb identifier id'>mongodb</span><span class='minus op'>-</span><span class='rubyid_server identifier id'>server</span>
</code></pre>

<p><em>CONFIGURING</em></p>

<p>To configure MongoDB to require authentication:</p>

<p>Open the <code>/etc/mongodb.conf</code> file. Add the following line anywhere in the file:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_auth identifier id'>auth</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
</code></pre>

<p>If there are any other lines beginning with &quot;auth =&quot;, delete those lines.
Save and close the file.
To configure the MongoDB default database size:</p>

<p>Open the <code>/etc/mongodb.conf</code> file. Add the following line anywhere in the file:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_smallfiles identifier id'>smallfiles</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
</code></pre>

<p>If there are any other lines beginning with &quot;smallfiles =&quot;, delete those lines.
Save and close the file.</p>

<p>Open the firewall rules and make the service restart on reboot with:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_chkconfig identifier id'>chkconfig</span> <span class='rubyid_mongod identifier id'>mongod</span> <span class='rubyid_on identifier id'>on</span>
</code></pre>

<p>Now start the mongo daemon:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_service identifier id'>service</span> <span class='rubyid_mongod identifier id'>mongod</span> <span class='rubyid_start identifier id'>start</span>
</code></pre>

<p>Ref: <a href="https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/mongo.pp">https://github.com/openshift/puppet-openshift_origin/blob/master/manifests/mongo.pp</a></p>

<p><em>VERIFYING</em></p>

<p>Run the mongo command to ensure that you can connect to the MongoDB database:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_mongo identifier id'>mongo</span>
</code></pre>

<p>The command starts an interactive session with the database. Press CTRL+D (the Control key with the &quot;d&quot; key) to leave this session and return to the command shell.</p>

<h4>Setting up ActiveMQ</h4>

<p>You need to install and configure ActiveMQ which will be used as the messaging platform to aid in communication between the broker and node hosts.</p>

<p><em>INSTALLING</em></p>

<p>To install the packages needed for ActiveMQ, run the following command:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_yum identifier id'>yum</span> <span class='rubyid_install identifier id'>install</span> <span class='rubyid_activemq identifier id'>activemq</span>
</code></pre>

<p><em>CONFIGURING</em></p>

<p>You can configure ActiveMQ by editing the <code>/etc/activemq/activemq.xml</code> file. Create the file using the following command:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_cat identifier id'>cat</span> <span class='string val'>&quot;&lt;!--\n    Licensed to the Apache Software Foundation (ASF) under one or more\n    contributor license agreements.  See the NOTICE file distributed with\n    this work for additional information regarding copyright ownership.\n    The ASF licenses this file to You under the Apache License, Version 2.0\n    (the \&quot;License\&quot;); you may not use this file except in compliance with\n    the License.  You may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n--&gt;\n&lt;beans\n  xmlns=\&quot;http://www.springframework.org/schema/beans\&quot;\n  xmlns:amq=\&quot;http://activemq.apache.org/schema/core\&quot;\n  xmlns:xsi=\&quot;http://www.w3.org/2001/XMLSchema-instance\&quot;\n  xsi:schemaLocation=\&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd\n  http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd\&quot;&gt;\n\n    &lt;!-- Allows us to use system properties as variables in this configuration file --&gt;\n    &lt;bean class=\&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\&quot;&gt;\n        &lt;property name=\&quot;locations\&quot;&gt;\n            &lt;value&gt;file:\\${activemq.conf}/credentials.properties&lt;/value&gt;\n        &lt;/property&gt;\n    &lt;/bean&gt;\n\n    &lt;!--\n        The &lt;broker&gt; element is used to configure the ActiveMQ broker.\n    --&gt;\n    &lt;broker xmlns=\&quot;http://activemq.apache.org/schema/core\&quot; brokerName=\&quot;broker.example.com\&quot; dataDirectory=\&quot;\\${activemq.data}\&quot;&gt;\n\n        &lt;!--\n            For better performances use VM cursor and small memory limit.\n            For more information, see:\n\n            http://activemq.apache.org/message-cursors.html\n\n            Also, if your producer is \&quot;hanging\&quot;, it's probably due to producer flow control.\n            For more information, see:\n            http://activemq.apache.org/producer-flow-control.html\n        --&gt;\n\n        &lt;destinationPolicy&gt;\n            &lt;policyMap&gt;\n              &lt;policyEntries&gt;\n                &lt;policyEntry topic=\&quot;&gt;\&quot; producerFlowControl=\&quot;true\&quot; memoryLimit=\&quot;1mb\&quot;&gt;\n                  &lt;pendingSubscriberPolicy&gt;\n                    &lt;vmCursor /&gt;\n                  &lt;/pendingSubscriberPolicy&gt;\n                &lt;/policyEntry&gt;\n                &lt;policyEntry queue=\&quot;&gt;\&quot; producerFlowControl=\&quot;true\&quot; memoryLimit=\&quot;1mb\&quot;&gt;\n                  &lt;!-- Use VM cursor for better latency\n                       For more information, see:\n\n                       http://activemq.apache.org/message-cursors.html\n\n                  &lt;pendingQueuePolicy&gt;\n                    &lt;vmQueueCursor/&gt;\n                  &lt;/pendingQueuePolicy&gt;\n                  --&gt;\n                &lt;/policyEntry&gt;\n              &lt;/policyEntries&gt;\n            &lt;/policyMap&gt;\n        &lt;/destinationPolicy&gt;\n\n\n        &lt;!--\n            The managementContext is used to configure how ActiveMQ is exposed in\n            JMX. By default, ActiveMQ uses the MBean server that is started by\n            the JVM. For more information, see:\n\n            http://activemq.apache.org/jmx.html\n        --&gt;\n        &lt;managementContext&gt;\n            &lt;managementContext createConnector=\&quot;false\&quot;/&gt;\n        &lt;/managementContext&gt;\n\n        &lt;!--\n            Configure message persistence for the broker. The default persistence\n            mechanism is the KahaDB store (identified by the kahaDB tag).\n            For more information, see:\n\n            http://activemq.apache.org/persistence.html\n        --&gt;\n        &lt;persistenceAdapter&gt;\n            &lt;kahaDB directory=\&quot;\\${activemq.data}/kahadb\&quot;/&gt;\n        &lt;/persistenceAdapter&gt;\n\n        &lt;!-- add users for mcollective --&gt;\n\n        &lt;plugins&gt;\n          &lt;statisticsBrokerPlugin/&gt;\n          &lt;simpleAuthenticationPlugin&gt;\n             &lt;users&gt;\n               &lt;authenticationUser username=\&quot;mcollective\&quot; password=\&quot;marionette\&quot; groups=\&quot;mcollective,everyone\&quot;/&gt;\n               &lt;authenticationUser username=\&quot;admin\&quot; password=\&quot;secret\&quot; groups=\&quot;mcollective,admin,everyone\&quot;/&gt;\n             &lt;/users&gt;\n          &lt;/simpleAuthenticationPlugin&gt;\n          &lt;authorizationPlugin&gt;\n            &lt;map&gt;\n              &lt;authorizationMap&gt;\n                &lt;authorizationEntries&gt;\n                  &lt;authorizationEntry queue=\&quot;&gt;\&quot; write=\&quot;admins\&quot; read=\&quot;admins\&quot; admin=\&quot;admins\&quot; /&gt;\n                  &lt;authorizationEntry topic=\&quot;&gt;\&quot; write=\&quot;admins\&quot; read=\&quot;admins\&quot; admin=\&quot;admins\&quot; /&gt;\n                  &lt;authorizationEntry topic=\&quot;mcollective.&gt;\&quot; write=\&quot;mcollective\&quot; read=\&quot;mcollective\&quot; admin=\&quot;mcollective\&quot; /&gt;\n                  &lt;authorizationEntry queue=\&quot;mcollective.&gt;\&quot; write=\&quot;mcollective\&quot; read=\&quot;mcollective\&quot; admin=\&quot;mcollective\&quot; /&gt;\n                  &lt;authorizationEntry topic=\&quot;ActiveMQ.Advisory.&gt;\&quot; read=\&quot;everyone\&quot; write=\&quot;everyone\&quot; admin=\&quot;everyone\&quot;/&gt;\n                &lt;/authorizationEntries&gt;\n              &lt;/authorizationMap&gt;\n            &lt;/map&gt;\n          &lt;/authorizationPlugin&gt;\n        &lt;/plugins&gt;\n\n          &lt;!--\n            The systemUsage controls the maximum amount of space the broker will\n            use before slowing down producers. For more information, see:\n            http://activemq.apache.org/producer-flow-control.html\n            If using ActiveMQ embedded - the following limits could safely be used:\n\n        &lt;systemUsage&gt;\n            &lt;systemUsage&gt;\n                &lt;memoryUsage&gt;\n                    &lt;memoryUsage limit=\&quot;20 mb\&quot;/&gt;\n                &lt;/memoryUsage&gt;\n                &lt;storeUsage&gt;\n                    &lt;storeUsage limit=\&quot;1 gb\&quot;/&gt;\n                &lt;/storeUsage&gt;\n                &lt;tempUsage&gt;\n                    &lt;tempUsage limit=\&quot;100 mb\&quot;/&gt;\n                &lt;/tempUsage&gt;\n            &lt;/systemUsage&gt;\n        &lt;/systemUsage&gt;\n        --&gt;\n          &lt;systemUsage&gt;\n            &lt;systemUsage&gt;\n                &lt;memoryUsage&gt;\n                    &lt;memoryUsage limit=\&quot;64 mb\&quot;/&gt;\n                &lt;/memoryUsage&gt;\n                &lt;storeUsage&gt;\n                    &lt;storeUsage limit=\&quot;100 gb\&quot;/&gt;\n                &lt;/storeUsage&gt;\n                &lt;tempUsage&gt;\n                    &lt;tempUsage limit=\&quot;50 gb\&quot;/&gt;\n                &lt;/tempUsage&gt;\n            &lt;/systemUsage&gt;\n        &lt;/systemUsage&gt;\n\n        &lt;!--\n            The transport connectors expose ActiveMQ over a given protocol to\n            clients and other brokers. For more information, see:\n\n            http://activemq.apache.org/configuring-transports.html\n        --&gt;\n        &lt;transportConnectors&gt;\n            &lt;transportConnector name=\&quot;openwire\&quot; uri=\&quot;tcp://0.0.0.0:61616\&quot;/&gt;\n            &lt;transportConnector name=\&quot;stomp\&quot; uri=\&quot;stomp://0.0.0.0:61613\&quot;/&gt;\n        &lt;/transportConnectors&gt;\n\n    &lt;/broker&gt;\n\n    &lt;!--\n        Enable web consoles, REST and Ajax APIs and demos\n\n        Take a look at \\${ACTIVEMQ_HOME}/conf/jetty.xml for more details\n    --&gt;\n    &lt;import resource=\&quot;jetty.xml\&quot;/&gt;\n\n&lt;/beans&gt;\n&lt;!-- END SNIPPET: example --&gt;\n&quot;</span> <span class='gt op'>&gt;</span> <span class='regexp val'>/etc/</span><span class='rubyid_activemq identifier id'>activemq</span><span class='div op'>/</span><span class='rubyid_activemq identifier id'>activemq</span><span class='dot token'>.</span><span class='rubyid_xml identifier id'>xml</span>
</code></pre>

<p>Note: Replace &quot;broker.example.com&quot; with the actual FQDN of the broker. You are also encouraged to substitute your own passwords (and use the same in the MCollective configuration that follows).</p>

<p>Open the firewall rules and make the service restart on reboot with:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_lokkit identifier id'>lokkit</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='rubyid_port identifier id'>port</span><span class='assign token'>=</span><span class='integer val'>61613</span><span class='symbol val'>:tcp</span>
<span class='rubyid_chkconfig identifier id'>chkconfig</span> <span class='rubyid_activemq identifier id'>activemq</span> <span class='rubyid_on identifier id'>on</span>
</code></pre>

<p>Now start the activemq service with:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_service identifier id'>service</span> <span class='rubyid_activemq identifier id'>activemq</span> <span class='rubyid_start identifier id'>start</span>
</code></pre>
</div></div>

    <div id="footer">
  Generated on Tue May 28 18:08:00 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.8.7).
</div>

  </body>
</html>