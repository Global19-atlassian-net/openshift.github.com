<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Asciidoctor 0.1.4" name="generator">
<meta content="OpenShift Origin Documentation Project &lt;dev@lists.openshift.redhat.com&gt;" name="author">
<title>OpenShift PEP 010: Cartridge V3 and Docker Containers</title>
<style>@import url(http://openshift.redhat.com/app/assets/overpass.css);
@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
/*
Origin theme source file

To build it:
- clone the asciidoctor-stylesheet-factory repo
- copy this theme file to the sass folder inside the repo
- copy the settings file to the sass/settings file inside the repo
- cd to the cloned repo
- bundle install
- compass compile
- compiled stylesheet is in the stylesheets/ directory
*/
/* Generated by Font Squirrel (http://www.fontsquirrel.com) on July 24, 2013 */
@font-face { font-family: 'source_code_pro'; src: url("fonts/sourcecodepro-regular-webfont.eot"); src: url("fonts/sourcecodepro-regular-webfont.eot?#iefix") format("embedded-opentype"), url("fonts/sourcecodepro-regular-webfont.woff") format("woff"), url("fonts/sourcecodepro-regular-webfont.ttf") format("truetype"), url("sourcecodepro-regular-webfont.svg#source_code_proregular") format("svg"); font-weight: normal; font-style: normal; }

/*
Settings and overrides for the Origin theme
*/
/* normalize.css v2.1.1 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address styling not present in IE 8/9. */
[hidden] { display: none; }

/* ========================================================================== Base ========================================================================== */
/** 1. Prevent system color scheme's background color being used in Firefox, IE, and Opera. 2. Prevent system color scheme's text color being used in Firefox, IE, and Opera. 3. Set default font family to sans-serif. 4. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { background: #fff; /* 1 */ color: #000; /* 2 */ font-family: sans-serif; /* 3 */ -ms-text-size-adjust: 100%; /* 4 */ -webkit-text-size-adjust: 100%; /* 4 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

a:focus { outline: none; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .ulist > .title, .olist > .title, .dlist > .title, .qlist > .title, .tableblock > caption { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #006699; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #005580; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Overpass, sans-serif; font-weight: bold; font-style: normal; color: #222222; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #7f0a0c; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

/*
.clearfix,
.floatend { zoom: 1; &:before, &:after { content: " "; display: table; } &:after { clear: both; }
}
*/
code { font-size: inherit; padding: 0; white-space: nowrap; background-color: inherit; border: 0 solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }

kbd.keyseq { color: #555555; }

kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

kbd kbd:first-child { margin-left: 0; }

kbd kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #222222; font-weight: bold; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 0 solid #dddddd; padding-bottom: 1.25em; }
#toc > ul, #toc > ol { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a, #toc ol.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1, #toc ol.sectlevel0 ol.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul, #toc ol { list-style-type: none; }

#toctitle { color: #6f6f6f; }

@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul, #toc.toc2 > ol { font-size: .95em; }
  #toc.toc2 ul ul, #toc.toc2 ol ol { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1, #toc.toc2 ol.sectlevel0 ol.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 0 solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .ulist > .title, .olist > .title, .dlist > .title, .qlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > .paragraph:last-child > p { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; line-height: 1.6; }
.sidebarblock > .content > .paragraph:last-child p { margin-bottom: 0; }

pre { color: black; font-family: source_code_pro, monospace, serif; overflow-x: auto; line-height: 1.4; }

.verseblock { margin-bottom: 1.25em; }

.literalblock, .listingblock { margin-bottom: 1.25em; }
.literalblock > .content > pre, .listingblock > .content > pre { background: #eeeeee; color: black; font-family: source_code_pro, monospace, serif; border-width: 0; padding: 0.8em 0.8em 0.6em 0.8em; word-wrap: break-word; line-height: 1.4; }
.literalblock > .content > pre.nowrap, .listingblock > .content > pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content > pre > code, .listingblock > .content > pre > code { font-size: 1em; white-space: inherit; color: black; font-family: source_code_pro, monospace, serif; padding: 0; background: none; font-weight: normal; border: none; }
@media only screen { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 1em; } }

.listingblock:hover .xml:before { content: "xml"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .html:before { content: "html"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .ruby:before { content: "ruby"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .asciidoc:before { content: "asciidoc"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .java:before { content: "java"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .javascript:before { content: "javascript"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .css:before { content: "css"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .scss:before { content: "scss"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }

.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.halign-top, td.tableblock.halign-top { vertical-align: top; }

th.tableblock.halign-bottom, td.tableblock.halign-bottom { vertical-align: bottom; }

th.tableblock.halign-middle, td.tableblock.halign-middle { vertical-align: middle; }

p.tableblock.header { color: #222222; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist { list-style-type: none; margin-left: 0.625em; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

td.hdlist1 { vertical-align: top; padding-right: .8em; font-weight: bold; }

.qanda > ol > li > p:first-child { color: #005580; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: none; box-shadow: none; }

.imageblock { margin-bottom: 1.25em; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding: 0.75em 0.375em; margin-bottom: 1.25em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: none; cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #006699; color: #004c73; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

nav.global { background: #222; width: 100%; height: 4em; }
nav.global ul { list-style-type: none; margin: 0; }
nav.global li { display: inline-block; }
nav.global a { display: block; padding: .5em 1em; font-family: Overpass; font-size: 1.1em; color: white; }
nav.global a:hover { color: #ef2e32; }
nav.global a img { margin-top: .25em; height: 2.75em; }

#header > h1 { border: none; }

#toc { background: #eee; border-right: none; }
#toc.toc2 { box-shadow: 1px 0 1px rgba(0, 0, 0, 0.3); }

code { font-family: source_code_pro; }

.admonitionblock td.icon .icon-tip:before { color: #cc6; text-shadow: none; }

#footer { background-image: url("images/panda.png"); background-position: right bottom; background-repeat: no-repeat; }

/* Alignment Styles */
.halign-left { text-align: left }
.halign-center { text-align: center }
.halign-right { text-align: right }

.valign-top { vertical-align: top }
.valign-middle { vertical-align: middle }
.valign-bottom { vertical-align: bottom }</style>
<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="article toc2">
<nav class="global">
<ul>
<li>
<a href="http://openshift.github.io">
<img alt="OpenShift Origin" src="images/logo.png">
</a>
</li>
<li>
<a href="index.html">Documentation Home</a>
</li>
</ul>
</nav>
<div id="header">
<h1>OpenShift PEP 010: Cartridge V3 and Docker Containers</h1>
<span id="author">OpenShift Origin Documentation Project &lt;dev@lists.openshift.redhat.com&gt;</span>
<br>
<div class="toc2" id="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#abstract">Abstract</a></li>
<li><a href="#background">Background</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#specification">Specification</a></li>
<li><a href="#gear-management">Gear management</a></li>
<li><a href="#upgrades">Upgrades</a></li>
<li><a href="#additional-topics">Additional Topics</a></li>
<li><a href="#risks">Risks</a></li>
</ul>
</div>
</div>
<div id="content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>PEP: 010<br>
Title: Cartridge V3 and Docker Containers<br>
Status: draft<br>
Author: Clayton Coleman <a href="mailto:ccoleman@redhat.com">ccoleman@redhat.com</a>, Paul Morie <a href="mailto:pmorie@redhat.com">pmorie@redhat.com</a><br>
Arch Priority: high<br>
Complexity: 200<br>
Affected Components: web, api, runtime, cartridges, broker, admin_tools, cli<br>
Affected Teams: Runtime, UI), Broker, Enterprise<br>
User Impact: high<br>
Epic:</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="abstract"><a class="anchor" href="#abstract"></a>Abstract</h3>
<div class="paragraph">
<p>Leverage Docker in OpenShift to deliver a more flexible and powerful distribution model for full application stacks. Each Docker image is like a full Operating System snapshot, but each image can be composed of multiple layers (a set of commands and files that describe how to build on top of each layer). Users can easily create Docker layers and images and distribute them for execution in other environments, even other Linux versions. This PEP describes how the OpenShift cartridge and gear format can evolve to leverage the full capabilities of Docker.</p>
</div>
<div class="paragraph">
<p>We would alter the build/deployment/cartridge model to focus more on image deployment - source code changes are combined with a cartridge (build/deployment/execution environment) to create a docker image that can be easily scaled up or rolled back to. Users would be able to install their own packages and run their gear images on their local laptops. In addition, we would enable easier distribution and execution mechanisms for cartridges that build on our existing system. We would enable more controlled upgrades, deployments, and version to version changes.</p>
</div>
<div class="paragraph">
<p>This PEP depends on and modifies <a href="https://github.com/openshift/openshift-pep/blob/master/openshift-pep-002-cartridge-v2.md">PEP 002: Cartridges V2</a>. It defines the use cases which <a href="https://github.com/openshift/openshift-pep/blob/master/openshift-pep-010-docker-cartridges.md">PEP 011: Docker containerization</a> must address from a technical standpoint.</p>
</div>
</div>
<div class="sect2">
<h3 id="background"><a class="anchor" href="#background"></a>Background</h3>
<div class="paragraph">
<p>We hope to leverage the full capabilities of the Docker container, while working with the OpenStack Solum project to evolve a new public standard that benefits developers and operators in the public cloud. We should take into account the limitations of the current mutable gear model and look for opportunities to isolate components further (gears don&#8217;t change, source code split out into its own locations, routing moves out of gears and nodes).</p>
</div>
<div class="paragraph">
<p>A key design goal is to reduce the changes that occur inside of a gear after it is created - in theory, reduce the changes to solely user application state, vs cartridge or gear state.</p>
</div>
</div>
<div class="sect2">
<h3 id="core-concepts"><a class="anchor" href="#core-concepts"></a>Core Concepts</h3>
<div class="paragraph">
<p>A V2 OpenShift application is composed of 1..N gears. Each gear represents an execution environment for 1 primary cartridge and 0..N secondary cartridges (also called plugins). Each gear maps to one "container", which is a unix user, a SELinux category label, a home directory, and a set of exposed ports.</p>
</div>
<div class="paragraph">
<p>A Docker gear should be a Docker container - which means that it is stopped and started via the Docker control API, initialized with environment via the Docker run command, and expected to use the same code from server to server. The gear would be provided with mounted directories for mutable data. In order to guarantee that a gear would continue to function in isolation, the <strong>gear image</strong> would be the result of combining the primary cartridge with the application source code (and any build results). This allows the gear image to be started on multiple servers as the result of a scale up, without any communication required between gears. Any change to a gear occurs on a build, which means that a single process is responsible for user code changes, security updates, and cartridge version changes.</p>
</div>
<div class="paragraph">
<p>An OpenShift cartridge is metadata that describes the capabilities of a set of software - likewise, a Dockerfile is metadata describing how to prepare a set of software for use in an image. In OpenShift, we would treat the base Dockerfile elements - BASE, RUN, and EXECUTE - as new additions to the cartridge manifest, and we would map the remaining metadata to existing OpenShift elements.</p>
</div>
<div class="paragraph">
<p>A Docker cartridge is a Docker image, with a set of metadata (a manifest) that can be translated to a Dockerfile for execution during a build. The Docker manifest adds additional elements to handle the execution of steps and a RUN command. V2 cartridges will have default values for these (bin/setup and bin/control start). The act of transforming a cartridge image with cartridge hooks and/or source and build will be known as the <strong>prepare</strong> step ("preparing a cartridge"), and result in a <strong>deployment artifact</strong> which is a Docker image. Since <strong>prepare</strong> may contain dependencies, downloads, or unreliable options that may fail, subsequent <strong>prepare</strong> operations may wish to reuse the contents of the prior image.</p>
</div>
<div class="sect3">
<h4 id="whats-in-a-deployment-artifact-docker-layers"><a class="anchor" href="#whats-in-a-deployment-artifact-docker-layers"></a>What&#8217;s in a deployment artifact (Docker layers)?</h4>
<div class="listingblock">
<div class="content">
<pre>                                                         +--------------+
                                      +--------------+   | Symlinks     |  Deployment Layer
                          Build Layer | Maven        |   | Built WAR    |
                   +--------------+   +--------------+   +--------------+
                   | Scripts      |   | Scripts      |   | Scripts      |  Cartridge Layer
                   | JBoss        |   | JBoss        |   | JBoss        |
+--------------+   +--------------+   +--------------+   +--------------+
| Libc / Bash  |   | Libc / Bash  |   | Libc / Bash  |   | Libc / Bash  |  Base Layer
+--------------+   +--------------+   +--------------+   +--------------+

+--------------+   +--------------+   +--------------+   +--------------+
| Kernel       |   | Kernel       |   | Kernel       |   | Kernel       |
+--------------+   +--------------+   +--------------+   +--------------+

1. Base from CDN   2. Cartridge       3. Build Image     4. Deployment
                                                            Artifact</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-build-image-flow"><a class="anchor" href="#creating-a-build-image-flow"></a>Creating a build image flow</h4>
<div class="listingblock">
<div class="content">
<pre>                     +----------------------+
                     |  Cartridge Manifest  |
                     +----------------------+
                                |
                                |
                                |
                                |
                                |
                                |           +--------------+
                                |           | Maven        |
+--------------+                v           +--------------+
| Scripts      |------&gt; Add build deps +---&gt;| Scripts      +---&gt; save as new
| JBoss        |                            | JBoss        |     image in Docker
+--------------+                            +--------------+
| Libc / Bash  |                            | Libc / Bash  |
+--------------+                            +--------------+

Cartridge Image                             Build Image</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-deployment-artifact-from-user-source-flow"><a class="anchor" href="#creating-a-deployment-artifact-from-user-source-flow"></a>Creating a deployment artifact from user source flow</h4>
<div class="listingblock">
<div class="content">
<pre>                     +--------------+
                     | User Git     |
                     | repo tarball |
                     +------+-------+
                            |
+--------------+            |
| Maven        |            |
+--------------+            v               +--------------+
| Scripts      |------&gt;   build   ---------&gt;| Built WAR    |
| JBoss        |                            +-------+------+
+--------------+                                    |
| Libc / Bash  |                                    |
+--------------+                                    |
                                +-------------------+
Build Image                     |
                                |               +--------------+
                                |               | Symlinks     |
+--------------+                v               | Built WAR    |
| Scripts      |------&gt; create deployment +----&gt;+--------------+
| JBoss        |        artifact                | Scripts      |
+--------------+                                | JBoss        |
| Libc / Bash  |                                +--------------+
+--------------+                                | Libc / Bash  |
                                                +--------------+
Cartridge Image</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-deployment-artifact-from-binary-flow"><a class="anchor" href="#creating-a-deployment-artifact-from-binary-flow"></a>Creating a deployment artifact from binary flow</h4>
<div class="listingblock">
<div class="content">
<pre>                     +-------------------+
                     | Binary            |
                     | (WAR / Zip)       |
                     +-------------------+
                                |               +-----------------+
                                |               | Symlinks        |
+--------------+                v               | Binary (WAR/Zip)|
| Scripts      |------&gt; create deployment +----&gt;+-----------------+----&gt; save as new
| JBoss        |        artifact                | Scripts         |      image in docker
+--------------+                                | JBoss           |
| Libc / Bash  |                                +-----------------+
+--------------+                                | Libc / Bash     |
                                                +-----------------+
Cartridge Image
                                               Deployment Artifact</pre>
</div>
</div>
<div class="paragraph">
<p>In V2 scalable applications, haproxy gears were responsible for distributing repository content to the gears in the application. In contrast, for Docker-based applications, the broker will manage which deployed artifact (DA) a gear is using. An auto scaling subsystem would make requests to the broker to scale up or down.</p>
</div>
<div class="paragraph">
<p>Plugin cartridges are TBD, but they may be injected during the prepare step or bind mounted into the gear after launch.</p>
</div>
<div class="paragraph">
<p>In order to deliver security updates to cartridges, the operator must be able to regenerate docker images and then trigger builds in affected gears. This is a long running operation and may also involve skipping failed builds and notifying affected users. Cartridge authors may need to provide additional functionality to allow incremental layer creation - reusing downloaded dependencies and generated files from a previous image - in order to ensure security updates do not break user applications unintentionally.</p>
</div>
<div class="paragraph">
<p>Docker images live in a registry backed by some persistent storage. OpenShift requires a registry solution that allows both public and private images. Public images would be where shared cartridges come from, but private images would be isolated per account (domain?) and not visible to others. The metadata describing cartridges would move to the broker, and be mediated via a set of APIs for administrators and users. Over time, OpenShift might expose access to the registries to external users so they can download and run gears locally.</p>
</div>
<div class="paragraph">
<p>OpenShift should support V2 cartridges and Docker cartridges side by side.</p>
</div>
<div class="paragraph">
<p>In order to advance both high availability and the evolution of the platform, moving HAProxy out of the gears and into its own set of containers / layer would be ideal. Further investigation is needed, but a number of open source projects have advanced sufficiently to where full HA routing is now possible without a deep investment. In either case, the Routing SPI abstraction would allow us to choose how and when to move this functionality out of the main gears.</p>
</div>
</div>
<div class="sect3">
<h4 id="write-once-gears"><a class="anchor" href="#write-once-gears"></a>Write-once Gears</h4>
<div class="paragraph">
<p>There are a number of advantages to making our gears and cartridges write-once - i.e., doing cartridge installs, gear setup, and source builds together, and then reusing the result of that change over and over. Since the runtime for the cartridge is bundled with user code, users can easily revert to a previous version in the event of an update. Security updates and builds cannot break running gears - they can only cause a new build to fail and there is always a rollback if the new code doesn&#8217;t work. This has the potential to make security updates and gear migrations much easier to control - pushing new cartridge versions can be done without causing users to immediately break.</p>
</div>
<div class="paragraph">
<p>If gears are write-once, it would be better to force the choice of having state in those gears to be explicit. A large part of gear state today is the Git repository. Moving the Git repository into its own container (but still distributed on nodes) would allow us to add additional semantics to those repositories while reusing existing concepts like SSH and cgroup limits. OpenShift would invoke a plugin to create the repository container on the appropriate node, and add a special API call that the post-receive hook of the repository would use to notify OpenShift of a new commit. The gear repo would have access to the user&#8217;s public keys as they do today (potentially within a separate gear group). During a prepare, OpenShift would extract the source for the application into the cartridge image.</p>
</div>
<div class="paragraph">
<p>Another consequence of write-once gears is that application environment should exist outside any gear. Docker applies environment on startup, so it would be ideal to distribute environment via some private mechanism inside the node cluster and to pull that data on start.</p>
</div>
<div class="paragraph">
<p>This also enables the concept of compatible cartridges upgrades - for example from php-5.3 to php-5.4 - where a user may start on one version of the technology and later want to move up (or down) to a different compatible version. The two cartridges have the same contract with the source code, but a developer would be able to choose that new cartridge version to apply on a given build.</p>
</div>
<div class="paragraph">
<p>It is important to note that gears will still have ephemeral local storage for use in caching scenarios.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-security"><a class="anchor" href="#container-security"></a>Container security</h4>
<div class="paragraph">
<p>In the Linux kernel the user namespace feature offers the ability for a container to have a root user that is actually a normal-user on the system. However, this feature is new and the potential for vulnerabilities at this layer remains high. In the short term (2013 into 2014), security conscious container operators should still run containers as non-root. In OpenShift, the focus will be on enabling the use of images that may have been created or built with root access, but which at execution time are still jailed to a normal user. Trusted users may still be allowed to build cartridges within the system, but still require a regular user for execution.</p>
</div>
</div>
<div class="sect3">
<h4 id="process-management"><a class="anchor" href="#process-management"></a>Process management</h4>
<div class="paragraph">
<p>Docker defines a container entrypoint&#8201;&#8212;&#8201;an executable script or shell command&#8201;&#8212;&#8201;that will be executed when the container is started. This entrypoint is expected to be a standard Unix process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It should respond to signals (like SIGTERM when docker is ready to shutdown)</p>
</li>
<li>
<p>It should either log to disk, syslog, or STDERR/STDOUT</p>
</li>
<li>
<p>When the process goes away, Docker considers the container stopped.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, cartridges should expose the lowest level process that can manage the work the cartridge accomplishes. Using SystemD or SysInit within a cartridge generally brings additional behavior that prevents the platform itself (if not initially, then later) from offering advanced process management. An example would be restarting stuck processes - it would be better if the platform (Docker, OpenShift, or OpenShift using SystemD) could track the stuck/failing state and expose that information back to a user. If the cartridge hides that from the platform, then it is much harder to aggregate that information.</p>
</div>
<div class="paragraph">
<p>Another concern for cartridge authors - the signal Docker uses to terminate a process is SIGTERM, and if a wrapper script is used that does not respond to SIGTERM, then the end result will be a SIGKILL. The process entrypoint should be sure to respond to SIGTERM gracefully.</p>
</div>
<div class="paragraph">
<p>SystemD integration with Docker is an area of active investigation - there are many process management capabilities that would be ideal to manage from SystemD vs Docker / OpenShift.</p>
</div>
</div>
<div class="sect3">
<h4 id="log-management"><a class="anchor" href="#log-management"></a>Log management</h4>
<div class="paragraph">
<p>Different frameworks and languages offer different log capabilities, and many require significant configuration to work in different modes. OpenShift should offer platform tooling that simplifies the scenarios described below where possible:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allow cartridges to write log data to disk into transient or mounted volume directories.</p>
</li>
<li>
<p>Cartridge STDOUT/STDERR can be redirected by the platform to arbitrary locations.</p>
</li>
<li>
<p>Per-container syslog mounts could be exposed that a cartridge could write to.</p>
</li>
<li>
<p>Cartridge code can support language/framework specific log output that may go to external sources (log4j remote logging, etc)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As a cartridge author, information about how a cartridge logs should be exposed via the manifest, and OpenShift would delegate that information as necessary to integrators.</p>
</div>
</div>
<div class="sect3">
<h4 id="downloadable-cartridges"><a class="anchor" href="#downloadable-cartridges"></a>Downloadable Cartridges</h4>
<div class="paragraph">
<p>A downloadable V2 cart is a manifest that links to a source URL. The Docker manifest should be a superset of a dockerfile, which means that a user can specify a dockerfile as input to creating an app, and that dockerfile will become a downloadable cart for the app. When prepare happens for that gear, we can easily build their custom cartridge as a base layer, then run prepare on top of it. On subsequent builds, the base cartridge could be refreshed (via a different mechanism probably) which triggers a build.</p>
</div>
</div>
<div class="sect3">
<h4 id="moving-haproxy-out-of-gears"><a class="anchor" href="#moving-haproxy-out-of-gears"></a>Moving HAProxy out of Gears</h4>
<div class="paragraph">
<p>HAProxy within web gears complicates a number of processes. For Docker, we should investigate the creation and adoption of a routing layer to take edge traffic and route to gear groups based on endpoint data the broker has been made aware of. We will also investigate the ability to deploy HAProxy gears within the application as a separate gear group.</p>
</div>
<div class="paragraph">
<p>At a routing level, a further topic of investigation is the separation of traffic into low-volume /high-rate-of-change frontends, and high-volume/low-rate-of-change frontends. Different technologies might be chosen for each which would allow new applications to go into the low-volume pool, and then moved into the high-volume pool via a DNS migration as an automated or administrative process.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="specification"><a class="anchor" href="#specification"></a>Specification</h3>
<div class="sect3">
<h4 id="changes-to-manifest.yml"><a class="anchor" href="#changes-to-manifest.yml"></a>Changes to manifest.yml</h4>
<div class="paragraph">
<p>A Docker manifest would look similar to a V2 manifest, with the addition of a "run" collection (list of commands to run). A Docker manifest is a strict superset of a dockerfile.</p>
</div>
<div class="paragraph">
<p>Dockerfile | V2 | Docker | Description -----------|----|----|------------- FROM |<em>default</em> RHEL 6.5 OpenShift Node environment|Runtime (URL or known constant)|The base image this cartridge depends on. MAINTAINER |-|Author|The author of this cartridge RUN |<em>default</em> bin/install and bin/setup|Run|The series of steps used to initialize this cartridge on disk EXPOSE |Endpoints|Endpoints|The internal ports and their metadata this cartridge exposes. Both V2 and Docker cartridges expose additional options as well as the protocol type. ENV |<em>default</em> created during bin/setup| |An environment key and value this image starts with ADD |SourceUrl| |A set of source files and destinations to copy into the container - Docker provides this at image creation time, OpenShift V2 allowed only an external URL that was downloaded into the root working directory ENTRYPOINT |<em>default</em> bin/control start|Execute|An executable that will be run when the container starts. CMD |-|Execute|The default executable or arguments that will be run when the container starts. OpenShift docker cartridges require an executable, so a Dockerfile without CMD or ENTRYPOINT cannot be used as a cartridge. VOLUME |-| |A volume or directory that will be externally mounted into the running container. Not supported in V2. USER |<em>default</em> gear user| |The Unix user the container processes will start under WORKDIR |<em>default</em> gear directory| |The working directory for the ENTRYPOINT | |Prepare|A path to a script (or an embedded script) that will be executed when a cartridge is <strong>prepared</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementation-note-v2-interoperability"><a class="anchor" href="#implementation-note-v2-interoperability"></a>Implementation Note: V2 Interoperability</h4>
<div class="paragraph">
<p>V2 and Docker will operate side by side in a single OpenShift environment via application-based code path switching. The system will use two pools of nodes, one for V2 applications and one for Docker applications, with appropriate runtimes running in the nodes of each pool. New applications might be created with a flag indicating the stack to use with the application, and those gears would run only on nodes of the appropriate type.</p>
</div>
<div class="paragraph">
<p>The workflow to upgrade an application from the V2 cartridge system to the Docker cartridge system is currently unspecified.</p>
</div>
</div>
<div class="sect3">
<h4 id="cartridge-author-workflow-basic-case"><a class="anchor" href="#cartridge-author-workflow-basic-case"></a>Cartridge Author Workflow (basic case)</h4>
<div class="paragraph">
<p><span class="image"><img src="data:image/png:base64," alt="Cartridge author workflow"></span></p>
</div>
<div class="paragraph">
<p>In the basic case, the cartridge author workflow is simple. The cartridge author prepares a manifest and uses the <code>oo-admin-ctl-cartridge</code> tool to upload the manifest to the OpenShift Broker. The manifest contains the following information:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A reference to a publicly available docker image for the cartridge (cartridge image)</p>
</li>
<li>
<p>A path within the cartridge image that is the <code>prepare</code> script</p>
</li>
<li>
<p>An optional URL to git repo to use as a template for the default git repo for the cartridge. The currently supported syntax using #&lt;commit&gt; at the end of the URL to denote a specific commit revision is supported.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The broker creates a record for the new cartridge. The manifest is used as part of messages to create new applications or add cartridges to an application, and therefore the manifest content is contained in the record for the cartridge. (TODO: add information re: versioning / streams)</p>
</div>
</div>
<div class="sect3">
<h4 id="app-creation-workflow"><a class="anchor" href="#app-creation-workflow"></a>App Creation Workflow</h4>
<div class="paragraph">
<p><span class="image"><img src="data:image/png:base64," alt="App creation workflow"></span></p>
</div>
<div class="paragraph">
<p>The basic app creation workflow is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An OpenShift user calls <code>rhc app-create &lt;type&gt;</code></p>
</li>
<li>
<p><code>rhc</code> makes a rest call to the OpenShift broker to create a new application of the specified type</p>
</li>
<li>
<p>The OpenShift broker creates a record for the new application</p>
</li>
<li>
<p>The broker makes a call to a Docker node (an OpenShift node which is configured to support Docker-based gears) to create a source control container, passing the template git repo URL</p>
</li>
<li>
<p>The node downloads the specified template repo</p>
</li>
<li>
<p>The node creates a new git repository from the template content</p>
</li>
<li>
<p>The broker starts the prepare workflow</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="gear-image-preparation-workflow"><a class="anchor" href="#gear-image-preparation-workflow"></a>Gear Image Preparation Workflow</h4>
<div class="paragraph">
<p>The gear image preparation workflow is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The broker makes a call to create a builder gear, passing the manifest and git repo:</p>
</li>
<li>
<p>The node downloads the application git repo into a known directory for bind-mount into the builder gear container</p>
</li>
<li>
<p>If the manifest defines a prepare command, starts the container with <code>docker run -e &lt;prepare cmd&gt;</code></p>
</li>
<li>
<p>If not, the node starts the container with <code>docker run</code></p>
</li>
<li>
<p>The node waits for the container to finish running, imposing a timeout</p>
</li>
<li>
<p>The node extracts from the container (method TBD) any necessary stateful information such as: environment variables, cartridge hooks, dynamic network endpoints</p>
</li>
<li>
<p>The node performs a docker commit which creates the <strong>deployment layer</strong></p>
</li>
<li>
<p>The node pushes the docker image to the application&#8217;s private docker registry</p>
</li>
<li>
<p>The node reports the new deployment artifact (DA) id to the broker</p>
</li>
<li>
<p>The broker creates a new (DA) record for the application</p>
</li>
<li>
<p>The broker starts the deploy workflow</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="incremental-image-preparation"><a class="anchor" href="#incremental-image-preparation"></a>Incremental Image Preparation</h5>
<div class="paragraph">
<p>The preparation described above is a <strong>clean prepare</strong> - completely regenerating the layer containing the user source code. A consequence of a clean prepare is that the prepare script must redownload any dependencies of the application source (Ruby gems, Python eggs, Maven JARs). This may result in the versions of those dependencies changing and the introduction of failures or bugs. Therefore, there must be the possibility of an <strong>incremental prepare</strong> for security updates that allows a cartridge to reuse some or all of the previously generated content.</p>
</div>
<div class="paragraph">
<p>Potential problems caused by reusing a previous deployment layer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A cartridge might override system libraries with newer versions - those libraries might have the same security vulnerability that the system administrator is trying to patch</p>
</li>
<li>
<p>Libraries updated in the deployment layer may be intermixed with libraries from the cartridge layer, and a new library added to the cartridge layer that also exists in the deployment layer might prevent the runtime from starting because of incompatible versions.<br></p>
</li>
<li>
<p>Update may require the rebuild of compiled dependecies or code in order to patch a vulnerability / bug</p>
</li>
<li>
<p>The location of dependencies the cartridge expects may change</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all of these scenarios, the cartridge author and platform must coordinate around which content can be reused and when a full rebuild is required.</p>
</div>
<div class="paragraph">
<p>The incremental prepare workflow might look like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The broker makes a call to create a builder gear, passing the manifest, git repo, and previous gear image id:</p>
</li>
<li>
<p>The node downloads the application git repo into a known directory for bind-mount into the builder gear container</p>
</li>
<li>
<p>The node fetches the deployment layer of the previous gear image by its id.</p>
</li>
<li>
<p>The node calculates which contents from the previous image should be used in the new container, and if necessary copies them into the container.</p>
</li>
<li>
<p>If the manifest defines a prepare command, starts the container with <code>docker run -e &lt;prepare cmd&gt;</code></p>
</li>
<li>
<p>If not, the node starts the container with <code>docker run</code></p>
</li>
<li>
<p>The container code must decide whether to reuse the previously generated contents, or whether to continue without them (if a file listing dependencies has changed, new dependencies must be downloaded).</p>
</li>
<li>
<p>The node waits for the container to finish running, imposing a timeout</p>
</li>
<li>
<p>The node extracts from the container (method TBD) any necessary stateful information such as: environment variables, cartridge hooks, dynamic network endpoints</p>
</li>
<li>
<p>The node performs a docker commit which creates the <strong>deployment layer</strong></p>
</li>
<li>
<p>The node pushes the docker image to the application&#8217;s private docker registry</p>
</li>
<li>
<p>The node reports the new deployment artifact (DA) id to the broker</p>
</li>
<li>
<p>The broker creates a new (DA) record for the application</p>
</li>
<li>
<p>The broker starts the deploy workflow</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="version-upgrade"><a class="anchor" href="#version-upgrade"></a>Version upgrade</h5>
<div class="paragraph">
<p>A prepare may result in the version of a cartridge in use changing in the broker - it may have been input by the developer at build time. An application may have multiple cartridge versions in different gears as a result of a deploy. The broker should gracefully handle rollforward and rollback of this scenario:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and deploy v1 with PHP-5.3</p>
</li>
<li>
<p>Build and deploy v2 with PHP-5.4</p>
</li>
<li>
<p>Rollback to v1</p>
</li>
<li>
<p>Next build and deployment should use PHP-5.3</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deployment-workflow"><a class="anchor" href="#deployment-workflow"></a>Deployment Workflow</h4>
<div class="paragraph">
<p>The deployment process is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare a new version of the cartridge and get a DA id</p>
</li>
<li>
<p>Take the id of the new DA and begin updating the gears in the gear group with that new artifact</p>
</li>
<li>
<p>For web cartridges, a scale up, scale down operation is ideal.</p>
</li>
<li>
<p>For DB / stateful cartridges, a replace in place is ideal - stop the old container, keep the old stateful directories and ports as is, and then start the new container.</p>
</li>
<li>
<p>Once all gears are using the new DA, check whether the old DA should be deleted</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gear-management"><a class="anchor" href="#gear-management"></a>Gear management</h3>
<div class="paragraph">
<p>Due to the write-once nature of Docker gears, there are significantly less operations that can be performed on Docker gears than on V2 gears. Operations that would mutate a V2 gear instead result in a new image being prepared for an application&#8217;s web gears. This makes it possible for there to be three fundamental operations that can be performed on Docker gears: scale up, scale down, and replace.</p>
</div>
<div class="sect3">
<h4 id="scale-up-workflow"><a class="anchor" href="#scale-up-workflow"></a>Scale Up Workflow</h4>
<div class="paragraph">
<p>The scale up workflow is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The broker makes a call to scale up a new gear from a deployment ID:</p>
</li>
<li>
<p>The broker must provide sufficient information to the node for the node to securely retrieve the gear image. While the exact process will be defined elsewhere, the node is not assumed to have read access to all gear images in the system for security reasons.</p>
</li>
<li>
<p>The node establishes process isolation for the gear container on the node. This might be creating a unix user for a gear and/or creating selinux categories, etc.</p>
</li>
<li>
<p>The node starts the container with the application&#8217;s environment variables and a bind-mount into the application&#8217;s external storage.</p>
</li>
<li>
<p>The node makes the gear routable on a node-level.</p>
</li>
<li>
<p>The broker makes a call to the routing layer to route application requests to the new gear.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="scale-down-workflow"><a class="anchor" href="#scale-down-workflow"></a>Scale Down Workflow</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The broker makes a call to the routing later to disable routing application requests to the gear being scaled down.</p>
</li>
<li>
<p>The broker makes a call to scale down the gear on the node:</p>
</li>
<li>
<p>The node gracefully stops the container</p>
</li>
<li>
<p>The node removes the node-level routing for the gear</p>
</li>
<li>
<p>The node removes any artifacts of process isolation for the gear</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="replace-workflow"><a class="anchor" href="#replace-workflow"></a>Replace Workflow</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The broker makes a call to the node where the gear is running to replace the gear, passing the gear uuid and the DA id to replace to.</p>
</li>
<li>
<p>The node stops the container</p>
</li>
<li>
<p>The node restarts the container using the new DA</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are several use-cases that replace has to support with need to be further explored:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Avoid changing IP address or port bindings, as these would potentially necessitate environment changes.</p>
</li>
<li>
<p>Endpoint changes across versions of DAs</p>
</li>
<li>
<p>Mountpoint changes across versions of DAs</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Docker currently doesn&#8217;t directly support switching out an image for a process and starting another image with the same mounts / user / network bindings, but it has been requested.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrades"><a class="anchor" href="#upgrades"></a>Upgrades</h3>
<div class="paragraph">
<p>To upgrade a Docker gear (when a security update is released to a package):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify all the base cartridges that would be affected</p>
</li>
<li>
<p>For each cartridge:</p>
</li>
<li>
<p>Rebuild the cartridge from its dockerfile</p>
</li>
<li>
<p>Store the new version of the cartridge image alongside the old one</p>
</li>
<li>
<p>Mark all the applications using the old cartridge image as needing a rebuild</p>
</li>
<li>
<p>For each application needing a rebuild</p>
</li>
<li>
<p>Trigger a rebuild and redeploy</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Plugin cartridges may complicate this story, and user installed packages complicate it further. We may need a mechanism for categorizing gears into a searchable repo for packages.</p>
</div>
</div>
<div class="sect2">
<h3 id="additional-topics"><a class="anchor" href="#additional-topics"></a>Additional Topics</h3>
<div class="paragraph">
<p>These topics need further investigation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enabling the ability to run <em>yum</em> in a container and how that affects root security</p>
</li>
<li>
<p>Needs discussion with Dan Walsh for security - need to elaborate all potential risks with RPM install inside container</p>
</li>
<li>
<p>Disk usage of layers can be extreme:</p>
</li>
<li>
<p>Example is Java, where you may have 100M of base cartridge files, but Maven brings down 1GB of data</p>
</li>
<li>
<p>Need to explore how builds and cartridges can coexist without making carts hard to write, and how we deal with lots of disk usage during prepare.</p>
</li>
<li>
<p>Density of docker containers</p>
</li>
<li>
<p>How can container hooks be supported - which are necessary and which are not</p>
</li>
<li>
<p>Should hooks be run at build time by passing in the info about the current app, and then the env vars are changed as the app is rolled out?</p>
</li>
<li>
<p>Examples of individual scenarios for each type of cartridge</p>
</li>
<li>
<p>Plugin cartridges - composition (more images and slower builds) or injection (limited capabilities)</p>
</li>
<li>
<p>Cron</p>
</li>
<li>
<p>Jenkins-client</p>
</li>
<li>
<p>The exact process by which large number of gears are updated</p>
</li>
<li>
<p>Details of how cartridges are built - we need to support multiple versions of each cartridge for much longer and the broker has to handle that</p>
</li>
<li>
<p>Supporting arbitrary docker images (environment only injection)</p>
</li>
<li>
<p>Updating a docker image in place (upgrade)</p>
</li>
<li>
<p>Letting users define a cartridge as a dockerfile - downloadable cartridge replacement</p>
</li>
<li>
<p>Gear migration across servers</p>
</li>
<li>
<p>Quota and images (can be managed in thinp in gears, docker registry should give us more).</p>
</li>
<li>
<p>Routing discussion, but we have 90% of everything we need</p>
</li>
<li>
<p>How do port mappings and the port limit change?</p>
</li>
<li>
<p>Is move still necessary?</p>
</li>
<li>
<p>Where are environment variables stored?</p>
</li>
<li>
<p>In bind mount directory?</p>
</li>
<li>
<p>Env vars now have to be distributed to all nodes</p>
</li>
<li>
<p>How are bind mounts from persistent per node storage managed?</p>
</li>
<li>
<p>Same as today, bind /var/lib/openshift//data to an arbitrary location rather than inside home</p>
</li>
<li>
<p>How does gear directory change? No home mount automatic binding - home dir is transient per gear?</p>
</li>
<li>
<p>Two carts with same contract with source repo but different operating systems</p>
</li>
<li>
<p>Both java-tomcat-maven, only one is supported</p>
</li>
<li>
<p>UI/broker groups them together so you get a choice (RHEL supported, Fedora community supported)</p>
</li>
<li>
<p>Community maintains one or the other</p>
</li>
<li>
<p>Still need RPMs eventually for real distributions</p>
</li>
<li>
<p>SSH can be optionally implemented</p>
</li>
<li>
<p>Similar model but different behavior, LXC attach, krishna looking at it.</p>
</li>
<li>
<p>How do we rebuild without grabbing new dependencies? How do we do a security update that doesn&#8217;t need a build efficiently? If we take a security update and break because of a build dependency change, that&#8217;s worse than the security update breaking the app.</p>
</li>
<li>
<p>Point to point image distribution between nodes is preferred, although it requires us to manage our own availability. Can&#8217;t have redundancy for image backups without it.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="risks"><a class="anchor" href="#risks"></a>Risks</h3>
<div class="ulist">
<ul>
<li>
<p>Density changes from high thousands</p>
</li>
<li>
<p>Cost to update gears</p>
</li>
</ul>
</div>
</div></div>
<div id="footer">
<div id="footer-text">
<br>
Last updated 2014-02-20 10:42:50 EST
</div>
<!-- Google Analytics -->
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40375612-1']);
  _gaq.push(['_setDomainName', 'openshift.github.io']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
  $(document).ready(function() {
    _gaq.push(function() {
      $('a:not([href^="http"])').on("click", function(e) {
        e.preventDefault();
        var link = $(this).attr("href");
        _gaq.push(["_trackEvent", "Internal Links", "click", link]);
        setTimeout('document.location = "' + link + '"', 300);
      });
      $('a[href^="http"]').on("click", function(e) {
        e.preventDefault();
        var link = $(this).attr("href");
        _gaq.push(["_trackEvent", "Outbound Links", "click", link]);
        setTimeout('document.location = "' + link + '"', 300);
      });
    });
  });
</script>
<!-- Google Code for Remarketing -->
<script>
  var google_conversion_id = 1007064360;
  var google_conversion_label = "7jfmCMC5ugQQqKqa4AM";
  var google_custom_params = window.google_tag_params;
  var google_remarketing_only = true;
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script>
<noscript>
<div style="display: inline;">
<img alt="" height="1" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1007064360/?value=0&amp;label=7jfmCMC5ugQQqKqa4AM&amp;guid=ON&amp;script=0" style="border-style: none;" width="1">
</div>
</noscript>
</div>
</body>
</html>