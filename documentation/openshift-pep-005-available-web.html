<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Asciidoctor 0.1.4" name="generator">
<meta content="OpenShift Origin Documentation Project &lt;dev@lists.openshift.redhat.com&gt;" name="author">
<title>OpenShift PEP 005: Highly Available Web Applications</title>
<style>@import url(http://openshift.redhat.com/app/assets/overpass.css);
@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
/*
Origin theme source file

To build it:
- clone the asciidoctor-stylesheet-factory repo
- copy this theme file to the sass folder inside the repo
- copy the settings file to the sass/settings file inside the repo
- cd to the cloned repo
- bundle install
- compass compile
- compiled stylesheet is in the stylesheets/ directory
*/
/* Generated by Font Squirrel (http://www.fontsquirrel.com) on July 24, 2013 */
@font-face { font-family: 'source_code_pro'; src: url("fonts/sourcecodepro-regular-webfont.eot"); src: url("fonts/sourcecodepro-regular-webfont.eot?#iefix") format("embedded-opentype"), url("fonts/sourcecodepro-regular-webfont.woff") format("woff"), url("fonts/sourcecodepro-regular-webfont.ttf") format("truetype"), url("sourcecodepro-regular-webfont.svg#source_code_proregular") format("svg"); font-weight: normal; font-style: normal; }

/*
Settings and overrides for the Origin theme
*/
/* normalize.css v2.1.1 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address styling not present in IE 8/9. */
[hidden] { display: none; }

/* ========================================================================== Base ========================================================================== */
/** 1. Prevent system color scheme's background color being used in Firefox, IE, and Opera. 2. Prevent system color scheme's text color being used in Firefox, IE, and Opera. 3. Set default font family to sans-serif. 4. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { background: #fff; /* 1 */ color: #000; /* 2 */ font-family: sans-serif; /* 3 */ -ms-text-size-adjust: 100%; /* 4 */ -webkit-text-size-adjust: 100%; /* 4 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

a:focus { outline: none; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .ulist > .title, .olist > .title, .dlist > .title, .qlist > .title, .tableblock > caption { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #006699; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #005580; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Overpass, sans-serif; font-weight: bold; font-style: normal; color: #222222; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #7f0a0c; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

/*
.clearfix,
.floatend { zoom: 1; &:before, &:after { content: " "; display: table; } &:after { clear: both; }
}
*/
code { font-size: inherit; padding: 0; white-space: nowrap; background-color: inherit; border: 0 solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }

kbd.keyseq { color: #555555; }

kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

kbd kbd:first-child { margin-left: 0; }

kbd kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #222222; font-weight: bold; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 0 solid #dddddd; padding-bottom: 1.25em; }
#toc > ul, #toc > ol { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a, #toc ol.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1, #toc ol.sectlevel0 ol.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul, #toc ol { list-style-type: none; }

#toctitle { color: #6f6f6f; }

@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul, #toc.toc2 > ol { font-size: .95em; }
  #toc.toc2 ul ul, #toc.toc2 ol ol { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1, #toc.toc2 ol.sectlevel0 ol.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 0 solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .ulist > .title, .olist > .title, .dlist > .title, .qlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > .paragraph:last-child > p { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; line-height: 1.6; }
.sidebarblock > .content > .paragraph:last-child p { margin-bottom: 0; }

pre { color: black; font-family: source_code_pro, monospace, serif; overflow-x: auto; line-height: 1.4; }

.verseblock { margin-bottom: 1.25em; }

.literalblock, .listingblock { margin-bottom: 1.25em; }
.literalblock > .content > pre, .listingblock > .content > pre { background: #eeeeee; color: black; font-family: source_code_pro, monospace, serif; border-width: 0; padding: 0.8em 0.8em 0.6em 0.8em; word-wrap: break-word; line-height: 1.4; }
.literalblock > .content > pre.nowrap, .listingblock > .content > pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content > pre > code, .listingblock > .content > pre > code { font-size: 1em; white-space: inherit; color: black; font-family: source_code_pro, monospace, serif; padding: 0; background: none; font-weight: normal; border: none; }
@media only screen { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 1em; } }

.listingblock:hover .xml:before { content: "xml"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .html:before { content: "html"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .ruby:before { content: "ruby"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .asciidoc:before { content: "asciidoc"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .java:before { content: "java"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .javascript:before { content: "javascript"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .css:before { content: "css"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .scss:before { content: "scss"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }

.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.halign-top, td.tableblock.halign-top { vertical-align: top; }

th.tableblock.halign-bottom, td.tableblock.halign-bottom { vertical-align: bottom; }

th.tableblock.halign-middle, td.tableblock.halign-middle { vertical-align: middle; }

p.tableblock.header { color: #222222; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist { list-style-type: none; margin-left: 0.625em; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

td.hdlist1 { vertical-align: top; padding-right: .8em; font-weight: bold; }

.qanda > ol > li > p:first-child { color: #005580; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: none; box-shadow: none; }

.imageblock { margin-bottom: 1.25em; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding: 0.75em 0.375em; margin-bottom: 1.25em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: none; cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #006699; color: #004c73; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

nav.global { background: #222; width: 100%; height: 4em; }
nav.global ul { list-style-type: none; margin: 0; }
nav.global li { display: inline-block; }
nav.global a { display: block; padding: .5em 1em; font-family: Overpass; font-size: 1.1em; color: white; }
nav.global a:hover { color: #ef2e32; }
nav.global a img { margin-top: .25em; height: 2.75em; }

#header > h1 { border: none; }

#toc { background: #eee; border-right: none; }
#toc.toc2 { box-shadow: 1px 0 1px rgba(0, 0, 0, 0.3); }

code { font-family: source_code_pro; }

.admonitionblock td.icon .icon-tip:before { color: #cc6; text-shadow: none; }

#footer { background-image: url("images/panda.png"); background-position: right bottom; background-repeat: no-repeat; }

/* Alignment Styles */
.halign-left { text-align: left }
.halign-center { text-align: center }
.halign-right { text-align: right }

.valign-top { vertical-align: top }
.valign-middle { vertical-align: middle }
.valign-bottom { vertical-align: bottom }</style>
<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="article toc2">
<nav class="global">
<ul>
<li>
<a href="http://openshift.github.io">
<img alt="OpenShift Origin" src="images/logo.png">
</a>
</li>
<li>
<a href="index.html">Documentation Home</a>
</li>
</ul>
</nav>
<div id="header">
<h1>OpenShift PEP 005: Highly Available Web Applications</h1>
<span id="author">OpenShift Origin Documentation Project &lt;dev@lists.openshift.redhat.com&gt;</span>
<br>
<div class="toc2" id="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#abstract">Abstract</a></li>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#terms">Terms</a></li>
<li><a href="#specification">Specification</a></li>
<li><a href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a href="#rationale">Rationale</a></li>
</ul>
</div>
</div>
<div id="content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>PEP: 005<br>
Title: Highly Available Web Applications<br>
Status: accepted<br>
Author: Rajat Chopra <a href="mailto:rchopra@redhat.com">rchopra@redhat.com</a>, Mrunal Patel <a href="mailto:mpatel@redhat.com">mpatel@redhat.com</a>, Mike McGrath <a href="mailto:mmcgrath@redhat.com">mmcgrath@redhat.com</a>, Clayton Coleman <a href="mailto:ccoleman@redhat.com">ccoleman@redhat.com</a><br>
Arch Priority: high<br>
Complexity: 40<br>
Affected Components: <em>web, api, runtime, broker, admin_tools, cli</em><br>
Affected Teams: Runtime (5), UI (3), Broker (4), Enterprise (1)<br>
User Impact: high<br>
Epic: E01 <a href="https://trello.com/card/epic-01-i-can-run-an-application-with-a-highly-available-web-tier-ha/512a75379a7ef45063008db9/4">https://trello.com/card/epic-01-i-can-run-an-application-with-a-highly-available-web-tier-ha/512a75379a7ef45063008db9/4</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="abstract"><a class="anchor" href="#abstract"></a>Abstract</h3>
<div class="paragraph">
<p>Provide highly available web support for OpenShift applications to ensure that single node and gear failures do not result in downtime, and allow integration into existing routing and load-balancer infrastructures in customer environments. At high scale, applications should remain manageable and problems with individual gears can be corrected.</p>
</div>
</div>
<div class="sect2">
<h3 id="motivation"><a class="anchor" href="#motivation"></a>Motivation</h3>
<div class="paragraph">
<p>OpenShift must be able to offer the option of a highly available web tier for production applications. While the current OpenShift architecture uses a single HAProxy in a gear listening on the public DNS address for the application, future applications must be able to survive the failure of the node or gear containing that proxy.</p>
</div>
<div class="paragraph">
<p>Many customer environments include infrastructure that may offer availability and/or load balancing to HTTP servers. Leveraging that infrastructure will allow deployments of OpenShift that can fit into existing production environments.</p>
</div>
</div>
<div class="sect2">
<h3 id="terms"><a class="anchor" href="#terms"></a>Terms</h3>
<div class="paragraph">
<p><strong>system proxy</strong> - the HTTP (today apache) server that listens at port 80/443 on each node, terminates SSL (via SNI), routes traffic to gears located on that node via their internal address/port, and manages idling</p>
</div>
<div class="paragraph">
<p><strong>router / routing layer</strong> - a set of servers that provides highly available routing and/or load balancing for a set of applications. An OpenShift infrastructure may have multiple sets of routers. OpenShift has no routing layer implementation by default - instead, the application DNS is mapped to a specific node, which has a system proxy which chooses which gear receives the traffic.</p>
</div>
<div class="paragraph">
<p><strong>load balancing layer</strong> - a set of systems intended to distribute load for one or more applications. OpenShift implements a default load balancer mechanism within applications using one or more HAProxies inside of web gears. An implementation may choose to move load balancing above the node level and route traffic directly to public web gears - in this case the implementation may need to be notified of rotate-in/out actions on the individual gears.</p>
</div>
<div class="paragraph">
<p><strong>head gear</strong> - in OSE 1.2, the web gear within an application that has HAProxy and corresponds to the node the DNS entry for the app points to. In this pep, referred to as "web load balancer gear"</p>
</div>
</div>
<div class="sect2">
<h3 id="specification"><a class="anchor" href="#specification"></a>Specification</h3>
<div class="paragraph">
<p>Within an OpenShift deployment certain applications may need to be highly available in the event of node, gear, or network failures. Today, each application is load balanced by a single HAProxy instance within a gear of that application (known as the web load balancer gear). HTTP traffic to the application DNS entry goes directly to the node containing that gear, through the system proxy, into HAProxy, and then out to other gears on other nodes.</p>
</div>
<div class="paragraph">
<p>Within an application, gears may also behave as TCP load balancers. A TCP balancer must perform many of the same roles as the web balancer. The current web load balancer could be extended to support TCP balancing of arbitrary backends by exposing new external ports and advertising those routes to the broker, or a new TCP balancer cartridge could be created that uses its own gears and also advertises those routes.</p>
</div>
<div class="paragraph">
<p>The mapping between application DNS entries, load balancer gears, and backend gears is known as the OpenShift <strong>routing table</strong>. The OpenShift broker is the system of record for the routing table, with nodes reserving and releasing ports as necessary to satisfy installed cartridges. The broker also is responsible for reliably updating a DNS registry with application names and correct servers. The routing table is maintained for all endpoints, not just those that are HTTP specific.</p>
</div>
<div class="paragraph">
<p>This PEP specifies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A reliable system programming interface (routing SPI) on the OpenShift broker for notifying an external system of changes to the global routing table. The interface will be a Ruby plugin to the broker, and receive a stream of change notifications for the routing table of all applications. A series of default implementations and examples will be provided, starting simply with a message queue and moving up to full OpenStack Quantum API integration. A set of REST APIs for retrieving the application routing tables will also be provided for clients.</p>
</li>
<li>
<p>A new optional system component - a "router" - that proxies incoming HTTP requests from one or more application DNS entries to nodes, web load balancer gears, or web gears. The component may also perform load balancing, although that is not its primary objective. This component is typically two or more servers that are capable of high load proxying with fast failover in the event of problems. The router is aware of some or all of the state of the OpenShift routing table. The router may provide global TCP balancing, or delegate to a TCP load balancing cartridge within an application. It is the router&#8217;s responsibility to provide external TCP port mapping on the appropriate DNS address.</p>
</li>
<li>
<p>An OpenShift application should be able to contain multiple web load balancer gears, which distribute the incoming traffic load and provide redundancy. The system is capable of automatically creating the appropriate web load balancer gears on scale-up and scale-down and also allows an application owner to manage the exact number of web load balancer gears. Autoscaling should continue to function on the load balancer gears even in the event one or more balancer gears are unavailable. When an application becomes highly available, it acquires a new DNS entry.</p>
</li>
<li>
<p>A recommended design for an out of the box router configuration for OpenShift that utilizes the routing SPI to provision, configure, and update a set of systems that take application HTTP traffic and reliably route it to the web load balancer gears within an application. This configuration should be suitable for very large deployments of OpenShift and be able to be sharded under high load.</p>
</li>
<li>
<p>New operations on OpenShift applications via the REST API to handle management at extreme scale, including the removal of specific gears, notifying the web balancer gears to ignore or send traffic to specific web gears within an application (rotate-in and rotate-out). This includes the necessary operations to ensure failure of a web balancer gear or node does not halt the flow of operations within an application.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="topology-diagram"><a class="anchor" href="#topology-diagram"></a>Topology diagram</h5>
<div class="listingblock">
<div class="content">
<pre>           | Web HTTP traffic to                           | Changes to application (1)
           | app1-me.ha.rhcloud.com                        | Scale, add cart, etc
           |                                               v
           |                                           +-------------+
           |              Heartbeat IP                 | REST API    |
           v              Failover to Proxy 2          +-------------+-----+
     +----------+   +----------+                       |                   |
     |Proxy 1   |   |Proxy 2   |                       |        Broker     |
     |IP 1      +--&gt;|          |                       |                   |
     |          |&lt;--|          |                       +-------------------+
     |          |   |          |&lt;---------------------+| Routing SPI |  ^
     +-----+----+   +----------+      Changes to       +-------------+  |
           |                          applications                      | Persist
   +-------+-----+                    (3)                               | changes (2)
   |             |                                                      v
+--|--------+ +--|--------+ +----------+        +----------------------------------------+
|  v   Node | |  v   Node | |     Node |        | MongoDB (routing table model)          |
+-------+   | +-------+   | |          |        |                                        |
|Gear1  |   | |Gear2  |   | +------+   |        | App1  = has HA DNS                     |
|HAProxy|   | |HAProxy|   | |Gear3 |   |        | Gear1 = Load balance + PHP @ Host+Port |
|PHP    |   | |PHP    |   | |PHP   |   |        | Gear2 = Load balance + PHP @ Host+Port |
+----+--+---+ +-----+-+---+ +----------+        | Gear3 = PHP                @ Host+Port |
   ^ |           ^  |         ^ ^               +----------------------------------------+
   | +-----------+--|---------+ |
   +----------------+-----------+</pre>
</div>
</div>
<div class="paragraph">
<p>Changing an application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A user changing an application via the REST API invokes a command to scale up a PHP web application</p>
</li>
<li>
<p>The broker provisions a new gear on a node, and then records those changes in Mongo along with the host and port of the gear endpoints</p>
</li>
<li>
<p>As part of the provision, the broker sends a notification via the routing SPI about a new gear, along with the necessary info. The SPI may write that info to a file, a DB, a message bus, or directly to Apache, Nginx, or HAProxy configuration on a remote system.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because the application is marked as being highly available, it has an HA DNS entry for app1-me.ha.rhcloud.com in addition to its normal app1-me.rhcloud.com DNS entry.</p>
</div>
<div class="paragraph">
<p>Failover of a proxy</p>
</div>
<div class="paragraph">
<p>In this hypothetical configuration, proxy 1 and proxy 2 are both configured to virtual host route HTTP requests to app1-me.ha-rhcloud.com to any of the web load balancer gears within app1 (gear1 and gear2). Proxy 1 and proxy 2 are in a heartbeat IP failover setup - if proxy2 detects that proxy1 is not responding, it will be assigned IP address 1 and continue handling traffic. This is just one possible configuration. Other applications may be routed via proxy1 and proxy2, but a large system may choose to deploy multiple sets of proxies, each handling a different subset of applications.</p>
</div>
</div>
<div class="sect4">
<h5 id="related-peps"><a class="anchor" href="#related-peps"></a>Related PEPs</h5>
<div class="paragraph">
<p>This PEP interacts with the deploy/zero-downtime PEP and the Geo PEP. This PEP does not attempt to define the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TCP load balancing within OpenShift applications or at the infrastructure level. It is assumed that external TCP balancing will require public ports to be exposed, and also must define how the endpoints are described to clients. The routing SPI and the REST API will be built to support the possibility of TCP load balancing.</p>
</li>
<li>
<p>Multi-master / failover for pushes/build/deployments (covered by zero-downtime PEP)</p>
</li>
<li>
<p>Websocket support, although it is assumed that web sockets can be load balanced and proxied in a similar fashion to HTTP edge traffic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Flowchart for websockets with proxy servers <a href="http://imgur.com/cZOuS1Y">http://imgur.com/cZOuS1Y</a> (from The Definitive Guide to HTML5 WebSocket)</p>
</div>
</div>
<div class="sect3">
<h4 id="routing-system-programming-interface-spi"><a class="anchor" href="#routing-system-programming-interface-spi"></a>Routing System Programming Interface (SPI)</h4>
<div class="paragraph">
<p>OpenShift will reliably distribute notifications of the following changes to applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation of an application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>lists the application DNS and the web load balancer / web gear it points to. Also lists any other routes created with the app</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deletion of an application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>lists the application DNS and the web load balancer / web gear it points to. Also lists any other routes created with the app</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Addition/removal of routes to an application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a new cartridge is added or removed to an app, additional routes may be available on individual gears. Those changes would be sent as a list of dns + port entries, types of traffic on that port (http, ssh, https), and whether it&#8217;s a load-balancer or not</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Addition/removal/changes to SSL certs of aliases from an application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An alias is an external route - the mapping between the alias DNS and the application DNS must be known to a routing implementor. Sends the alias+port and the underlying DNS address+port it should map to.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Addition/removal of geography changes to an application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A geo (see <a href="https://github.com/openshift/openshift-pep/blob/master/openshift-pep-004.md">Geo PEP 004</a>) may convey information about the placement of an application. Sends the application DNS, the Geo, and the application id</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to the stop/start/rotate-in/rotate-out status of an application or gear</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When components within OpenShift request changes to the running status of a gear or application or whether traffic flows to items in that app. Sends a list of affected dns + port entries and the types of traffic.</p>
</div>
<div class="paragraph">
<p>The broker will invoke a Ruby service interface for each of these events when changes are being made to the system in a way that guarantees at-least-once delivery of the event to the interface. A standard implementation of that interface would typically put those events onto a reliable message queue (such as ActiveMQ) for processing by an external script. This ensures that multiple workers can process events and notify an external service.</p>
</div>
<div class="paragraph">
<p>In addition, OpenShift must support a REST API call per application to retrieve the full state of the routing table for that application, including all DNS entries for endpoints, ports, and the types and responsibilities of each endpoint in the application. The underlying broker data model will support high performance retrieval of that map.</p>
</div>
<div class="sect4">
<h5 id="routing-table-data-model-wip"><a class="anchor" href="#routing-table-data-model-wip"></a>Routing table data model [WIP]</h5>
<div class="paragraph">
<p>The developer clients and consumers of the routing SPI need to be able to answer the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What is the public http URL for this app? (what if there are multiple?)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>answers: app dns url, aliases, ha app dns url. Aliases should take priority, but all need to be listed with the appropriate endpoints (what they resolve to)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What are the hosts and ports of my web load balancers?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mongo data model will contain information about the external HTTP port and host for each load balancer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What are the proxy-ports for each of my db gears? Do I get a display name for the type of what this is (since most time it&#8217;s pretty simple)</p>
</li>
<li>
<p>What are the proxy ports for each of my web gears? When I ask for this, I shouldn&#8217;t get the URL for phpmyadmin</p>
</li>
<li>
<p>What is the URL of phpmyadmin? (this implementation can be deferred)</p>
</li>
<li>
<p>What is my git url? (and what protocol is it - git+ssh is all we support today) What if there are multiple Git URLs?</p>
</li>
<li>
<p>What are all of the proxy ports, protocls, and hostnames for my app so I can establish a bulk port-forward session</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Possible API is a list of all endpoints. Each endpoint has:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more types/roles - i.e. web, load-balanced, ssh, git, tcp (generic), mysql:master, mysql:slave, redis</p>
</li>
<li>
<p>Roles/types are used to identify the logical use for the endpoint, and are stable over time</p>
</li>
<li>
<p>A single protocol (maybe 2)</p>
</li>
<li>
<p>http, https, tcp, git+ssh, mysql, tcp seems like a default</p>
</li>
<li>
<p>A single port number, that maps to the external gear PROXY_PORT</p>
</li>
<li>
<p>A hostname that uniquely identifies the server that resolves that request.</p>
</li>
<li>
<p>Zero or more additional hostnames associated with this endpoint<br></p>
</li>
<li>
<p>For the app endpoint, the app DNS is the primary entry and the aliases</p>
</li>
<li>
<p>The gear id that owns that endpoint, or null if no gear handles this endpoint.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="openshift-router-component"><a class="anchor" href="#openshift-router-component"></a>OpenShift Router component</h4>
<div class="paragraph">
<p>An OpenShift may optionally include one or more router components that route web traffic from application DNS entries to web load balancer gears or individual web gears. The router(s) are notified of changes to the routing table via the routing SPI, although the exact implementation can vary between deployments. The most common router configuration would be to distribute incoming HTTP traffic amongst the various web balancer gears for an application, potentially sharded into several separate router components each handling a section of the overall application traffic. The recommended configuration would be a pair of high volume traffic proxies connected via heartbeat in an active-active or active-passive configuration with fast IP reassignment.</p>
</div>
<div class="paragraph">
<p>A router component MUST perform the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide HTTP virtual host passing to individual web backends for one or more applications. The router is expected to map external DNS aliases (including application aliases) as well as the application DNS entry associated with high availability. The standard model would be the external web load balancer port (not via the system proxy) as backends, although implementors may consider external availability and load balancing by going directly to web gears.</p>
</li>
<li>
<p>Detect dead backends and gracefully reallocate traffic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A router component SHOULD perform the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide HTTPS termination including SNI for individual aliases</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A router component MAY perform the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Divide traffic among multiple frontends via multihomed DNS entries</p>
</li>
<li>
<p>Support global TCP balancing by routing external ports to backends advertised by port/protocol within applications. Because generic TCP balancing cannot take advantage of virtual hosting, it is expected that a router either listens on random ports, or listens on multiple physical or virtual IP interfaces at standard ports (3306 for mysql, etc).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is expected that integrators may choose to use commercial load balancer hardware or software load balancers.</p>
</div>
</div>
<div class="sect3">
<h4 id="multiple-web-load-balancer-gears-per-application"><a class="anchor" href="#multiple-web-load-balancer-gears-per-application"></a>Multiple web load balancer gears per application</h4>
<div class="paragraph">
<p>OpenShift exposes a single instance of HAProxy within a scalable application today that is bound to the application DNS - that web balancer gear, if down, prevents traffic from reaching the apps. To that end, an application should be able to activate multiple HAProxies instances and ensure that those instances can properly cooperate to distribute load. An application should be able to scale cleanly from 1 gear to 1000 gears, with the infrastructure making correct decisions as necessary to allocate new web balancer gears.</p>
</div>
<div class="paragraph">
<p>This section deals primarily with HTTP load balancing, although multi-master TCP balancing is an application of the same principles when embedded withxn other web gears. The implementation of the load balancer cart and the broker&#8217;s interaciton with it would be similar on a web gear group as on a db gear group.</p>
</div>
<div class="paragraph">
<p>In general, all load balancers within an app should be considered active, and it is the responsibility of higher infrastructures (routers) to maintain their own mechanism for tracking backend status. A load balancer gear should be stoppable, just like other gears.</p>
</div>
<div class="paragraph">
<p>In general, the minimum availability level is to have two web load balancers, each serving traffic to all web gear backends. To scale to a traffic load beyond what a single web load balancer gear can handle will require multiple balancers. A user may elect to make their application capable of multiple balancers - when they do so they are assigned a new DNS application entry that represents the aggregation of the traffic to multiple balancers, while their application DNS entry continues to point to their first load balancer. By default applications are created with only a single load balancer. An application owner may choose to return to a single web gear configuration at any time.</p>
</div>
<div class="paragraph">
<p>There are a few important limits to be aware of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network traffic a single, in-gear load balancer can handle - effective bandwidth limit of the node (1GB/s)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Traffic to a single load balancer is limited by the inbound/outbound traffic supported by the kernel/machine. There may be competition between gears on that node for a fair share of bandwidth.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of backends HAProxy can performantly monitor - at least hundreds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HAProxy should scale reasonably well to hundreds of backends, but every change to the config (backends) requires a SIGUSR1 signal and a reload of the config, which can affect uptime and status.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of HAProxies that must drain an individual gear of traffic before a restart can continue - expect to limit to 3-10</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If multiple HAProxies point to a single gear, a rotate-out operation must wait for ALL HAProxies to successfully mark the backend down before the gear can be safely stopped. Because HAProxy failures are independent events, every additional front end load balancer significantly increases the probability of a failure or timeout. This number should be kept small, and in large topologies will require partition of balancer&#8594;gear responsibilities. This is limited by the coverage percentage (the percent of web gears within an app that a given balancer points to)</p>
</div>
<div class="paragraph">
<p>We define a few variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>M - the number of web load balancer gears in the application</p>
</li>
<li>
<p>N - the number of web gears in the application</p>
</li>
<li>
<p>C - the percent of gears in N that a given load balancer talks to</p>
</li>
<li>
<p>R - the number of web gears that can route traffic through a single node</p>
</li>
<li>
<p>X - the number of gears that must be drained in order to rotate a node out</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In practice, a realistic small gear &#8594; load balancer ratio that saturates the limits of a single node might be 15 (R ~ 15). At small scales, C=100% is not limited by any of the factors above. The minimum configuration required for availability is 2 web gears, each with the load balancer active. This is likely to work quite well up to tens of gears.</p>
</div>
<div class="paragraph">
<p>At larger scales, with C=100% (each balancer talks to all web gears), the last constraint is the most important - all masters have to drain the traffic for a single gear to be rotated out. The gear limit is expressed (for a given value of X) as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>N = X * R / C</pre>
</div>
</div>
<div class="paragraph">
<p>From the suggested limit above, a cautious X=3 to a somewhat larger X=10 with C=100% practically limits the number of gears to 3_15/100% &#8658; 10_15/100% or 45-150 per application. That upper limit is flexible, but increases the load on other parts of system and impacts the latency of rotate-out requests. If C is lower, larger numbers of gears can be serviced - C=50% would be 3_15/50% &#8658; 10_15/50% or 90-300, C=33% would be 145-450, etc.</p>
</div>
<div class="paragraph">
<p>Therefore, the system will be designed with C=100% as the low scale preference, while at higher scale levels effective C must be tested experimentally, and should be a value that users can modify.</p>
</div>
<div class="sect4">
<h5 id="auto-scaling-multiple-load-balancers"><a class="anchor" href="#auto-scaling-multiple-load-balancers"></a>Auto-scaling multiple load balancers</h5>
<div class="paragraph">
<p>The web load balancer cartridge is responsible for making decisions about scaling, as the mechanisms for measuring traffic load are specific to the cartridge providing load balancing (in this case HAProxy). OpenShift will expect the cartridge to invoke the appropriate REST API endpoint using broker key authorization as it does today. The load balancer cartridge is responsible for ensuring that scale decisions are consistent across multiple web load balancers.</p>
</div>
<div class="paragraph">
<p>The simplest cartridge implementation is to use the connection hook information provided by the broker to determine a single gear that is responsible for sending scale up and scale down messages. For instance, the first gear created might enable the daemon for sending scale up events, but later gears might not. To allow change in the event of a failure, the cartridge might support an application environment variable specifying the gear that should run the scaler. A user would add an application environment variable, then restart the load balancer gears. This mechanism could use the load information just for its own gear, or also look at the load information for the other gears.</p>
</div>
<div class="paragraph">
<p>A more complicated implementation would attempt to make scale decisions independently of other web load balancer gears, attempting to estimate the traffic the balancer is handling in isolation. This has the advantage of requiring no coordination, but may result in additional gears being provisioned unnecessarily.</p>
</div>
<div class="paragraph">
<p>An alternative implementation would be for the load balancer components to communicate and reach a decision about scale via consensus or via leader election. The broker may or may not be used to handle election.</p>
</div>
<div class="paragraph">
<p>In all scenarios, manual scaling can be used to increase capacity temporarily in the event of a failure on a head gear.</p>
</div>
</div>
<div class="sect4">
<h5 id="data-model-changes"><a class="anchor" href="#data-model-changes"></a>Data Model Changes</h5>
<div class="paragraph">
<p>Each gear that is a load balancer (has a cartridge installed and activated that can provide load balancing duties for the web framework cartridge) will be tracked in the broker data model. A single gear group contains the web framework and load balancer cartridges, and all data related to the scaling of either is stored with that gear group. The broker will decide whether a new gear should have only the web framework (e.g. PHP) or the web framework and a load balancer (in this example, the HAProxy load balancer cart), and then record that decision on the gear object in the model.</p>
</div>
<div class="paragraph">
<p>To change to the number of load balancer gears within an application, a user may set either the minimum and maximum scale on the web load balancer cartridge, or rely on a simple ratio provided by the cartridge. That ratio determines how many web gears should exist for each one load balancer, and is applied when a new gear is created. A user may be able to set that ratio directly on the load balancer cartridge. In both cases, the scale factors are modelled with the gear group and are applied through the cartridge REST API.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="new-gear-operations"><a class="anchor" href="#new-gear-operations"></a>New gear operations</h4>
<div class="paragraph">
<p>In order to properly scale to hundreds of gears, application owners must be able to remove broken gears, manage individual gears, and handle rotation duties.</p>
</div>
<div class="sect4">
<h5 id="remove-a-specific-gear"><a class="anchor" href="#remove-a-specific-gear"></a>Remove a specific gear</h5>
<div class="paragraph">
<p>In the event that a node or gear is permanently lost, or a sustained network outage, it should be possible for an application owner to instruct the REST API / platform to remove/scale down a specific gear. This should include load-balancer gears, and the platform should recognize that that removal requires a replacement. It should not be possible to remove the last gear or the last node.</p>
</div>
</div>
<div class="sect4">
<h5 id="restart-an-individual-gear"><a class="anchor" href="#restart-an-individual-gear"></a>Restart an individual gear</h5>
<div class="paragraph">
<p>It should be possible via the REST API to restart an individual gear in order to clear wedged processes.</p>
</div>
</div>
<div class="sect4">
<h5 id="instruct-the-web-load-balancers-and-or-router-to-take-backends-in-and-out-of-rotation"><a class="anchor" href="#instruct-the-web-load-balancers-and-or-router-to-take-backends-in-and-out-of-rotation"></a>Instruct the web load balancers and/or router to take backends in and out of rotation</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Rotate-Out</strong></p>
<div class="paragraph">
<p>Remove the requested gear from receiving traffic inside and outside of the application, on all endpoints except SSH. This operation is <strong>graceful</strong> - it instructs the elements within the node to remove the affected gear from any active traffic in a non-disruptive manner. This operation should be persistent until a rotate-in is executed for that gear.</p>
</div>
<div class="paragraph">
<p>It should be possible to execute this operation asynchronously, without waiting (prereq: scheduler)</p>
</div>
<div class="paragraph">
<p>The operation must always be provided a timeout, since some clients will refuse to release their connection. The default timeout should be reasonable for HTTP traffic (minutes) and should be configurable per application (env var)</p>
</div>
</li>
<li>
<p><strong>Rotate-In</strong></p>
<div class="paragraph">
<p>Allow the requested gear to receive traffic inside and outside of the application, on all endpoints except SSH. This operation should be persistent until a rotate-out is executed for that gear.</p>
</div>
<div class="paragraph">
<p>The operation is expected to complete deterministically in a short (&lt; 3s?) timeframe, and thus does not need a timeout.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A number of other operations within OpenShift will use these two actions either individually or in bulk to protect the users of an application from errors and downtime. Parallel operation (instructing an application to rotate-out multiple gears) will be important at scale.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Restarting a gear without downtime requires the following operations today:</p>
<div class="paragraph">
<p>Rotate-out / full stop cartridges / full start cartridges / rotate-in</p>
</div>
<div class="paragraph">
<p>!! Many web technologies do not require full restarts to pick up new versions - we should be prepared to allow individual cartridges to make that decision, by sending a gear level event to restart and let the cartridges decide whether they need to be rotated out. !!</p>
</div>
</li>
<li>
<p>Deploying a new version of code requires the following operations today:</p>
<div class="paragraph">
<p>Rotate-out / full stop cartridges / replace version / run deploy / full start cartridges / rotate-in</p>
</div>
<div class="paragraph">
<p>!! Some consumers may have cartridges or applications that can cleanly reload new code without any of these steps being executed (because they fully load source into memory) - we should look for opportunities to enable this</p>
</div>
</li>
<li>
<p>If a problematic gear is detected, administrators of an application may wish to take it out of rotation in order to troubleshoot problems.</p>
<div class="paragraph">
<p>The gear may not be down as seen by HAProxy - instead it may be functioning incorrectly. Stop / delete may destroy important debugging info.</p>
</div>
</li>
<li>
<p>Administrators of an application may take large sets of gears out of rotation to perform special, non-deployment operations</p>
<div class="paragraph">
<p>This may include driving a deployment outside of OpenShift&#8217;s control, by targeting discrete operations.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="resilience-of-the-application-pending-operations-queue"><a class="anchor" href="#resilience-of-the-application-pending-operations-queue"></a>Resilience of the application pending operations queue</h5>
<div class="paragraph">
<p>The application pending operations queue (used to transactionally manage distributed resources like gears) must be resilient to node failures, and allow certain operations to continue even in the presence of operations that cannot complete at the current time. The minimal operations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scale down a specific gear</p>
</li>
<li>
<p>Scale up a new load balancer gear</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It <strong>must</strong> be possible for an administrator to unblock a specific application so it may continue to scale in a deployment of OpenShift. Application owners <strong>should</strong> have the capability to cancel operations that cannot complete. The infrastructure and job infrastructure <strong>should</strong> be designed so that operations that must operate on gears that are not available can be bypassed / skipped / delayed correctly.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="broker-operations-for-multiple-web-load-balancers"><a class="anchor" href="#broker-operations-for-multiple-web-load-balancers"></a>Broker operations for multiple web load balancers</h4>
<div class="paragraph">
<p>Coordination for the router and the web load balancer gears (HAProxy) will be managed by the broker in a series of events managed by the operation queue. The create HA application flow would be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create app called through the rest api</p>
</li>
<li>
<p>Two pending ops are added to the queue. One to create the app and one to add HA. The second op is no different than someone adding HA to an existing app.</p>
</li>
<li>
<p>Pending ops to create the app are elaborated (same as they are already)</p>
</li>
<li>
<p>Application is created as it is today without HA (the app in non form will be accessible at this point)</p>
</li>
<li>
<p>Pending ops to add HA are elaborated. Rough steps are:</p>
</li>
<li>
<p>Add additional HAProxy gear</p>
</li>
<li>
<p>Configure connections with additional HAProxy gear with all existing gears (so identical haproxy.cfg in both haproxy gears)</p>
<div class="ulist">
<ul>
<li>
<p>Expose HAProxy servers on external ports will need to be an additional connection for HA apps)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Add HAProxy servers of app to the routing layer tables. Note: The communication between the routing layer and the HAProxy servers should skip the apache proxy on the nodes and go directly to HAProxy on an exposed port.</p>
</li>
<li>
<p>Add add HA CNAME for the app pointing to the routing layer. Probably something like ha-myapp-mydom.rhcloud.com</p>
</li>
<li>
<p>Notify the routing SPI</p>
</li>
<li>
<p>Execute the pending ops (rollbacks and retries at many points are possible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remove HA from an application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pending ops to remove HA are elaborated. Rough steps are:</p>
</li>
<li>
<p>Remove additional HAProxy gear</p>
</li>
<li>
<p>Execute connections</p>
</li>
<li>
<p>Re HAProxy servers of app to the routing layer tables.</p>
</li>
<li>
<p>Remove HA CNAME</p>
</li>
<li>
<p>Notify the routing SPI</p>
</li>
<li>
<p>Execute the pending ops (rollbacks and retries at many points are possible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Git Push/Build/Deployments</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A build / Deployment PEP is being designed that will cover more exotic changes to the build process.</p>
</li>
<li>
<p>This PEP only covers the basic use case of pushing to the master HAProxy gear and having it sync to all other gears just as it is today.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="backwards-compatibility"><a class="anchor" href="#backwards-compatibility"></a>Backwards Compatibility</h3>
<div class="ulist">
<ul>
<li>
<p>No backward incompatible API changes are planned. All APIs and SPIs are new.</p>
</li>
<li>
<p>The routers and the routing SPI operate independently of the nodes.</p>
</li>
<li>
<p>An existing application can continue to serve traffic to its original DNS entry, and can configure its aliases to point to the HA layer as necessary.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="rationale"><a class="anchor" href="#rationale"></a>Rationale</h3>
<div class="paragraph">
<p>Highly available systems should require multiple independent failures before a service disruption occurs. Adding multiple HAProxy servers allows a large distributed environment to provide HA for several applications. By making the router infrastructure pluggable, enterprises can inject their own load balancers into individual applications (for example a redline balancer). Thus the pluggable balancer system is outside the scope of this document, but considered while implementing the routing SPI.</p>
</div>
<div class="paragraph">
<p>Having multiple backend haproxy servers provides easier customization of the configs on a per application basis and further assists in application containment to mitigate different applications from impacting the performance of other applications. At the same time, operations on the existing HAProxy gear (the head gear) are made less special - over time all operations that could span multiple HAProxy masters can be executed in a distributed fashion (build, deploy, restart, rotate-out).</p>
</div>
<div class="paragraph">
<p>Instead of having a thick or smart routing tier, OpenShift has picked a more traditional route using light weight existing technologies to balance applications across different load balancers. Users will not be able to ssh in to these servers and won&#8217;t have access to them just as they don&#8217;t the system reverse proxy tier today. An implementor may choose to develop a more complex infrastructure using the routing SPI.</p>
</div>
</div></div>
<div id="footer">
<div id="footer-text">
<br>
Last updated 2014-12-17 00:12:01 EST
</div>
<!-- Google Analytics -->
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40375612-1']);
  _gaq.push(['_setDomainName', 'openshift.github.io']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
  $(document).ready(function() {
    _gaq.push(function() {
      $('a:not([href^="http"])').on("click", function(e) {
        e.preventDefault();
        var link = $(this).attr("href");
        _gaq.push(["_trackEvent", "Internal Links", "click", link]);
        setTimeout('document.location = "' + link + '"', 300);
      });
      $('a[href^="http"]').on("click", function(e) {
        e.preventDefault();
        var link = $(this).attr("href");
        _gaq.push(["_trackEvent", "Outbound Links", "click", link]);
        setTimeout('document.location = "' + link + '"', 300);
      });
    });
  });
</script>
<!-- Google Code for Remarketing -->
<script>
  var google_conversion_id = 1007064360;
  var google_conversion_label = "7jfmCMC5ugQQqKqa4AM";
  var google_custom_params = window.google_tag_params;
  var google_remarketing_only = true;
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script>
<noscript>
<div style="display: inline;">
<img alt="" height="1" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1007064360/?value=0&amp;label=7jfmCMC5ugQQqKqa4AM&amp;guid=ON&amp;script=0" style="border-style: none;" width="1">
</div>
</noscript>
</div>
</body>
</html>