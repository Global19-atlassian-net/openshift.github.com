<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OpenShift::Runtime::Utils::TC
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../';
  framesUrl = "../../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../OpenShift.html" title="OpenShift (module)">OpenShift</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Runtime.html" title="OpenShift::Runtime (module)">Runtime</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Utils.html" title="OpenShift::Runtime::Utils (module)">Utils</a></span></span>
     &raquo; 
    <span class="title">TC</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OpenShift::Runtime::Utils::TC
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OpenShift::Runtime::Utils::TC</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This class is a nearly direct translation of the TC shell script to solve a
specific problem and should be rewritten to be a clean API when time
permits.</p>

<p>CAVEAT: This script assumes the selinux container and libcgroup</p>

<pre class="code ruby"><code class="ruby">cgroups implementation.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="MUTEX-classvariable" class="">@@MUTEX =
          
        </dt>
        <dd><pre class="code"><span class='gvar'>$OPENSHIFT_RUNTIME_UTILS_TC_MUTEX</span></pre></dd>
      
        <dt id="LOCKFILE-classvariable" class="">@@LOCKFILE =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/var/lock/oo-tc</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deluser-instance_method" title="#deluser (instance method)">- (Object) <strong>deluser</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_interface_mtu-instance_method" title="#get_interface_mtu (instance method)">- (Object) <strong>get_interface_mtu</strong>(iface) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (TC) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of TC.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nothrottleuser-instance_method" title="#nothrottleuser (instance method)">- (Object) <strong>nothrottleuser</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output-instance_method" title="#output (instance method)">- (Object) <strong>output</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_valid_user-instance_method" title="#parse_valid_user (instance method)">- (Object) <strong>parse_valid_user</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#restart-instance_method" title="#restart (instance method)">- (Object) <strong>restart</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#restartuser-instance_method" title="#restartuser (instance method)">- (Object) <strong>restartuser</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">- (Object) <strong>show</strong>(uuid = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_impl-instance_method" title="#start_impl (instance method)">- (Object) <strong>start_impl</strong>(f) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#startuser-instance_method" title="#startuser (instance method)">- (Object) <strong>startuser</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#startuser_impl-instance_method" title="#startuser_impl (instance method)">- (Object) <strong>startuser_impl</strong>(uuid, pwent, netclass, f) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#status-instance_method" title="#status (instance method)">- (Object) <strong>status</strong>(uuid = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#statususer-instance_method" title="#statususer (instance method)">- (Object) <strong>statususer</strong>(uuid, pwent, netclass) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (Object) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_impl-instance_method" title="#stop_impl (instance method)">- (Object) <strong>stop_impl</strong>(f) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stopuser-instance_method" title="#stopuser (instance method)">- (Object) <strong>stopuser</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stopuser_impl-instance_method" title="#stopuser_impl (instance method)">- (Object) <strong>stopuser_impl</strong>(uuid, pwent, netclass, f) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#synchronized-instance_method" title="#synchronized (instance method)">- (Object) <strong>synchronized</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#throttleuser-instance_method" title="#throttleuser (instance method)">- (Object) <strong>throttleuser</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_all_users-instance_method" title="#with_all_users (instance method)">- (Object) <strong>with_all_users</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_tc_batch-instance_method" title="#with_tc_batch (instance method)">- (Object) <strong>with_tc_batch</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_tc_loaded-instance_method" title="#with_tc_loaded (instance method)">- (Object) <strong>with_tc_loaded</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="OpenShift::Runtime::Utils::TC (class)">TC</a></span></tt>) <strong>initialize</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A new instance of TC</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@output</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='ivar'>@config</span>    <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/etc/openshift/node.conf</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@resources</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/etc/openshift/resource_limits.conf</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># ============================================================================
</span>  <span class='comment'>#  Functions for setting the net class
</span>  <span class='comment'># ============================================================================
</span>
  <span class='comment'>#
</span>  <span class='comment'>#  tc uses the following units when passed as a parameter.
</span>  <span class='comment'>#  kbps: Kilobytes per second
</span>  <span class='comment'>#  mbps: Megabytes per second
</span>  <span class='comment'>#  kbit: Kilobits per second
</span>  <span class='comment'>#  mbit: Megabits per second
</span>  <span class='comment'>#  bps: Bytes per second
</span>  <span class='comment'>#       Amounts of data can be specified in:
</span>  <span class='comment'>#       kb or k: Kilobytes
</span>  <span class='comment'>#       mb or m: Megabytes
</span>  <span class='comment'>#       mbit: Megabits
</span>  <span class='comment'>#       kbit: Kilobits
</span>  <span class='comment'>#  To get the byte figure from bits, divide the number by 8 bit
</span>  <span class='comment'>#
</span>
  <span class='comment'># Create a openshift parent qdesc and limit it to a large percentage of the
</span>  <span class='comment'># bandwidth of the interface (leaving some for the OS)
</span>  <span class='comment'>#
</span>  <span class='comment'># Then create for each user a qdesc and limit it to a small fraction of
</span>  <span class='comment'># the total bandwidth
</span>  <span class='comment'>#
</span>
  <span class='comment'># The network interface we&#39;re planning on limiting bandwidth.
</span>  <span class='ivar'>@tc_if</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>EXTERNAL_ETH_DEV</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>eth0</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@tc_if_mtu</span><span class='op'>=</span><span class='id identifier rubyid_get_interface_mtu'>get_interface_mtu</span><span class='lparen'>(</span><span class='ivar'>@tc_if</span><span class='rparen'>)</span>
  <span class='ivar'>@tc_min_quantum</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_min_quantum</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@tc_if_mtu</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@tc_max_quantum</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_max_quantum</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='int'>100000</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='comment'># Normal bandwidths are in Mbit/s
</span>  <span class='ivar'>@tc_max_bandwidth</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_max_bandwidth</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='int'>800</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='comment'># 800 mbit/s
</span>  <span class='ivar'>@tc_user_share</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_user_share</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>         <span class='comment'># 8 mbit/s normal gear rate (*100 gears = tc_max_bandwidth)
</span>  <span class='ivar'>@tc_user_limit</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_user_limit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@tc_max_bandwidth</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='comment'># Full burst by default
</span>  <span class='ivar'>@tc_user_quantum</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_user_quantum</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@tc_max_quantum</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='comment'># Throttles are in kbit/s
</span>  <span class='ivar'>@tc_throttle_user_share</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_throttle_user_share</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='int'>128</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>    <span class='comment'># 128 kbits/s with no borrow
</span>  <span class='ivar'>@tc_throttle_user_limit</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_throttle_user_limit</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@tc_throttle_user_share</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@tc_throttle_user_quantum</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_throttle_user_quantum</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@tc_min_quantum</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='comment'># Where we keep track of throttled/high users
</span>  <span class='ivar'>@tc_user_dir</span><span class='op'>=</span><span class='lparen'>(</span><span class='ivar'>@resources</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tc_user_dir</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GEAR_BASE_DIR</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.tc_user_dir</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="deluser-instance_method">
  
    - (<tt>Object</tt>) <strong>deluser</strong>(uuid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


315
316
317
318
319
320
321
322
323
324
325</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 315</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deluser'>deluser</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Deleting user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_f'>rm_f</span><span class='lparen'>(</span><span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_user_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>_*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='id identifier rubyid_stopuser_impl'>stopuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_interface_mtu-instance_method">
  
    - (<tt>Object</tt>) <strong>get_interface_mtu</strong>(iface) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_interface_mtu'>get_interface_mtu</span><span class='lparen'>(</span><span class='id identifier rubyid_iface'>iface</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>ip link show dev </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_iface'>iface</span><span class='embexpr_end'>}</span><span class='tstring_end'>]</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to determine external network interface IP address.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_out'>out</span><span class='op'>=~</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>mtu\s+(\d+)</span><span class='regexp_end'>/</span></span>
    <span class='gvar'>$~</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>else</span>
    <span class='int'>1500</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nothrottleuser-instance_method">
  
    - (<tt>Object</tt>) <strong>nothrottleuser</strong>(uuid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


301
302
303
304
305
306
307
308
309
310
311
312
313</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 301</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nothrottleuser'>nothrottleuser</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unthrottling user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_f'>rm_f</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_user_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>_throttle</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_stopuser_impl'>stopuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>rescue</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='const'>ArgumentError</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_startuser_impl'>startuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output-instance_method">
  
    - (<tt>Object</tt>) <strong>output</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output'>output</span>
  <span class='ivar'>@output</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_valid_user-instance_method">
  
    - (<tt>Object</tt>) <strong>parse_valid_user</strong>(uuid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114
115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 112</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pwent'>pwent</span> <span class='op'>=</span> <span class='const'>Etc</span><span class='period'>.</span><span class='id identifier rubyid_getpwnam'>getpwnam</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="restart-instance_method">
  
    - (<tt>Object</tt>) <strong>restart</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


327
328
329
330
331
332
333
334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 327</span>

<span class='kw'>def</span> <span class='id identifier rubyid_restart'>restart</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Restarting bandwidth shaping: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_stop_impl'>stop_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>rescue</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='const'>ArgumentError</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_start_impl'>start_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="restartuser-instance_method">
  
    - (<tt>Object</tt>) <strong>restartuser</strong>(uuid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


275
276
277
278
279
280
281
282
283
284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 275</span>

<span class='kw'>def</span> <span class='id identifier rubyid_restartuser'>restartuser</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Restarting user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_stopuser_impl'>stopuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>rescue</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='const'>ArgumentError</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_startuser_impl'>startuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    - (<tt>Object</tt>) <strong>show</strong>(uuid = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


338
339
340</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 338</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-instance_method">
  
    - (<tt>Object</tt>) <strong>start</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233
234
235
236
237
238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 231</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Starting bandwidth shaping: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
      <span class='id identifier rubyid_start_impl'>start_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_impl-instance_method">
  
    - (<tt>Object</tt>) <strong>start_impl</strong>(f) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223
224
225
226
227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 221</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_impl'>start_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>qdisc add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> root handle 1: htb</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>class add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent 1: classid 1:1 htb rate </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_max_bandwidth</span><span class='embexpr_end'>}</span><span class='tstring_content'>mbit</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>filter add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent 1: protocol ip prio 10 handle 1: cgroup</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_with_all_users'>with_all_users</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
    <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Starting tc for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_startuser_impl'>startuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="startuser-instance_method">
  
    - (<tt>Object</tt>) <strong>startuser</strong>(uuid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255
256
257
258
259
260
261
262</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 253</span>

<span class='kw'>def</span> <span class='id identifier rubyid_startuser'>startuser</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Starting tc for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
      <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='id identifier rubyid_startuser_impl'>startuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="startuser_impl-instance_method">
  
    - (<tt>Object</tt>) <strong>startuser_impl</strong>(uuid, pwent, netclass, f) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_startuser_impl'>startuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
  <span class='comment'># Select what type of user.  Note that a user can high bandwidth
</span>  <span class='comment'># normally but throttled for a specific and temporary reason.
</span>  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_user_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>_throttle</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@output</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>throttled</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_this_user_share'>this_user_share</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_throttle_user_share</span><span class='embexpr_end'>}</span><span class='tstring_content'>kbit</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_this_user_limit'>this_user_limit</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_throttle_user_limit</span><span class='embexpr_end'>}</span><span class='tstring_content'>kbit</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_this_user_quantum'>this_user_quantum</span><span class='op'>=</span><span class='ivar'>@tc_throttle_user_quantum</span>
  <span class='kw'>else</span>
    <span class='ivar'>@output</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>normal</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_this_user_share'>this_user_share</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_user_share</span><span class='embexpr_end'>}</span><span class='tstring_content'>mbit</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_this_user_limit'>this_user_limit</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_user_limit</span><span class='embexpr_end'>}</span><span class='tstring_content'>mbit</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_this_user_quantum'>this_user_quantum</span><span class='op'>=</span><span class='ivar'>@tc_user_quantum</span>
  <span class='kw'>end</span>

  <span class='comment'># Overall class for the gear
</span>  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>class add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent 1:1 classid 1:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'> htb rate </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_this_user_share'>this_user_share</span><span class='embexpr_end'>}</span><span class='tstring_content'> ceil </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_this_user_limit'>this_user_limit</span><span class='embexpr_end'>}</span><span class='tstring_content'> quantum </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_this_user_quantum'>this_user_quantum</span><span class='embexpr_end'>}</span><span class='tstring_end'>]</span></span>

  <span class='comment'># Specific constraints within the gear&#39;s limit
</span>  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>qdisc add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent 1:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'> handle </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>: htb default 0</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>class add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>: classid </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>:2 htb rate 128kbit ceil 256kbit quantum </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_min_quantum</span><span class='embexpr_end'>}</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>class add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>: classid </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>:3 htb rate  12kbit ceil  24kbit quantum </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_min_quantum</span><span class='embexpr_end'>}</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>filter add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>: protocol ip prio 10 u32 match ip dport 587 0xffff flowid </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>:2</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>filter add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>: protocol ip prio 10 u32 match ip dport  25 0xffff flowid </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>:3</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>filter add dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>: protocol ip prio 10 u32 match ip dport 465 0xffff flowid </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_content'>:3</span><span class='tstring_end'>]</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="status-instance_method">
  
    - (<tt>Object</tt>) <strong>status</strong>(uuid = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bandwidth shaping status: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_with_tc_loaded'>with_tc_loaded</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_uuid'>uuid</span>
      <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
        <span class='id identifier rubyid_statususer'>statususer</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tc -s qdisc show dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_out'>out</span>
      <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tc -s class show dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_out'>out</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="statususer-instance_method">
  
    - (<tt>Object</tt>) <strong>statususer</strong>(uuid, pwent, netclass) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195
196
197
198
199</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 192</span>

<span class='kw'>def</span> <span class='id identifier rubyid_statususer'>statususer</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tc -s class show dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> classid 1:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tc not configured for user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_out'>out</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    - (<tt>Object</tt>) <strong>stop</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


244
245
246
247
248
249
250
251</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 244</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Stopping bandwidth shaping: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
      <span class='id identifier rubyid_stop_impl'>stop_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_impl-instance_method">
  
    - (<tt>Object</tt>) <strong>stop_impl</strong>(f) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 240</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_impl'>stop_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>%Q[</span><span class='tstring_content'>qdisc del dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> root</span><span class='tstring_end'>]</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stopuser-instance_method">
  
    - (<tt>Object</tt>) <strong>stopuser</strong>(uuid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266
267
268
269
270
271
272
273</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 264</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stopuser'>stopuser</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Stopping tc for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
      <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='id identifier rubyid_stopuser_impl'>stopuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stopuser_impl-instance_method">
  
    - (<tt>Object</tt>) <strong>stopuser_impl</strong>(uuid, pwent, netclass, f) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 177</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stopuser_impl'>stopuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>class del dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_content'> parent 1:1 classid 1:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netclass'>netclass</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="synchronized-instance_method">
  
    - (<tt>Object</tt>) <strong>synchronized</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 201</span>

<span class='kw'>def</span> <span class='id identifier rubyid_synchronized'>synchronized</span>
  <span class='id identifier rubyid_r'>r</span><span class='op'>=</span><span class='kw'>nil</span>
  <span class='cvar'>@@MUTEX</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='cvar'>@@LOCKFILE</span><span class='comma'>,</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>RDWR</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>CREAT</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>TRUNC</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>SYNC</span><span class='comma'>,</span> <span class='int'>0o0600</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_lockfile'>lockfile</span><span class='op'>|</span>
      <span class='id identifier rubyid_lockfile'>lockfile</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span><span class='op'>=</span><span class='kw'>true</span>
      <span class='id identifier rubyid_lockfile'>lockfile</span><span class='period'>.</span><span class='id identifier rubyid_fcntl'>fcntl</span><span class='lparen'>(</span><span class='const'>Fcntl</span><span class='op'>::</span><span class='const'>F_SETFD</span><span class='comma'>,</span> <span class='const'>Fcntl</span><span class='op'>::</span><span class='const'>FD_CLOEXEC</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_lockfile'>lockfile</span><span class='period'>.</span><span class='id identifier rubyid_flock'>flock</span><span class='lparen'>(</span><span class='const'>File</span><span class='op'>::</span><span class='const'>LOCK_EX</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_lockfile'>lockfile</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Process</span><span class='op'>::</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>begin</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
          <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='kw'>yield</span>
        <span class='kw'>end</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_lockfile'>lockfile</span><span class='period'>.</span><span class='id identifier rubyid_flock'>flock</span><span class='lparen'>(</span><span class='const'>File</span><span class='op'>::</span><span class='const'>LOCK_UN</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_r'>r</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="throttleuser-instance_method">
  
    - (<tt>Object</tt>) <strong>throttleuser</strong>(uuid) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


288
289
290
291
292
293
294
295
296
297
298
299</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 288</span>

<span class='kw'>def</span> <span class='id identifier rubyid_throttleuser'>throttleuser</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Throttling user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_synchronized'>synchronized</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_parse_valid_user'>parse_valid_user</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_user_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>_throttle</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='id identifier rubyid_stopuser_impl'>stopuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_startuser_impl'>startuser_impl</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_all_users-instance_method">
  
    - (<tt>Object</tt>) <strong>with_all_users</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_all_users'>with_all_users</span>
  <span class='id identifier rubyid_users'>users</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='const'>Etc</span><span class='period'>.</span><span class='id identifier rubyid_passwd'>passwd</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pwent'>pwent</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='period'>.</span><span class='id identifier rubyid_gecos'>gecos</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='ivar'>@config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GEAR_GECOS</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OO guest</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_users'>users</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_pwent'>pwent</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='op'>|</span>
      <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='id identifier rubyid_pwent'>pwent</span><span class='comma'>,</span> <span class='id identifier rubyid_netclass'>netclass</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_tc_batch-instance_method">
  
    - (<tt>Object</tt>) <strong>with_tc_batch</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_tc_batch'>with_tc_batch</span>
  <span class='id identifier rubyid_f'>f</span><span class='op'>=</span><span class='const'>Tempfile</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tc-batch</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_fsync'>fsync</span>
    <span class='comment'># Can&#39;t directly send the file to TC in stdin due to selinux domains.
</span>    <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cat </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'> | tc -force -batch</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span>
    <span class='kw'>end</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close!'>close!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_tc_loaded-instance_method">
  
    - (<tt>Object</tt>) <strong>with_tc_loaded</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183
184
185
186
187
188
189
190</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/utils/tc.rb', line 181</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_tc_loaded'>with_tc_loaded</span>
  <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tc qdisc show dev </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qdisc htb 1:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='kw'>yield</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no htb qdisc on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@tc_if</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Jul 29 18:20:06 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>