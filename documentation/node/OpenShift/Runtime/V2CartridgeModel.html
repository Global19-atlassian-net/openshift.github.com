<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OpenShift::Runtime::V2CartridgeModel
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (V)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../OpenShift.html" title="OpenShift (module)">OpenShift</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Runtime.html" title="OpenShift::Runtime (module)">Runtime</a></span></span>
     &raquo; 
    <span class="title">V2CartridgeModel</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OpenShift::Runtime::V2CartridgeModel
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OpenShift::Runtime::V2CartridgeModel</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="NodeLogger.html" title="OpenShift::Runtime::NodeLogger (module)">NodeLogger</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb</dd>
  
</dl>
<div class="clear"></div>

<div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="V2UpgradeCartridgeModel.html" title="OpenShift::Runtime::V2UpgradeCartridgeModel (class)">V2UpgradeCartridgeModel</a></span></p>
</div>

  <h2>Constant Summary</h2>
  



  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="NodeLogger.html" title="OpenShift::Runtime::NodeLogger (module)">NodeLogger</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NodeLogger.html#DEFAULT_LOGGER_CLASS-constant" title="OpenShift::Runtime::NodeLogger::DEFAULT_LOGGER_CLASS (constant)">NodeLogger::DEFAULT_LOGGER_CLASS</a></span></p>





  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#address_bound%3F-instance_method" title="#address_bound? (instance method)">- (Boolean) <strong>address_bound?</strong>(ip, port) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns true if the given IP and port are currently bound according to
lsof, otherwise false.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#addresses_bound%3F-instance_method" title="#addresses_bound? (instance method)">- (Boolean) <strong>addresses_bound?</strong>(addresses) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#builder_cartridge-instance_method" title="#builder_cartridge (instance method)">- (Object) <strong>builder_cartridge</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detects and returns a builder <code>Cartridge</code> in the gear if
present, otherwise <code>nil</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cartridge_action-instance_method" title="#cartridge_action (instance method)">- (Object) <strong>cartridge_action</strong>(cartridge, action, software_version, render_erbs = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cartridge_action(cartridge, action, software_version, render_erbs) -&gt;
buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cartridge_directory-instance_method" title="#cartridge_directory (instance method)">- (Object) <strong>cartridge_directory</strong>(cart_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cartridge_hooks-instance_method" title="#cartridge_hooks (instance method)">- (Object) <strong>cartridge_hooks</strong>(action_hooks, action, name, version) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cartridge_teardown-instance_method" title="#cartridge_teardown (instance method)">- (Object) <strong>cartridge_teardown</strong>(cartridge_name, remove_cartridge_dir = true) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cartridge_teardown(cartridge_name, remove_cartridge_dir) -&gt; buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#configure-instance_method" title="#configure (instance method)">- (Object) <strong>configure</strong>(cartridge_name, template_git_url = nil, manifest = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>configure(cartridge_name, template_git_url, manifest) -&gt; stdout.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect_frontend-instance_method" title="#connect_frontend (instance method)">- (Object) <strong>connect_frontend</strong>(cartridge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connector_execute-instance_method" title="#connector_execute (instance method)">- (Object) <strong>connector_execute</strong>(cart_name, pub_cart_name, connection_type, connector, args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:call-seq:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert_to_shell_arguments-instance_method" title="#convert_to_shell_arguments (instance method)">- (Object) <strong>convert_to_shell_arguments</strong>(args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convert env var hook arguments to shell arguments TODO: document expected
form of args.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_cartridge_directory-instance_method" title="#create_cartridge_directory (instance method)">- (Object) <strong>create_cartridge_directory</strong>(cartridge, software_version) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>create_cartridge_directory(cartridge name) -&gt; nil.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_private_endpoints-instance_method" title="#create_private_endpoints (instance method)">- (Object) <strong>create_private_endpoints</strong>(cartridge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Allocates and assigns private IP/port entries for a cartridge based on
endpoint metadata for the cartridge.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_public_endpoint-instance_method" title="#create_public_endpoint (instance method)">- (Object) <strong>create_public_endpoint</strong>(cartridge, endpoint, private_ip) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Expose an endpoint for a cartridge through the port proxy.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_stop_lock-instance_method" title="#create_stop_lock (instance method)">- (Object) <strong>create_stop_lock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Writes the <code>stop_lock</code> file and changes its ownership to the
gear user.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deconfigure-instance_method" title="#deconfigure (instance method)">- (Object) <strong>deconfigure</strong>(cartridge_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>deconfigure(cartridge_name) -&gt; nil.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_cartridge_directory-instance_method" title="#delete_cartridge_directory (instance method)">- (Object) <strong>delete_cartridge_directory</strong>(cartridge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_private_endpoints-instance_method" title="#delete_private_endpoints (instance method)">- (Object) <strong>delete_private_endpoints</strong>(cartridge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong>(skip_hooks = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>destroy(skip_hooks = false) -&gt; [buffer, &#39;&#39;, 0].</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disconnect_frontend-instance_method" title="#disconnect_frontend (instance method)">- (Object) <strong>disconnect_frontend</strong>(cartridge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>disconnect cartridge from frontend proxy.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#do_action_hook-instance_method" title="#do_action_hook (instance method)">- (Object) <strong>do_action_hook</strong>(action, env, options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes the named <code>action</code> from the user repo
<code>action_hooks</code> directory and returns the stdout of the
execution, or raises a <code>ShellExecutionException</code> if the action
returns a non-zero return code.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#do_control-instance_method" title="#do_control (instance method)">- (Object) <strong>do_control</strong>(action, cartridge, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#do_control_with_directory-instance_method" title="#do_control_with_directory (instance method)">- (Object) <strong>do_control_with_directory</strong>(action, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:call-seq:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#do_lock-instance_method" title="#do_lock (instance method)">- (Object) <strong>do_lock</strong>(entries) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>do_lock_gear(array of file names) -&gt; array.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#do_unlock-instance_method" title="#do_unlock (instance method)">- (Object) <strong>do_unlock</strong>(entries) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>do_unlock_gear(array of file names) -&gt; array.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each_cartridge-instance_method" title="#each_cartridge (instance method)">- (Object) <strong>each_cartridge</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Yields a <code>Cartridge</code> instance for each cartridge in the gear.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#empty_repository%3F-instance_method" title="#empty_repository? (instance method)">- (Boolean) <strong>empty_repository?</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_open_ip-instance_method" title="#find_open_ip (instance method)">- (Object) <strong>find_open_ip</strong>(port) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finds the next IP address available for binding of the given port for the
current gear user.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_allocated_private_ips-instance_method" title="#get_allocated_private_ips (instance method)">- (Object) <strong>get_allocated_private_ips</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns an array containing all currently allocated endpoint private IP
addresses assigned to carts within the current gear, or an empty array if
none are currently defined.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_cartridge-instance_method" title="#get_cartridge (instance method)">- (Object) <strong>get_cartridge</strong>(cart_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load the cartridge&#39;s local manifest from the Broker token
&#39;name-version&#39;.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_cartridge_fallback-instance_method" title="#get_cartridge_fallback (instance method)">- (Object) <strong>get_cartridge_fallback</strong>(cart_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load the cartridge&#39;s local manifest from the Broker token
&#39;name-version&#39;.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_cartridge_from_directory-instance_method" title="#get_cartridge_from_directory (instance method)">- (Object) <strong>get_cartridge_from_directory</strong>(directory) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Load cartridge&#39;s local manifest from cartridge directory name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_repository%3F-instance_method" title="#has_repository? (instance method)">- (Boolean) <strong>has_repository?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (V2CartridgeModel) <strong>initialize</strong>(config, container, state, hourglass) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of V2CartridgeModel.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#list_proxy_mappings-instance_method" title="#list_proxy_mappings (instance method)">- (Object) <strong>list_proxy_mappings</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#map_cartridge_name-instance_method" title="#map_cartridge_name (instance method)">- (Object) <strong>map_cartridge_name</strong>(cartridge_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>FIXME: Once Broker/Node protocol updated to provided necessary information
this hack must go away.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#populate_gear_repo-instance_method" title="#populate_gear_repo (instance method)">- (Object) <strong>populate_gear_repo</strong>(cartridge_name, template_url = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:call-seq:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_configure-instance_method" title="#post_configure (instance method)">- (Object) <strong>post_configure</strong>(cartridge_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_install-instance_method" title="#post_install (instance method)">- (Object) <strong>post_install</strong>(cartridge, software_version, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#primary_cartridge-instance_method" title="#primary_cartridge (instance method)">- (Object) <strong>primary_cartridge</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the primary <code>Cartridge</code> in the gear as specified by the
<code>OPENSHIFT_PRIMARY_CARTRIDGE_DIR</code> environment variable, or
<code>Nil</code> if no primary cartridge is present.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_cartridges-instance_method" title="#process_cartridges (instance method)">- (Object) <strong>process_cartridges</strong>(cartridge_dir = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run code block against each cartridge in gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_erb_templates-instance_method" title="#process_erb_templates (instance method)">- (Object) <strong>process_erb_templates</strong>(cartridge) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>process_erb_templates(cartridge_name) -&gt; nil.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#publish_gear_endpoint-instance_method" title="#publish_gear_endpoint (instance method)">- (Object) <strong>publish_gear_endpoint</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>special methods that are handled especially by the platform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#render_erbs-instance_method" title="#render_erbs (instance method)">- (Object) <strong>render_erbs</strong>(env, erbs) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>render_erbs(program environment as a hash, erbs) -&gt; nil.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#secure_cartridge-instance_method" title="#secure_cartridge (instance method)">- (Object) <strong>secure_cartridge</strong>(short_name, uid, gid = uid, cartridge_home) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_connection_hook_env_vars-instance_method" title="#set_connection_hook_env_vars (instance method)">- (Object) <strong>set_connection_hook_env_vars</strong>(cart_name, pub_cart_name, args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#short_name_from_full_cart_name-instance_method" title="#short_name_from_full_cart_name (instance method)">- (Object) <strong>short_name_from_full_cart_name</strong>(pub_cart_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_cartridge-instance_method" title="#start_cartridge (instance method)">- (Object) <strong>start_cartridge</strong>(type, cartridge, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Starts a cartridge.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_gear-instance_method" title="#start_gear (instance method)">- (Object) <strong>start_gear</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Starts up the gear by running the cartridge <code>start</code> control
action for each cartridge in the gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_cartridge-instance_method" title="#stop_cartridge (instance method)">- (Object) <strong>stop_cartridge</strong>(cartridge, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Stops a cartridge.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_gear-instance_method" title="#stop_gear (instance method)">- (Object) <strong>stop_gear</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shuts down the gear by running the cartridge <code>stop</code> control
action for each cartridge in the gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_lock-instance_method" title="#stop_lock (instance method)">- (Object) <strong>stop_lock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_lock%3F-instance_method" title="#stop_lock? (instance method)">- (Boolean) <strong>stop_lock?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tidy-instance_method" title="#tidy (instance method)">- (Object) <strong>tidy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>tidy() -&gt; nil.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unlock_gear-instance_method" title="#unlock_gear (instance method)">- (Object) <strong>unlock_gear</strong>(cartridge, relock = true) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>unlock_gear(cartridge_name) -&gt; nil.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unsubscribe-instance_method" title="#unsubscribe (instance method)">- (Object) <strong>unsubscribe</strong>(cart_name, pub_cart_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Let a cart perform some action when another cart is being removed Today, it
is used to cleanup environment variables.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_cartridge-instance_method" title="#validate_cartridge (instance method)">- (Object) <strong>validate_cartridge</strong>(manifest) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#web_proxy-instance_method" title="#web_proxy (instance method)">- (Object) <strong>web_proxy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the <code>Cartridge</code> in the gear whose <code>web_proxy</code>
flag is set to true, nil otherwise.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_environment_variables-instance_method" title="#write_environment_variables (instance method)">- (Object) <strong>write_environment_variables</strong>(path, hash, prefix = true) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Write out environment variables.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="NodeLogger.html" title="OpenShift::Runtime::NodeLogger (module)">NodeLogger</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NodeLogger.html#context-class_method" title="OpenShift::Runtime::NodeLogger.context (method)">context</a></span>, <span class='object_link'><a href="NodeLogger.html#create_logger-class_method" title="OpenShift::Runtime::NodeLogger.create_logger (method)">create_logger</a></span>, <span class='object_link'><a href="NodeLogger.html#disable-class_method" title="OpenShift::Runtime::NodeLogger.disable (method)">disable</a></span>, <span class='object_link'><a href="NodeLogger.html#load_config-class_method" title="OpenShift::Runtime::NodeLogger.load_config (method)">load_config</a></span>, <span class='object_link'><a href="NodeLogger.html#logger-class_method" title="OpenShift::Runtime::NodeLogger.logger (method)">logger</a></span>, <span class='object_link'><a href="NodeLogger.html#logger-instance_method" title="OpenShift::Runtime::NodeLogger#logger (method)">#logger</a></span>, <span class='object_link'><a href="NodeLogger.html#set_logger-class_method" title="OpenShift::Runtime::NodeLogger.set_logger (method)">set_logger</a></span>, <span class='object_link'><a href="NodeLogger.html#stderr-class_method" title="OpenShift::Runtime::NodeLogger.stderr (method)">stderr</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="OpenShift::Runtime::V2CartridgeModel (class)">V2CartridgeModel</a></span></tt>) <strong>initialize</strong>(config, container, state, hourglass) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A new instance of V2CartridgeModel</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58
59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 56</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span><span class='comma'>,</span> <span class='id identifier rubyid_container'>container</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_hourglass'>hourglass</span><span class='rparen'>)</span>
  <span class='ivar'>@config</span>     <span class='op'>=</span> <span class='id identifier rubyid_config'>config</span>
  <span class='ivar'>@container</span>  <span class='op'>=</span> <span class='id identifier rubyid_container'>container</span>
  <span class='ivar'>@state</span>      <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span>
  <span class='ivar'>@timeout</span>    <span class='op'>=</span> <span class='int'>30</span>
  <span class='ivar'>@cartridges</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@hourglass</span>  <span class='op'>=</span> <span class='id identifier rubyid_hourglass'>hourglass</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="address_bound?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>address_bound?</strong>(ip, port) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns true if the given IP and port are currently bound according to
lsof, otherwise false.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


866
867
868
869</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 866</span>

<span class='kw'>def</span> <span class='id identifier rubyid_address_bound?'>address_bound?</span><span class='lparen'>(</span><span class='id identifier rubyid_ip'>ip</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/sbin/lsof -i @</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rc'>rc</span> <span class='op'>==</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="addresses_bound?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>addresses_bound?</strong>(addresses) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


871
872
873
874
875
876
877
878
879</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 871</span>

<span class='kw'>def</span> <span class='id identifier rubyid_addresses_bound?'>addresses_bound?</span><span class='lparen'>(</span><span class='id identifier rubyid_addresses'>addresses</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/sbin/lsof</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_addresses'>addresses</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_addr'>addr</span><span class='op'>|</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> -i @</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='symbol'>:ip</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rc'>rc</span> <span class='op'>==</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="builder_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>builder_cartridge</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detects and returns a builder <code>Cartridge</code> in the gear if
present, otherwise <code>nil</code>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111
112
113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 107</span>

<span class='kw'>def</span> <span class='id identifier rubyid_builder_cartridge'>builder_cartridge</span>
  <span class='id identifier rubyid_builder_cart'>builder_cart</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_each_cartridge'>each_cartridge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_categories'>categories</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ci_builder</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_builder_cart'>builder_cart</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_builder_cart'>builder_cart</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cartridge_action-instance_method">
  
    - (<tt>Object</tt>) <strong>cartridge_action</strong>(cartridge, action, software_version, render_erbs = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cartridge_action(cartridge, action, software_version, render_erbs) -&gt;
buffer</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Returns</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_results'>results</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_calling'>calling</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>s action script.
Includes &lt;code&gt;--version&lt;/code&gt; if provided.
Raises exception if script fails

</span></span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 637</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cartridge_action'>cartridge_action</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='comma'>,</span> <span class='id identifier rubyid_render_erbs'>render_erbs</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Running </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'> for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_cartridge_home'>cartridge_home</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_action'>action</span>         <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bin</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span> <span class='id identifier rubyid_action'>action</span>

  <span class='id identifier rubyid_gear_env'>gear_env</span>           <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cartridge_env_home'>cartridge_env_home</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>env</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_cartridge_env'>cartridge_env</span> <span class='op'>=</span> <span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_env_home'>cartridge_env_home</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PATH</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cartridge_env'>cartridge_env</span> <span class='op'>=</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_render_erbs'>render_erbs</span>
    <span class='id identifier rubyid_erbs'>erbs</span> <span class='op'>=</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_env_home'>cartridge_env_home</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/*.erb</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>FNM_DOTMATCH</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_render_erbs'>render_erbs</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='comma'>,</span> <span class='id identifier rubyid_erbs'>erbs</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_cartridge_env'>cartridge_env</span> <span class='op'>=</span> <span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_env_home'>cartridge_env_home</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PATH</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cartridge_env'>cartridge_env</span> <span class='op'>=</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_action'>action</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> --version </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_software_version'>software_version</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span>
                                                  <span class='label'>env:</span>                 <span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='comma'>,</span>
                                                  <span class='label'>chdir:</span>               <span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='comma'>,</span>
                                                  <span class='label'>timeout:</span>             <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='comma'>,</span>
                                                  <span class='label'>expected_exitstatus:</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ran </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'> for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_credentials'>sanitize_credentials</span><span class='lparen'>(</span><span class='id identifier rubyid_out'>out</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_out'>out</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cartridge_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>cartridge_directory</strong>(cart_name) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cartridge_directory'>cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span>  <span class='op'>=</span> <span class='id identifier rubyid_map_cartridge_name'>map_cartridge_name</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cart_dir'>cart_dir</span> <span class='op'>=</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ambiguous cartridge name </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: found </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='int'>1</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge directory not found for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span>  <span class='int'>1</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>

  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cartridge_hooks-instance_method">
  
    - (<tt>Object</tt>) <strong>cartridge_hooks</strong>(action_hooks, action, name, version) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1205</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cartridge_hooks'>cartridge_hooks</span><span class='lparen'>(</span><span class='id identifier rubyid_action_hooks'>action_hooks</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_hooks'>hooks</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>pre:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>post:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_hooks'>hooks</span><span class='period'>.</span><span class='id identifier rubyid_each_key'>each_key</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_new_hook'>new_hook</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_action_hooks'>action_hooks</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_old_hook'>old_hook</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_action_hooks'>action_hooks</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_hooks'>hooks</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>source </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_hook'>new_hook</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_new_hook'>new_hook</span>
    <span class='id identifier rubyid_hooks'>hooks</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>source </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_old_hook'>old_hook</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_old_hook'>old_hook</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_hooks'>hooks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cartridge_teardown-instance_method">
  
    - (<tt>Object</tt>) <strong>cartridge_teardown</strong>(cartridge_name, remove_cartridge_dir = true) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cartridge_teardown(cartridge_name, remove_cartridge_dir) -&gt; buffer</p>

<p>Returns the output from calling the cartridge&#39;s teardown script.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Raises</span> <span class='id identifier rubyid_exception'>exception</span> <span class='kw'>if</span> <span class='id identifier rubyid_script'>script</span> <span class='id identifier rubyid_fails'>fails</span></code></pre>

<p>stdout = cartridge_teardown(&#39;php-5.3&#39;)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 701</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cartridge_teardown'>cartridge_teardown</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='comma'>,</span> <span class='id identifier rubyid_remove_cartridge_dir'>remove_cartridge_dir</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cartridge_home'>cartridge_home</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_env'>env</span>            <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_teardown'>teardown</span>       <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bin</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>teardown</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span> <span class='id identifier rubyid_teardown'>teardown</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_teardown'>teardown</span><span class='embexpr_end'>}</span><span class='tstring_content'>: is not executable\n</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span> <span class='id identifier rubyid_teardown'>teardown</span>

  <span class='comment'># FIXME: Will anyone retry if this reports error, or should we remove from disk no matter what?
</span>  <span class='id identifier rubyid_buffer'>buffer</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='id identifier rubyid_teardown'>teardown</span><span class='comma'>,</span>
                                                       <span class='label'>env:</span>                 <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span>
                                                       <span class='label'>chdir:</span>               <span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='comma'>,</span>
                                                       <span class='label'>timeout:</span>             <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='comma'>,</span>
                                                       <span class='label'>expected_exitstatus:</span> <span class='int'>0</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_err'>err</span>

  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_r'>rm_r</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_cartridge_dir'>remove_cartridge_dir</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ran teardown for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_buffer'>buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="configure-instance_method">
  
    - (<tt>Object</tt>) <strong>configure</strong>(cartridge_name, template_git_url = nil, manifest = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>configure(cartridge_name, template_git_url, manifest) -&gt; stdout</p>

<p>Add a cartridge to a gear</p>

<p>configure(&#39;php-5.3&#39;) configure(&#39;php-666&#39;, &#39;git://&#39;)
configure(&#39;php-666&#39;, &#39;git://&#39;, &#39;git://&#39;)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 244</span>

<span class='kw'>def</span> <span class='id identifier rubyid_configure'>configure</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='comma'>,</span> <span class='id identifier rubyid_template_git_url'>template_git_url</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_manifest'>manifest</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span>                 <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span> <span class='op'>=</span> <span class='id identifier rubyid_map_cartridge_name'>map_cartridge_name</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cartridge'>cartridge</span>              <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_manifest'>manifest</span>
                             <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Loading from manifest...</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
                             <span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Manifest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_manifest'>manifest</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>
                           <span class='kw'>else</span>
                             <span class='const'>CartridgeRepository</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>
                           <span class='kw'>end</span>

  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_boost'>boost</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_create_cartridge_directory'>create_cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>
    <span class='comment'># Note: the following if statement will check the following criteria long-term:
</span>    <span class='comment'># 1. Is the app scalable?
</span>    <span class='comment'># 2. Is this the head gear?
</span>    <span class='comment'># 3. Is this the first time the platform has generated an ssh key?
</span>    <span class='comment'>#
</span>    <span class='comment'># In the current state of things, the following check is sufficient to test all
</span>    <span class='comment'># of these criteria, and we do not have a way to explicitly check the first two
</span>    <span class='comment'># criteria.  However, it should be considered a TODO to add more explicit checks.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_web_proxy?'>web_proxy?</span>
      <span class='comment'># The BROKER_AUTH_KEY_ADD token does not use any arguments.  It tells the broker
</span>      <span class='comment'># to enable this gear to make REST API calls on behalf of the user who owns this gear.
</span>      <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BROKER_AUTH_KEY_ADD: \n</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_create_private_endpoints'>create_private_endpoints</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>

    <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_chdir'>chdir</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_unlock_gear'>unlock_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
        <span class='id identifier rubyid_expected_entries'>expected_entries</span> <span class='op'>=</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cartridge_action'>cartridge_action</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>setup</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_process_erb_templates'>process_erb_templates</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cartridge_action'>cartridge_action</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>install</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_actual_entries'>actual_entries</span>  <span class='op'>=</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_illegal_entries'>illegal_entries</span> <span class='op'>=</span> <span class='id identifier rubyid_actual_entries'>actual_entries</span> <span class='op'>-</span> <span class='id identifier rubyid_expected_entries'>expected_entries</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_illegal_entries'>illegal_entries</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
                    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge created the following directories in the gear home directory: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_illegal_entries'>illegal_entries</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_populate_gear_repo'>populate_gear_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='comma'>,</span> <span class='id identifier rubyid_template_git_url'>template_git_url</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_deployable?'>deployable?</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_validate_cartridge'>validate_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_connect_frontend'>connect_frontend</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>configure output: </span><span class='embexpr_beg'>#{</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_credentials'>sanitize_credentials</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span>
<span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_rc_override'>rc_override</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_rc'>rc</span> <span class='op'>&lt;</span> <span class='int'>100</span> <span class='op'>?</span> <span class='int'>157</span> <span class='op'>:</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_rc'>rc</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Sdk</span><span class='period'>.</span><span class='id identifier rubyid_translate_shell_ex_for_client'>translate_shell_ex_for_client</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_rc_override'>rc_override</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected error during configure: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n  </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_ex'>ex</span> <span class='op'>=</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Sdk</span><span class='period'>.</span><span class='id identifier rubyid_translate_out_for_client'>translate_out_for_client</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_set_backtrace'>set_backtrace</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_ex'>ex</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connect_frontend-instance_method">
  
    - (<tt>Object</tt>) <strong>connect_frontend</strong>(cartridge) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 922</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_frontend'>connect_frontend</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_frontend'>frontend</span>       <span class='op'>=</span> <span class='const'>FrontendHttpServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_gear_env'>gear_env</span>       <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_web_proxy_cart'>web_proxy_cart</span> <span class='op'>=</span> <span class='id identifier rubyid_web_proxy'>web_proxy</span>

  <span class='kw'>begin</span>
    <span class='comment'># TODO: exception handling
</span>    <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='op'>|</span>
      <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mapping'>mapping</span><span class='op'>|</span>
        <span class='id identifier rubyid_private_ip'>private_ip</span>  <span class='op'>=</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_backend_uri'>backend_uri</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_backend'>backend</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_options'>options</span>     <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_websocket_port'>websocket_port</span>
          <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>websocket_port</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_websocket_port'>websocket_port</span>
        <span class='kw'>end</span>

        <span class='comment'># Make sure that the mapping does not collide with the default web_proxy mapping
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_frontend'>frontend</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_web_proxy?'>web_proxy?</span> <span class='kw'>and</span> <span class='id identifier rubyid_web_proxy_cart'>web_proxy_cart</span>
          <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping default mapping as web proxy owns it for the application</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>

        <span class='comment'># Only web proxy cartridges can override the default mapping
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_frontend'>frontend</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_web_proxy?'>web_proxy?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>!=</span> <span class='id identifier rubyid_primary_cartridge'>primary_cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping default mapping as primary cartridge owns it for the application</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connecting frontend mapping for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>\
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_frontend'>frontend</span><span class='embexpr_end'>}</span><span class='tstring_content'>] =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_backend_uri'>backend_uri</span><span class='embexpr_end'>}</span><span class='tstring_content'>] with options: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_frontend'>frontend</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span><span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_frontend'>frontend</span><span class='comma'>,</span> <span class='id identifier rubyid_backend_uri'>backend_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>V2CartModel#connect_frontend: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connector_execute-instance_method">
  
    - (<tt>Object</tt>) <strong>connector_execute</strong>(cart_name, pub_cart_name, connection_type, connector, args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:call-seq:</p>

<pre class="ruby"><span class="ruby-constant">V2CartridgeModel</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">...</span>).<span class="ruby-identifier">connector_execute</span>(<span class="ruby-identifier">cartridge_name</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">connector</span>, <span class="ruby-identifier">args</span>) =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">String</span>
</pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1045</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connector_execute'>connector_execute</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='comma'>,</span> <span class='id identifier rubyid_connection_type'>connection_type</span><span class='comma'>,</span> <span class='id identifier rubyid_connector'>connector</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cart_name cannot be nil</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_cart_name'>cart_name</span>

  <span class='id identifier rubyid_cartridge'>cartridge</span>    <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge'>get_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_env'>env</span>          <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_env_var_hook'>env_var_hook</span> <span class='op'>=</span> <span class='id identifier rubyid_connection_type'>connection_type</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ENV:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span>

  <span class='comment'># Special treatment for env var connection hooks
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_env_var_hook'>env_var_hook</span>
    <span class='id identifier rubyid_set_connection_hook_env_vars'>set_connection_hook_env_vars</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='id identifier rubyid_convert_to_shell_arguments'>convert_to_shell_arguments</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_conn'>conn</span> <span class='op'>=</span> <span class='const'>Runtime</span><span class='op'>::</span><span class='const'>PubSubConnector</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_connection_type'>connection_type</span><span class='comma'>,</span> <span class='id identifier rubyid_connector'>connector</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_reserved?'>reserved?</span>
    <span class='kw'>begin</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_action_name'>action_name</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>NoMethodError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>; falling back to script</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cartridge_home'>cartridge_home</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_script'>script</span>         <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hooks</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span><span class='lparen'>(</span><span class='id identifier rubyid_script'>script</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_env_var_hook'>env_var_hook</span>
      <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Set environment variables successfully</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: action &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connector'>connector</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; not found.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='int'>127</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_command'>command</span>      <span class='op'>=</span> <span class='id identifier rubyid_script'>script</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_args'>args</span>
  <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span>
                                                     <span class='label'>env:</span>     <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span>
                                                     <span class='label'>chdir:</span>   <span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='comma'>,</span>
                                                     <span class='label'>timeout:</span> <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='int'>0</span> <span class='op'>==</span> <span class='id identifier rubyid_rc'>rc</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rc'>rc</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n------\n</span><span class='embexpr_beg'>#{</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_credentials'>sanitize_credentials</span><span class='lparen'>(</span><span class='id identifier rubyid_out'>out</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n------)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_out'>out</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rc'>rc</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n------\n</span><span class='embexpr_beg'>#{</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_credentials'>sanitize_credentials</span><span class='lparen'>(</span><span class='id identifier rubyid_out'>out</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n------)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Control action &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connector'>connector</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; returned an error. rc=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rc'>rc</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_out'>out</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span><span class='comma'>,</span> <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="convert_to_shell_arguments-instance_method">
  
    - (<tt>Object</tt>) <strong>convert_to_shell_arguments</strong>(args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Convert env var hook arguments to shell arguments TODO: document expected
form of args</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1033
1034
1035
1036
1037
1038
1039
1040</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1033</span>

<span class='kw'>def</span> <span class='id identifier rubyid_convert_to_shell_arguments'>convert_to_shell_arguments</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_vstr'>vstr</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_args'>new_args</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;=&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_vstr'>vstr</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='const'>Shellwords</span><span class='op'>::</span><span class='id identifier rubyid_shellescape'>shellescape</span><span class='lparen'>(</span><span class='id identifier rubyid_new_args'>new_args</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_cartridge_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>create_cartridge_directory</strong>(cartridge, software_version) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>create_cartridge_directory(cartridge name) -&gt; nil</p>

<p>Create the cartridges home directory</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_v2_cart_model'>v2_cart_model</span><span class='period'>.</span><span class='id identifier rubyid_create_cartridge_directory'>create_cartridge_directory</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>php-5.3</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 494</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_cartridge_directory'>create_cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creating cartridge directory </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
  <span class='const'>CartridgeRepository</span><span class='period'>.</span><span class='id identifier rubyid_instantiate_cartridge'>instantiate_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_ident'>ident</span> <span class='op'>=</span> <span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Manifest</span><span class='period'>.</span><span class='id identifier rubyid_build_ident'>build_ident</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_vendor'>cartridge_vendor</span><span class='comma'>,</span>
                                        <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
                                        <span class='id identifier rubyid_software_version'>software_version</span><span class='comma'>,</span>
                                        <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_version'>cartridge_version</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_envs'>envs</span>                                  <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_envs'>envs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_short_name'>short_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_DIR</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>   <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>+</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>SEPARATOR</span>
  <span class='id identifier rubyid_envs'>envs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_short_name'>short_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_IDENT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_ident'>ident</span>

  <span class='id identifier rubyid_write_environment_variables'>write_environment_variables</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_target'>target</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>env</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_envs'>envs</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_envs'>envs</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
  <span class='id identifier rubyid_envs'>envs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>namespace</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span> <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span>

  <span class='comment'># If there&#39;s not already a primary cartridge on the gear, assume
</span>  <span class='comment'># the new cartridge is the primary.
</span>  <span class='id identifier rubyid_current_gear_env'>current_gear_env</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_current_gear_env'>current_gear_env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OPENSHIFT_PRIMARY_CARTRIDGE_DIR</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_envs'>envs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>primary_cartridge_dir</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>+</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>SEPARATOR</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> recorded as primary within gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_envs'>envs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_write_environment_variables'>write_environment_variables</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.env</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_envs'>envs</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Gear level actions: Placed here to be off the V1 code path...
</span>  <span class='id identifier rubyid_old_path'>old_path</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.env</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PATH</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_old_path'>old_path</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span> <span class='id identifier rubyid_old_path'>old_path</span>

  <span class='id identifier rubyid_secure_cartridge'>secure_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_short_name'>short_name</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gid'>gid</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created cartridge directory </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_private_endpoints-instance_method">
  
    - (<tt>Object</tt>) <strong>create_private_endpoints</strong>(cartridge) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Allocates and assigns private IP/port entries for a cartridge based on
endpoint metadata for the cartridge.</p>

<p>Returns nil on success, or raises an exception if any errors occur: all
errors here are considered fatal.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 758</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_private_endpoints'>create_private_endpoints</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge is required</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_cartridge'>cartridge</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creating </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> private endpoints for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_env'>env</span>           <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_allocated_ips'>allocated_ips</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_allocated_endpoints'>allocated_endpoints</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='op'>|</span>
    <span class='comment'># Reuse previously allocated IPs of the same name. When recycling
</span>    <span class='comment'># an IP, double-check that it&#39;s not bound to the target port, and
</span>    <span class='comment'># bail if it&#39;s unexpectedly bound.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='comment'># Allocate a new IP for the endpoint
</span>        <span class='id identifier rubyid_private_ip'>private_ip</span> <span class='op'>=</span> <span class='id identifier rubyid_find_open_ip'>find_open_ip</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_private_ip'>private_ip</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No IP was available to create endpoint for cart </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> in gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>\
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>

        <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_add_env_var'>add_env_var</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='comma'>,</span> <span class='id identifier rubyid_private_ip'>private_ip</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_private_ip'>private_ip</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_private_ip'>private_ip</span> <span class='op'>=</span> <span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span>

    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port_name'>private_port_name</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_allocated_endpoints'>allocated_endpoints</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_endpoint'>endpoint</span>

    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_add_env_var'>add_env_var</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port_name'>private_port_name</span><span class='comma'>,</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>

    <span class='comment'># Create the environment variable for WebSocket Port if it is specified
</span>    <span class='comment'># in the manifest.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_websocket_port_name'>websocket_port_name</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_websocket_port'>websocket_port</span>
      <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_add_env_var'>add_env_var</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_websocket_port_name'>websocket_port_name</span><span class='comma'>,</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_websocket_port'>websocket_port</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created private endpoint for cart </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> in gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>\
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port_name'>private_port_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='comment'># Expose the public endpoint if ssl_to_gear option is set
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='kw'>and</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ssl_to_gear</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ssl_to_gear option set for the endpoint</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_create_public_endpoint'>create_public_endpoint</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='comma'>,</span> <span class='id identifier rubyid_private_ip'>private_ip</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Validate all the allocations to ensure they aren&#39;t already bound. Batch up the initial check
</span>  <span class='comment'># for efficiency, then do individual checks to provide better reporting before we fail.
</span>  <span class='id identifier rubyid_address_list'>address_list</span> <span class='op'>=</span> <span class='id identifier rubyid_allocated_endpoints'>allocated_endpoints</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='lbrace'>{</span><span class='label'>ip:</span> <span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='lbracket'>[</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='rbrace'>}</span> <span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_address_list'>address_list</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_addresses_bound?'>addresses_bound?</span><span class='lparen'>(</span><span class='id identifier rubyid_address_list'>address_list</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_failures'>failures</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_allocated_endpoints'>allocated_endpoints</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_address_bound?'>address_bound?</span><span class='lparen'>(</span><span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>)=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to create the following private endpoints due to existing process bindings: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_failures'>failures</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures'>failures</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_public_endpoint-instance_method">
  
    - (<tt>Object</tt>) <strong>create_public_endpoint</strong>(cartridge, endpoint, private_ip) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Expose an endpoint for a cartridge through the port proxy.</p>

<p>Returns nil on success, or raises an exception if any errors occur: all
errors here are considered fatal.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


727
728
729
730
731
732
733</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 727</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_public_endpoint'>create_public_endpoint</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='comma'>,</span> <span class='id identifier rubyid_private_ip'>private_ip</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_public_port'>public_port</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_create_public_endpoint'>create_public_endpoint</span><span class='lparen'>(</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>
  <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_add_env_var'>add_env_var</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_public_port_name'>public_port_name</span><span class='comma'>,</span> <span class='id identifier rubyid_public_port'>public_port</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created public endpoint for cart </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> in gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>\
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_public_port_name'>public_port_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_stop_lock-instance_method">
  
    - (<tt>Object</tt>) <strong>create_stop_lock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Writes the <code>stop_lock</code> file and changes its ownership to the
gear user.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1383
1384
1385
1386
1387
1388
1389</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1383</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_stop_lock'>create_stop_lock</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_stop_lock?'>stop_lock?</span>
    <span class='id identifier rubyid_mcs_label'>mcs_label</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_get_mcs_label'>get_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_stop_lock'>stop_lock</span><span class='comma'>,</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>CREAT</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>TRUNC</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>WRONLY</span><span class='comma'>,</span> <span class='int'>0644</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_set_rw_permission'>set_rw_permission</span><span class='lparen'>(</span><span class='id identifier rubyid_stop_lock'>stop_lock</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="deconfigure-instance_method">
  
    - (<tt>Object</tt>) <strong>deconfigure</strong>(cartridge_name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>deconfigure(cartridge_name) -&gt; nil</p>

<p>Remove cartridge from gear with the following workflow:</p>

<pre class="code ruby"><code class="ruby">1. Delete private endpoints
2. Stop the cartridge
3. Execute the cartridge `control teardown` action
4. Disconnect the frontend for the cartridge
5. Delete the cartridge directory</code></pre>

<p>If the cartridge stop or teardown operations fail, the error output will be
captured, but the frontend will still be disconnect and the cartridge
directory will be deleted.</p>

<p>deconfigure(&#39;php-5.3&#39;)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 364</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deconfigure'>deconfigure</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_teardown_output'>teardown_output</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge'>get_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='id identifier rubyid_teardown_output'>teardown_output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CLIENT_ERROR: Corrupted cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> removed. There may be extraneous data left on system.\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Corrupted cartridge </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> removed. There may be extraneous data left on system.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span> <span class='op'>=</span> <span class='id identifier rubyid_map_cartridge_name'>map_cartridge_name</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Corrupted cartridge </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Attempting to auto-correct for deconfigure using local manifest.yml.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge_fallback'>get_cartridge_fallback</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Corrupted cartridge </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Attempting to auto-correct for deconfigure resorting to CartridgeRepository.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='op'>=</span> <span class='const'>CartridgeRepository</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_ident'>ident</span> <span class='op'>=</span> <span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Manifest</span><span class='period'>.</span><span class='id identifier rubyid_build_ident'>build_ident</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_vendor'>cartridge_vendor</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_software_version'>software_version</span><span class='comma'>,</span>
                                          <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_version'>cartridge_version</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_write_environment_variables'>write_environment_variables</span><span class='lparen'>(</span>
        <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>env</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_short_name'>short_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_IDENT</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ident'>ident</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_delete_private_endpoints'>delete_private_endpoints</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_boost'>boost</span> <span class='kw'>do</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_stop_cartridge'>stop_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='label'>user_initiated:</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_unlock_gear'>unlock_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
        <span class='id identifier rubyid_teardown_output'>teardown_output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cartridge_teardown'>cartridge_teardown</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_teardown_output'>teardown_output</span> <span class='op'>&lt;&lt;</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Sdk</span><span class='op'>::</span><span class='id identifier rubyid_translate_out_for_client'>translate_out_for_client</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_teardown_output'>teardown_output</span> <span class='op'>&lt;&lt;</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Sdk</span><span class='op'>::</span><span class='id identifier rubyid_translate_out_for_client'>translate_out_for_client</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_stderr'>stderr</span><span class='comma'>,</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_disconnect_frontend'>disconnect_frontend</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_delete_cartridge_directory'>delete_cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_teardown_output'>teardown_output</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_cartridge_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_cartridge_directory</strong>(cartridge) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


571
572
573
574
575
576</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 571</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_cartridge_directory'>delete_cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Deleting cartridge directory for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='comment'># TODO: rm_rf correct?
</span>  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_rf'>rm_rf</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Deleted cartridge directory for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_private_endpoints-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_private_endpoints</strong>(cartridge) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


828
829
830
831
832
833
834
835
836
837</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 828</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_private_endpoints'>delete_private_endpoints</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Deleting private endpoints for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='op'>|</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_remove_env_var'>remove_env_var</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rparen'>)</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_remove_env_var'>remove_env_var</span><span class='lparen'>(</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port_name'>private_port_name</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Deleted private endpoints for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong>(skip_hooks = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>destroy(skip_hooks = false) -&gt; [buffer, &#39;&#39;, 0]</p>

<p>Remove all cartridges from a gear and delete the gear.  Accepts and
discards any parameters to comply with the signature of V1 require, which
accepted a single argument.</p>

<p>destroy() =&gt; [&#39;&#39;, &#39;&#39;, 0]</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 193</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_hooks'>skip_hooks</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V2 destroy</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>begin</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_skip_hooks'>skip_hooks</span>
      <span class='id identifier rubyid_each_cartridge'>each_cartridge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='op'>|</span>
        <span class='id identifier rubyid_unlock_gear'>unlock_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
          <span class='kw'>begin</span>
            <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cartridge_teardown'>cartridge_teardown</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
          <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
            <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge teardown operation failed on gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> (rc=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_rc'>rc</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge teardown operation failed on gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for some cartridge: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CLIENT_ERROR: Abandoned cartridge teardowns. There may be extraneous data left on system.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Ensure we&#39;re not in the gear&#39;s directory
</span>  <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_chdir'>chdir</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GEAR_BASE_DIR</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='comment'># FIXME: V1 contract is there a better way?
</span>  <span class='lbracket'>[</span><span class='id identifier rubyid_buffer'>buffer</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disconnect_frontend-instance_method">
  
    - (<tt>Object</tt>) <strong>disconnect_frontend</strong>(cartridge) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>disconnect cartridge from frontend proxy</p>

<p>This is only called when a cartridge is removed from a cartridge not a gear
delete</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


908
909
910
911
912
913
914
915
916
917
918
919
920</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 908</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect_frontend'>disconnect_frontend</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='op'>|</span>
    <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mapping'>mapping</span><span class='op'>|</span>
      <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_mapping'>mapping</span><span class='period'>.</span><span class='id identifier rubyid_frontend'>frontend</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Disconnecting frontend mapping for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='const'>FrontendHttpServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_disconnect'>disconnect</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_mappings'>mappings</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="do_action_hook-instance_method">
  
    - (<tt>Object</tt>) <strong>do_action_hook</strong>(action, env, options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Executes the named <code>action</code> from the user repo
<code>action_hooks</code> directory and returns the stdout of the
execution, or raises a <code>ShellExecutionException</code> if the action
returns a non-zero return code.</p>

<p>All hyphens in the <code>action</code> will be replaced with underscores.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1179</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_action_hook'>do_action_hook</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_action'>action</span> <span class='op'>=</span> <span class='id identifier rubyid_action'>action</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>-</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_action_hooks_dir'>action_hooks_dir</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>app-root</span><span class='words_sep'> </span><span class='tstring_content'>runtime</span><span class='words_sep'> </span><span class='tstring_content'>repo</span><span class='words_sep'> </span><span class='tstring_content'>.openshift</span><span class='words_sep'> </span><span class='tstring_content'>action_hooks</span><span class='words_sep'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_action_hook'>action_hook</span>      <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_action_hooks_dir'>action_hooks_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_buffer'>buffer</span>           <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span><span class='lparen'>(</span><span class='id identifier rubyid_action_hook'>action_hook</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='id identifier rubyid_action_hook'>action_hook</span><span class='comma'>,</span>
                                                       <span class='label'>env:</span>     <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span>
                                                       <span class='label'>chdir:</span>   <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span>
                                                       <span class='label'>timeout:</span> <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='comma'>,</span>
                                                       <span class='label'>out:</span>     <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                       <span class='label'>err:</span>     <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:err</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to execute action hook &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> application </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_application_name'>application_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='id identifier rubyid_rc'>rc</span><span class='comma'>,</span> <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span>
          <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_out'>out</span> <span class='kw'>if</span> <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_err'>err</span> <span class='kw'>if</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_buffer'>buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="do_control-instance_method">
  
    - (<tt>Object</tt>) <strong>do_control</strong>(action, cartridge, options = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


979
980
981
982
983
984
985
986
987
988
989
990
991
992</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 979</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_control'>do_control</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_cartridge'>cartridge</span>
    <span class='kw'>when</span> <span class='const'>String</span>
      <span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_cartridge_directory'>cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>Manifest</span>
      <span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsupported cartridge argument type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cartridge_dir</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span>

  <span class='id identifier rubyid_do_control_with_directory'>do_control_with_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="do_control_with_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>do_control_with_directory</strong>(action, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:call-seq:</p>

<pre class="code ruby"><code class="ruby">V2CartridgeModel.new(...).do_control_with_directory(action, options)  -&gt; output
V2CartridgeModel.new(...).do_control_with_directory(action)           -&gt; output</code></pre>

<p>Call action on cartridge <code>control</code> script. Run all pre/post
hooks if found.</p>

<p><code>options</code>: hash</p>

<pre class="ruby">:<span class="ruby-identifier">cartridge_dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>             <span class="ruby-operator">:</span> <span class="ruby-constant">Process</span> <span class="ruby-identifier">all</span> <span class="ruby-identifier">cartridges</span> (<span class="ruby-keyword">if</span> <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span>) <span class="ruby-keyword">or</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">provided</span> <span class="ruby-identifier">cartridge</span>
:<span class="ruby-identifier">pre_action_hooks_enabled</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>  <span class="ruby-operator">:</span> <span class="ruby-constant">Whether</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">process</span> <span class="ruby-identifier">repo</span> <span class="ruby-identifier">action</span> <span class="ruby-identifier">hooks</span> <span class="ruby-identifier">before</span> <span class="ruby-operator">+</span><span class="ruby-identifier">action</span><span class="ruby-operator">+</span>
:<span class="ruby-identifier">post_action_hooks_enabled</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Whether</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">process</span> <span class="ruby-identifier">repo</span> <span class="ruby-identifier">action</span> <span class="ruby-identifier">hooks</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">+</span><span class="ruby-identifier">action</span><span class="ruby-operator">+</span>
:<span class="ruby-identifier">prefix_action_hooks</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>       <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>, <span class="ruby-identifier">action</span> <span class="ruby-identifier">hook</span> <span class="ruby-identifier">names</span> <span class="ruby-identifier">are</span> <span class="ruby-identifier">automatically</span> <span class="ruby-identifier">prefixed</span> <span class="ruby-identifier">with</span>
                                     <span class="ruby-string">&#39;pre&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-string">&#39;post&#39;</span> <span class="ruby-identifier">depending</span> <span class="ruby-identifier">on</span> <span class="ruby-identifier">their</span> <span class="ruby-identifier">execution</span> <span class="ruby-identifier">order</span>.
:<span class="ruby-identifier">out</span>                               <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDOUT</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                     <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
:<span class="ruby-identifier">err</span>                               <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDERR</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                     <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
</pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_control_with_directory'>do_control_with_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span>             <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cartridge_dir</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_pre_action_hooks_enabled'>pre_action_hooks_enabled</span>  <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:pre_action_hooks_enabled</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:pre_action_hooks_enabled</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_post_action_hooks_enabled'>post_action_hooks_enabled</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:post_action_hooks_enabled</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:post_action_hooks_enabled</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_prefix_action_hooks'>prefix_action_hooks</span>       <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:prefix_action_hooks</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:prefix_action_hooks</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'> against &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_buffer'>buffer</span>       <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_gear_env'>gear_env</span>     <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_action_hooks'>action_hooks</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>app-root</span><span class='words_sep'> </span><span class='tstring_content'>runtime</span><span class='words_sep'> </span><span class='tstring_content'>repo</span><span class='words_sep'> </span><span class='tstring_content'>.openshift</span><span class='words_sep'> </span><span class='tstring_content'>action_hooks</span><span class='words_sep'>}</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_pre_action_hooks_enabled'>pre_action_hooks_enabled</span>
    <span class='id identifier rubyid_pre_action_hook'>pre_action_hook</span> <span class='op'>=</span> <span class='id identifier rubyid_prefix_action_hooks'>prefix_action_hooks</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pre_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_action'>action</span>
    <span class='id identifier rubyid_hook_buffer'>hook_buffer</span>     <span class='op'>=</span> <span class='id identifier rubyid_do_action_hook'>do_action_hook</span><span class='lparen'>(</span><span class='id identifier rubyid_pre_action_hook'>pre_action_hook</span><span class='comma'>,</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_hook_buffer'>hook_buffer</span> <span class='kw'>if</span> <span class='id identifier rubyid_hook_buffer'>hook_buffer</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_process_cartridges'>process_cartridges</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
    <span class='comment'># Make sure this cartridge&#39;s env directory overrides that of other cartridge envs
</span>    <span class='id identifier rubyid_cartridge_local_env'>cartridge_local_env</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>env</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cartridge_local_env'>cartridge_local_env</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PATH</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_ident'>ident</span>                            <span class='op'>=</span> <span class='id identifier rubyid_cartridge_local_env'>cartridge_local_env</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_grep'>grep</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^OPENSHIFT_.*_IDENT</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_software'>software</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Manifest</span><span class='period'>.</span><span class='id identifier rubyid_parse_ident'>parse_ident</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_local_env'>cartridge_local_env</span><span class='lbracket'>[</span><span class='id identifier rubyid_ident'>ident</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_hooks'>hooks</span>                            <span class='op'>=</span> <span class='id identifier rubyid_cartridge_hooks'>cartridge_hooks</span><span class='lparen'>(</span><span class='id identifier rubyid_action_hooks'>action_hooks</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_software'>software</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_cartridge_env'>cartridge_env</span> <span class='op'>=</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_local_env'>cartridge_local_env</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_control'>control</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bin</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>control</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_hooks'>hooks</span><span class='lbracket'>[</span><span class='symbol'>:pre</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_hooks'>hooks</span><span class='lbracket'>[</span><span class='symbol'>:pre</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_control'>control</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_executable?'>executable?</span> <span class='id identifier rubyid_control'>control</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_hooks'>hooks</span><span class='lbracket'>[</span><span class='symbol'>:post</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_hooks'>hooks</span><span class='lbracket'>[</span><span class='symbol'>:post</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set -e</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>|</span> <span class='id identifier rubyid_command'>command</span>

      <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
                                                         <span class='label'>env:</span>     <span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='comma'>,</span>
                                                         <span class='label'>chdir:</span>   <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span>
                                                         <span class='label'>timeout:</span> <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='comma'>,</span>
                                                         <span class='label'>out:</span>     <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                                         <span class='label'>err:</span>     <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:err</span><span class='rbracket'>]</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_out'>out</span> <span class='kw'>if</span> <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_err'>err</span> <span class='kw'>if</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to execute: &#39;control </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span><span class='comma'>,</span> <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span>
            <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_post_action_hooks_enabled'>post_action_hooks_enabled</span>
    <span class='id identifier rubyid_post_action_hook'>post_action_hook</span> <span class='op'>=</span> <span class='id identifier rubyid_prefix_action_hooks'>prefix_action_hooks</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>post_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_action'>action</span>
    <span class='id identifier rubyid_hook_buffer'>hook_buffer</span>      <span class='op'>=</span> <span class='id identifier rubyid_do_action_hook'>do_action_hook</span><span class='lparen'>(</span><span class='id identifier rubyid_post_action_hook'>post_action_hook</span><span class='comma'>,</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_hook_buffer'>hook_buffer</span> <span class='kw'>if</span> <span class='id identifier rubyid_hook_buffer'>hook_buffer</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_buffer'>buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="do_lock-instance_method">
  
    - (<tt>Object</tt>) <strong>do_lock</strong>(entries) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>do_lock_gear(array of file names) -&gt; array</p>

<p>Take the given array of file system entries and prepare them for the
application developer</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_v2_cart_model'>v2_cart_model</span><span class='period'>.</span><span class='id identifier rubyid_do_lock_gear'>do_lock_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 466</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_lock'>do_lock</span><span class='lparen'>(</span><span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mcs_label'>mcs_label</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_get_mcs_label'>get_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span>

  <span class='comment'># It is expensive doing one file at a time but...
</span>  <span class='comment'># ...it allows reporting on the failed command at the file level
</span>  <span class='comment'># ...we don&#39;t have to worry about the length of argv
</span>  <span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_set_ro_permission'>set_ro_permission</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>FileLockError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to lock file system entry [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_entry'>entry</span><span class='embexpr_end'>}</span><span class='tstring_content'>]: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                  <span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_set_ro_permission'>set_ro_permission</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>FileLockError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to lock gear home [</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>]: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                                <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="do_unlock-instance_method">
  
    - (<tt>Object</tt>) <strong>do_unlock</strong>(entries) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>do_unlock_gear(array of file names) -&gt; array</p>

<p>Take the given array of file system entries and prepare them for the
cartridge author</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_v2_cart_model'>v2_cart_model</span><span class='period'>.</span><span class='id identifier rubyid_do_unlock_gear'>do_unlock_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 431</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_unlock'>do_unlock</span><span class='lparen'>(</span><span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mcs_label'>mcs_label</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_get_mcs_label'>get_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_entries'>entries</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_end_with?'>end_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_chomp!'>chomp!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkpath'>mkpath</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='comma'>,</span> <span class='label'>mode:</span> <span class='int'>0755</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_entry'>entry</span>
    <span class='kw'>else</span>
      <span class='comment'># FileUtils.touch not used as it doesn&#39;t support mode
</span>      <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='comma'>,</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>CREAT</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>TRUNC</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>WRONLY</span><span class='comma'>,</span> <span class='int'>0644</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='comment'># It is expensive doing one file at a time but...
</span>    <span class='comment'># ...it allows reporting on the failed command at the file level
</span>    <span class='comment'># ...we don&#39;t have to worry about the length of argv
</span>    <span class='kw'>begin</span>
      <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_set_rw_permission'>set_rw_permission</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FileUnlockError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to unlock file system entry [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_entry'>entry</span><span class='embexpr_end'>}</span><span class='tstring_content'>]: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                <span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_set_rw_permission'>set_rw_permission</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FileUnlockError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to unlock gear home [</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>]: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>each_cartridge</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Yields a <code>Cartridge</code> instance for each cartridge in the gear.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


75
76
77
78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 75</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each_cartridge'>each_cartridge</span>
  <span class='id identifier rubyid_process_cartridges'>process_cartridges</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span><span class='op'>|</span>
    <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge_from_directory'>get_cartridge_from_directory</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_cartridge'>cartridge</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="empty_repository?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>empty_repository?</strong>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1427
1428
1429</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1427</span>

<span class='kw'>def</span> <span class='id identifier rubyid_empty_repository?'>empty_repository?</span>
  <span class='const'>ApplicationRepository</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_open_ip-instance_method">
  
    - (<tt>Object</tt>) <strong>find_open_ip</strong>(port) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finds the next IP address available for binding of the given port for the
current gear user. The IP is assumed to be available only if the IP is not
already associated with an existing endpoint defined by any cartridge
within the gear.</p>

<p>Returns a string IP address in dotted-quad notation if one is available for
the given port, or returns nil if IP is available.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 845</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_open_ip'>find_open_ip</span><span class='lparen'>(</span><span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_allocated_ips'>allocated_ips</span> <span class='op'>=</span> <span class='id identifier rubyid_get_allocated_private_ips'>get_allocated_private_ips</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>IPs already allocated for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='embexpr_end'>}</span><span class='tstring_content'> in gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_open_ip'>open_ip</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>for</span> <span class='id identifier rubyid_host_ip'>host_ip</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='int'>127</span>
    <span class='id identifier rubyid_candidate_ip'>candidate_ip</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_get_ip_addr'>get_ip_addr</span><span class='lparen'>(</span><span class='id identifier rubyid_host_ip'>host_ip</span><span class='rparen'>)</span>

    <span class='comment'># Skip the IP if it&#39;s already assigned to an endpoint
</span>    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_allocated_ips'>allocated_ips</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_candidate_ip'>candidate_ip</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_open_ip'>open_ip</span> <span class='op'>=</span> <span class='id identifier rubyid_candidate_ip'>candidate_ip</span>
    <span class='kw'>break</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_open_ip'>open_ip</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_allocated_private_ips-instance_method">
  
    - (<tt>Object</tt>) <strong>get_allocated_private_ips</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns an array containing all currently allocated endpoint private IP
addresses assigned to carts within the current gear, or an empty array if
none are currently defined.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 884</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_allocated_private_ips'>get_allocated_private_ips</span>
  <span class='id identifier rubyid_env'>env</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='op'>::</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_allocated_ips'>allocated_ips</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='comment'># Collect all existing endpoint IP allocations
</span>  <span class='id identifier rubyid_process_cartridges'>process_cartridges</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cart_path'>cart_path</span><span class='op'>|</span>
    <span class='id identifier rubyid_cart_dir'>cart_dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_path'>cart_path</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cart'>cart</span>     <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge_from_directory'>get_cartridge_from_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_cart'>cart</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='op'>|</span>
      <span class='comment'># TODO: If the private IP variable exists but the value isn&#39;t in
</span>      <span class='comment'># the environment, what should happen?
</span>      <span class='id identifier rubyid_ip'>ip</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_allocated_ips'>allocated_ips</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ip'>ip</span> <span class='kw'>unless</span> <span class='id identifier rubyid_ip'>ip</span> <span class='op'>==</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_allocated_ips'>allocated_ips</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>get_cartridge</strong>(cart_name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Load the cartridge&#39;s local manifest from the Broker token
&#39;name-version&#39;</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_cartridge'>get_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='ivar'>@cartridges</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='id identifier rubyid_cart_name'>cart_name</span>
    <span class='id identifier rubyid_cart_dir'>cart_dir</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_cart_dir'>cart_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_cartridge_directory'>cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>

      <span class='ivar'>@cartridges</span><span class='lbracket'>[</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge_from_directory'>get_cartridge_from_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to get cartridge &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'> in gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@cartridges</span><span class='lbracket'>[</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_cartridge_fallback-instance_method">
  
    - (<tt>Object</tt>) <strong>get_cartridge_fallback</strong>(cart_name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Load the cartridge&#39;s local manifest from the Broker token
&#39;name-version&#39;</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178
179
180
181
182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_cartridge_fallback'>get_cartridge_fallback</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_directory'>directory</span>  <span class='op'>=</span> <span class='id identifier rubyid_cartridge_directory'>cartridge_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='id identifier rubyid_map_cartridge_name'>map_cartridge_name</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Directory name is required</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_directory'>directory</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='id identifier rubyid_directory'>directory</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_cartridge_path'>cartridge_path</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_manifest_path'>manifest_path</span>  <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_path'>cartridge_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>metadata</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>manifest.yml</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge manifest not found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_manifest_path'>manifest_path</span><span class='embexpr_end'>}</span><span class='tstring_content'> missing</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_manifest_path'>manifest_path</span><span class='rparen'>)</span>

  <span class='const'>Manifest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_manifest_path'>manifest_path</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='symbol'>:file</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_cartridge_from_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>get_cartridge_from_directory</strong>(directory) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Load cartridge&#39;s local manifest from cartridge directory name</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 153</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_cartridge_from_directory'>get_cartridge_from_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Directory name is required</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_directory'>directory</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='id identifier rubyid_directory'>directory</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='ivar'>@cartridges</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='id identifier rubyid_directory'>directory</span>
    <span class='id identifier rubyid_cartridge_path'>cartridge_path</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_manifest_path'>manifest_path</span>  <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_path'>cartridge_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>metadata</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>manifest.yml</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ident_path'>ident_path</span>     <span class='op'>=</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_path'>cartridge_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>env</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OPENSHIFT_*_IDENT</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge manifest not found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_manifest_path'>manifest_path</span><span class='embexpr_end'>}</span><span class='tstring_content'> missing</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_manifest_path'>manifest_path</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge Ident not found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ident_path'>ident_path</span><span class='embexpr_end'>}</span><span class='tstring_content'> missing</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_ident_path'>ident_path</span><span class='rparen'>)</span>

    <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Manifest</span><span class='period'>.</span><span class='id identifier rubyid_parse_ident'>parse_ident</span><span class='lparen'>(</span><span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_ident_path'>ident_path</span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='ivar'>@cartridges</span><span class='lbracket'>[</span><span class='id identifier rubyid_directory'>directory</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Manifest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_manifest_path'>manifest_path</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='symbol'>:file</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='ivar'>@cartridges</span><span class='lbracket'>[</span><span class='id identifier rubyid_directory'>directory</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_repository?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>has_repository?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1391
1392
1393</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1391</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_repository?'>has_repository?</span>
  <span class='const'>ApplicationRepository</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="list_proxy_mappings-instance_method">
  
    - (<tt>Object</tt>) <strong>list_proxy_mappings</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 735</span>

<span class='kw'>def</span> <span class='id identifier rubyid_list_proxy_mappings'>list_proxy_mappings</span>
  <span class='id identifier rubyid_proxied_ports'>proxied_ports</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_gear_env'>gear_env</span>      <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_each_cartridge'>each_cartridge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='op'>|</span>
    <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_public_port_name'>public_port_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_proxied_ports'>proxied_ports</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span>
          <span class='symbol'>:private_ip_name</span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='comma'>,</span>
          <span class='symbol'>:public_port_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_public_port_name'>public_port_name</span><span class='comma'>,</span>
          <span class='symbol'>:private_ip</span>       <span class='op'>=&gt;</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_ip_name'>private_ip_name</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:private_port</span>     <span class='op'>=&gt;</span> <span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_private_port'>private_port</span><span class='comma'>,</span>
          <span class='symbol'>:proxy_port</span>       <span class='op'>=&gt;</span> <span class='id identifier rubyid_gear_env'>gear_env</span><span class='lbracket'>[</span><span class='id identifier rubyid_endpoint'>endpoint</span><span class='period'>.</span><span class='id identifier rubyid_public_port_name'>public_port_name</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_proxied_ports'>proxied_ports</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="map_cartridge_name-instance_method">
  
    - (<tt>Object</tt>) <strong>map_cartridge_name</strong>(cartridge_name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>FIXME: Once Broker/Node protocol updated to provided necessary information
this hack must go away</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_map_cartridge_name'>map_cartridge_name</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([a-zA-Z\d-]+)-([\d\.]+)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid cartridge identifier &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;: expected name-version</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_results'>results</span> <span class='op'>&amp;&amp;</span> <span class='int'>2</span> <span class='op'>==</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="populate_gear_repo-instance_method">
  
    - (<tt>Object</tt>) <strong>populate_gear_repo</strong>(cartridge_name, template_url = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:call-seq:</p>

<pre class="ruby"><span class="ruby-identifier">model</span>.<span class="ruby-identifier">populate_gear_repo</span>(<span class="ruby-identifier">cartridge</span> <span class="ruby-identifier">name</span>) =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>
<span class="ruby-identifier">model</span>.<span class="ruby-identifier">populate_gear_repo</span>(<span class="ruby-identifier">cartridge</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">application</span> <span class="ruby-identifier">git</span> <span class="ruby-identifier">template</span> <span class="ruby-identifier">url</span>) <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>
</pre>

<p>Populate the gear git repository with a sample application</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_populate_gear_repo'>populate_gear_repo</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby-1.9</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_populate_gear_repo'>populate_gear_repo</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby-1.9</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://rails-example.example.com</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 586</span>

<span class='kw'>def</span> <span class='id identifier rubyid_populate_gear_repo'>populate_gear_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='comma'>,</span> <span class='id identifier rubyid_template_url'>template_url</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creating gear repo for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> from `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_template_url'>template_url</span><span class='embexpr_end'>}</span><span class='tstring_content'>`</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_repo'>repo</span> <span class='op'>=</span> <span class='const'>ApplicationRepository</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_template_url'>template_url</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_populate_from_cartridge'>populate_from_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Git</span><span class='period'>.</span><span class='id identifier rubyid_empty_clone_spec?'>empty_clone_spec?</span><span class='lparen'>(</span><span class='id identifier rubyid_template_url'>template_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_populate_empty'>populate_empty</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_populate_from_url'>populate_from_url</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='comma'>,</span> <span class='id identifier rubyid_template_url'>template_url</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span>
    <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_archive'>archive</span>
  <span class='kw'>end</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_configure-instance_method">
  
    - (<tt>Object</tt>) <strong>post_configure</strong>(cartridge_name) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 328</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_configure'>post_configure</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span> <span class='op'>=</span> <span class='id identifier rubyid_map_cartridge_name'>map_cartridge_name</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cartridge'>cartridge</span>              <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge'>get_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>

  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_boost'>boost</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_empty_repository?'>empty_repository?</span>
      <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CLIENT_MESSAGE: An empty Git repository has been created for your application.  Use &#39;git push&#39; to add your code.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_start_cartridge'>start_cartridge</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>start</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='label'>user_initiated:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cartridge_action'>cartridge_action</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>post_install</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>post-configure output: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output'>output</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span>
<span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Sdk</span><span class='period'>.</span><span class='id identifier rubyid_translate_shell_ex_for_client'>translate_shell_ex_for_client</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='int'>157</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_install-instance_method">
  
    - (<tt>Object</tt>) <strong>post_install</strong>(cartridge, software_version, options = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


322
323
324
325
326</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 322</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_install'>post_install</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_cartridge_action'>cartridge_action</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>post_install</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_software_version'>software_version</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_output'>output</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="primary_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>primary_cartridge</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the primary <code>Cartridge</code> in the gear as specified by the
<code>OPENSHIFT_PRIMARY_CARTRIDGE_DIR</code> environment variable, or
<code>Nil</code> if no primary cartridge is present.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88
89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 86</span>

<span class='kw'>def</span> <span class='id identifier rubyid_primary_cartridge'>primary_cartridge</span>
  <span class='id identifier rubyid_env'>env</span>              <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_primary_cart_dir'>primary_cart_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OPENSHIFT_PRIMARY_CARTRIDGE_DIR</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No primary cartridge detected in gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_primary_cart_dir'>primary_cart_dir</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_get_cartridge_from_directory'>get_cartridge_from_directory</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_primary_cart_dir'>primary_cart_dir</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_cartridges-instance_method">
  
    - (<tt>Object</tt>) <strong>process_cartridges</strong>(cartridge_dir = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Run code block against each cartridge in gear</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>Code</span>
      
      
        <span class='type'>(<tt>block</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>block to process cartridge</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


966
967
968
969
970
971
972
973
974
975
976
977</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 966</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_cartridges'>process_cartridges</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='comment'># : yields cartridge_path
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span>
    <span class='id identifier rubyid_cart_dir'>cart_dir</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge_dir'>cartridge_dir</span><span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_cart_dir'>cart_dir</span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='const'>Dir</span><span class='lbracket'>[</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_symlink?'>symlink?</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_dir'>cart_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>metadata</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>manifest.yml</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_cart_dir'>cart_dir</span>
  <span class='kw'>end</span> <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span> <span class='kw'>and</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_erb_templates-instance_method">
  
    - (<tt>Object</tt>) <strong>process_erb_templates</strong>(cartridge) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>process_erb_templates(cartridge_name) -&gt; nil</p>

<p>Search cartridge for any remaining <code>erb</code> files render them</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 607</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_erb_templates'>process_erb_templates</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_directory'>directory</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Processing ERB templates for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_env'>env</span>  <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_directory'>directory</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_erbs'>erbs</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_processed_templates'>processed_templates</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_erbs'>erbs</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_erb_file'>erb_file</span><span class='op'>|</span>
    <span class='id identifier rubyid_reject'>reject</span> <span class='op'>=</span> <span class='op'>!</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_erb_file'>erb_file</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_reject'>reject</span>
      <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CLIENT_ERROR: File declared in processed_templates does not exist and will not be rendered: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_erb_file'>erb_file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_reject'>reject</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_render_erbs'>render_erbs</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_erbs'>erbs</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_buffer'>buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="publish_gear_endpoint-instance_method">
  
    - (<tt>Object</tt>) <strong>publish_gear_endpoint</strong>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>special methods that are handled especially by the platform</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1397</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publish_gear_endpoint'>publish_gear_endpoint</span>
  <span class='kw'>begin</span>
    <span class='comment'># TODO:
</span>    <span class='comment'># There is some concern about how well-behaved Facter is
</span>    <span class='comment'># when it is require&#39;d.
</span>    <span class='comment'># Instead, we use run_in_container_context here to avoid it altogether.
</span>    <span class='comment'># For the long-term, then, figure out a way to reliably
</span>    <span class='comment'># determine the IP address from Ruby.
</span>    <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>facter ipaddress</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                                                           <span class='label'>env:</span>                 <span class='id identifier rubyid_cartridge_env'>cartridge_env</span><span class='comma'>,</span>
                                                           <span class='label'>chdir:</span>               <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span>
                                                           <span class='label'>timeout:</span>             <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='comma'>,</span>
                                                           <span class='label'>expected_exitstatus:</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_private_ip'>private_ip</span>       <span class='op'>=</span> <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='kw'>rescue</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_addrinfo'>addrinfo</span>     <span class='op'>=</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_getaddrinfo'>getaddrinfo</span><span class='lparen'>(</span><span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_gethostname'>gethostname</span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='comment'># 80 is arbitrary
</span>    <span class='id identifier rubyid_private_addr'>private_addr</span> <span class='op'>=</span> <span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
      <span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^127</span><span class='regexp_end'>/</span></span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_private_ip'>private_ip</span>   <span class='op'>=</span> <span class='id identifier rubyid_private_addr'>private_addr</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_env'>env</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='op'>::</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OPENSHIFT_GEAR_UUID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_primary_cartridge'>primary_cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OPENSHIFT_GEAR_DNS</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='id identifier rubyid_output'>output</span>
  <span class='id identifier rubyid_output'>output</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="render_erbs-instance_method">
  
    - (<tt>Object</tt>) <strong>render_erbs</strong>(env, erbs) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>render_erbs(program environment as a hash, erbs) -&gt; nil</p>

<p>Run <code>erb</code> against each template file submitted</p>

<pre class="ruby"><span class="ruby-identifier">v2_cart_model</span>.<span class="ruby-identifier">render_erbs</span>({<span class="ruby-constant">HOMEDIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;/home/no_place_like&#39;</span>}, [<span class="ruby-string">&#39;/var/lib/openshift/user/cart/foo.erb&#39;</span>, <span class="ruby-operator">...</span>])
</pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 674</span>

<span class='kw'>def</span> <span class='id identifier rubyid_render_erbs'>render_erbs</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_erbs'>erbs</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_erbs'>erbs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'>/usr/bin/oo-erb -S 2 -- </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='embexpr_end'>}</span><span class='tstring_content'> &gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.erb</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>}</span></span><span class='comma'>,</span>
                                          <span class='label'>env:</span>                 <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span>
                                          <span class='label'>chdir:</span>               <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span>
                                          <span class='label'>timeout:</span>             <span class='ivar'>@hourglass</span><span class='period'>.</span><span class='id identifier rubyid_remaining'>remaining</span><span class='comma'>,</span>
                                          <span class='label'>expected_exitstatus:</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to render ERB </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_stderr'>stderr</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='kw'>begin</span>
        <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span>
        <span class='comment'># already gone for some reason; ignore it
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="secure_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>secure_cartridge</strong>(short_name, uid, gid = uid, cartridge_home) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 536</span>

<span class='kw'>def</span> <span class='id identifier rubyid_secure_cartridge'>secure_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_short_name'>short_name</span><span class='comma'>,</span> <span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span> <span class='id identifier rubyid_gid'>gid</span><span class='op'>=</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='rparen'>)</span>
  <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_chdir'>chdir</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_set_rw_permission_R'>set_rw_permission_R</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge_home'>cartridge_home</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_files'>files</span> <span class='op'>=</span> <span class='const'>ManagedFiles</span><span class='op'>::</span><span class='const'>IMMUTABLE_FILES</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
      <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_short_name'>short_name</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_file'>file</span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
    <span class='kw'>end</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_files'>files</span><span class='period'>.</span><span class='id identifier rubyid_compact!'>compact!</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_files'>files</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_set_ro_permission'>set_ro_permission</span><span class='lparen'>(</span><span class='id identifier rubyid_files'>files</span><span class='rparen'>)</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_chmod'>chmod</span><span class='lparen'>(</span><span class='int'>0644</span><span class='comma'>,</span> <span class='id identifier rubyid_files'>files</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_connection_hook_env_vars-instance_method">
  
    - (<tt>Object</tt>) <strong>set_connection_hook_env_vars</strong>(cart_name, pub_cart_name, args) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1011</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_connection_hook_env_vars'>set_connection_hook_env_vars</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Setting env vars for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ARGS: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_env_dir_path'>env_dir_path</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.env</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_short_name_from_full_cart_name'>short_name_from_full_cart_name</span><span class='lparen'>(</span><span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkpath'>mkpath</span><span class='lparen'>(</span><span class='id identifier rubyid_env_dir_path'>env_dir_path</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_envs'>envs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='comment'># Skip the first three arguments and jump to gear =&gt; &quot;k1=v1\nk2=v2\n&quot; hash map
</span>  <span class='id identifier rubyid_pairs'>pairs</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_pairs'>pairs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pair'>pair</span><span class='op'>|</span>
    <span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span>    <span class='op'>=</span> <span class='id identifier rubyid_pair'>pair</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_envs'>envs</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_write_environment_variables'>write_environment_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_env_dir_path'>env_dir_path</span><span class='comma'>,</span> <span class='id identifier rubyid_envs'>envs</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="short_name_from_full_cart_name-instance_method">
  
    - (<tt>Object</tt>) <strong>short_name_from_full_cart_name</strong>(pub_cart_name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


994
995
996
997
998
999
1000
1001
1002</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 994</span>

<span class='kw'>def</span> <span class='id identifier rubyid_short_name_from_full_cart_name'>short_name_from_full_cart_name</span><span class='lparen'>(</span><span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pub_cart_name cannot be nil</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span> <span class='kw'>if</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_tokens'>tokens</span> <span class='op'>=</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tokens'>tokens</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
  <span class='id identifier rubyid_tokens'>tokens</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>start_cartridge</strong>(type, cartridge, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Starts a cartridge.</p>

<p>Both application state and the stop lock are managed during the operation.
If start of the primary cartridge is invoked and
<code>user_initiated</code> is true, the stop lock is created.</p>

<p><code>type</code>      : Type of start [start, restart, reload]
<code>cartridge</code> : A <code>Cartridge</code> instance or
<code>String</code> name of a cartridge. <code>options</code>   : hash</p>

<pre class="ruby">:<span class="ruby-identifier">user_initiated</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]  <span class="ruby-operator">:</span> <span class="ruby-constant">Indicates</span> <span class="ruby-identifier">whether</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">operation</span> <span class="ruby-identifier">was</span> <span class="ruby-identifier">user</span> <span class="ruby-identifier">initated</span>.
                                <span class="ruby-constant">Default</span> <span class="ruby-identifier">is</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">hot_deploy</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]      <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">+</span><span class="ruby-identifier">cartridge</span><span class="ruby-operator">+</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">primary</span> <span class="ruby-identifier">cartridge</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">gear</span>, <span class="ruby-identifier">the</span>
                                <span class="ruby-identifier">gear</span> <span class="ruby-identifier">state</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">to</span> <span class="ruby-operator">+</span><span class="ruby-constant">STARTED</span><span class="ruby-operator">+</span> <span class="ruby-identifier">but</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">actual</span> <span class="ruby-identifier">cartridge</span> <span class="ruby-identifier">start</span> <span class="ruby-identifier">operation</span>
                                <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">skipped</span>. <span class="ruby-constant">Non</span><span class="ruby-operator">-</span><span class="ruby-identifier">primary</span> <span class="ruby-identifier">cartridges</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">skipped</span> <span class="ruby-identifier">with</span> <span class="ruby-identifier">no</span> <span class="ruby-identifier">state</span> <span class="ruby-identifier">change</span>.
                                <span class="ruby-constant">Default</span> <span class="ruby-identifier">is</span> <span class="ruby-operator">+</span><span class="ruby-keyword">false</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">out</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDOUT</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
:<span class="ruby-identifier">err</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDERR</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
</pre>

<p>Returns the output of the operation as a <code>String</code> or raises a
<code>ShellExecutionException</code> if the cartridge script fails.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1304</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_cartridge'>start_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:user_initiated</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:hot_deploy</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:hot_deploy</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge'>get_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_stop_lock?'>stop_lock?</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not starting cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> because the application was explicitly stopped by the user</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_primary_cartridge'>primary_cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_f'>rm_f</span><span class='lparen'>(</span><span class='id identifier rubyid_stop_lock'>stop_lock</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='const'>State</span><span class='op'>::</span><span class='const'>STARTED</span>

    <span class='comment'># Unidle the application, preferring to use the privileged operation if possible
</span>    <span class='id identifier rubyid_frontend'>frontend</span> <span class='op'>=</span> <span class='const'>FrontendHttpServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>==</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
      <span class='id identifier rubyid_frontend'>frontend</span><span class='period'>.</span><span class='id identifier rubyid_unprivileged_unidle'>unprivileged_unidle</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_frontend'>frontend</span><span class='period'>.</span><span class='id identifier rubyid_unidle'>unidle</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:hot_deploy</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not starting cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> because hot deploy is enabled</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_do_control'>do_control</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_gear-instance_method">
  
    - (<tt>Object</tt>) <strong>start_gear</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Starts up the gear by running the cartridge <code>start</code> control
action for each cartridge in the gear.</p>

<p>By default, all cartridges in the gear are started. The selection of
cartridges to be started is configurable via <code>options</code>.</p>

<p><code>options</code>: hash</p>

<pre class="ruby">:<span class="ruby-identifier">primary_only</span>   =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]  <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>, <span class="ruby-identifier">only</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">primary</span> <span class="ruby-identifier">cartridge</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">started</span>.
                                <span class="ruby-constant">Mutually</span> <span class="ruby-identifier">exclusive</span> <span class="ruby-identifier">with</span> <span class="ruby-operator">+</span><span class="ruby-identifier">secondary_only</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">secondary_only</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]  <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>, <span class="ruby-identifier">all</span> <span class="ruby-identifier">cartridges</span> <span class="ruby-identifier">except</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">primary</span> <span class="ruby-identifier">cartridge</span>
                                <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">started</span>. <span class="ruby-constant">Mutually</span> <span class="ruby-identifier">exclusive</span> <span class="ruby-identifier">with</span> <span class="ruby-operator">+</span><span class="ruby-identifier">primary_only</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">user_initiated</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]  <span class="ruby-operator">:</span> <span class="ruby-constant">Indicates</span> <span class="ruby-identifier">whether</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">operation</span> <span class="ruby-identifier">was</span> <span class="ruby-identifier">user</span> <span class="ruby-identifier">initated</span>.
                                <span class="ruby-constant">Default</span> <span class="ruby-identifier">is</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">out</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDOUT</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
:<span class="ruby-identifier">err</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDERR</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
</pre>

<p>Returns the combined output of all <code>start</code> action executions as
a <code>String</code>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1263</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_gear'>start_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:user_initiated</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:primary_only</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:secondary_only</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The primary_only and secondary_only options are mutually exclusive options</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_each_cartridge'>each_cartridge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:primary_only</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>!=</span> <span class='id identifier rubyid_primary_cartridge'>primary_cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:secondary_only</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_primary_cartridge'>primary_cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_start_cartridge'>start_cartridge</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>start</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_buffer'>buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>stop_cartridge</strong>(cartridge, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Stops a cartridge.</p>

<p>Both application state and the stop lock are managed during the operation.
If stop of the primary cartridge is invoked and <code>user_initiated</code>
is true, the stop lock is removed.</p>

<p><code>cartridge</code> : A <code>Cartridge</code> instance or
<code>String</code> name of a cartridge. <code>options</code>   : hash</p>

<pre class="ruby">:<span class="ruby-identifier">user_initiated</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]  <span class="ruby-operator">:</span> <span class="ruby-constant">Indicates</span> <span class="ruby-identifier">whether</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">operation</span> <span class="ruby-identifier">was</span> <span class="ruby-identifier">user</span> <span class="ruby-identifier">initated</span>.
                                <span class="ruby-constant">Default</span> <span class="ruby-identifier">is</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">hot_deploy</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]      <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>, <span class="ruby-identifier">the</span> <span class="ruby-identifier">stop</span> <span class="ruby-identifier">operation</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">skipped</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">all</span> <span class="ruby-identifier">cartridge</span> <span class="ruby-identifier">types</span>,
                                <span class="ruby-identifier">the</span> <span class="ruby-identifier">gear</span> <span class="ruby-identifier">state</span> <span class="ruby-identifier">is</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">modified</span>, <span class="ruby-keyword">and</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">stop</span> <span class="ruby-identifier">lock</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">never</span> <span class="ruby-identifier">created</span>.
                                <span class="ruby-constant">Default</span> <span class="ruby-identifier">is</span> <span class="ruby-operator">+</span><span class="ruby-keyword">false</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">out</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDOUT</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
:<span class="ruby-identifier">err</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDERR</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
</pre>

<p>Returns the output of the operation as a <code>String</code> or raises a
<code>ShellExecutionException</code> if the cartridge script fails.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1357</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_cartridge'>stop_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:user_initiated</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:hot_deploy</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:hot_deploy</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='op'>=</span> <span class='id identifier rubyid_get_cartridge'>get_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:hot_deploy</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not stopping cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> because hot deploy is enabled</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_stop_lock?'>stop_lock?</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not stopping cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> because the application was explicitly stopped by the user\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_primary_cartridge'>primary_cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_create_stop_lock'>create_stop_lock</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='const'>State</span><span class='op'>::</span><span class='const'>STOPPED</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_do_control'>do_control</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stop</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_gear-instance_method">
  
    - (<tt>Object</tt>) <strong>stop_gear</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shuts down the gear by running the cartridge <code>stop</code> control
action for each cartridge in the gear.</p>

<p><code>options</code>: hash</p>

<pre class="ruby">:<span class="ruby-identifier">user_initiated</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">boolean</span>]  <span class="ruby-operator">:</span> <span class="ruby-constant">Indicates</span> <span class="ruby-identifier">whether</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">operation</span> <span class="ruby-identifier">was</span> <span class="ruby-identifier">user</span> <span class="ruby-identifier">initated</span>.
                                <span class="ruby-constant">Default</span> <span class="ruby-identifier">is</span> <span class="ruby-operator">+</span><span class="ruby-keyword">true</span><span class="ruby-operator">+</span>.
:<span class="ruby-identifier">out</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDOUT</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
:<span class="ruby-identifier">err</span>                          <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">control</span> <span class="ruby-identifier">script</span> <span class="ruby-constant">STDERR</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">directed</span>. <span class="ruby-constant">If</span>
                                <span class="ruby-operator">+</span><span class="ruby-keyword">nil</span><span class="ruby-operator">+</span> (<span class="ruby-identifier">the</span> <span class="ruby-identifier">default</span>), <span class="ruby-identifier">output</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">logged</span>.
</pre>

<p>Returns the combined output of all <code>stop</code> action executions as a
<code>String</code>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1231</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_gear'>stop_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:user_initiated</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:user_initiated</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_each_cartridge'>each_cartridge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='op'>|</span>
    <span class='id identifier rubyid_buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_stop_cartridge'>stop_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_buffer'>buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_lock-instance_method">
  
    - (<tt>Object</tt>) <strong>stop_lock</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 65</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_lock'>stop_lock</span>
  <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>app-root</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>runtime</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.stop_lock</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_lock?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>stop_lock?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 69</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_lock?'>stop_lock?</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_stop_lock'>stop_lock</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tidy-instance_method">
  
    - (<tt>Object</tt>) <strong>tidy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>tidy() -&gt; nil</p>

<p>Run tidy operation on each cartridge on a gear</p>

<p>tidy()</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228
229
230
231
232
233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tidy'>tidy</span>
  <span class='id identifier rubyid_each_cartridge'>each_cartridge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_do_control'>do_control</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tidy</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>ShellExecutionException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tidy operation failed for cartridge </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> on </span><span class='tstring_end'>&quot;</span></span>\
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gear </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> (rc=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_rc'>rc</span><span class='embexpr_end'>}</span><span class='tstring_content'>), output=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output'>output</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unlock_gear-instance_method">
  
    - (<tt>Object</tt>) <strong>unlock_gear</strong>(cartridge, relock = true) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>unlock_gear(cartridge_name) -&gt; nil</p>

<p>Prepare the given cartridge for the cartridge author</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_v2_cart_model'>v2_cart_model</span><span class='period'>.</span><span class='id identifier rubyid_unlock_gear'>unlock_gear</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>php-5.3</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


416
417
418
419
420
421
422
423
424</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 416</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unlock_gear'>unlock_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='comma'>,</span> <span class='id identifier rubyid_relock'>relock</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_do_unlock'>do_unlock</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_locked_files'>locked_files</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_cartridge'>cartridge</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_do_lock'>do_lock</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_locked_files'>locked_files</span><span class='lparen'>(</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_relock'>relock</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unsubscribe-instance_method">
  
    - (<tt>Object</tt>) <strong>unsubscribe</strong>(cart_name, pub_cart_name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Let a cart perform some action when another cart is being removed Today, it
is used to cleanup environment variables</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1006
1007
1008
1009</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 1006</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unsubscribe'>unsubscribe</span><span class='lparen'>(</span><span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_env_dir_path'>env_dir_path</span> <span class='op'>=</span> <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.env</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_short_name_from_full_cart_name'>short_name_from_full_cart_name</span><span class='lparen'>(</span><span class='id identifier rubyid_pub_cart_name'>pub_cart_name</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_rf'>rm_rf</span><span class='lparen'>(</span><span class='id identifier rubyid_env_dir_path'>env_dir_path</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_cartridge-instance_method">
  
    - (<tt>Object</tt>) <strong>validate_cartridge</strong>(manifest) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


308
309
310
311
312
313
314
315
316
317
318
319
320</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 308</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_cartridge'>validate_cartridge</span><span class='lparen'>(</span><span class='id identifier rubyid_manifest'>manifest</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_illegal_overrides'>illegal_overrides</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.env</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>&amp;</span>
      <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_manifest'>manifest</span><span class='period'>.</span><span class='id identifier rubyid_directory'>directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>env</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>

  <span class='comment'># Older gears may have these and cartridges are allowed to override them
</span>  <span class='id identifier rubyid_illegal_overrides'>illegal_overrides</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LD_LIBRARY_PATH</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_illegal_overrides'>illegal_overrides</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PATH</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_illegal_overrides'>illegal_overrides</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cartridge attempted to override the following gear environment variables: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_illegal_overrides'>illegal_overrides</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="web_proxy-instance_method">
  
    - (<tt>Object</tt>) <strong>web_proxy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the <code>Cartridge</code> in the gear whose <code>web_proxy</code>
flag is set to true, nil otherwise</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_web_proxy'>web_proxy</span>
  <span class='id identifier rubyid_each_cartridge'>each_cartridge</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cartridge'>cartridge</span><span class='op'>|</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_cartridge'>cartridge</span> <span class='kw'>if</span> <span class='id identifier rubyid_cartridge'>cartridge</span><span class='period'>.</span><span class='id identifier rubyid_web_proxy?'>web_proxy?</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_environment_variables-instance_method">
  
    - (<tt>Object</tt>) <strong>write_environment_variables</strong>(path, hash, prefix = true) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Write out environment variables.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


555
556
557
558
559
560
561
562
563
564
565
566
567
568
569</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/node/lib/openshift-origin-node/model/v2_cart_model.rb', line 555</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_environment_variables'>write_environment_variables</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_prefix'>prefix</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkpath'>mkpath</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_path'>path</span>

  <span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_prefix'>prefix</span>
      <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OPENSHIFT_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>0666</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
      <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Sep  9 22:06:12 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>