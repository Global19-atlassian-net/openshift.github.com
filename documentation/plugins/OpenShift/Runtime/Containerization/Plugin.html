<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OpenShift::Runtime::Containerization::Plugin
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../';
  framesUrl = "../../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../OpenShift.html" title="OpenShift (module)">OpenShift</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Runtime.html" title="OpenShift::Runtime (module)">Runtime</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Containerization.html" title="OpenShift::Runtime::Containerization (module)">Containerization</a></span></span>
     &raquo; 
    <span class="title">Plugin</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OpenShift::Runtime::Containerization::Plugin
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OpenShift::Runtime::Containerization::Plugin</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">NodeLogger</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb<span class="defines">,<br />
  /home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb</span>
</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="CONF_DIR-constant" class="">CONF_DIR =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/etc/openshift/</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="NODE_PLUGINS_DIR-constant" class="">NODE_PLUGINS_DIR =
          
        </dt>
        <dd><pre class="code"><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>CONF_DIR</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>node-plugins.d/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#gear_shell-instance_method" title="#gear_shell (instance method)">- (Object) <strong>gear_shell</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute gear_shell.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#mcs_label-instance_method" title="#mcs_label (instance method)">- (Object) <strong>mcs_label</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute mcs_label.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#container_dir-class_method" title="container_dir (class method)">+ (Object) <strong>container_dir</strong>(container) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#cidr_to_dotted-instance_method" title="#cidr_to_dotted (instance method)">- (Object) <strong>cidr_to_dotted</strong>(mask) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (Object) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Public: Create an empty gear.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#create_iptables_rules-instance_method" title="#create_iptables_rules (instance method)">- (Object) <strong>create_iptables_rules</strong>(action, public_port, container_ip, node_ip, private_ip, private_port) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_public_endpoint-instance_method" title="#create_public_endpoint (instance method)">- (Object) <strong>create_public_endpoint</strong>(private_ip, private_port) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#define_dummy_iface-instance_method" title="#define_dummy_iface (instance method)">- (Object) <strong>define_dummy_iface</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_all_public_endpoints-instance_method" title="#delete_all_public_endpoints (instance method)">- (Object) <strong>delete_all_public_endpoints</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Public: Initialize OpenShift Port Proxy for this gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_public_endpoints-instance_method" title="#delete_public_endpoints (instance method)">- (Object) <strong>delete_public_endpoints</strong>(proxy_mappings) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Public: Destroys a gear stopping all processes and removing all files.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disable_fs_limits-instance_method" title="#disable_fs_limits (instance method)">- (Object) <strong>disable_fs_limits</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disable_traffic_control-instance_method" title="#disable_traffic_control (instance method)">- (Object) <strong>disable_traffic_control</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#dotted_to_cidr-instance_method" title="#dotted_to_cidr (instance method)">- (Object) <strong>dotted_to_cidr</strong>(mask) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#enable_cgroups-instance_method" title="#enable_cgroups (instance method)">- (Object) <strong>enable_cgroups</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>TODO: notes why disabled.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#enable_fs_limits-instance_method" title="#enable_fs_limits (instance method)">- (Object) <strong>enable_fs_limits</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#enable_traffic_control-instance_method" title="#enable_traffic_control (instance method)">- (Object) <strong>enable_traffic_control</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#freeze_cgroups-instance_method" title="#freeze_cgroups (instance method)">- (Object) <strong>freeze_cgroups</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#freeze_fs_limits-instance_method" title="#freeze_fs_limits (instance method)">- (Object) <strong>freeze_fs_limits</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ip_addr-instance_method" title="#get_ip_addr (instance method)">- (Object) <strong>get_ip_addr</strong>(host_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deterministically constructs an IP address for the given UID based on the
given host identifier (LSB of the IP).</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#get_nat_ip_address-instance_method" title="#get_nat_ip_address (instance method)">- (Object) <strong>get_nat_ip_address</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#get_nat_ip_mask-instance_method" title="#get_nat_ip_mask (instance method)">- (Object) <strong>get_nat_ip_mask</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#get_open_proxy_port-instance_method" title="#get_open_proxy_port (instance method)">- (Object) <strong>get_open_proxy_port</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Plugin) <strong>initialize</strong>(application_container) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Plugin.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#list_home_dir-instance_method" title="#list_home_dir (instance method)">- (String) <strong>list_home_dir</strong>(home_dir) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: list directories (cartridges) in home directory.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#port_range-instance_method" title="#port_range (instance method)">- (Object) <strong>port_range</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a Range representing the valid proxy port values.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#purge_sysvipc-instance_method" title="#purge_sysvipc (instance method)">- (Object) <strong>purge_sysvipc</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: Purge IPC entities for a given gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#recreate_all_public_endpoints-instance_method" title="#recreate_all_public_endpoints (instance method)">- (Object) <strong>recreate_all_public_endpoints</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#reload_network-instance_method" title="#reload_network (instance method)">- (Object) <strong>reload_network</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_permission-instance_method" title="#reset_permission (instance method)">- (Object) <strong>reset_permission</strong>(*paths) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_permission_R-instance_method" title="#reset_permission_R (instance method)">- (Object) <strong>reset_permission_R</strong>(*paths) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#restore_cgroups-instance_method" title="#restore_cgroups (instance method)">- (Object) <strong>restore_cgroups</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run_in_container_context-instance_method" title="#run_in_container_context (instance method)">- (Object) <strong>run_in_container_context</strong>(command, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>run_in_container_context(command, [, options]) -&gt; [stdout, stderr, exit
status].</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#run_in_container_root_context-instance_method" title="#run_in_container_root_context (instance method)">- (Object) <strong>run_in_container_root_context</strong>(command, options = {}) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>run_in_container_root_context(command, [, options]) -&gt; [stdout, stderr,
exit status].</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#set_default_route-instance_method" title="#set_default_route (instance method)">- (Object) <strong>set_default_route</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_ro_permission-instance_method" title="#set_ro_permission (instance method)">- (Object) <strong>set_ro_permission</strong>(*paths) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_ro_permission_R-instance_method" title="#set_ro_permission_R (instance method)">- (Object) <strong>set_ro_permission_R</strong>(*paths) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_rw_permission-instance_method" title="#set_rw_permission (instance method)">- (Object) <strong>set_rw_permission</strong>(*paths) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_rw_permission_R-instance_method" title="#set_rw_permission_R (instance method)">- (Object) <strong>set_rw_permission_R</strong>(*paths) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (Object) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: Kill all processes for a given gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_cgroups-instance_method" title="#stop_cgroups (instance method)">- (Object) <strong>stop_cgroups</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#unfreeze_cgroups-instance_method" title="#unfreeze_cgroups (instance method)">- (Object) <strong>unfreeze_cgroups</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>release resources (cgroups thaw), this causes Zombies to get killed.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="OpenShift::Runtime::Containerization::Plugin (class)">Plugin</a></span></tt>) <strong>initialize</strong>(application_container) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A new instance of Plugin</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_application_container'>application_container</span><span class='rparen'>)</span>
  <span class='ivar'>@container</span>  <span class='op'>=</span> <span class='id identifier rubyid_application_container'>application_container</span>
  <span class='ivar'>@config</span>     <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@mcs_label</span>  <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_get_mcs_label'>get_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='ivar'>@gear_shell</span> <span class='op'>=</span> <span class='ivar'>@config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GEAR_SHELL</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>    <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/bin/bash</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="gear_shell-instance_method">
  
    - (<tt>Object</tt>) <strong>gear_shell</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute gear_shell</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gear_shell'>gear_shell</span>
  <span class='ivar'>@gear_shell</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="mcs_label-instance_method">
  
    - (<tt>Object</tt>) <strong>mcs_label</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute mcs_label</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mcs_label'>mcs_label</span>
  <span class='ivar'>@mcs_label</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="container_dir-class_method">
  
    + (<tt>Object</tt>) <strong>container_dir</strong>(container) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 11</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='rparen'>)</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='period'>.</span><span class='id identifier rubyid_base_dir'>base_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_container'>container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="cidr_to_dotted-instance_method">
  
    - (<tt>Object</tt>) <strong>cidr_to_dotted</strong>(mask)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


581
582
583</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 581</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cidr_to_dotted'>cidr_to_dotted</span><span class='lparen'>(</span><span class='id identifier rubyid_mask'>mask</span><span class='rparen'>)</span>
  <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span><span class='op'>*</span><span class='id identifier rubyid_mask'>mask</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='op'>*</span><span class='lparen'>(</span><span class='int'>32</span><span class='op'>-</span><span class='id identifier rubyid_mask'>mask</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>AF_INET</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-instance_method">
  
    - (<tt>Object</tt>) <strong>create</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Public: Create an empty gear.</p>

<p>Examples</p>

<pre class="ruby"><span class="ruby-identifier">create</span>
<span class="ruby-comment"># =&gt; nil</span>
<span class="ruby-comment"># a user</span>
<span class="ruby-comment"># Setup permissions</span>
</pre>

<p>Returns nil on Success or raises on Failure</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>::OpenShift::Runtime::UserCreationException</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='comment'># Lock to prevent race condition on obtaining a UNIX user uid.
</span>  <span class='comment'># When running without districts, there is a simple search on the
</span>  <span class='comment'>#   passwd file for the next available uid.
</span>  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/var/lock/oo-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>RDWR</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>CREAT</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>TRUNC</span><span class='comma'>,</span> <span class='int'>0o0600</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span> <span class='id identifier rubyid_uid_lock'>uid_lock</span> <span class='op'>|</span>
    <span class='id identifier rubyid_uid_lock'>uid_lock</span><span class='period'>.</span><span class='id identifier rubyid_fcntl'>fcntl</span><span class='lparen'>(</span><span class='const'>Fcntl</span><span class='op'>::</span><span class='const'>F_SETFD</span><span class='comma'>,</span> <span class='const'>Fcntl</span><span class='op'>::</span><span class='const'>FD_CLOEXEC</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_uid_lock'>uid_lock</span><span class='period'>.</span><span class='id identifier rubyid_flock'>flock</span><span class='lparen'>(</span><span class='const'>File</span><span class='op'>::</span><span class='const'>LOCK_EX</span><span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
      <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gid'>gid</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_next_uid'>next_uid</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>useradd -u </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='embexpr_end'>}</span><span class='tstring_content'> \
            -d </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'> \
            -s </span><span class='embexpr_beg'>#{</span><span class='ivar'>@gear_shell</span><span class='embexpr_end'>}</span><span class='tstring_content'> \
            -c &#39;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gecos'>gecos</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; \
            -m \
            -k </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_skel_dir'>skel_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'> \
            </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_end'>}</span></span>
    <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_supplementary_groups'>supplementary_groups</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'> -G &quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_supplementary_groups'>supplementary_groups</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span><span class='id identifier rubyid_err'>err</span><span class='comma'>,</span><span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>UserCreationException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: unable to create user account(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rc'>rc</span><span class='embexpr_end'>}</span><span class='tstring_content'>): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_squeeze'>squeeze</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> stdout: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_out'>out</span><span class='embexpr_end'>}</span><span class='tstring_content'> stderr: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_err'>err</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>==</span> <span class='int'>0</span>

    <span class='ivar'>@mcs_label</span>  <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_get_mcs_label'>get_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_set_ro_permission'>set_ro_permission</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_chmod'>chmod</span> <span class='int'>0o0750</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_enable_cgroups'>enable_cgroups</span>
  <span class='id identifier rubyid_enable_traffic_control'>enable_traffic_control</span>

  <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_initialize_homedir'>initialize_homedir</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_base_dir'>base_dir</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_enable_fs_limits'>enable_fs_limits</span>
  <span class='id identifier rubyid_delete_all_public_endpoints'>delete_all_public_endpoints</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_iptables_rules-instance_method">
  
    - (<tt>Object</tt>) <strong>create_iptables_rules</strong>(action, public_port, container_ip, node_ip, private_ip, private_port)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 612</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_iptables_rules'>create_iptables_rules</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_public_port'>public_port</span><span class='comma'>,</span> <span class='id identifier rubyid_container_ip'>container_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_node_ip'>node_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_private_ip'>private_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='symbol'>:add</span>
    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iptables -t nat -A PREROUTING </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iptables -t nat -A OUTPUT </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_run_in_container_root_context'>run_in_container_root_context</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firewall-cmd --direct --passthrough ipv4 -t nat -A PREROUTING </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_ip'>node_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firewall-cmd --direct --passthrough ipv4 -t nat -A OUTPUT </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_ip'>node_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firewall-cmd --direct --passthrough ipv4 -t filter -I FORWARD </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-p tcp --dport </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> -d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -j ACCEPT</span><span class='tstring_end'>&quot;</span></span>
    <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='symbol'>:delete</span>
    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iptables -t nat -D PREROUTING </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iptables -t nat -D OUTPUT </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_private_port'>private_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_run_in_container_root_context'>run_in_container_root_context</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firewall-cmd --direct --passthrough ipv4 -t nat -D PREROUTING </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_ip'>node_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firewall-cmd --direct --passthrough ipv4 -t nat -D OUTPUT </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_ip'>node_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -p tcp --dport=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-j DNAT --to-destination </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firewall-cmd --direct --passthrough ipv4 -t filter -D FORWARD </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-p tcp --dport </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_public_port'>public_port</span><span class='embexpr_end'>}</span><span class='tstring_content'> -d </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_container_ip'>container_ip</span><span class='embexpr_end'>}</span><span class='tstring_content'> -j ACCEPT</span><span class='tstring_end'>&quot;</span></span>
    <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_public_endpoint-instance_method">
  
    - (<tt>Object</tt>) <strong>create_public_endpoint</strong>(private_ip, private_port) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 205</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_public_endpoint'>create_public_endpoint</span><span class='lparen'>(</span><span class='id identifier rubyid_private_ip'>private_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>FrontendProxyServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='comment'># Add the public-to-private endpoint-mapping to the port proxy
</span>  <span class='id identifier rubyid_public_port'>public_port</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span> <span class='id identifier rubyid_private_ip'>private_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="define_dummy_iface-instance_method">
  
    - (<tt>Object</tt>) <strong>define_dummy_iface</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


439
440
441
442
443
444
445
446
447
448</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 439</span>

<span class='kw'>def</span> <span class='id identifier rubyid_define_dummy_iface'>define_dummy_iface</span>
  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='id identifier rubyid_run_in_container_root_context'>run_in_container_root_context</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>ip link show dummy0</span><span class='tstring_end'>}</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_rc'>rc</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ip link add dummy0 type dummy; </span><span class='tstring_end'>&quot;</span></span>
    <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>127</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ip addr add 169.254.169.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'> dev dummy0; </span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_run_in_container_root_context'>run_in_container_root_context</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_all_public_endpoints-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_all_public_endpoints</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Public: Initialize OpenShift Port Proxy for this gear</p>

<p>The port proxy range is determined by configuration and must produce
identical results to the abstract cartridge provided range.</p>

<p>Examples: reset_openshift_port_proxy</p>

<pre class="ruby">=<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-identifier">service</span> <span class="ruby-identifier">openshift_port_proxy</span> <span class="ruby-identifier">setproxy</span> <span class="ruby-value">35000</span> <span class="ruby-identifier">delete</span> <span class="ruby-value">35001</span> <span class="ruby-identifier">delete</span> <span class="ruby-identifier">etc</span><span class="ruby-operator">...</span>
</pre>

<p>Returns:</p>

<pre class="code ruby"><code class="ruby">true   - port proxy could be initialized properly
false  - port proxy could not be initialized properly</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 230</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_all_public_endpoints'>delete_all_public_endpoints</span>
  <span class='id identifier rubyid_proxy_server'>proxy_server</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>FrontendProxyServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_proxy_server'>proxy_server</span><span class='period'>.</span><span class='id identifier rubyid_delete_all_for_uid'>delete_all_for_uid</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_public_endpoints-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_public_endpoints</strong>(proxy_mappings) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 211</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_public_endpoints'>delete_public_endpoints</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy_mappings'>proxy_mappings</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>FrontendProxyServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_delete_all'>delete_all</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy_mappings'>proxy_mappings</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='symbol'>:proxy_port</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Public: Destroys a gear stopping all processes and removing all files</p>

<p>The order of the calls and gyrations done in this code is to prevent</p>

<pre class="code ruby"><code class="ruby">pam_namespace from locking polyinstantiated directories during
their deletion. If you see &quot;broken&quot; gears, i.e. ~uuid/.tmp and
 ~/uuid/.sandbox after #destroy has been called, this method is broken.</code></pre>

<p>See Bug 853582 for history.</p>

<p>Examples</p>

<pre class="ruby"><span class="ruby-identifier">destroy</span>
<span class="ruby-comment"># =&gt; nil</span>
</pre>

<p>Returns nil on Success or raises on Failure</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 88</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='comment'># These calls and their order is designed to release pam_namespace&#39;s
</span>  <span class='comment'>#   locks on .tmp and .sandbox. Change then at your peril.
</span>  <span class='comment'>#
</span>  <span class='comment'># 1. Kill off the easy processes
</span>  <span class='comment'># 2. Lock down the user from creating new processes (cgroups freeze, nprocs 0)
</span>  <span class='comment'># 3. Attempt to move any processes that didn&#39;t die into state &#39;D&#39; (re: cgroups freeze)
</span>  <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_kill_procs'>kill_procs</span>
  <span class='id identifier rubyid_freeze_fs_limits'>freeze_fs_limits</span>
  <span class='id identifier rubyid_freeze_cgroups'>freeze_cgroups</span>
  <span class='id identifier rubyid_disable_traffic_control'>disable_traffic_control</span>
  <span class='id identifier rubyid_last_access_dir'>last_access_dir</span> <span class='op'>=</span> <span class='ivar'>@config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LAST_ACCESS_DIR</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rm -f </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_last_access_dir'>last_access_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> &gt; /dev/null</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_kill_procs'>kill_procs</span>

  <span class='id identifier rubyid_purge_sysvipc'>purge_sysvipc</span>
  <span class='id identifier rubyid_delete_all_public_endpoints'>delete_all_public_endpoints</span>

  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>FrontendHttpServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>

  <span class='id identifier rubyid_dirs'>dirs</span> <span class='op'>=</span> <span class='id identifier rubyid_list_home_dir'>list_home_dir</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>userdel --remove -f \&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span><span class='id identifier rubyid_err'>err</span><span class='comma'>,</span><span class='id identifier rubyid_rc'>rc</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
    <span class='comment'># Ref man userdel(8) for exit codes.
</span>    <span class='kw'>case</span> <span class='id identifier rubyid_rc'>rc</span>
    <span class='kw'>when</span> <span class='int'>0</span>
    <span class='kw'>when</span> <span class='int'>6</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Userdel: user does not exist: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='int'>12</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Userdel: could not remove home directory, we will retry: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='comment'># 1 == cannot update password file.
</span>      <span class='comment'># 2 == invalid command syntax.
</span>      <span class='comment'># 8 == currently logged in, should not be possible after we kill the pids.
</span>      <span class='comment'># 10 == can&#39;t update group file
</span>      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: unable to delete user account(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rc'>rc</span><span class='embexpr_end'>}</span><span class='tstring_content'>): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='embexpr_end'>}</span><span class='tstring_content'> stdout: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_out'>out</span><span class='embexpr_end'>}</span><span class='tstring_content'> stderr: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_err'>err</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>UserDeletionException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user does not exist. ignore.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># 1. Don&#39;t believe everything you read on the userdel man page...
</span>  <span class='comment'># 2. If there are any active processes left pam_namespace is not going
</span>  <span class='comment'>#      to let polyinstantiated directories be deleted.
</span>  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_rf'>rm_rf</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
    <span class='comment'># Ops likes the verbose verbage
</span>    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'>
1st attempt to remove \&#39;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>\&#39; from filesystem failed.
Dir(before)   </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dirs'>dirs</span><span class='embexpr_end'>}</span><span class='tstring_content'>
Dir(after)    </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_list_home_dir'>list_home_dir</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='comment'># release resources (cgroups thaw), this causes Zombies to get killed
</span>  <span class='id identifier rubyid_unfreeze_cgroups'>unfreeze_cgroups</span>
  <span class='id identifier rubyid_stop_cgroups'>stop_cgroups</span>
  <span class='id identifier rubyid_disable_fs_limits'>disable_fs_limits</span>

  <span class='comment'># try one last time...
</span>  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>5</span><span class='rparen'>)</span>                    <span class='comment'># don&#39;t fear the reaper
</span>    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_rf'>rm_rf</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>   <span class='comment'># This is our last chance to nuke the polyinstantiated directories
</span>    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2nd attempt to remove \&#39;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='embexpr_end'>}</span><span class='tstring_content'>\&#39; from filesystem failed.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_out'>out</span><span class='comma'>,</span><span class='id identifier rubyid_err'>err</span><span class='comma'>,</span><span class='id identifier rubyid_rc'>rc</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disable_fs_limits-instance_method">
  
    - (<tt>Object</tt>) <strong>disable_fs_limits</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>::OpenShift::Runtime::UserCreationException</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


263
264
265
266</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 263</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disable_fs_limits'>disable_fs_limits</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_remove_pam_limits'>remove_pam_limits</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_remove_quota'>remove_quota</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disable_traffic_control-instance_method">
  
    - (<tt>Object</tt>) <strong>disable_traffic_control</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253
254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 251</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disable_traffic_control'>disable_traffic_control</span>
  <span class='kw'>begin</span>
    <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>TC</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_deluser'>deluser</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dotted_to_cidr-instance_method">
  
    - (<tt>Object</tt>) <strong>dotted_to_cidr</strong>(mask)  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


577
578
579</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 577</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dotted_to_cidr'>dotted_to_cidr</span><span class='lparen'>(</span><span class='id identifier rubyid_mask'>mask</span><span class='rparen'>)</span>
  <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_mask'>mask</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>AF_INET</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="enable_cgroups-instance_method">
  
    - (<tt>Object</tt>) <strong>enable_cgroups</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>TODO: notes why disabled</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 324</span>

<span class='kw'>def</span> <span class='id identifier rubyid_enable_cgroups'>enable_cgroups</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="enable_fs_limits-instance_method">
  
    - (<tt>Object</tt>) <strong>enable_fs_limits</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>::OpenShift::Runtime::UserCreationException</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260
261</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 258</span>

<span class='kw'>def</span> <span class='id identifier rubyid_enable_fs_limits'>enable_fs_limits</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_init_quota'>init_quota</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_quota_blocks'>quota_blocks</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_quota_files'>quota_files</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_init_pam_limits'>init_pam_limits</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="enable_traffic_control-instance_method">
  
    - (<tt>Object</tt>) <strong>enable_traffic_control</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


243
244
245
246
247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 243</span>

<span class='kw'>def</span> <span class='id identifier rubyid_enable_traffic_control'>enable_traffic_control</span>
  <span class='kw'>begin</span>
    <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>TC</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_startuser'>startuser</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>UserCreationException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to setup tc for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="freeze_cgroups-instance_method">
  
    - (<tt>Object</tt>) <strong>freeze_cgroups</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 340</span>

<span class='kw'>def</span> <span class='id identifier rubyid_freeze_cgroups'>freeze_cgroups</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_cg'>cg</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cg'>cg</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
    <span class='int'>20</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_pids'>pids</span> <span class='op'>=</span> <span class='id identifier rubyid_cg'>cg</span><span class='period'>.</span><span class='id identifier rubyid_processes'>processes</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_pids'>pids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='const'>Process</span><span class='op'>::</span><span class='const'>Kill</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>KILL</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='op'>*</span><span class='id identifier rubyid_pids'>pids</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cg'>cg</span><span class='period'>.</span><span class='id identifier rubyid_thaw'>thaw</span>
        <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_cg'>cg</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="freeze_fs_limits-instance_method">
  
    - (<tt>Object</tt>) <strong>freeze_fs_limits</strong>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>::OpenShift::Runtime::UserCreationException</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 336</span>

<span class='kw'>def</span> <span class='id identifier rubyid_freeze_fs_limits'>freeze_fs_limits</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_pam_freeze'>pam_freeze</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_ip_addr-instance_method">
  
    - (<tt>Object</tt>) <strong>get_ip_addr</strong>(host_id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Deterministically constructs an IP address for the given UID based on the
given host identifier (LSB of the IP). The host identifier must be a value
between 1-127 inclusive.</p>

<p>The global user IP range begins at 0x7F000000.</p>

<p>Returns an IP address string in dotted-quad notation.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 187</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_ip_addr'>get_ip_addr</span><span class='lparen'>(</span><span class='id identifier rubyid_host_id'>host_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid host_id specified</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_host_id'>host_id</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_host_id'>host_id</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>||</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&gt;</span> <span class='int'>262143</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User uid </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='embexpr_end'>}</span><span class='tstring_content'> is outside the working range 0-262143</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_host_id'>host_id</span> <span class='op'>&lt;</span> <span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_host_id'>host_id</span> <span class='op'>&gt;</span> <span class='int'>127</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Supplied host identifier </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host_id'>host_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> must be between 1 and 127</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Generate an IP (32-bit unsigned) in the user&#39;s range
</span>  <span class='id identifier rubyid_ip'>ip</span> <span class='op'>=</span> <span class='int'>0x7F000000</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&lt;&lt;</span> <span class='int'>7</span><span class='rparen'>)</span>  <span class='op'>+</span> <span class='id identifier rubyid_host_id'>host_id</span>

  <span class='comment'># Return the IP in dotted-quad notation
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span> <span class='op'>&gt;&gt;</span> <span class='int'>24</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span> <span class='op'>&gt;&gt;</span> <span class='int'>16</span> <span class='op'>&amp;</span> <span class='int'>0xFF</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span> <span class='op'>&gt;&gt;</span> <span class='int'>8</span> <span class='op'>&amp;</span> <span class='int'>0xFF</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span> <span class='op'>&amp;</span> <span class='int'>0xFF</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_nat_ip_address-instance_method">
  
    - (<tt>Object</tt>) <strong>get_nat_ip_address</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 585</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_nat_ip_address'>get_nat_ip_address</span>
  <span class='id identifier rubyid_iprange'>iprange</span> <span class='op'>=</span> <span class='ivar'>@container_config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LIBVIRT_PRIVATE_IP_RANGE</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_valid_ips'>valid_ips</span> <span class='op'>=</span> <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_iprange'>iprange</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_range'>to_range</span>
  <span class='id identifier rubyid_uid_offset'>uid_offset</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>-</span> <span class='ivar'>@uid_begin</span>
  <span class='id identifier rubyid_gw_ip'>gw_ip</span> <span class='op'>=</span> <span class='ivar'>@container_config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LIBVIRT_PRIVATE_IP_GW</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'>#offset to skip address ending in .0
</span>  <span class='id identifier rubyid_nat_ip'>nat_ip</span> <span class='op'>=</span> <span class='id identifier rubyid_valid_ips'>valid_ips</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lparen'>(</span><span class='id identifier rubyid_uid_offset'>uid_offset</span> <span class='op'>+</span> <span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>if</span><span class='lparen'>(</span> <span class='id identifier rubyid_nat_ip'>nat_ip</span> <span class='op'>==</span> <span class='id identifier rubyid_gw_ip'>gw_ip</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_nat_ip'>nat_ip</span> <span class='op'>=</span> <span class='id identifier rubyid_valid_ips'>valid_ips</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lparen'>(</span><span class='id identifier rubyid_uid_offset'>uid_offset</span> <span class='op'>+</span> <span class='int'>3</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='id identifier rubyid_iprange'>iprange</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='id identifier rubyid_dotted_to_cidr'>dotted_to_cidr</span><span class='lparen'>(</span><span class='id identifier rubyid_mask'>mask</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_nat_ip'>nat_ip</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_nat_ip_mask-instance_method">
  
    - (<tt>Object</tt>) <strong>get_nat_ip_mask</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


604
605
606
607
608
609
610</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 604</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_nat_ip_mask'>get_nat_ip_mask</span>
  <span class='id identifier rubyid_iprange'>iprange</span> <span class='op'>=</span> <span class='ivar'>@container_config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LIBVIRT_PRIVATE_IP_RANGE</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='id identifier rubyid_iprange'>iprange</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='id identifier rubyid_dotted_to_cidr'>dotted_to_cidr</span><span class='lparen'>(</span><span class='id identifier rubyid_mask'>mask</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_mask'>mask</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_open_proxy_port-instance_method">
  
    - (<tt>Object</tt>) <strong>get_open_proxy_port</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461
462
463
464
465
466</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 459</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_open_proxy_port'>get_open_proxy_port</span>
  <span class='id identifier rubyid_endpoints'>endpoints</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_list_proxy_mappings'>list_proxy_mappings</span>
  <span class='id identifier rubyid_used_ports'>used_ports</span> <span class='op'>=</span> <span class='id identifier rubyid_endpoints'>endpoints</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span> <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='symbol'>:proxy_port</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_port_range'>port_range</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_port'>port</span><span class='op'>|</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_port'>port</span> <span class='kw'>unless</span> <span class='id identifier rubyid_used_ports'>used_ports</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_port'>port</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="list_home_dir-instance_method">
  
    - (<tt>String</tt>) <strong>list_home_dir</strong>(home_dir)  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: list directories (cartridges) in home directory</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>home</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>directory</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>comma separated list of directories</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


377
378
379
380
381
382
383
384
385
386</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 377</span>

<span class='kw'>def</span> <span class='id identifier rubyid_list_home_dir'>list_home_dir</span><span class='lparen'>(</span><span class='id identifier rubyid_home_dir'>home_dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_home_dir'>home_dir</span><span class='rparen'>)</span>
    <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_foreach'>foreach</span><span class='lparen'>(</span><span class='id identifier rubyid_home_dir'>home_dir</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
      <span class='comment'>#next if entry =~ /^\.{1,2}/   # Ignore &quot;.&quot;, &quot;..&quot;, or hidden files
</span>      <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_entry'>entry</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="port_range-instance_method">
  
    - (<tt>Object</tt>) <strong>port_range</strong>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a Range representing the valid proxy port values</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


451
452
453
454
455
456
457</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 451</span>

<span class='kw'>def</span> <span class='id identifier rubyid_port_range'>port_range</span>
  <span class='id identifier rubyid_uid_offset'>uid_offset</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>-</span> <span class='ivar'>@uid_begin</span>
  <span class='id identifier rubyid_proxy_port_begin'>proxy_port_begin</span> <span class='op'>=</span> <span class='ivar'>@port_begin</span> <span class='op'>+</span> <span class='id identifier rubyid_uid_offset'>uid_offset</span> <span class='op'>*</span> <span class='ivar'>@ports_per_user</span>

  <span class='id identifier rubyid_proxy_port_range'>proxy_port_range</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_proxy_port_begin'>proxy_port_begin</span> <span class='op'>...</span> <span class='lparen'>(</span><span class='id identifier rubyid_proxy_port_begin'>proxy_port_begin</span> <span class='op'>+</span> <span class='ivar'>@ports_per_user</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_proxy_port_range'>proxy_port_range</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="purge_sysvipc-instance_method">
  
    - (<tt>Object</tt>) <strong>purge_sysvipc</strong>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: Purge IPC entities for a given gear</p>

<p>Enumerate and remove all IPC entities for a given user ID or user name.</p>

<p>Examples: purge_sysvipc</p>

<pre class="ruby">=<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-identifier">ipcs</span> <span class="ruby-operator">-</span><span class="ruby-identifier">c</span>
<span class="ruby-identifier">ipcrm</span> <span class="ruby-operator">-</span><span class="ruby-identifier">s</span> <span class="ruby-identifier">id</span>
<span class="ruby-identifier">ipcrm</span> <span class="ruby-operator">-</span><span class="ruby-identifier">m</span> <span class="ruby-identifier">id</span>
</pre>

<p>Raises exception on error.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


402
403
404
405
406
407
408
409
410
411
412
413
414</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 402</span>

<span class='kw'>def</span> <span class='id identifier rubyid_purge_sysvipc'>purge_sysvipc</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-m</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-q</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-s</span><span class='tstring_end'>&#39;</span></span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ipctype'>ipctype</span><span class='op'>|</span>
    <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span><span class='id identifier rubyid_err'>err</span><span class='comma'>,</span><span class='id identifier rubyid_rc'>rc</span><span class='op'>=</span><span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>/usr/bin/ipcs -c </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ipctype'>ipctype</span><span class='embexpr_end'>}</span><span class='tstring_content'> 2&gt; /dev/null</span><span class='tstring_end'>}</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_lines'>lines</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ipcl'>ipcl</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_ipcl'>ipcl</span><span class='op'>=~</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\d</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_ipcent'>ipcent</span> <span class='op'>=</span> <span class='id identifier rubyid_ipcl'>ipcl</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_ipcent'>ipcent</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span>
        <span class='comment'># The ID may already be gone
</span>        <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>/usr/bin/ipcrm </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ipctype'>ipctype</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ipcent'>ipcent</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>}</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="recreate_all_public_endpoints-instance_method">
  
    - (<tt>Object</tt>) <strong>recreate_all_public_endpoints</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 310</span>

<span class='kw'>def</span> <span class='id identifier rubyid_recreate_all_public_endpoints'>recreate_all_public_endpoints</span>
  <span class='id identifier rubyid_delete_all_public_endpoints'>delete_all_public_endpoints</span>
  <span class='id identifier rubyid_proxy_mappings'>proxy_mappings</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mapping'>mapping</span><span class='op'>|</span>
    <span class='id identifier rubyid_public_port'>public_port</span>  <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span><span class='lbracket'>[</span><span class='symbol'>:proxy_port</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_container_ip'>container_ip</span> <span class='op'>=</span> <span class='id identifier rubyid_get_nat_ip_address'>get_nat_ip_address</span>
    <span class='id identifier rubyid_node_ip'>node_ip</span>      <span class='op'>=</span> <span class='ivar'>@config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PUBLIC_IP</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_private_ip'>private_ip</span>   <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span><span class='lbracket'>[</span><span class='symbol'>:private_ip</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_private_port'>private_port</span> <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span><span class='lbracket'>[</span><span class='symbol'>:private_port</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_create_iptables_rules'>create_iptables_rules</span><span class='lparen'>(</span><span class='symbol'>:add</span><span class='comma'>,</span> <span class='id identifier rubyid_public_port'>public_port</span><span class='comma'>,</span> <span class='id identifier rubyid_container_ip'>container_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_node_ip'>node_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_private_ip'>private_ip</span><span class='comma'>,</span> <span class='id identifier rubyid_private_port'>private_port</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reload_network-instance_method">
  
    - (<tt>Object</tt>) <strong>reload_network</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


468
469
470
471</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 468</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reload_network'>reload_network</span>
  <span class='id identifier rubyid_set_default_route'>set_default_route</span>
  <span class='id identifier rubyid_define_dummy_iface'>define_dummy_iface</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_permission-instance_method">
  
    - (<tt>Object</tt>) <strong>reset_permission</strong>(*paths) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


304
305
306
307</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 304</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_permission'>reset_permission</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_clear_mcs_label'>clear_mcs_label</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_set_mcs_label'>set_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@mcs_label</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_permission_R-instance_method">
  
    - (<tt>Object</tt>) <strong>reset_permission_R</strong>(*paths) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311
312</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_permission_R'>reset_permission_R</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_clear_mcs_label_R'>clear_mcs_label_R</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_set_mcs_label_R'>set_mcs_label_R</span><span class='lparen'>(</span><span class='ivar'>@mcs_label</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="restore_cgroups-instance_method">
  
    - (<tt>Object</tt>) <strong>restore_cgroups</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


367
368
369
370
371
372</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 367</span>

<span class='kw'>def</span> <span class='id identifier rubyid_restore_cgroups'>restore_cgroups</span>
  <span class='kw'>begin</span>
    <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_restore'>restore</span>
  <span class='kw'>rescue</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run_in_container_context-instance_method">
  
    - (<tt>Object</tt>) <strong>run_in_container_context</strong>(command, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>run_in_container_context(command, [, options]) -&gt; [stdout, stderr, exit
status]</p>

<p>Executes specified command and return its stdout, stderr and exit status.
Or, raise exceptions if certain conditions are not met. The command is as
container user in a SELinux context using runuser/runcon. The environment
variables are cleared and mys be specified by :env.</p>

<p>command: command line string which is passed to the standard shell</p>

<p>options: hash</p>

<pre class="ruby">:<span class="ruby-identifier">env</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>
  <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">environment</span> <span class="ruby-identifier">variable</span>
  <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">unset</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">environment</span> <span class="ruby-identifier">variable</span>
:<span class="ruby-identifier">chdir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>             <span class="ruby-operator">:</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">current</span> <span class="ruby-identifier">directory</span> <span class="ruby-keyword">when</span> <span class="ruby-identifier">running</span> <span class="ruby-identifier">command</span>
:<span class="ruby-identifier">expected_exitstatus</span>       <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-constant">Integer</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">expected</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">code</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">command</span>
                           <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">spawn</span>() <span class="ruby-identifier">returns</span> <span class="ruby-identifier">exitstatus</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">command</span> <span class="ruby-identifier">otherwise</span>
                           <span class="ruby-operator">:</span> <span class="ruby-identifier">raise</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">error</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exitstatus</span> <span class="ruby-identifier">is</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">expected_exitstatus</span>
:<span class="ruby-identifier">timeout</span>                   <span class="ruby-operator">:</span> <span class="ruby-constant">Maximum</span> <span class="ruby-identifier">number</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">seconds</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">wait</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">command</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">finish</span>. <span class="ruby-identifier">default</span><span class="ruby-operator">:</span> <span class="ruby-value">3600</span>
                           <span class="ruby-operator">:</span> <span class="ruby-identifier">stdin</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">command</span> <span class="ruby-identifier">is</span> <span class="ruby-regexp">/dev/</span><span class="ruby-identifier">ull</span>
:<span class="ruby-identifier">out</span>                       <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-identifier">specified</span>, <span class="ruby-constant">STDOUT</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">child</span> <span class="ruby-identifier">process</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">redirected</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">the</span>
                             <span class="ruby-identifier">provided</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span>.
:<span class="ruby-identifier">err</span>                       <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-identifier">specified</span>, <span class="ruby-constant">STDERR</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">child</span> <span class="ruby-identifier">process</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">redirected</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">the</span>
                             <span class="ruby-identifier">provided</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span>.
</pre>

<p>NOTE: If the <code>out</code> or <code>err</code> options are specified,
the corresponding return value from <code>oo_spawn</code> will be the
incoming/provided <code>IO</code> objects instead of the buffered
<code>String</code> output. It&#39;s the responsibility of the caller to
correctly handle the resulting data type.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


295
296
297
298
299
300
301
302</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 295</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run_in_container_context'>run_in_container_context</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>openshift-origin-node/utils/selinux</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:unsetenv_others</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:uid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:gid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gid'>gid</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:selinux_context</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_context_from_defaults'>context_from_defaults</span><span class='lparen'>(</span><span class='ivar'>@mcs_label</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run_in_container_root_context-instance_method">
  
    - (<tt>Object</tt>) <strong>run_in_container_root_context</strong>(command, options = {})  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>run_in_container_root_context(command, [, options]) -&gt; [stdout, stderr,
exit status]</p>

<p>Executes specified command and return its stdout, stderr and exit status.
Or, raise exceptions if certain conditions are not met. The command is run
as root within the container. The environment variables are cleared and may
be specified by :env.</p>

<p>command: command line string which is passed to the standard shell</p>

<p>options: hash</p>

<pre class="ruby">:<span class="ruby-identifier">env</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>
  <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">environment</span> <span class="ruby-identifier">variable</span>
  <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">unset</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">environment</span> <span class="ruby-identifier">variable</span>
:<span class="ruby-identifier">chdir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>             <span class="ruby-operator">:</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">current</span> <span class="ruby-identifier">directory</span> <span class="ruby-keyword">when</span> <span class="ruby-identifier">running</span> <span class="ruby-identifier">command</span>
:<span class="ruby-identifier">expected_exitstatus</span>       <span class="ruby-operator">:</span> <span class="ruby-constant">An</span> <span class="ruby-constant">Integer</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">expected</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">code</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">command</span>
                           <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">spawn</span>() <span class="ruby-identifier">returns</span> <span class="ruby-identifier">exitstatus</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">command</span> <span class="ruby-identifier">otherwise</span>
                           <span class="ruby-operator">:</span> <span class="ruby-identifier">raise</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">error</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">exitstatus</span> <span class="ruby-identifier">is</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">expected_exitstatus</span>
:<span class="ruby-identifier">timeout</span>                   <span class="ruby-operator">:</span> <span class="ruby-constant">Maximum</span> <span class="ruby-identifier">number</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">seconds</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">wait</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">command</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">finish</span>. <span class="ruby-identifier">default</span><span class="ruby-operator">:</span> <span class="ruby-value">3600</span>
                           <span class="ruby-operator">:</span> <span class="ruby-identifier">stdin</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">command</span> <span class="ruby-identifier">is</span> <span class="ruby-regexp">/dev/</span><span class="ruby-identifier">ull</span>
:<span class="ruby-identifier">out</span>                       <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-identifier">specified</span>, <span class="ruby-constant">STDOUT</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">child</span> <span class="ruby-identifier">process</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">redirected</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">the</span>
                             <span class="ruby-identifier">provided</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span>.
:<span class="ruby-identifier">err</span>                       <span class="ruby-operator">:</span> <span class="ruby-constant">If</span> <span class="ruby-identifier">specified</span>, <span class="ruby-constant">STDERR</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">child</span> <span class="ruby-identifier">process</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">redirected</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">the</span>
                             <span class="ruby-identifier">provided</span> <span class="ruby-operator">+</span><span class="ruby-constant">IO</span><span class="ruby-operator">+</span> <span class="ruby-identifier">object</span>.
</pre>

<p>NOTE: If the <code>out</code> or <code>err</code> options are specified,
the corresponding return value from <code>oo_spawn</code> will be the
incoming/provided <code>IO</code> objects instead of the buffered
<code>String</code> output. It&#39;s the responsibility of the caller to
correctly handle the resulting data type.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


500
501
502
503
504
505
506
507
508
509
510
511
512
513
514</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 500</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run_in_container_root_context'>run_in_container_root_context</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:unsetenv_others</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:env</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:env</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:env</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Environ</span><span class='period'>.</span><span class='id identifier rubyid_for_gear'>for_gear</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_container_dir'>container_dir</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/dev/container-id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cd </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:chdir</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> ; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_command'>command</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:chdir</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/bin/virt-sandbox-service execute </span><span class='embexpr_beg'>#{</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> -- /bin/bash -c &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_command'>command</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='id identifier rubyid_oo_spawn'>oo_spawn</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_default_route-instance_method">
  
    - (<tt>Object</tt>) <strong>set_default_route</strong>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


427
428
429
430
431
432
433
434
435
436
437</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/libvirt/lib/openshift/runtime/containerization/libvirt_container.rb', line 427</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_default_route'>set_default_route</span>
  <span class='id identifier rubyid_gw'>gw</span> <span class='op'>=</span> <span class='ivar'>@container_config</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LIBVIRT_PRIVATE_IP_GW</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_run_in_container_root_context'>run_in_container_root_context</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>ip route show</span><span class='tstring_end'>}</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>default via ([\d\.]+) dev eth0 \n</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_m'>m</span> <span class='op'>||</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_gw'>gw</span>
    <span class='id identifier rubyid_run_in_container_root_context'>run_in_container_root_context</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>
      ip route del default;
      ip route add default via </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gw'>gw</span><span class='embexpr_end'>}</span><span class='tstring_content'> dev eth0
    </span><span class='tstring_end'>}</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_ro_permission-instance_method">
  
    - (<tt>Object</tt>) <strong>set_ro_permission</strong>(*paths) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


319
320
321
322</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 319</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_ro_permission'>set_ro_permission</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_oo_chown'>oo_chown</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gid'>gid</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_set_mcs_label'>set_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@mcs_label</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_ro_permission_R-instance_method">
  
    - (<tt>Object</tt>) <strong>set_ro_permission_R</strong>(*paths) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


314
315
316
317</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 314</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_ro_permission_R'>set_ro_permission_R</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_oo_chown_R'>oo_chown_R</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gid'>gid</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_set_mcs_label_R'>set_mcs_label_R</span><span class='lparen'>(</span><span class='ivar'>@mcs_label</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_rw_permission-instance_method">
  
    - (<tt>Object</tt>) <strong>set_rw_permission</strong>(*paths) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 329</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_rw_permission'>set_rw_permission</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_oo_chown'>oo_chown</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gid'>gid</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_set_mcs_label'>set_mcs_label</span><span class='lparen'>(</span><span class='ivar'>@mcs_label</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_rw_permission_R-instance_method">
  
    - (<tt>Object</tt>) <strong>set_rw_permission_R</strong>(*paths) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326
327</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 324</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_rw_permission_R'>set_rw_permission_R</span><span class='lparen'>(</span><span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='const'>PathUtils</span><span class='period'>.</span><span class='id identifier rubyid_oo_chown_R'>oo_chown_R</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_gid'>gid</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>SELinux</span><span class='period'>.</span><span class='id identifier rubyid_set_mcs_label_R'>set_mcs_label_R</span><span class='lparen'>(</span><span class='ivar'>@mcs_label</span><span class='comma'>,</span> <span class='id identifier rubyid_paths'>paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-instance_method">
  
    - (<tt>Object</tt>) <strong>start</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
  <span class='id identifier rubyid_restore_cgroups'>restore_cgroups</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    - (<tt>Object</tt>) <strong>stop</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: Kill all processes for a given gear</p>

<p>Kill all processes owned by the uid or uuid. No reason for graceful
shutdown first, the directories and user are going</p>

<pre class="code ruby"><code class="ruby">to be removed from the system.</code></pre>

<p>Examples: kill_gear_procs</p>

<pre class="ruby">=<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-identifier">pkill</span> <span class="ruby-operator">-</span><span class="ruby-identifier">u</span> <span class="ruby-identifier">id</span>
</pre>

<p>Raises exception on error.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_kill_procs'>kill_procs</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_cgroups-instance_method">
  
    - (<tt>Object</tt>) <strong>stop_cgroups</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 239</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_cgroups'>stop_cgroups</span>
  <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unfreeze_cgroups-instance_method">
  
    - (<tt>Object</tt>) <strong>unfreeze_cgroups</strong>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>release resources (cgroups thaw), this causes Zombies to get killed</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


360
361
362
363
364
365</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/plugins/container/selinux/lib/openshift/runtime/containerization/selinux_container.rb', line 360</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unfreeze_cgroups'>unfreeze_cgroups</span>
  <span class='kw'>begin</span>
    <span class='op'>::</span><span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>Runtime</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Cgroups</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_thaw'>thaw</span>
  <span class='kw'>rescue</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Aug 13 22:06:14 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>