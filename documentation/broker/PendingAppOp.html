<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: PendingAppOp
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (P)</a> &raquo;
    
    
    <span class="title">PendingAppOp</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: PendingAppOp
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">PendingAppOp</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Mongoid::Document</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/home/fedora/origin-server/controller/app/models/pending_app_op.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Class to represent pending operations that need to occur for the
<span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="AddAliasOp.html" title="AddAliasOp (class)">AddAliasOp</a></span>, <span class='object_link'><a href="AddBrokerAuthKeyOp.html" title="AddBrokerAuthKeyOp (class)">AddBrokerAuthKeyOp</a></span>, <span class='object_link'><a href="AddCompOp.html" title="AddCompOp (class)">AddCompOp</a></span>, <span class='object_link'><a href="AddSslCertOp.html" title="AddSslCertOp (class)">AddSslCertOp</a></span>, <span class='object_link'><a href="CreateGearOp.html" title="CreateGearOp (class)">CreateGearOp</a></span>, <span class='object_link'><a href="CreateGroupInstanceOp.html" title="CreateGroupInstanceOp (class)">CreateGroupInstanceOp</a></span>, <span class='object_link'><a href="DeleteCompOp.html" title="DeleteCompOp (class)">DeleteCompOp</a></span>, <span class='object_link'><a href="DeleteGearOp.html" title="DeleteGearOp (class)">DeleteGearOp</a></span>, <span class='object_link'><a href="DeleteGroupInstanceOp.html" title="DeleteGroupInstanceOp (class)">DeleteGroupInstanceOp</a></span>, <span class='object_link'><a href="DeregisterDnsOp.html" title="DeregisterDnsOp (class)">DeregisterDnsOp</a></span>, <span class='object_link'><a href="DestroyGearOp.html" title="DestroyGearOp (class)">DestroyGearOp</a></span>, <span class='object_link'><a href="ExecuteConnectionsOp.html" title="ExecuteConnectionsOp (class)">ExecuteConnectionsOp</a></span>, <span class='object_link'><a href="ExposePortOp.html" title="ExposePortOp (class)">ExposePortOp</a></span>, <span class='object_link'><a href="InitGearOp.html" title="InitGearOp (class)">InitGearOp</a></span>, <span class='object_link'><a href="NewCompOp.html" title="NewCompOp (class)">NewCompOp</a></span>, <span class='object_link'><a href="NotifyAppCreateOp.html" title="NotifyAppCreateOp (class)">NotifyAppCreateOp</a></span>, <span class='object_link'><a href="NotifyAppDeleteOp.html" title="NotifyAppDeleteOp (class)">NotifyAppDeleteOp</a></span>, <span class='object_link'><a href="PatchUserEnvVarsOp.html" title="PatchUserEnvVarsOp (class)">PatchUserEnvVarsOp</a></span>, <span class='object_link'><a href="PostConfigureCompOp.html" title="PostConfigureCompOp (class)">PostConfigureCompOp</a></span>, <span class='object_link'><a href="PublishRoutingInfoOp.html" title="PublishRoutingInfoOp (class)">PublishRoutingInfoOp</a></span>, <span class='object_link'><a href="RegisterDnsOp.html" title="RegisterDnsOp (class)">RegisterDnsOp</a></span>, <span class='object_link'><a href="RegisterRoutingDnsOp.html" title="RegisterRoutingDnsOp (class)">RegisterRoutingDnsOp</a></span>, <span class='object_link'><a href="ReloadCompConfigOp.html" title="ReloadCompConfigOp (class)">ReloadCompConfigOp</a></span>, <span class='object_link'><a href="RemoveAliasOp.html" title="RemoveAliasOp (class)">RemoveAliasOp</a></span>, <span class='object_link'><a href="RemoveBrokerAuthKeyOp.html" title="RemoveBrokerAuthKeyOp (class)">RemoveBrokerAuthKeyOp</a></span>, <span class='object_link'><a href="RemoveCompOp.html" title="RemoveCompOp (class)">RemoveCompOp</a></span>, <span class='object_link'><a href="RemoveSslCertOp.html" title="RemoveSslCertOp (class)">RemoveSslCertOp</a></span>, <span class='object_link'><a href="ReplaceAllSshKeysOp.html" title="ReplaceAllSshKeysOp (class)">ReplaceAllSshKeysOp</a></span>, <span class='object_link'><a href="ReserveGearUidOp.html" title="ReserveGearUidOp (class)">ReserveGearUidOp</a></span>, <span class='object_link'><a href="RestartCompOp.html" title="RestartCompOp (class)">RestartCompOp</a></span>, <span class='object_link'><a href="SetAddtlFsGbOp.html" title="SetAddtlFsGbOp (class)">SetAddtlFsGbOp</a></span>, <span class='object_link'><a href="SetGroupOverridesOp.html" title="SetGroupOverridesOp (class)">SetGroupOverridesOp</a></span>, <span class='object_link'><a href="StartCompOp.html" title="StartCompOp (class)">StartCompOp</a></span>, <span class='object_link'><a href="StopCompOp.html" title="StopCompOp (class)">StopCompOp</a></span>, <span class='object_link'><a href="TidyCompOp.html" title="TidyCompOp (class)">TidyCompOp</a></span>, <span class='object_link'><a href="TrackUsageOp.html" title="TrackUsageOp (class)">TrackUsageOp</a></span>, <span class='object_link'><a href="UnreserveGearUidOp.html" title="UnreserveGearUidOp (class)">UnreserveGearUidOp</a></span>, <span class='object_link'><a href="UnsubscribeConnectionsOp.html" title="UnsubscribeConnectionsOp (class)">UnsubscribeConnectionsOp</a></span>, <span class='object_link'><a href="UpdateAppConfigOp.html" title="UpdateAppConfigOp (class)">UpdateAppConfigOp</a></span></p>
</div>




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#application-instance_method" title="#application (instance method)">- (Application) <strong>application</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p><span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span> that this operation needs to be performed on.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#arguments-instance_method" title="#arguments (instance method)">- (Hash) <strong>arguments</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Arguments hash.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#op_type-instance_method" title="#op_type (instance method)">- (Symbol) <strong>op_type</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Operation type.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#retry_count-instance_method" title="#retry_count (instance method)">- (Integer) <strong>retry_count</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Number of times this operation has been attempted.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#state-instance_method" title="#state (instance method)">- (Symbol) <strong>state</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Operation state.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#addParallelExecuteJob-instance_method" title="#addParallelExecuteJob (instance method)">- (Object) <strong>addParallelExecuteJob</strong>(handle) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#addParallelRollbackJob-instance_method" title="#addParallelRollbackJob (instance method)">- (Object) <strong>addParallelRollbackJob</strong>(handle) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#completed-instance_method" title="#completed (instance method)">- (Object) <strong>completed</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Marks the operation as completed on the parent operation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">- (Object) <strong>execute</strong>(skip_node_ops = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>this method needs to be implemented by the subclass.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_component_instance-instance_method" title="#get_component_instance (instance method)">- (Object) <strong>get_component_instance</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_gear-instance_method" title="#get_gear (instance method)">- (Object) <strong>get_gear</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_group_instance-instance_method" title="#get_group_instance (instance method)">- (Object) <strong>get_group_instance</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#isParallelExecutable-instance_method" title="#isParallelExecutable (instance method)">- (Object) <strong>isParallelExecutable</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parent_op-instance_method" title="#parent_op (instance method)">- (PendingDomainOps) <strong>parent_op</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Domain level operation that spawned this operation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parent_op%3D-instance_method" title="#parent_op= (instance method)">- (Object) <strong>parent_op=</strong>(op) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the [PendingDomainOps] Domain level operation that spawned this
operation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prereq-instance_method" title="#prereq (instance method)">- (Object) <strong>prereq</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rollback-instance_method" title="#rollback (instance method)">- (Object) <strong>rollback</strong>(skip_node_ops = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>this method needs to be implemented by the subclass.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_state-instance_method" title="#set_state (instance method)">- (Object) <strong>set_state</strong>(new_state) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>the new_state needs to be a symbol.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_with_retries-instance_method" title="#update_with_retries (instance method)">- (Object) <strong>update_with_retries</strong>(num_retries, failure_message, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="application-instance_method">
  
    - (<tt><span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span></tt>) <strong>application</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p><span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span> that this operation needs to be performed on.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p><span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span> that this operation needs to be performed on.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 12</span>

<span class='kw'>class</span> <span class='const'>PendingAppOp</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:pending_app_op_group</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PendingAppOpGroup</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:state</span><span class='comma'>,</span>             <span class='label'>type:</span> <span class='const'>Symbol</span><span class='comma'>,</span>   <span class='label'>default:</span> <span class='symbol'>:init</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:prereq</span><span class='comma'>,</span>            <span class='label'>type:</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_count</span><span class='comma'>,</span>       <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span>  <span class='label'>default:</span> <span class='int'>0</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_rollback_op</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Moped</span><span class='op'>::</span><span class='const'>BSON</span><span class='op'>::</span><span class='const'>ObjectId</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_prereq'>prereq</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prereq</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Sets the [PendingDomainOps] Domain level operation that spawned this operation.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># op::
</span>  <span class='comment'>#   The {PendingDomainOps} object.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op='>parent_op=</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [PendingDomainOps] Domain level operation that spawned this operation.  
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op'>parent_op</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># Marks the operation as completed on the parent operation.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_completed'>completed</span>
    <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:completed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parent_op'>parent_op</span><span class='period'>.</span><span class='id identifier rubyid_child_completed'>child_completed</span><span class='lparen'>(</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Execution not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_isParallelExecutable'>isParallelExecutable</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelExecuteJob'>addParallelExecuteJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel execute not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelRollbackJob'>addParallelRollbackJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  
  <span class='comment'># the new_state needs to be a symbol
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='id identifier rubyid_new_state'>new_state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set pending_op </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> state to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_state'>new_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_op'>updated_op</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.state</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_state'>new_state</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># set the state in the object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_op'>updated_op</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='rparen'>)</span>

      <span class='comment'># the op needs to be reloaded to find the updated index
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_op'>current_op</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance_id'>group_instance_id</span><span class='rparen'>)</span> 
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_gear'>get_gear</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_id'>gear_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_component_instance'>get_component_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span>
      <span class='id identifier rubyid_comp_name'>comp_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comp</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cart_name'>cart_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cart</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_component_instances'>component_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>cartridge_name:</span> <span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='label'>component_name:</span> <span class='id identifier rubyid_comp_name'>comp_name</span><span class='comma'>,</span> <span class='label'>group_instance_id:</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="arguments-instance_method">
  
    - (<tt><span class='object_link'><a href="Hash.html" title="Hash (class)">Hash</a></span></tt>) <strong>arguments</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Arguments hash</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Arguments hash</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 12</span>

<span class='kw'>class</span> <span class='const'>PendingAppOp</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:pending_app_op_group</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PendingAppOpGroup</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:state</span><span class='comma'>,</span>             <span class='label'>type:</span> <span class='const'>Symbol</span><span class='comma'>,</span>   <span class='label'>default:</span> <span class='symbol'>:init</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:prereq</span><span class='comma'>,</span>            <span class='label'>type:</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_count</span><span class='comma'>,</span>       <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span>  <span class='label'>default:</span> <span class='int'>0</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_rollback_op</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Moped</span><span class='op'>::</span><span class='const'>BSON</span><span class='op'>::</span><span class='const'>ObjectId</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_prereq'>prereq</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prereq</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Sets the [PendingDomainOps] Domain level operation that spawned this operation.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># op::
</span>  <span class='comment'>#   The {PendingDomainOps} object.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op='>parent_op=</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [PendingDomainOps] Domain level operation that spawned this operation.  
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op'>parent_op</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># Marks the operation as completed on the parent operation.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_completed'>completed</span>
    <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:completed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parent_op'>parent_op</span><span class='period'>.</span><span class='id identifier rubyid_child_completed'>child_completed</span><span class='lparen'>(</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Execution not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_isParallelExecutable'>isParallelExecutable</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelExecuteJob'>addParallelExecuteJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel execute not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelRollbackJob'>addParallelRollbackJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  
  <span class='comment'># the new_state needs to be a symbol
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='id identifier rubyid_new_state'>new_state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set pending_op </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> state to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_state'>new_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_op'>updated_op</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.state</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_state'>new_state</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># set the state in the object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_op'>updated_op</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='rparen'>)</span>

      <span class='comment'># the op needs to be reloaded to find the updated index
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_op'>current_op</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance_id'>group_instance_id</span><span class='rparen'>)</span> 
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_gear'>get_gear</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_id'>gear_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_component_instance'>get_component_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span>
      <span class='id identifier rubyid_comp_name'>comp_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comp</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cart_name'>cart_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cart</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_component_instances'>component_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>cartridge_name:</span> <span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='label'>component_name:</span> <span class='id identifier rubyid_comp_name'>comp_name</span><span class='comma'>,</span> <span class='label'>group_instance_id:</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="op_type-instance_method">
  
    - (<tt>Symbol</tt>) <strong>op_type</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Operation type</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Operation type</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 12</span>

<span class='kw'>class</span> <span class='const'>PendingAppOp</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:pending_app_op_group</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PendingAppOpGroup</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:state</span><span class='comma'>,</span>             <span class='label'>type:</span> <span class='const'>Symbol</span><span class='comma'>,</span>   <span class='label'>default:</span> <span class='symbol'>:init</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:prereq</span><span class='comma'>,</span>            <span class='label'>type:</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_count</span><span class='comma'>,</span>       <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span>  <span class='label'>default:</span> <span class='int'>0</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_rollback_op</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Moped</span><span class='op'>::</span><span class='const'>BSON</span><span class='op'>::</span><span class='const'>ObjectId</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_prereq'>prereq</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prereq</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Sets the [PendingDomainOps] Domain level operation that spawned this operation.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># op::
</span>  <span class='comment'>#   The {PendingDomainOps} object.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op='>parent_op=</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [PendingDomainOps] Domain level operation that spawned this operation.  
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op'>parent_op</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># Marks the operation as completed on the parent operation.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_completed'>completed</span>
    <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:completed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parent_op'>parent_op</span><span class='period'>.</span><span class='id identifier rubyid_child_completed'>child_completed</span><span class='lparen'>(</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Execution not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_isParallelExecutable'>isParallelExecutable</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelExecuteJob'>addParallelExecuteJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel execute not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelRollbackJob'>addParallelRollbackJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  
  <span class='comment'># the new_state needs to be a symbol
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='id identifier rubyid_new_state'>new_state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set pending_op </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> state to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_state'>new_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_op'>updated_op</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.state</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_state'>new_state</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># set the state in the object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_op'>updated_op</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='rparen'>)</span>

      <span class='comment'># the op needs to be reloaded to find the updated index
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_op'>current_op</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance_id'>group_instance_id</span><span class='rparen'>)</span> 
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_gear'>get_gear</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_id'>gear_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_component_instance'>get_component_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span>
      <span class='id identifier rubyid_comp_name'>comp_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comp</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cart_name'>cart_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cart</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_component_instances'>component_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>cartridge_name:</span> <span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='label'>component_name:</span> <span class='id identifier rubyid_comp_name'>comp_name</span><span class='comma'>,</span> <span class='label'>group_instance_id:</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="retry_count-instance_method">
  
    - (<tt>Integer</tt>) <strong>retry_count</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Number of times this operation has been attempted</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Number of times this operation has been attempted</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 12</span>

<span class='kw'>class</span> <span class='const'>PendingAppOp</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:pending_app_op_group</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PendingAppOpGroup</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:state</span><span class='comma'>,</span>             <span class='label'>type:</span> <span class='const'>Symbol</span><span class='comma'>,</span>   <span class='label'>default:</span> <span class='symbol'>:init</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:prereq</span><span class='comma'>,</span>            <span class='label'>type:</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_count</span><span class='comma'>,</span>       <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span>  <span class='label'>default:</span> <span class='int'>0</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_rollback_op</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Moped</span><span class='op'>::</span><span class='const'>BSON</span><span class='op'>::</span><span class='const'>ObjectId</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_prereq'>prereq</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prereq</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Sets the [PendingDomainOps] Domain level operation that spawned this operation.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># op::
</span>  <span class='comment'>#   The {PendingDomainOps} object.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op='>parent_op=</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [PendingDomainOps] Domain level operation that spawned this operation.  
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op'>parent_op</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># Marks the operation as completed on the parent operation.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_completed'>completed</span>
    <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:completed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parent_op'>parent_op</span><span class='period'>.</span><span class='id identifier rubyid_child_completed'>child_completed</span><span class='lparen'>(</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Execution not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_isParallelExecutable'>isParallelExecutable</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelExecuteJob'>addParallelExecuteJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel execute not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelRollbackJob'>addParallelRollbackJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  
  <span class='comment'># the new_state needs to be a symbol
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='id identifier rubyid_new_state'>new_state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set pending_op </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> state to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_state'>new_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_op'>updated_op</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.state</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_state'>new_state</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># set the state in the object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_op'>updated_op</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='rparen'>)</span>

      <span class='comment'># the op needs to be reloaded to find the updated index
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_op'>current_op</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance_id'>group_instance_id</span><span class='rparen'>)</span> 
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_gear'>get_gear</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_id'>gear_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_component_instance'>get_component_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span>
      <span class='id identifier rubyid_comp_name'>comp_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comp</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cart_name'>cart_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cart</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_component_instances'>component_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>cartridge_name:</span> <span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='label'>component_name:</span> <span class='id identifier rubyid_comp_name'>comp_name</span><span class='comma'>,</span> <span class='label'>group_instance_id:</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="state-instance_method">
  
    - (<tt>Symbol</tt>) <strong>state</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Operation state. One of init, queued or completed</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Operation state. One of init, queued or completed</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 12</span>

<span class='kw'>class</span> <span class='const'>PendingAppOp</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:pending_app_op_group</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PendingAppOpGroup</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:state</span><span class='comma'>,</span>             <span class='label'>type:</span> <span class='const'>Symbol</span><span class='comma'>,</span>   <span class='label'>default:</span> <span class='symbol'>:init</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:prereq</span><span class='comma'>,</span>            <span class='label'>type:</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_count</span><span class='comma'>,</span>       <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span>  <span class='label'>default:</span> <span class='int'>0</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:retry_rollback_op</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Moped</span><span class='op'>::</span><span class='const'>BSON</span><span class='op'>::</span><span class='const'>ObjectId</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_prereq'>prereq</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prereq</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Sets the [PendingDomainOps] Domain level operation that spawned this operation.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># op::
</span>  <span class='comment'>#   The {PendingDomainOps} object.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op='>parent_op=</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [PendingDomainOps] Domain level operation that spawned this operation.  
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parent_op'>parent_op</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># Marks the operation as completed on the parent operation.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_completed'>completed</span>
    <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:completed</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parent_op'>parent_op</span><span class='period'>.</span><span class='id identifier rubyid_child_completed'>child_completed</span><span class='lparen'>(</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Execution not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># this method needs to be implemented by the subclass
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_isParallelExecutable'>isParallelExecutable</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelExecuteJob'>addParallelExecuteJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel execute not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_addParallelRollbackJob'>addParallelRollbackJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  
  <span class='comment'># the new_state needs to be a symbol
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='id identifier rubyid_new_state'>new_state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set pending_op </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> state to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_state'>new_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_op'>updated_op</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.state</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_state'>new_state</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># set the state in the object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_op'>updated_op</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='rparen'>)</span>

      <span class='comment'># the op needs to be reloaded to find the updated index
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_op'>current_op</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance_id'>group_instance_id</span><span class='rparen'>)</span> 
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_gear'>get_gear</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_id'>gear_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_get_component_instance'>get_component_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span>
      <span class='id identifier rubyid_comp_name'>comp_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comp</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cart_name'>cart_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cart</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_component_instances'>component_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>cartridge_name:</span> <span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='label'>component_name:</span> <span class='id identifier rubyid_comp_name'>comp_name</span><span class='comma'>,</span> <span class='label'>group_instance_id:</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="addParallelExecuteJob-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>addParallelExecuteJob</strong>(handle) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 58</span>

<span class='kw'>def</span> <span class='id identifier rubyid_addParallelExecuteJob'>addParallelExecuteJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel execute not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="addParallelRollbackJob-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>addParallelRollbackJob</strong>(handle) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_addParallelRollbackJob'>addParallelRollbackJob</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="completed-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>completed</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Marks the operation as completed on the parent operation.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_completed'>completed</span>
  <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:completed</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_parent_op'>parent_op</span><span class='period'>.</span><span class='id identifier rubyid_child_completed'>child_completed</span><span class='lparen'>(</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>execute</strong>(skip_node_ops = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>this method needs to be implemented by the subclass</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Execution not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_component_instance-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_component_instance</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 124</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_component_instance'>get_component_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span>
    <span class='id identifier rubyid_comp_name'>comp_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comp</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_cart_name'>cart_name</span> <span class='op'>=</span> <span class='id identifier rubyid_comp_spec'>comp_spec</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cart</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_component_instance'>component_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_component_instances'>component_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>cartridge_name:</span> <span class='id identifier rubyid_cart_name'>cart_name</span><span class='comma'>,</span> <span class='label'>component_name:</span> <span class='id identifier rubyid_comp_name'>comp_name</span><span class='comma'>,</span> <span class='label'>group_instance_id:</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_component_instance'>component_instance</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_gear-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_gear</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_gear'>get_gear</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_id'>gear_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_group_instance-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_group_instance</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_group_instance'>get_group_instance</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance_id'>group_instance_id</span><span class='rparen'>)</span> 
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="isParallelExecutable-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>isParallelExecutable</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 54</span>

<span class='kw'>def</span> <span class='id identifier rubyid_isParallelExecutable'>isParallelExecutable</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parent_op-instance_method">
  
    - (<tt><span class='object_link'><a href="PendingDomainOps.html" title="PendingDomainOps (class)">PendingDomainOps</a></span></tt>) <strong>parent_op</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Domain level operation that spawned this operation.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="PendingDomainOps.html" title="PendingDomainOps (class)">PendingDomainOps</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Domain level operation that spawned this operation.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 34</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parent_op'>parent_op</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parent_op_id'>parent_op_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parent_op=-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>parent_op=</strong>(op) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the [PendingDomainOps] Domain level operation that spawned this
operation.</p>

<h2 id="label-Parameters%3A">Parameters:<span><a href="#label-Parameters%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<dl class="rdoc-list note-list"><dt>op
<dd>
<p>The <span class='object_link'><a href="PendingDomainOps.html" title="PendingDomainOps (class)">PendingDomainOps</a></span> object.</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parent_op='>parent_op=</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_op_id'>parent_op_id</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prereq-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>prereq</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prereq'>prereq</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prereq</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rollback-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>rollback</strong>(skip_node_ops = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>this method needs to be implemented by the subclass</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_node_ops'>skip_node_ops</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rollback not implemented: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_state-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_state</strong>(new_state) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>the new_state needs to be a symbol</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 68</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='id identifier rubyid_new_state'>new_state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set pending_op </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> state to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_state'>new_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_updated_op'>updated_op</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='op'>|</span>
    <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending_op_groups.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.pending_ops.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_op_index'>op_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.state</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_state'>new_state</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='comment'># set the state in the object in mongoid memory for access by the caller
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_op'>updated_op</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_with_retries-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>update_with_retries</strong>(num_retries, failure_message, &amp;block) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/pending_app_op.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span>
  <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pending_app_op_group'>pending_app_op_group</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

  <span class='comment'># find the index and do an atomic update
</span>  <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>

  <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='comma'>,</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='comma'>,</span> <span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='comma'>,</span> <span class='id identifier rubyid_op_index'>op_index</span><span class='rparen'>)</span>

    <span class='comment'># the op needs to be reloaded to find the updated index
</span>    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_current_op_group'>current_op_group</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_op_group_index'>op_group_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op_group'>current_op_group</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_current_op'>current_op</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_op'>current_op</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_op_index'>op_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_pending_op_groups'>pending_op_groups</span><span class='lbracket'>[</span><span class='id identifier rubyid_op_group_index'>op_group_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pending_ops'>pending_ops</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_op'>current_op</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># log the details in case we cannot update the pending_op
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='kw'>return</span> <span class='id identifier rubyid_current_op'>current_op</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Sep 27 22:06:27 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>