<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Admin::Suggestion::Advisor::Capacity::Remove
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../../';
  framesUrl = "../../../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../../Admin.html" title="Admin (module)">Admin</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../Suggestion.html" title="Admin::Suggestion (module)">Suggestion</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Advisor.html" title="Admin::Suggestion::Advisor (class)">Advisor</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Capacity.html" title="Admin::Suggestion::Advisor::Capacity (module)">Capacity</a></span></span>
     &raquo; 
    <span class="title">Remove</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Admin::Suggestion::Advisor::Capacity::Remove
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Advisor.html" title="Admin::Suggestion::Advisor (class)">Admin::Suggestion::Advisor</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="../../Advisor.html" title="Admin::Suggestion::Advisor (class)">Admin::Suggestion::Advisor</a></span></li>
          
            <li class="next">Admin::Suggestion::Advisor::Capacity::Remove</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
      <dt class="r2">Extended by:</dt>
      <dd class="r2"><span class='object_link'><a href="Util.html" title="Admin::Suggestion::Advisor::Capacity::Util (module)">Util</a></span></dd>
      
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/home/fedora/origin-server/controller/app/models/admin/suggestion/advisor/capacity.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>too much capacity, recommend removing at least one node</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compact_districts-class_method" title="compact_districts (class method)">+ (Object) <strong>compact_districts</strong>(params, stats) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#query-class_method" title="query (class method)">+ (Object) <strong>query</strong>(params, stats, current_suggestions) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_nodes_from_profile-class_method" title="remove_nodes_from_profile (class method)">+ (Object) <strong>remove_nodes_from_profile</strong>(params, psum) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#test_instances-class_method" title="test_instances (class method)">+ (Object) <strong>test_instances</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Util.html" title="Admin::Suggestion::Advisor::Capacity::Util (module)">Util</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Util.html#adjusted_active_pct-instance_method" title="Admin::Suggestion::Advisor::Capacity::Util#adjusted_active_pct (method)">adjusted_active_pct</a></span>, <span class='object_link'><a href="Util.html#node_capacity_in_profile-instance_method" title="Admin::Suggestion::Advisor::Capacity::Util#node_capacity_in_profile (method)">node_capacity_in_profile</a></span>, <span class='object_link'><a href="Util.html#nodes_district_can_accept-instance_method" title="Admin::Suggestion::Advisor::Capacity::Util#nodes_district_can_accept (method)">nodes_district_can_accept</a></span>, <span class='object_link'><a href="Util.html#suggested_nodes_per_district-instance_method" title="Admin::Suggestion::Advisor::Capacity::Util#suggested_nodes_per_district (method)">suggested_nodes_per_district</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../../Advisor.html" title="Admin::Suggestion::Advisor (class)">Admin::Suggestion::Advisor</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Advisor.html#subclass_test_instances-class_method" title="Admin::Suggestion::Advisor.subclass_test_instances (method)">subclass_test_instances</a></span>, <span class='object_link'><a href="../../Advisor.html#test_profile-class_method" title="Admin::Suggestion::Advisor.test_profile (method)">test_profile</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Logger.html" title="Admin::Suggestion::Logger (module)">Logger</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Logger.html#log_debug-instance_method" title="Admin::Suggestion::Logger#log_debug (method)">#log_debug</a></span>, <span class='object_link'><a href="../../Logger.html#log_error-instance_method" title="Admin::Suggestion::Logger#log_error (method)">#log_error</a></span>, <span class='object_link'><a href="../../Logger.html#log_info-instance_method" title="Admin::Suggestion::Logger#log_info (method)">#log_info</a></span>, <span class='object_link'><a href="../../Logger.html#log_warn-instance_method" title="Admin::Suggestion::Logger#log_warn (method)">#log_warn</a></span></p>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="compact_districts-class_method">
  
    + (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>compact_districts</strong>(params, stats) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/admin/suggestion/advisor/capacity.rb', line 258</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_compact_districts'>compact_districts</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_compact_district'>compact_district</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_stats'>stats</span><span class='period'>.</span><span class='id identifier rubyid_district_summaries'>district_summaries</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dsum'>dsum</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_missing_nodes'>missing_nodes</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='comment'># missing nodes throw off calculations
</span>    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_district_capacity'>district_capacity</span> <span class='op'>==</span> <span class='int'>0</span> <span class='comment'># exclude the NONE district
</span>
    <span class='comment'># smallest node in this district; keep in mind they could vary!
</span>    <span class='id identifier rubyid_max_active_gears'>max_active_gears</span> <span class='op'>=</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_nodes'>nodes</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_max_active_gears'>max_active_gears</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span> <span class='op'>||</span> <span class='int'>100</span>
    <span class='comment'># active gear pct in this district
</span>    <span class='id identifier rubyid_active_gear_pct'>active_gear_pct</span> <span class='op'>=</span> <span class='id identifier rubyid_adjusted_active_pct'>adjusted_active_pct</span><span class='lparen'>(</span><span class='id identifier rubyid_dsum'>dsum</span><span class='comma'>,</span> <span class='id identifier rubyid_max_active_gears'>max_active_gears</span><span class='comma'>,</span> <span class='int'>100</span><span class='rparen'>)</span>
    <span class='comment'># how many nodes we should have based on above (being generous)
</span>    <span class='id identifier rubyid_node_target'>node_target</span> <span class='op'>=</span> <span class='id identifier rubyid_suggested_nodes_per_district'>suggested_nodes_per_district</span><span class='lparen'>(</span><span class='id identifier rubyid_max_active_gears'>max_active_gears</span><span class='comma'>,</span>
                                               <span class='id identifier rubyid_active_gear_pct'>active_gear_pct</span><span class='rparen'>)</span>
    <span class='comment'># active capacity that will never be used
</span>    <span class='id identifier rubyid_excess_gears'>excess_gears</span> <span class='op'>=</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_available_active_gears'>available_active_gears</span> <span class='op'>-</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_dist_avail_capacity'>dist_avail_capacity</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_nodes'>nodes</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_node_target'>node_target</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_excess_gears'>excess_gears</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_active_gears'>max_active_gears</span>
      <span class='comment'># compacting is advised; pick out least-used nodes to remove
</span>      <span class='id identifier rubyid_remaining_nodes'>remaining_nodes</span> <span class='op'>=</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_nodes'>nodes</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
      <span class='id identifier rubyid_c_excess_gears'>c_excess_gears</span> <span class='op'>=</span> <span class='id identifier rubyid_excess_gears'>excess_gears</span> <span class='comment'># keep track as nodes removed
</span>      <span class='id identifier rubyid_d_avail_active'>d_avail_active</span> <span class='op'>=</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_available_active_gears'>available_active_gears</span> <span class='comment'># likewise
</span>      <span class='kw'>while</span> <span class='id identifier rubyid_c_excess_gears'>c_excess_gears</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_active_gears'>max_active_gears</span> <span class='op'>&amp;&amp;</span>
            <span class='id identifier rubyid_remaining_nodes'>remaining_nodes</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_node_target'>node_target</span>
        <span class='id identifier rubyid_found_one'>found_one</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_remaining_nodes'>remaining_nodes</span><span class='period'>.</span><span class='id identifier rubyid_sort_by!'>sort_by!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span>
          <span class='comment'># put inactive nodes first in consideration for removal;
</span>          <span class='comment'># then prefer those with the least gears to move
</span>          <span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_district_active'>district_active</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_gears_total_count'>gears_total_count</span> <span class='rbracket'>]</span>
        <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_select!'>select!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span>
          <span class='id identifier rubyid_keep'>keep</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_node_cap'>node_cap</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_max_active_gears'>max_active_gears</span> <span class='op'>-</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_gears_active_count'>gears_active_count</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_d_avail_active'>d_avail_active</span> <span class='op'>-</span> <span class='id identifier rubyid_node_cap'>node_cap</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_gears_active_count'>gears_active_count</span>
            <span class='comment'># active gears on this node won&#39;t overwhelm remaining nodes
</span>            <span class='id identifier rubyid_keep'>keep</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='id identifier rubyid_found_one'>found_one</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='id identifier rubyid_c_excess_gears'>c_excess_gears</span> <span class='op'>-=</span> <span class='id identifier rubyid_node_cap'>node_cap</span>
            <span class='id identifier rubyid_d_avail_active'>d_avail_active</span> <span class='op'>-=</span> <span class='id identifier rubyid_node_cap'>node_cap</span>
            <span class='id identifier rubyid_compact_district'>compact_district</span><span class='lbracket'>[</span><span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>Remove</span><span class='op'>::</span><span class='const'>CompactDistrict</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='label'>profile:</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_profile'>profile</span><span class='comma'>,</span>
              <span class='label'>scope:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>district</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='label'>district_uuid:</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span>
              <span class='label'>district_name:</span> <span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
              <span class='label'>node_names:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
              <span class='label'>max_active_gears:</span> <span class='id identifier rubyid_max_active_gears'>max_active_gears</span><span class='comma'>,</span>
              <span class='label'>active_gear_pct:</span> <span class='id identifier rubyid_active_gear_pct'>active_gear_pct</span><span class='comma'>,</span>
              <span class='label'>node_target:</span> <span class='id identifier rubyid_node_target'>node_target</span><span class='comma'>,</span>
              <span class='label'>excess_gears:</span> <span class='id identifier rubyid_excess_gears'>excess_gears</span><span class='comma'>,</span>
            <span class='rparen'>)</span>
            <span class='id identifier rubyid_compact_district'>compact_district</span><span class='lbracket'>[</span><span class='id identifier rubyid_dsum'>dsum</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_node_names'>node_names</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
            <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_max_active_gears'>max_active_gears</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_c_excess_gears'>c_excess_gears</span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_keep'>keep</span>
        <span class='kw'>end</span>
        <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_found_one'>found_one</span> <span class='comment'># couldn&#39;t reduce any further
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span> <span class='comment'># each district
</span>  <span class='const'>Container</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='op'>+</span> <span class='id identifier rubyid_compact_district'>compact_district</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="query-class_method">
  
    + (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>query</strong>(params, stats, current_suggestions) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244
245
246
247
248
249
250
251
252
253
254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/admin/suggestion/advisor/capacity.rb', line 242</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='id identifier rubyid_current_suggestions'>current_suggestions</span><span class='rparen'>)</span>

  <span class='comment'># suggest compacting districts as needed
</span>  <span class='id identifier rubyid_suggestions'>suggestions</span> <span class='op'>=</span> <span class='id identifier rubyid_compact_districts'>compact_districts</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span><span class='rparen'>)</span>

  <span class='comment'># suggest removing any extra nodes
</span>  <span class='id identifier rubyid_stats'>stats</span><span class='period'>.</span><span class='id identifier rubyid_profile_summaries_hash'>profile_summaries_hash</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_profile'>profile</span><span class='comma'>,</span><span class='id identifier rubyid_summary'>summary</span><span class='op'>|</span>
    <span class='comment'># It is too complex to figure out where to remove nodes in
</span>    <span class='comment'># addition to compacting. So, hold off if compaction is
</span>    <span class='comment'># already suggested for this profile.
</span>    <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_suggestions'>suggestions</span><span class='period'>.</span><span class='id identifier rubyid_for_profile'>for_profile</span><span class='lparen'>(</span><span class='id identifier rubyid_profile'>profile</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_suggestions'>suggestions</span> <span class='op'>+=</span> <span class='id identifier rubyid_remove_nodes_from_profile'>remove_nodes_from_profile</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_summary'>summary</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_suggestions'>suggestions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_nodes_from_profile-class_method">
  
    + (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>remove_nodes_from_profile</strong>(params, psum) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/admin/suggestion/advisor/capacity.rb', line 317</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_remove_nodes_from_profile'>remove_nodes_from_profile</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_psum'>psum</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_down'>down</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_gear_down_threshold'>gear_down_threshold</span><span class='lparen'>(</span><span class='id identifier rubyid_psum'>psum</span><span class='period'>.</span><span class='id identifier rubyid_profile'>profile</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_avail'>avail</span> <span class='op'>=</span> <span class='id identifier rubyid_psum'>psum</span><span class='period'>.</span><span class='id identifier rubyid_available_active_gears'>available_active_gears</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_down'>down</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_avail'>avail</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_down'>down</span>
  <span class='comment'># TODO: pick out specific nodes that would be best to remove
</span>  <span class='id identifier rubyid_gears_to_rm'>gears_to_rm</span> <span class='op'>=</span> <span class='id identifier rubyid_avail'>avail</span> <span class='op'>-</span> <span class='id identifier rubyid_down'>down</span>
  <span class='id identifier rubyid_rm'>rm</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>Remove</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='label'>profile:</span> <span class='id identifier rubyid_psum'>psum</span><span class='period'>.</span><span class='id identifier rubyid_profile'>profile</span><span class='comma'>,</span>
              <span class='label'>available_gears:</span> <span class='id identifier rubyid_avail'>avail</span><span class='comma'>,</span>
              <span class='label'>threshold:</span> <span class='id identifier rubyid_down'>down</span><span class='comma'>,</span>
              <span class='label'>max_active_gears:</span> <span class='id identifier rubyid_node_capacity_in_profile'>node_capacity_in_profile</span><span class='lparen'>(</span><span class='id identifier rubyid_psum'>psum</span><span class='rparen'>)</span><span class='comma'>,</span>
              <span class='label'>nodes_to_remove:</span> <span class='int'>0</span><span class='comma'>,</span>
         <span class='rparen'>)</span>
  <span class='id identifier rubyid_rm'>rm</span><span class='period'>.</span><span class='id identifier rubyid_nodes_to_remove'>nodes_to_remove</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='kw'>until</span> <span class='id identifier rubyid_gears_to_rm'>gears_to_rm</span> <span class='op'>&lt;=</span>
                                <span class='id identifier rubyid_rm'>rm</span><span class='period'>.</span><span class='id identifier rubyid_max_active_gears'>max_active_gears</span> <span class='op'>*</span> <span class='id identifier rubyid_rm'>rm</span><span class='period'>.</span><span class='id identifier rubyid_nodes_to_remove'>nodes_to_remove</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_rm'>rm</span> <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="test_instances-class_method">
  
    + (<tt><span class='object_link'><a href="../../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>test_instances</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/admin/suggestion/advisor/capacity.rb', line 335</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_test_instances'>test_instances</span>
  <span class='id identifier rubyid_suggestions'>suggestions</span> <span class='op'>=</span> <span class='const'>Container</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_suggestions'>suggestions</span> <span class='op'>&lt;&lt;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>Remove</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='label'>profile:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_test_profile'>test_profile</span><span class='comma'>,</span>
              <span class='label'>available_gears:</span> <span class='int'>1000</span><span class='comma'>,</span>
              <span class='label'>threshold:</span> <span class='int'>900</span><span class='comma'>,</span>
              <span class='label'>max_active_gears:</span> <span class='int'>50</span><span class='comma'>,</span>
              <span class='label'>nodes_to_remove:</span> <span class='int'>2</span><span class='comma'>,</span>
         <span class='rparen'>)</span>
  <span class='id identifier rubyid_suggestions'>suggestions</span> <span class='op'>&lt;&lt;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>Remove</span><span class='op'>::</span><span class='const'>CompactDistrict</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='label'>profile:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_test_profile'>test_profile</span><span class='comma'>,</span>
              <span class='label'>scope:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>district</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='label'>district_uuid:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test_district_uuid</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='label'>district_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test_district</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='label'>node_names:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>remove.example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>remove2.example.com</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
              <span class='label'>max_active_gears:</span> <span class='int'>100</span><span class='comma'>,</span>
              <span class='label'>active_gear_pct:</span> <span class='int'>10</span><span class='comma'>,</span>
              <span class='label'>node_target:</span> <span class='int'>6</span><span class='comma'>,</span>
              <span class='label'>excess_gears:</span> <span class='int'>200</span><span class='comma'>,</span>
            <span class='rparen'>)</span>
  <span class='id identifier rubyid_suggestions'>suggestions</span> <span class='op'>&lt;&lt;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>Remove</span><span class='op'>::</span><span class='const'>CompactDistrict</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
              <span class='label'>profile:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_test_profile'>test_profile</span><span class='comma'>,</span>
              <span class='label'>scope:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>district</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='label'>district_uuid:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test_district_uuid</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='label'>district_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test_district</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
              <span class='label'>node_names:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>remove.example.com</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
              <span class='label'>max_active_gears:</span> <span class='int'>100</span><span class='comma'>,</span>
              <span class='label'>active_gear_pct:</span> <span class='int'>10</span><span class='comma'>,</span>
              <span class='label'>node_target:</span> <span class='int'>6</span><span class='comma'>,</span>
              <span class='label'>excess_gears:</span> <span class='int'>200</span><span class='comma'>,</span>
            <span class='rparen'>)</span>
  <span class='id identifier rubyid_suggestions'>suggestions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Sep 23 22:05:39 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>