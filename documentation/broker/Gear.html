<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Gear
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (G)</a> &raquo;
    
    
    <span class="title">Gear</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Gear
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Gear</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Mongoid::Document</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/home/fedora/origin-server/controller/app/models/gear.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Represents a gear created on an OpenShift Origin Node.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#group_instance-instance_method" title="#group_instance (instance method)">- (GroupInstance) <strong>group_instance</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The <span class='object_link'><a href="GroupInstance.html" title="GroupInstance (class)">GroupInstance</a></span> that this gear is part of.</p>
</div></span>
  
</li>

    
      <li class="public deprecated">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">- (String) <strong>name</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  <span class="deprecated note title">deprecated</span>
  

  
    <span class="summary_desc"><strong>Deprecated.</strong> <div class='inline'>
<p>Will be removed once typeless gears is completed</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#server_identity-instance_method" title="#server_identity (instance method)">- (String) <strong>server_identity</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>DNS name of the node the gear is hosted on.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#uid-instance_method" title="#uid (instance method)">- (Integer) <strong>uid</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>UID of the user on the node.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#base_file_limit-class_method" title="base_file_limit (class method)">+ (Object) <strong>base_file_limit</strong>(gear_size) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#base_filesystem_gb-class_method" title="base_filesystem_gb (class method)">+ (Object) <strong>base_filesystem_gb</strong>(gear_size) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gear_sizes_display_string-class_method" title="gear_sizes_display_string (class method)">+ (Object) <strong>gear_sizes_display_string</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_gear_states-class_method" title="get_gear_states (class method)">+ (Object) <strong>get_gear_states</strong>(gears) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a set of gears, retrieve the state of the gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_gear_size%3F-class_method" title="valid_gear_size? (class method)">+ (Boolean) <strong>valid_gear_size?</strong>(gear_size) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_component-instance_method" title="#add_component (instance method)">- (Object) <strong>add_component</strong>(component, init_git_url = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Installs the specified component on the gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#app-instance_method" title="#app (instance method)">- (Object) <strong>app</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convenience method to get the <span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_gear-instance_method" title="#create_gear (instance method)">- (Object) <strong>create_gear</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deregister_dns-instance_method" title="#deregister_dns (instance method)">- (Object) <strong>deregister_dns</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy_gear-instance_method" title="#destroy_gear (instance method)">- (Object) <strong>destroy_gear</strong>(keep_uid = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_proxy-instance_method" title="#get_proxy (instance method)">- (Object) <strong>get_proxy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the instance of <span class='object_link'><a href="OpenShift/ApplicationContainerProxy.html" title="OpenShift::ApplicationContainerProxy (class)">OpenShift::ApplicationContainerProxy</a></span> that backs
this gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_public_ip_address-instance_method" title="#get_public_ip_address (instance method)">- (String) <strong>get_public_ip_address</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the public IP address for the Node this gear is hosted on</p>

<h2 id="label-Returns%3A.">Returns:.<span><a href="#label-Returns%3A.">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Gear) <strong>initialize</strong>(attrs = nil, options = nil) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes the gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method_missing-instance_method" title="#method_missing (instance method)">- (Object) <strong>method_missing</strong>(sym, *args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Used for handle methods like start/stop etc.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_configure_component-instance_method" title="#post_configure_component (instance method)">- (Object) <strong>post_configure_component</strong>(component, init_git_url = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Performs the post-configuration steps for the specified component on the
gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#public_hostname-instance_method" title="#public_hostname (instance method)">- (String) <strong>public_hostname</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the public hostname for the Node this gear is hosted on</p>

<h2 id="label-Returns%3A.">Returns:.<span><a href="#label-Returns%3A.">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publish_routing_info-instance_method" title="#publish_routing_info (instance method)">- (Object) <strong>publish_routing_info</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_dns-instance_method" title="#register_dns (instance method)">- (Object) <strong>register_dns</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_component-instance_method" title="#remove_component (instance method)">- (Object) <strong>remove_component</strong>(component) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Uninstalls the specified component from the gear.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reserve_uid-instance_method" title="#reserve_uid (instance method)">- (Object) <strong>reserve_uid</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#respond_to%3F-instance_method" title="#respond_to? (instance method)">- (Boolean) <strong>respond_to?</strong>(sym, include_private = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Used for identify methods like start/stop etc.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#server_identities-instance_method" title="#server_identities (instance method)">- (Object) <strong>server_identities</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_addtl_fs_gb-instance_method" title="#set_addtl_fs_gb (instance method)">- (Object) <strong>set_addtl_fs_gb</strong>(additional_filesystem_gb, remote_job_handle, tag = &quot;addtl-fs-gb&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#status-instance_method" title="#status (instance method)">- (Object) <strong>status</strong>(component_instance) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unreserve_uid-instance_method" title="#unreserve_uid (instance method)">- (Object) <strong>unreserve_uid</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_configuration-instance_method" title="#update_configuration (instance method)">- (Object) <strong>update_configuration</strong>(op, remote_job_handle, tag = &quot;&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_with_retries-instance_method" title="#update_with_retries (instance method)">- (Object) <strong>update_with_retries</strong>(num_retries, failure_message, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Gear (class)">Gear</a></span></tt>) <strong>initialize</strong>(attrs = nil, options = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initializes the gear</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:custom_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:custom_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:group_instance</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:group_instance</span><span class='rparen'>)</span>

  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='op'>=</span> <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_custom_id'>custom_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_app_dns'>app_dns</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>
<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>
  
    <div class="method_details first">
  <h3 class="signature first" id="method_missing-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>method_missing</strong>(sym, *args, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Used for handle methods like start/stop etc. which can be handled
transparently by an <span class='object_link'><a href="OpenShift/ApplicationContainerProxy.html" title="OpenShift::ApplicationContainerProxy (class)">OpenShift::ApplicationContainerProxy</a></span></p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>BasicObject::method_missing</li>
    
      <li><a href="http://www.ruby-doc.org/core-1.9.3/BasicObject.html" target="_parent" title="http://www.ruby-doc.org/core-1.9.3/BasicObject.html">http://www.ruby-doc.org/core-1.9.3/BasicObject.html</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 207</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sym'>sym</span> <span class='op'>=</span> <span class='symbol'>:reload</span> <span class='kw'>if</span> <span class='id identifier rubyid_sym'>sym</span> <span class='op'>==</span> <span class='symbol'>:reload_config</span>
  <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_new_args'>new_args</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="group_instance-instance_method">
  
    - (<tt><span class='object_link'><a href="GroupInstance.html" title="GroupInstance (class)">GroupInstance</a></span></tt>) <strong>group_instance</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The <span class='object_link'><a href="GroupInstance.html" title="GroupInstance (class)">GroupInstance</a></span> that this gear is part of.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="GroupInstance.html" title="GroupInstance (class)">GroupInstance</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The <span class='object_link'><a href="GroupInstance.html" title="GroupInstance (class)">GroupInstance</a></span> that this gear is part of.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 11</span>

<span class='kw'>class</span> <span class='const'>Gear</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:group_instance</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>GroupInstance</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:server_identity</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uuid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:quarantined</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:host_singletons</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:app_dns</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:sparse_carts</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_embeds_many'>embeds_many</span> <span class='symbol'>:port_interfaces</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PortInterface</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

  <span class='comment'># Initializes the gear
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:custom_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:custom_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:group_instance</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:group_instance</span><span class='rparen'>)</span>

    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='op'>=</span> <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_custom_id'>custom_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_app_dns'>app_dns</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_blocks</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_blocks'>get_quota_blocks</span><span class='rparen'>)</span>
      <span class='comment'># calculate the minimum storage in GB - blocks are 1KB each
</span>      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>/</span> <span class='int'>1024</span> <span class='op'>/</span> <span class='int'>1024</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_files</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_files'>get_quota_files</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_gear_sizes_display_string'>gear_sizes_display_string</span>
    <span class='comment'># Ex: (small(default)|medium|large)
</span>    <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='id identifier rubyid_gear_size'>gear_size</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(default)</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>==</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:default_gear_size</span><span class='rbracket'>]</span> 
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> 
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_gear_size?'>valid_gear_size?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reserve_uid'>reserve_uid</span>
    <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_available'>find_available</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_server_identities'>server_identities</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_reserve_uid'>reserve_uid</span>

    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to unset UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create_gear'>create_gear</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_destroy_gear'>destroy_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>
 
  <span class='kw'>def</span> <span class='id identifier rubyid_publish_routing_info'>publish_routing_info</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_port_interfaces'>port_interfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pi'>pi</span><span class='op'>|</span>
        <span class='id identifier rubyid_pi'>pi</span><span class='period'>.</span><span class='id identifier rubyid_publish_endpoint'>publish_endpoint</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_register_dns'>register_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_register_application'>register_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='comma'>,</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_deregister_dns'>deregister_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_deregister_application'>deregister_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Installs the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to install.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to add component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Performs the post-configuration steps for the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to configure.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to post-configure component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Uninstalls the specified component from the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to uninstall.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for identify methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see Object::respond_to?
</span>  <span class='comment'># @see http://ruby-doc.org/core-1.9.3/Object.html#method-i-respond_to-3F
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>super</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for handle methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see BasicObject::method_missing
</span>  <span class='comment'># @see http://www.ruby-doc.org/core-1.9.3/BasicObject.html
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sym'>sym</span> <span class='op'>=</span> <span class='symbol'>:reload</span> <span class='kw'>if</span> <span class='id identifier rubyid_sym'>sym</span> <span class='op'>==</span> <span class='symbol'>:reload_config</span>
    <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_new_args'>new_args</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public hostname for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public hostname of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_hostname'>get_public_hostname</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public IP address for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public IP address of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
  <span class='kw'>end</span>

  <span class='comment'># Given a set of gears, retrieve the state of the gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># gears::
</span>  <span class='comment'>#   Array of {Gear}s to retrieve state for.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># Hash of Gear._id =&gt; state representing the state of each gear
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_gear_states'>get_gear_states</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_handle'>handle</span> <span class='op'>=</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_create_parallel_job'>create_parallel_job</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_run_parallel_on_gears'>run_parallel_on_gears</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='comma'>,</span> <span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span>
        <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_show_state_job'>get_show_state_job</span><span class='lparen'>(</span><span class='id identifier rubyid_gear'>gear</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_get_parallel_run_results'>get_parallel_run_results</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>!=</span> <span class='int'>0</span>
        <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error getting application state from gear: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gear'>gear</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; with status: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; and output: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output'>output</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span>
  <span class='kw'>end</span>

  <span class='comment'># Retrieves the instance of {OpenShift::ApplicationContainerProxy} that backs this gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># {OpenShift::ApplicationContainerProxy}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='ivar'>@container</span> <span class='kw'>and</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='op'>!=</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> 
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    

    <span class='kw'>return</span> <span class='ivar'>@container</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_configuration'>update_configuration</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_keys'>add_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_keys_attrs'>add_keys_attrs</span>
    <span class='id identifier rubyid_remove_keys'>remove_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_keys_attrs'>remove_keys_attrs</span>
    <span class='id identifier rubyid_add_envs'>add_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_env_vars'>add_env_vars</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_env_vars'>remove_env_vars</span>

    <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_add_authorized_ssh_key_job'>get_add_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>      
    <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_remove_authorized_ssh_key_job'>get_remove_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

    <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_add_job'>get_env_var_add_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_remove_job'>get_env_var_remove_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>end</span>

  <span class='comment'># Convenience method to get the {Application}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='ivar'>@app</span> <span class='op'>||=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_set_addtl_fs_gb'>set_addtl_fs_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addtl-fs-gb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_file_limit'>base_file_limit</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>=</span> <span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span> <span class='op'>+</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='id identifier rubyid_total_file_limit'>total_file_limit</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>*</span> <span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_update_gear_quota_job'>get_update_gear_quota_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_total_file_limit'>total_file_limit</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_server_identities'>server_identities</span>
    <span class='id identifier rubyid_identities'>identities</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_identities'>identities</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
    <span class='id identifier rubyid_identities'>identities</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='rparen'>)</span>

      <span class='comment'># the gear needs to be reloaded to find the updated index as well as to return the updated document
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>uuid:</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_gear'>current_gear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="name-instance_method">
  
    - (<tt>String</tt>) <strong>name</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>Will be removed once typeless gears is completed</p>
</div></div>

<p>Name of the gear</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>name of the gear</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 11</span>

<span class='kw'>class</span> <span class='const'>Gear</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:group_instance</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>GroupInstance</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:server_identity</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uuid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:quarantined</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:host_singletons</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:app_dns</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:sparse_carts</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_embeds_many'>embeds_many</span> <span class='symbol'>:port_interfaces</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PortInterface</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

  <span class='comment'># Initializes the gear
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:custom_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:custom_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:group_instance</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:group_instance</span><span class='rparen'>)</span>

    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='op'>=</span> <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_custom_id'>custom_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_app_dns'>app_dns</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_blocks</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_blocks'>get_quota_blocks</span><span class='rparen'>)</span>
      <span class='comment'># calculate the minimum storage in GB - blocks are 1KB each
</span>      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>/</span> <span class='int'>1024</span> <span class='op'>/</span> <span class='int'>1024</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_files</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_files'>get_quota_files</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_gear_sizes_display_string'>gear_sizes_display_string</span>
    <span class='comment'># Ex: (small(default)|medium|large)
</span>    <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='id identifier rubyid_gear_size'>gear_size</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(default)</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>==</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:default_gear_size</span><span class='rbracket'>]</span> 
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> 
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_gear_size?'>valid_gear_size?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reserve_uid'>reserve_uid</span>
    <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_available'>find_available</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_server_identities'>server_identities</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_reserve_uid'>reserve_uid</span>

    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to unset UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create_gear'>create_gear</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_destroy_gear'>destroy_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>
 
  <span class='kw'>def</span> <span class='id identifier rubyid_publish_routing_info'>publish_routing_info</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_port_interfaces'>port_interfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pi'>pi</span><span class='op'>|</span>
        <span class='id identifier rubyid_pi'>pi</span><span class='period'>.</span><span class='id identifier rubyid_publish_endpoint'>publish_endpoint</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_register_dns'>register_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_register_application'>register_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='comma'>,</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_deregister_dns'>deregister_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_deregister_application'>deregister_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Installs the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to install.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to add component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Performs the post-configuration steps for the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to configure.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to post-configure component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Uninstalls the specified component from the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to uninstall.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for identify methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see Object::respond_to?
</span>  <span class='comment'># @see http://ruby-doc.org/core-1.9.3/Object.html#method-i-respond_to-3F
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>super</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for handle methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see BasicObject::method_missing
</span>  <span class='comment'># @see http://www.ruby-doc.org/core-1.9.3/BasicObject.html
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sym'>sym</span> <span class='op'>=</span> <span class='symbol'>:reload</span> <span class='kw'>if</span> <span class='id identifier rubyid_sym'>sym</span> <span class='op'>==</span> <span class='symbol'>:reload_config</span>
    <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_new_args'>new_args</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public hostname for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public hostname of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_hostname'>get_public_hostname</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public IP address for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public IP address of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
  <span class='kw'>end</span>

  <span class='comment'># Given a set of gears, retrieve the state of the gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># gears::
</span>  <span class='comment'>#   Array of {Gear}s to retrieve state for.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># Hash of Gear._id =&gt; state representing the state of each gear
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_gear_states'>get_gear_states</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_handle'>handle</span> <span class='op'>=</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_create_parallel_job'>create_parallel_job</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_run_parallel_on_gears'>run_parallel_on_gears</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='comma'>,</span> <span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span>
        <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_show_state_job'>get_show_state_job</span><span class='lparen'>(</span><span class='id identifier rubyid_gear'>gear</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_get_parallel_run_results'>get_parallel_run_results</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>!=</span> <span class='int'>0</span>
        <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error getting application state from gear: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gear'>gear</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; with status: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; and output: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output'>output</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span>
  <span class='kw'>end</span>

  <span class='comment'># Retrieves the instance of {OpenShift::ApplicationContainerProxy} that backs this gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># {OpenShift::ApplicationContainerProxy}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='ivar'>@container</span> <span class='kw'>and</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='op'>!=</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> 
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    

    <span class='kw'>return</span> <span class='ivar'>@container</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_configuration'>update_configuration</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_keys'>add_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_keys_attrs'>add_keys_attrs</span>
    <span class='id identifier rubyid_remove_keys'>remove_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_keys_attrs'>remove_keys_attrs</span>
    <span class='id identifier rubyid_add_envs'>add_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_env_vars'>add_env_vars</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_env_vars'>remove_env_vars</span>

    <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_add_authorized_ssh_key_job'>get_add_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>      
    <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_remove_authorized_ssh_key_job'>get_remove_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

    <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_add_job'>get_env_var_add_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_remove_job'>get_env_var_remove_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>end</span>

  <span class='comment'># Convenience method to get the {Application}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='ivar'>@app</span> <span class='op'>||=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_set_addtl_fs_gb'>set_addtl_fs_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addtl-fs-gb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_file_limit'>base_file_limit</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>=</span> <span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span> <span class='op'>+</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='id identifier rubyid_total_file_limit'>total_file_limit</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>*</span> <span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_update_gear_quota_job'>get_update_gear_quota_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_total_file_limit'>total_file_limit</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_server_identities'>server_identities</span>
    <span class='id identifier rubyid_identities'>identities</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_identities'>identities</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
    <span class='id identifier rubyid_identities'>identities</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='rparen'>)</span>

      <span class='comment'># the gear needs to be reloaded to find the updated index as well as to return the updated document
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>uuid:</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_gear'>current_gear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="server_identity-instance_method">
  
    - (<tt>String</tt>) <strong>server_identity</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>DNS name of the node the gear is hosted on.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>DNS name of the node the gear is hosted on.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 11</span>

<span class='kw'>class</span> <span class='const'>Gear</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:group_instance</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>GroupInstance</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:server_identity</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uuid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:quarantined</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:host_singletons</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:app_dns</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:sparse_carts</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_embeds_many'>embeds_many</span> <span class='symbol'>:port_interfaces</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PortInterface</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

  <span class='comment'># Initializes the gear
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:custom_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:custom_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:group_instance</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:group_instance</span><span class='rparen'>)</span>

    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='op'>=</span> <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_custom_id'>custom_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_app_dns'>app_dns</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_blocks</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_blocks'>get_quota_blocks</span><span class='rparen'>)</span>
      <span class='comment'># calculate the minimum storage in GB - blocks are 1KB each
</span>      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>/</span> <span class='int'>1024</span> <span class='op'>/</span> <span class='int'>1024</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_files</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_files'>get_quota_files</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_gear_sizes_display_string'>gear_sizes_display_string</span>
    <span class='comment'># Ex: (small(default)|medium|large)
</span>    <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='id identifier rubyid_gear_size'>gear_size</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(default)</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>==</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:default_gear_size</span><span class='rbracket'>]</span> 
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> 
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_gear_size?'>valid_gear_size?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reserve_uid'>reserve_uid</span>
    <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_available'>find_available</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_server_identities'>server_identities</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_reserve_uid'>reserve_uid</span>

    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to unset UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create_gear'>create_gear</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_destroy_gear'>destroy_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>
 
  <span class='kw'>def</span> <span class='id identifier rubyid_publish_routing_info'>publish_routing_info</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_port_interfaces'>port_interfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pi'>pi</span><span class='op'>|</span>
        <span class='id identifier rubyid_pi'>pi</span><span class='period'>.</span><span class='id identifier rubyid_publish_endpoint'>publish_endpoint</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_register_dns'>register_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_register_application'>register_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='comma'>,</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_deregister_dns'>deregister_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_deregister_application'>deregister_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Installs the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to install.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to add component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Performs the post-configuration steps for the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to configure.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to post-configure component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Uninstalls the specified component from the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to uninstall.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for identify methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see Object::respond_to?
</span>  <span class='comment'># @see http://ruby-doc.org/core-1.9.3/Object.html#method-i-respond_to-3F
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>super</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for handle methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see BasicObject::method_missing
</span>  <span class='comment'># @see http://www.ruby-doc.org/core-1.9.3/BasicObject.html
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sym'>sym</span> <span class='op'>=</span> <span class='symbol'>:reload</span> <span class='kw'>if</span> <span class='id identifier rubyid_sym'>sym</span> <span class='op'>==</span> <span class='symbol'>:reload_config</span>
    <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_new_args'>new_args</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public hostname for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public hostname of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_hostname'>get_public_hostname</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public IP address for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public IP address of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
  <span class='kw'>end</span>

  <span class='comment'># Given a set of gears, retrieve the state of the gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># gears::
</span>  <span class='comment'>#   Array of {Gear}s to retrieve state for.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># Hash of Gear._id =&gt; state representing the state of each gear
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_gear_states'>get_gear_states</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_handle'>handle</span> <span class='op'>=</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_create_parallel_job'>create_parallel_job</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_run_parallel_on_gears'>run_parallel_on_gears</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='comma'>,</span> <span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span>
        <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_show_state_job'>get_show_state_job</span><span class='lparen'>(</span><span class='id identifier rubyid_gear'>gear</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_get_parallel_run_results'>get_parallel_run_results</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>!=</span> <span class='int'>0</span>
        <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error getting application state from gear: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gear'>gear</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; with status: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; and output: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output'>output</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span>
  <span class='kw'>end</span>

  <span class='comment'># Retrieves the instance of {OpenShift::ApplicationContainerProxy} that backs this gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># {OpenShift::ApplicationContainerProxy}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='ivar'>@container</span> <span class='kw'>and</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='op'>!=</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> 
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    

    <span class='kw'>return</span> <span class='ivar'>@container</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_configuration'>update_configuration</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_keys'>add_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_keys_attrs'>add_keys_attrs</span>
    <span class='id identifier rubyid_remove_keys'>remove_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_keys_attrs'>remove_keys_attrs</span>
    <span class='id identifier rubyid_add_envs'>add_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_env_vars'>add_env_vars</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_env_vars'>remove_env_vars</span>

    <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_add_authorized_ssh_key_job'>get_add_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>      
    <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_remove_authorized_ssh_key_job'>get_remove_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

    <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_add_job'>get_env_var_add_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_remove_job'>get_env_var_remove_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>end</span>

  <span class='comment'># Convenience method to get the {Application}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='ivar'>@app</span> <span class='op'>||=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_set_addtl_fs_gb'>set_addtl_fs_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addtl-fs-gb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_file_limit'>base_file_limit</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>=</span> <span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span> <span class='op'>+</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='id identifier rubyid_total_file_limit'>total_file_limit</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>*</span> <span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_update_gear_quota_job'>get_update_gear_quota_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_total_file_limit'>total_file_limit</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_server_identities'>server_identities</span>
    <span class='id identifier rubyid_identities'>identities</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_identities'>identities</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
    <span class='id identifier rubyid_identities'>identities</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='rparen'>)</span>

      <span class='comment'># the gear needs to be reloaded to find the updated index as well as to return the updated document
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>uuid:</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_gear'>current_gear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="uid-instance_method">
  
    - (<tt>Integer</tt>) <strong>uid</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>UID of the user on the node.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>UID of the user on the node.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 11</span>

<span class='kw'>class</span> <span class='const'>Gear</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Mongoid</span><span class='op'>::</span><span class='const'>Document</span>
  <span class='id identifier rubyid_embedded_in'>embedded_in</span> <span class='symbol'>:group_instance</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>GroupInstance</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:server_identity</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uuid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:uid</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:quarantined</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:host_singletons</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:app_dns</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_field'>field</span> <span class='symbol'>:sparse_carts</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_embeds_many'>embeds_many</span> <span class='symbol'>:port_interfaces</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>PortInterface</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

  <span class='comment'># Initializes the gear
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:custom_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:custom_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_group_instance'>group_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:group_instance</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:group_instance</span><span class='rparen'>)</span>

    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='op'>=</span> <span class='id identifier rubyid_custom_id'>custom_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_custom_id'>custom_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_app_dns'>app_dns</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_blocks</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_blocks'>get_quota_blocks</span><span class='rparen'>)</span>
      <span class='comment'># calculate the minimum storage in GB - blocks are 1KB each
</span>      <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>/</span> <span class='int'>1024</span> <span class='op'>/</span> <span class='int'>1024</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_files</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_files'>get_quota_files</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_quota_files'>quota_files</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_gear_sizes_display_string'>gear_sizes_display_string</span>
    <span class='comment'># Ex: (small(default)|medium|large)
</span>    <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='id identifier rubyid_gear_size'>gear_size</span>
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(default)</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>==</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:default_gear_size</span><span class='rbracket'>]</span> 
      <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> 
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_gear_size?'>valid_gear_size?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reserve_uid'>reserve_uid</span>
    <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_available'>find_available</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_server_identities'>server_identities</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_reserve_uid'>reserve_uid</span>

    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    
    <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to unset UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
      <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create_gear'>create_gear</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_destroy_gear'>destroy_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>
 
  <span class='kw'>def</span> <span class='id identifier rubyid_publish_routing_info'>publish_routing_info</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_port_interfaces'>port_interfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pi'>pi</span><span class='op'>|</span>
        <span class='id identifier rubyid_pi'>pi</span><span class='period'>.</span><span class='id identifier rubyid_publish_endpoint'>publish_endpoint</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_register_dns'>register_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_register_application'>register_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='comma'>,</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_deregister_dns'>deregister_dns</span>
    <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_deregister_application'>deregister_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
    <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Installs the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to install.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to add component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Performs the post-configuration steps for the specified component on the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to configure.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to post-configure component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Uninstalls the specified component from the gear.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># component::
</span>  <span class='comment'>#   {ComponentInstance} to uninstall.
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># A {ResultIO} object with with output or error messages from the Node.
</span>  <span class='comment'># Exit codes:
</span>  <span class='comment'>#   success = 0
</span>  <span class='comment'># @raise [OpenShift::NodeException] on failure
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
    <span class='id identifier rubyid_result_io'>result_io</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for identify methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see Object::respond_to?
</span>  <span class='comment'># @see http://ruby-doc.org/core-1.9.3/Object.html#method-i-respond_to-3F
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>super</span>
  <span class='kw'>end</span>

  <span class='comment'># Used for handle methods like start/stop etc. which can be handled transparently by an {OpenShift::ApplicationContainerProxy}
</span>  <span class='comment'># @see BasicObject::method_missing
</span>  <span class='comment'># @see http://www.ruby-doc.org/core-1.9.3/BasicObject.html
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sym'>sym</span> <span class='op'>=</span> <span class='symbol'>:reload</span> <span class='kw'>if</span> <span class='id identifier rubyid_sym'>sym</span> <span class='op'>==</span> <span class='symbol'>:reload_config</span>
    <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_new_args'>new_args</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public hostname for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public hostname of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_hostname'>get_public_hostname</span>
  <span class='kw'>end</span>

  <span class='comment'># Gets the public IP address for the Node this gear is hosted on
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># @return [String] Public IP address of the node the gear is hosted on.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
    <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
  <span class='kw'>end</span>

  <span class='comment'># Given a set of gears, retrieve the state of the gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Parameters:
</span>  <span class='comment'># gears::
</span>  <span class='comment'>#   Array of {Gear}s to retrieve state for.
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># Hash of Gear._id =&gt; state representing the state of each gear
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_gear_states'>get_gear_states</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_handle'>handle</span> <span class='op'>=</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_create_parallel_job'>create_parallel_job</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_run_parallel_on_gears'>run_parallel_on_gears</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='comma'>,</span> <span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span>
        <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_show_state_job'>get_show_state_job</span><span class='lparen'>(</span><span class='id identifier rubyid_gear'>gear</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_get_parallel_run_results'>get_parallel_run_results</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>!=</span> <span class='int'>0</span>
        <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error getting application state from gear: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gear'>gear</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; with status: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; and output: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output'>output</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_gear_states'>gear_states</span>
  <span class='kw'>end</span>

  <span class='comment'># Retrieves the instance of {OpenShift::ApplicationContainerProxy} that backs this gear
</span>  <span class='comment'>#
</span>  <span class='comment'># == Returns:
</span>  <span class='comment'># {OpenShift::ApplicationContainerProxy}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
    <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='ivar'>@container</span> <span class='kw'>and</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='op'>!=</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> 
      <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
    <span class='kw'>end</span>    

    <span class='kw'>return</span> <span class='ivar'>@container</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_configuration'>update_configuration</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_add_keys'>add_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_keys_attrs'>add_keys_attrs</span>
    <span class='id identifier rubyid_remove_keys'>remove_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_keys_attrs'>remove_keys_attrs</span>
    <span class='id identifier rubyid_add_envs'>add_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_env_vars'>add_env_vars</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_env_vars'>remove_env_vars</span>

    <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_add_authorized_ssh_key_job'>get_add_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>      
    <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_remove_authorized_ssh_key_job'>get_remove_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

    <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_add_job'>get_env_var_add_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_remove_job'>get_env_var_remove_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>end</span>

  <span class='comment'># Convenience method to get the {Application}
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='ivar'>@app</span> <span class='op'>||=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_set_addtl_fs_gb'>set_addtl_fs_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addtl-fs-gb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base_file_limit'>base_file_limit</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>=</span> <span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span> <span class='op'>+</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='id identifier rubyid_total_file_limit'>total_file_limit</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>*</span> <span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
    <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_update_gear_quota_job'>get_update_gear_quota_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_total_file_limit'>total_file_limit</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_server_identities'>server_identities</span>
    <span class='id identifier rubyid_identities'>identities</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_identities'>identities</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
    <span class='id identifier rubyid_identities'>identities</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span>
    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

    <span class='comment'># find the index and do an atomic update
</span>    <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='rparen'>)</span>

      <span class='comment'># the gear needs to be reloaded to find the updated index as well as to return the updated document
</span>      <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>uuid:</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># log the details in case we cannot update the pending_op
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_current_gear'>current_gear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="base_file_limit-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>base_file_limit</strong>(gear_size) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 50</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_files</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_quota_files'>quota_files</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_files'>get_quota_files</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_quota_files'>quota_files</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="base_filesystem_gb-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>base_filesystem_gb</strong>(gear_size) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45
46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 41</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='const'>CacheHelper</span><span class='period'>.</span><span class='id identifier rubyid_get_cached'>get_cached</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_quota_blocks</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_one'>find_one</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_quota_blocks'>get_quota_blocks</span><span class='rparen'>)</span>
    <span class='comment'># calculate the minimum storage in GB - blocks are 1KB each
</span>    <span class='id identifier rubyid_quota_blocks'>quota_blocks</span> <span class='op'>/</span> <span class='int'>1024</span> <span class='op'>/</span> <span class='int'>1024</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gear_sizes_display_string-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>gear_sizes_display_string</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 58</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_gear_sizes_display_string'>gear_sizes_display_string</span>
  <span class='comment'># Ex: (small(default)|medium|large)
</span>  <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='id identifier rubyid_gear_size'>gear_size</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(default)</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_gear_size'>gear_size</span> <span class='op'>==</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:default_gear_size</span><span class='rbracket'>]</span> 
    <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>==</span> <span class='lparen'>(</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span> 
  <span class='kw'>end</span>
  <span class='id identifier rubyid_out'>out</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>)</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_gear_states-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_gear_states</strong>(gears) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a set of gears, retrieve the state of the gear</p>

<h2 id="label-Parameters%3A">Parameters:<span><a href="#label-Parameters%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<dl class="rdoc-list note-list"><dt>gears
<dd>
<p>Array of <span class='object_link'><a href="" title="Gear (class)">Gear</a></span>s to retrieve state for.</p>
</dd></dl>

<h2 id="label-Returns%3A">Returns:<span><a href="#label-Returns%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Hash of Gear._id =&gt; state representing the state of each gear</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 236</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_gear_states'>get_gear_states</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_gear_states'>gear_states</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_handle'>handle</span> <span class='op'>=</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_create_parallel_job'>create_parallel_job</span>
  <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_run_parallel_on_gears'>run_parallel_on_gears</span><span class='lparen'>(</span><span class='id identifier rubyid_gears'>gears</span><span class='comma'>,</span> <span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span>
      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_handle'>exec_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_show_state_job'>get_show_state_job</span><span class='lparen'>(</span><span class='id identifier rubyid_gear'>gear</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_get_parallel_run_results'>get_parallel_run_results</span><span class='lparen'>(</span><span class='id identifier rubyid_handle'>handle</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='id identifier rubyid_gear'>gear</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error getting application state from gear: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gear'>gear</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; with status: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; and output: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_output'>output</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unknown</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_gear_states'>gear_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_gear'>gear</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_gear_states'>gear_states</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_gear_size?-class_method">
  
    + (<tt>Boolean</tt>) <strong>valid_gear_size?</strong>(gear_size) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 69</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_gear_size?'>valid_gear_size?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_openshift'>openshift</span><span class='lbracket'>[</span><span class='symbol'>:gear_sizes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_component-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>add_component</strong>(component, init_git_url = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Installs the specified component on the gear.</p>

<h2 id="label-Parameters%3A">Parameters:<span><a href="#label-Parameters%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<dl class="rdoc-list note-list"><dt>component
<dd>
<p><span class='object_link'><a href="ComponentInstance.html" title="ComponentInstance (class)">ComponentInstance</a></span> to install.</p>
</dd></dl>

<h2 id="label-Returns%3A">Returns:<span><a href="#label-Returns%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>A <span class='object_link'><a href="ResultIO.html" title="ResultIO (class)">ResultIO</a></span> object with with output or error messages from the Node. Exit
codes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='int'>0</span></code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="OpenShift/NodeException.html" title="OpenShift::NodeException (class)">OpenShift::NodeException</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>on failure</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


153
154
155
156
157
158
159
160</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 153</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_add_component'>add_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to add component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
  <span class='id identifier rubyid_result_io'>result_io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="app-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>app</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Convenience method to get the <span class='object_link'><a href="Application.html" title="Application (class)">Application</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


286
287
288</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 286</span>

<span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
  <span class='ivar'>@app</span> <span class='op'>||=</span> <span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_gear-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>create_gear</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_gear'>create_gear</span>
  <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_io'>result_io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="deregister_dns-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>deregister_dns</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deregister_dns'>deregister_dns</span>
  <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_deregister_application'>deregister_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy_gear-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>destroy_gear</strong>(keep_uid = false) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 107</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_gear'>destroy_gear</span><span class='lparen'>(</span><span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_uid'>keep_uid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_io'>result_io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_proxy-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_proxy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the instance of <span class='object_link'><a href="OpenShift/ApplicationContainerProxy.html" title="OpenShift::ApplicationContainerProxy (class)">OpenShift::ApplicationContainerProxy</a></span> that backs
this gear</p>

<h2 id="label-Returns%3A">Returns:<span><a href="#label-Returns%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p><span class='object_link'><a href="OpenShift/ApplicationContainerProxy.html" title="OpenShift::ApplicationContainerProxy (class)">OpenShift::ApplicationContainerProxy</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


262
263
264
265
266
267
268
269
270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 262</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
  <span class='kw'>if</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>and</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='ivar'>@container</span> <span class='kw'>and</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='op'>!=</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> 
    <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rparen'>)</span>
  <span class='kw'>end</span>    

  <span class='kw'>return</span> <span class='ivar'>@container</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_public_ip_address-instance_method">
  
    - (<tt>String</tt>) <strong>get_public_ip_address</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the public IP address for the Node this gear is hosted on</p>

<h2 id="label-Returns%3A">Returns:<span><a href="#label-Returns%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Public IP address of the node the gear is hosted on.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225
226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 224</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
  <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_ip_address'>get_public_ip_address</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_configure_component-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>post_configure_component</strong>(component, init_git_url = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Performs the post-configuration steps for the specified component on the
gear.</p>

<h2 id="label-Parameters%3A">Parameters:<span><a href="#label-Parameters%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<dl class="rdoc-list note-list"><dt>component
<dd>
<p><span class='object_link'><a href="ComponentInstance.html" title="ComponentInstance (class)">ComponentInstance</a></span> to configure.</p>
</dd></dl>

<h2 id="label-Returns%3A">Returns:<span><a href="#label-Returns%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>A <span class='object_link'><a href="ResultIO.html" title="ResultIO (class)">ResultIO</a></span> object with with output or error messages from the Node. Exit
codes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='int'>0</span></code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="OpenShift/NodeException.html" title="OpenShift::NodeException (class)">OpenShift::NodeException</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>on failure</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_post_configure_component'>post_configure_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_init_git_url'>init_git_url</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_process_properties'>process_properties</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>NodeException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to post-configure component </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_cartridge_name'>cartridge_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_component_name'>component_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span><span class='comma'>,</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result_io'>result_io</span><span class='period'>.</span><span class='id identifier rubyid_exitcode'>exitcode</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_result_io'>result_io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="public_hostname-instance_method">
  
    - (<tt>String</tt>) <strong>public_hostname</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the public hostname for the Node this gear is hosted on</p>

<h2 id="label-Returns%3A">Returns:<span><a href="#label-Returns%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Public hostname of the node the gear is hosted on.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


217
218
219</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 217</span>

<span class='kw'>def</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span>
  <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_public_hostname'>get_public_hostname</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="publish_routing_info-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>publish_routing_info</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 113</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publish_routing_info'>publish_routing_info</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_port_interfaces'>port_interfaces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pi'>pi</span><span class='op'>|</span>
      <span class='id identifier rubyid_pi'>pi</span><span class='period'>.</span><span class='id identifier rubyid_publish_endpoint'>publish_endpoint</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_dns-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>register_dns</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register_dns'>register_dns</span>
  <span class='id identifier rubyid_dns'>dns</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>DnsService</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_register_application'>register_application</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='comma'>,</span> <span class='id identifier rubyid_public_hostname'>public_hostname</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_dns'>dns</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_component-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>remove_component</strong>(component) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Uninstalls the specified component from the gear.</p>

<h2 id="label-Parameters%3A">Parameters:<span><a href="#label-Parameters%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<dl class="rdoc-list note-list"><dt>component
<dd>
<p><span class='object_link'><a href="ComponentInstance.html" title="ComponentInstance (class)">ComponentInstance</a></span> to uninstall.</p>
</dd></dl>

<h2 id="label-Returns%3A">Returns:<span><a href="#label-Returns%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>A <span class='object_link'><a href="ResultIO.html" title="ResultIO (class)">ResultIO</a></span> object with with output or error messages from the Node. Exit
codes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='int'>0</span></code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="OpenShift/NodeException.html" title="OpenShift::NodeException (class)">OpenShift::NodeException</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>on failure</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 190</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_io'>result_io</span> <span class='op'>=</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_remove_component'>remove_component</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_process_commands'>process_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_result_io'>result_io</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sparse_carts'>sparse_carts</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span><span class='period'>.</span><span class='id identifier rubyid_is_sparse?'>is_sparse?</span>
  <span class='id identifier rubyid_result_io'>result_io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reserve_uid-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>reserve_uid</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reserve_uid'>reserve_uid</span>
  <span class='ivar'>@container</span> <span class='op'>=</span> <span class='const'>OpenShift</span><span class='op'>::</span><span class='const'>ApplicationContainerProxy</span><span class='period'>.</span><span class='id identifier rubyid_find_available'>find_available</span><span class='lparen'>(</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_server_identities'>server_identities</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span> <span class='op'>=</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_reserve_uid'>reserve_uid</span>

  <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  
  <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
    <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_reserved_gear_uid'>reserved_gear_uid</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="respond_to?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>respond_to?</strong>(sym, include_private = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Used for identify methods like start/stop etc. which can be handled
transparently by an <span class='object_link'><a href="OpenShift/ApplicationContainerProxy.html" title="OpenShift::ApplicationContainerProxy (class)">OpenShift::ApplicationContainerProxy</a></span></p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Object::respond_to?</li>
    
      <li><a href="http://ruby-doc.org/core-1.9.3/Object.html#method-i-respond_to-3F" target="_parent" title="http://ruby-doc.org/core-1.9.3/Object.html#method-i-respond_to-3F">http://ruby-doc.org/core-1.9.3/Object.html#method-i-respond_to-3F</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 200</span>

<span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_include_private'>include_private</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>super</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="server_identities-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>server_identities</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


298
299
300
301
302</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 298</span>

<span class='kw'>def</span> <span class='id identifier rubyid_server_identities'>server_identities</span>
  <span class='id identifier rubyid_identities'>identities</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_gear'>gear</span><span class='op'>|</span> <span class='id identifier rubyid_gear'>gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_identities'>identities</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
  <span class='id identifier rubyid_identities'>identities</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_addtl_fs_gb-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_addtl_fs_gb</strong>(additional_filesystem_gb, remote_job_handle, tag = &quot;addtl-fs-gb&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


290
291
292
293
294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 290</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_addtl_fs_gb'>set_addtl_fs_gb</span><span class='lparen'>(</span><span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addtl-fs-gb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base_file_limit'>base_file_limit</span> <span class='op'>=</span> <span class='const'>Gear</span><span class='period'>.</span><span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_gear_size'>gear_size</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>=</span> <span class='id identifier rubyid_additional_filesystem_gb'>additional_filesystem_gb</span> <span class='op'>+</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
  <span class='id identifier rubyid_total_file_limit'>total_file_limit</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span> <span class='op'>*</span> <span class='id identifier rubyid_base_file_limit'>base_file_limit</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_base_filesystem_gb'>base_filesystem_gb</span>
  <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_update_gear_quota_job'>get_update_gear_quota_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_total_fs_gb'>total_fs_gb</span><span class='comma'>,</span> <span class='id identifier rubyid_total_file_limit'>total_file_limit</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="status-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>status</strong>(component_instance) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 139</span>

<span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
  <span class='ivar'>@container</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_component_instance'>component_instance</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unreserve_uid-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>unreserve_uid</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 88</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span>
  <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_unreserve_uid'>unreserve_uid</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span>
  
  <span class='id identifier rubyid_failure_message'>failure_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to unset UID and server_identity for gear </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='embexpr_end'>}</span><span class='tstring_content'> for application </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_updated_gear'>updated_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='op'>|</span>
    <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>._id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uuid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.uid</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_instances.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gears.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_g_index'>g_index</span><span class='embexpr_end'>}</span><span class='tstring_content'>.server_identity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># set the server_identity and uid attributes in the gear object in mongoid memory for access by the caller
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_server_identity'>server_identity</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_gear'>updated_gear</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_configuration-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>update_configuration</strong>(op, remote_job_handle, tag = &quot;&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274
275
276
277
278
279
280
281
282
283</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 272</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_configuration'>update_configuration</span><span class='lparen'>(</span><span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_keys'>add_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_keys_attrs'>add_keys_attrs</span>
  <span class='id identifier rubyid_remove_keys'>remove_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_keys_attrs'>remove_keys_attrs</span>
  <span class='id identifier rubyid_add_envs'>add_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_add_env_vars'>add_env_vars</span>
  <span class='id identifier rubyid_remove_envs'>remove_envs</span> <span class='op'>=</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_remove_env_vars'>remove_env_vars</span>

  <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_add_authorized_ssh_key_job'>get_add_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_keys'>add_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>      
  <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='op'>|</span> <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_remove_authorized_ssh_key_job'>get_remove_authorized_ssh_key_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ssh_key'>ssh_key</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_keys'>remove_keys</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>     <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_add_job'>get_env_var_add_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_envs'>add_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_env'>env</span><span class='op'>|</span>      <span class='const'>RemoteJob</span><span class='period'>.</span><span class='id identifier rubyid_add_parallel_job'>add_parallel_job</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_job_handle'>remote_job_handle</span><span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_get_proxy'>get_proxy</span><span class='period'>.</span><span class='id identifier rubyid_get_env_var_remove_job'>get_env_var_remove_job</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>key</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_remove_envs'>remove_envs</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_with_retries-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>update_with_retries</strong>(num_retries, failure_message, &amp;block) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/fedora/origin-server/controller/app/models/gear.rb', line 304</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_with_retries'>update_with_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_num_retries'>num_retries</span><span class='comma'>,</span> <span class='id identifier rubyid_failure_message'>failure_message</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span>
  <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_group_instance'>group_instance</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span>

  <span class='comment'># find the index and do an atomic update
</span>  <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_retries'>num_retries</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_current_app'>current_app</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='comma'>,</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='comma'>,</span> <span class='id identifier rubyid_gi_index'>gi_index</span><span class='comma'>,</span> <span class='id identifier rubyid_g_index'>g_index</span><span class='rparen'>)</span>

    <span class='comment'># the gear needs to be reloaded to find the updated index as well as to return the updated document
</span>    <span class='id identifier rubyid_current_app'>current_app</span> <span class='op'>=</span> <span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_current_gi'>current_gi</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>_id:</span> <span class='id identifier rubyid_current_gi'>current_gi</span><span class='period'>.</span><span class='id identifier rubyid__id'>_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_gi_index'>gi_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gi'>current_gi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_current_gear'>current_gear</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>uuid:</span> <span class='id identifier rubyid_current_gear'>current_gear</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_g_index'>g_index</span> <span class='op'>=</span> <span class='id identifier rubyid_current_app'>current_app</span><span class='period'>.</span><span class='id identifier rubyid_group_instances'>group_instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_gi_index'>gi_index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gears'>gears</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_current_gear'>current_gear</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updatedExisting</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_success'>success</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># log the details in case we cannot update the pending_op
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_success'>success</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='id identifier rubyid_failure_message'>failure_message</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='kw'>return</span> <span class='id identifier rubyid_current_gear'>current_gear</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Sep 18 16:40:14 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>